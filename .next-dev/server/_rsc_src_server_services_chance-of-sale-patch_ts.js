"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "_rsc_src_server_services_chance-of-sale-patch_ts";
exports.ids = ["_rsc_src_server_services_chance-of-sale-patch_ts"];
exports.modules = {

/***/ "(rsc)/./src/server/services/chance-of-sale-patch.ts":
/*!*****************************************************!*\
  !*** ./src/server/services/chance-of-sale-patch.ts ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   applyCosPatch: () => (/* binding */ applyCosPatch),\n/* harmony export */   generateCosPatchFromModel: () => (/* binding */ generateCosPatchFromModel)\n/* harmony export */ });\n/* harmony import */ var _server_repositories_reports_v3_tabs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/server/repositories/reports-v3-tabs */ \"(rsc)/./src/server/repositories/reports-v3-tabs.ts\");\n/* harmony import */ var _server_repositories_sessions__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/server/repositories/sessions */ \"(rsc)/./src/server/repositories/sessions.ts\");\n/* harmony import */ var _server_repositories_transcripts__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/server/repositories/transcripts */ \"(rsc)/./src/server/repositories/transcripts.ts\");\n/* harmony import */ var _server_services_markdown_indexer__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/server/services/markdown-indexer */ \"(rsc)/./src/server/services/markdown-indexer.ts\");\n/* harmony import */ var _server_services_openrouter__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/server/services/openrouter */ \"(rsc)/./src/server/services/openrouter.ts\");\n\n\n\n\n\nconst COS_TAB_START = '<!-- TAB: CHANCE OF SALE -->';\nconst COS_TAB_END = '<!-- /TAB: CHANCE OF SALE -->';\nfunction ensureTabEnvelope(cosContent) {\n    const body = cosContent.trim();\n    if (body.includes(COS_TAB_START) && body.includes(COS_TAB_END)) return body;\n    return [\n        COS_TAB_START,\n        body,\n        COS_TAB_END\n    ].join('\\n');\n}\nfunction sectionStart(id) {\n    return `<!-- SECTION: ${id} -->`;\n}\nfunction sectionEnd(id) {\n    return `<!-- /SECTION: ${id} -->`;\n}\nconst SECTION_ORDER = [\n    'COS/DEAL_HEALTH',\n    'COS/MEDDICC',\n    'COS/BANT',\n    'COS/DEAL_SCORE',\n    'COS/PROBABILITY',\n    'COS/BOOSTERS_BLOCKERS',\n    'COS/NEXT_STEPS'\n];\nfunction insertAt(array, index, value) {\n    array.splice(index, 0, value);\n}\nfunction getCosSegment(combinedMarkdown) {\n    if (!combinedMarkdown) return null;\n    const s = combinedMarkdown.indexOf(COS_TAB_START);\n    const e = combinedMarkdown.indexOf(COS_TAB_END);\n    if (s === -1 || e === -1 || e <= s) return null;\n    const endIdx = e + COS_TAB_END.length;\n    return {\n        cos: combinedMarkdown.slice(s, endIdx),\n        start: s,\n        end: endIdx\n    };\n}\nfunction applySingleOpToCos(cosSegment, op) {\n    const lines = cosSegment.split('\\n');\n    const sMarker = sectionStart(op.path);\n    const eMarker = sectionEnd(op.path);\n    let sIdx = -1;\n    let eIdx = -1;\n    for(let i = 0; i < lines.length; i++){\n        if (lines[i].includes(sMarker)) sIdx = i;\n        if (lines[i].includes(eMarker)) {\n            eIdx = i;\n            if (sIdx !== -1) break;\n        }\n    }\n    // Helper: fallback to heading-based replace when markers missing\n    function headingFallbackReplace(contentMd) {\n        // Expect a second-level heading `##` within content; try to find same heading\n        const m = /^\\s*##\\s+(.+)$/m.exec(contentMd);\n        if (!m) return cosSegment // cannot fallback without a heading\n        ;\n        const heading = m[1].trim();\n        const all = cosSegment;\n        const idx = all.indexOf(`## ${heading}`);\n        if (idx === -1) return cosSegment;\n        // replace from heading to next `\\n## ` or TAB_END\n        const after = all.slice(idx);\n        const nextRel = after.indexOf('\\n## ');\n        const nextTab = after.indexOf(COS_TAB_END);\n        let replaceEnd = -1;\n        if (nextRel > 0) replaceEnd = idx + nextRel;\n        else if (nextTab > 0) replaceEnd = idx + nextTab;\n        else replaceEnd = all.length;\n        return all.slice(0, idx) + contentMd + all.slice(replaceEnd);\n    }\n    switch(op.op){\n        case 'remove_section':\n            {\n                if (sIdx !== -1 && eIdx !== -1 && eIdx > sIdx) {\n                    const before = lines.slice(0, sIdx);\n                    const after = lines.slice(eIdx + 1);\n                    return [\n                        ...before,\n                        ...after\n                    ].join('\\n');\n                }\n                // If no markers, nothing to remove\n                return cosSegment;\n            }\n        case 'replace_section':\n            {\n                if (sIdx !== -1 && eIdx !== -1 && eIdx > sIdx) {\n                    const before = lines.slice(0, sIdx + 1) // include start marker\n                    ;\n                    const after = lines.slice(eIdx) // include end marker\n                    ;\n                    const contentLines = op.content_md.replace(/\\r\\n?/g, '\\n').split('\\n');\n                    return [\n                        ...before,\n                        ...contentLines,\n                        ...after\n                    ].join('\\n');\n                }\n                // fallback: heading-based replacement\n                return headingFallbackReplace(op.content_md);\n            }\n        case 'upsert_section':\n            {\n                if (sIdx !== -1 && eIdx !== -1 && eIdx > sIdx) {\n                    // Already present; replace content between markers\n                    const before = lines.slice(0, sIdx + 1);\n                    const after = lines.slice(eIdx);\n                    const contentLines = op.content_md.replace(/\\r\\n?/g, '\\n').split('\\n');\n                    return [\n                        ...before,\n                        ...contentLines,\n                        ...after\n                    ].join('\\n');\n                }\n                // Insert a new section at canonical position (by SECTION_ORDER)\n                const insertionId = op.path;\n                const orderIndex = SECTION_ORDER.indexOf(insertionId);\n                // Find next existing section after desired index to insert before\n                let insertLine = lines.length - 1 // before TAB_END\n                ;\n                for(let i = orderIndex + 1; i < SECTION_ORDER.length; i++){\n                    const nextS = sectionStart(SECTION_ORDER[i]);\n                    const nextIdx = lines.findIndex((l)=>l.includes(nextS));\n                    if (nextIdx !== -1) {\n                        insertLine = nextIdx;\n                        break;\n                    }\n                }\n                const newBlock = [\n                    sMarker,\n                    ...op.content_md.replace(/\\r\\n?/g, '\\n').split('\\n'),\n                    eMarker\n                ];\n                const out = [\n                    ...lines\n                ];\n                insertAt(out, insertLine, newBlock.join('\\n'));\n                return out.join('\\n');\n            }\n    }\n}\nfunction applyPatchOpsToCos(cosSegment, ops) {\n    let out = ensureTabEnvelope(cosSegment);\n    for (const op of ops){\n        out = applySingleOpToCos(out, op);\n    }\n    return out;\n}\nasync function applyCosPatch(supabase, userId, sessionId, ops) {\n    const reportsRepo = new _server_repositories_reports_v3_tabs__WEBPACK_IMPORTED_MODULE_0__.ReportsV3TabsRepository(supabase);\n    const sessionsRepo = new _server_repositories_sessions__WEBPACK_IMPORTED_MODULE_1__.SessionsRepository(supabase);\n    const current = await reportsRepo.findBySessionId(sessionId, userId);\n    const combinedMd = current?.report?.markdown || '';\n    const seg = getCosSegment(combinedMd);\n    const cosOnly = seg?.cos || `${COS_TAB_START}\\n# Chance of Sale\\n\\n${COS_TAB_END}`;\n    const patchedCos = applyPatchOpsToCos(cosOnly, ops);\n    let nextCombined = combinedMd;\n    if (seg) {\n        nextCombined = combinedMd.slice(0, seg.start) + patchedCos + combinedMd.slice(seg.end);\n    } else {\n        nextCombined = [\n            combinedMd.trim(),\n            patchedCos\n        ].filter(Boolean).join('\\n\\n');\n    }\n    await supabase.from('session_reports_v3_tabs').update({\n        status: 'ready',\n        report_json: {\n            ...current?.report || {},\n            markdown: nextCombined\n        },\n        last_error: null\n    }).eq('session_id', sessionId).then(({ error })=>{\n        if (error) throw error;\n    });\n    try {\n        await (0,_server_services_markdown_indexer__WEBPACK_IMPORTED_MODULE_3__.indexReportMarkdown)(supabase, sessionId, nextCombined);\n    } catch  {}\n    // Versioning: store patch ops as diff in cos_versions\n    try {\n        const session = await sessionsRepo.findById(sessionId, userId);\n        const subjectId = session?.subject_id;\n        if (subjectId) {\n            const { data: verRow } = await supabase.from('cos_versions').select('version').eq('subject_id', subjectId).order('version', {\n                ascending: false\n            }).limit(1);\n            const nextVersion = (verRow?.[0]?.version || 0) + 1;\n            await supabase.from('cos_versions').insert({\n                subject_id: subjectId,\n                session_id: sessionId,\n                version: nextVersion,\n                markdown: patchedCos,\n                ops_json: ops,\n                reason: 'targeted_patch',\n                source: 'patch'\n            });\n        }\n    } catch  {}\n    return {\n        markdown: nextCombined\n    };\n}\nasync function generateCosPatchFromModel(supabase, userId, sessionId) {\n    const sessionsRepo = new _server_repositories_sessions__WEBPACK_IMPORTED_MODULE_1__.SessionsRepository(supabase);\n    const transcriptsRepo = new _server_repositories_transcripts__WEBPACK_IMPORTED_MODULE_2__.TranscriptsRepository(supabase);\n    const reportsRepo = new _server_repositories_reports_v3_tabs__WEBPACK_IMPORTED_MODULE_0__.ReportsV3TabsRepository(supabase);\n    const [session, transcripts, report] = await Promise.all([\n        sessionsRepo.findById(sessionId, userId),\n        transcriptsRepo.findBySessionId(sessionId, userId),\n        reportsRepo.findBySessionId(sessionId, userId)\n    ]);\n    const existing = report?.report?.markdown;\n    const messages = [\n        {\n            role: 'system',\n            content: [\n                'You are an expert sales analyst and technical editor.',\n                'Task: Propose targeted patch operations to update ONLY the Chance of Sale tab.',\n                'Use strict JSON via function tool only. Do not print raw markdown in assistant messages.',\n                'Each section must be a cohesive markdown fragment that can replace the section body.',\n                'Sections use invisible anchors: <!-- SECTION: COS/ID -->...<!-- /SECTION: COS/ID -->',\n                'Paths allowed: COS/DEAL_HEALTH, COS/MEDDICC, COS/BANT, COS/DEAL_SCORE, COS/PROBABILITY, COS/BOOSTERS_BLOCKERS, COS/NEXT_STEPS.',\n                'Prefer replace_section; use upsert_section when missing; remove_section rarely.'\n            ].join('\\n')\n        },\n        {\n            role: 'user',\n            content: [\n                `SESSION_ID: ${sessionId}`,\n                `SESSION_META: ${JSON.stringify({\n                    id: session?.id,\n                    type: session?.type,\n                    status: session?.status,\n                    started_at: session?.started_at,\n                    ended_at: session?.ended_at\n                })}`,\n                `EXISTING_MARKDOWN: ${(existing || '').slice(0, 8000)}`,\n                `TRANSCRIPTS: ${JSON.stringify(transcripts.slice(-50).map((t)=>({\n                        ts: t.timestamp || t.created_at,\n                        speaker: t.speaker,\n                        text: String(t.content_enc || t.text_enc || '').slice(0, 300)\n                    })))}`\n            ].join('\\n')\n        }\n    ];\n    const tools = [\n        {\n            type: 'function',\n            function: {\n                name: 'submit_patch_ops',\n                description: 'Submit the final list of patch operations to apply to Chance of Sale.',\n                parameters: {\n                    type: 'object',\n                    properties: {\n                        operations: {\n                            type: 'array',\n                            minItems: 1,\n                            items: {\n                                type: 'object',\n                                properties: {\n                                    op: {\n                                        type: 'string',\n                                        enum: [\n                                            'replace_section',\n                                            'upsert_section',\n                                            'remove_section'\n                                        ]\n                                    },\n                                    path: {\n                                        type: 'string',\n                                        enum: [\n                                            'COS/DEAL_HEALTH',\n                                            'COS/MEDDICC',\n                                            'COS/BANT',\n                                            'COS/DEAL_SCORE',\n                                            'COS/PROBABILITY',\n                                            'COS/BOOSTERS_BLOCKERS',\n                                            'COS/NEXT_STEPS'\n                                        ]\n                                    },\n                                    content_md: {\n                                        type: 'string'\n                                    }\n                                },\n                                required: [\n                                    'op',\n                                    'path'\n                                ],\n                                additionalProperties: false\n                            }\n                        },\n                        reason: {\n                            type: 'string'\n                        }\n                    },\n                    required: [\n                        'operations'\n                    ],\n                    additionalProperties: false\n                }\n            }\n        }\n    ];\n    const state = {};\n    const handlers = {\n        submit_patch_ops: async (args)=>{\n            const ops = Array.isArray(args?.operations) ? args.operations : [];\n            state.ops = ops;\n            state.reason = typeof args?.reason === 'string' ? args.reason : undefined;\n            return {\n                content: 'received'\n            };\n        }\n    };\n    let lastErr = null;\n    for(let attempt = 1; attempt <= 2; attempt++){\n        try {\n            await (0,_server_services_openrouter__WEBPACK_IMPORTED_MODULE_4__.chatWithTools)({\n                model: process.env.OPENROUTER_TOOL_MODEL || process.env.OPENROUTER_MODEL || 'gpt-4o-mini',\n                messages,\n                tools,\n                handlers,\n                parallelToolCalls: false,\n                maxToolIterations: 1,\n                returnOnToolCall: true,\n                providerSort: 'latency',\n                temperature: 0,\n                timeoutMs: 120000\n            });\n            lastErr = null;\n            break;\n        } catch (e) {\n            lastErr = e;\n            if (attempt < 2) await new Promise((r)=>setTimeout(r, attempt * 1000));\n        }\n    }\n    if (lastErr) throw lastErr;\n    if (!state.ops || state.ops.length === 0) {\n        return {\n            applied: false,\n            reason: 'Model did not submit patch operations.'\n        };\n    }\n    await applyCosPatch(supabase, userId, sessionId, state.ops);\n    return {\n        applied: true,\n        operations: state.ops,\n        reason: state.reason\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3NlcnZpY2VzL2NoYW5jZS1vZi1zYWxlLXBhdGNoLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBK0U7QUFDWjtBQUNNO0FBQ0Q7QUFDd0M7QUFrQmhILE1BQU1LLGdCQUFnQjtBQUN0QixNQUFNQyxjQUFjO0FBRXBCLFNBQVNDLGtCQUFrQkMsVUFBa0I7SUFDM0MsTUFBTUMsT0FBT0QsV0FBV0UsSUFBSTtJQUM1QixJQUFJRCxLQUFLRSxRQUFRLENBQUNOLGtCQUFrQkksS0FBS0UsUUFBUSxDQUFDTCxjQUFjLE9BQU9HO0lBQ3ZFLE9BQU87UUFBQ0o7UUFBZUk7UUFBTUg7S0FBWSxDQUFDTSxJQUFJLENBQUM7QUFDakQ7QUFFQSxTQUFTQyxhQUFhQyxFQUFnQjtJQUFZLE9BQU8sQ0FBQyxjQUFjLEVBQUVBLEdBQUcsSUFBSSxDQUFDO0FBQUM7QUFDbkYsU0FBU0MsV0FBV0QsRUFBZ0I7SUFBWSxPQUFPLENBQUMsZUFBZSxFQUFFQSxHQUFHLElBQUksQ0FBQztBQUFDO0FBRWxGLE1BQU1FLGdCQUFnQztJQUNwQztJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtDQUNEO0FBRUQsU0FBU0MsU0FBU0MsS0FBZSxFQUFFQyxLQUFhLEVBQUVDLEtBQWE7SUFDN0RGLE1BQU1HLE1BQU0sQ0FBQ0YsT0FBTyxHQUFHQztBQUN6QjtBQUVBLFNBQVNFLGNBQWNDLGdCQUFnQztJQUNyRCxJQUFJLENBQUNBLGtCQUFrQixPQUFPO0lBQzlCLE1BQU1DLElBQUlELGlCQUFpQkUsT0FBTyxDQUFDcEI7SUFDbkMsTUFBTXFCLElBQUlILGlCQUFpQkUsT0FBTyxDQUFDbkI7SUFDbkMsSUFBSWtCLE1BQU0sQ0FBQyxLQUFLRSxNQUFNLENBQUMsS0FBS0EsS0FBS0YsR0FBRyxPQUFPO0lBQzNDLE1BQU1HLFNBQVNELElBQUlwQixZQUFZc0IsTUFBTTtJQUNyQyxPQUFPO1FBQUVDLEtBQUtOLGlCQUFpQk8sS0FBSyxDQUFDTixHQUFHRztRQUFT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QUNWLElBQUlpSSxVQUFVLEdBQUcsTUFBTSxJQUFJeEMsUUFBUW9ELENBQUFBLElBQUtDLFdBQVdELEdBQUdaLFVBQVU7UUFDbEU7SUFDRjtJQUNBLElBQUlELFNBQVMsTUFBTUE7SUFFbkIsSUFBSSxDQUFDUCxNQUFNOUUsR0FBRyxJQUFJOEUsTUFBTTlFLEdBQUcsQ0FBQ3pDLE1BQU0sS0FBSyxHQUFHO1FBQ3hDLE9BQU87WUFBRTZJLFNBQVM7WUFBTzNELFFBQVE7UUFBeUM7SUFDNUU7SUFDQSxNQUFNeEMsY0FBY0MsVUFBVUMsUUFBUUMsV0FBVzBFLE1BQU05RSxHQUFHO0lBQzFELE9BQU87UUFBRW9HLFNBQVM7UUFBTTVCLFlBQVlNLE1BQU05RSxHQUFHO1FBQUV5QyxRQUFRcUMsTUFBTXJDLE1BQU07SUFBQztBQUN0RSIsInNvdXJjZXMiOlsiRDpcXERlbHRhIElWXFxTb2Z3YXJlc1xcZ2xhc3NcXHNhbmRib3hcXHNoYWRjbi1jcm0tZGFzaGJvYXJkXFxzcmNcXHNlcnZlclxcc2VydmljZXNcXGNoYW5jZS1vZi1zYWxlLXBhdGNoLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJlcG9ydHNWM1RhYnNSZXBvc2l0b3J5IH0gZnJvbSAnQC9zZXJ2ZXIvcmVwb3NpdG9yaWVzL3JlcG9ydHMtdjMtdGFicydcbmltcG9ydCB7IFNlc3Npb25zUmVwb3NpdG9yeSB9IGZyb20gJ0Avc2VydmVyL3JlcG9zaXRvcmllcy9zZXNzaW9ucydcbmltcG9ydCB7IFRyYW5zY3JpcHRzUmVwb3NpdG9yeSB9IGZyb20gJ0Avc2VydmVyL3JlcG9zaXRvcmllcy90cmFuc2NyaXB0cydcbmltcG9ydCB7IGluZGV4UmVwb3J0TWFya2Rvd24gfSBmcm9tICdAL3NlcnZlci9zZXJ2aWNlcy9tYXJrZG93bi1pbmRleGVyJ1xuaW1wb3J0IHsgY2hhdFdpdGhUb29scywgVG9vbERlZmluaXRpb24sIENoYXRNZXNzYWdlLCBDaGF0VG9vbEhhbmRsZXJSZXN1bHQgfSBmcm9tICdAL3NlcnZlci9zZXJ2aWNlcy9vcGVucm91dGVyJ1xuXG5leHBvcnQgdHlwZSBDb3NTZWN0aW9uSWQgPVxuICB8ICdDT1MvREVBTF9IRUFMVEgnXG4gIHwgJ0NPUy9NRURESUNDJ1xuICB8ICdDT1MvQkFOVCdcbiAgfCAnQ09TL0RFQUxfU0NPUkUnXG4gIHwgJ0NPUy9QUk9CQUJJTElUWSdcbiAgfCAnQ09TL0JPT1NURVJTX0JMT0NLRVJTJ1xuICB8ICdDT1MvTkVYVF9TVEVQUydcblxuZXhwb3J0IHR5cGUgQ29zUGF0Y2hPcCA9XG4gIHwgeyBvcDogJ3JlcGxhY2Vfc2VjdGlvbic7IHBhdGg6IENvc1NlY3Rpb25JZDsgY29udGVudF9tZDogc3RyaW5nIH1cbiAgfCB7IG9wOiAndXBzZXJ0X3NlY3Rpb24nOyBwYXRoOiBDb3NTZWN0aW9uSWQ7IGNvbnRlbnRfbWQ6IHN0cmluZyB9XG4gIHwgeyBvcDogJ3JlbW92ZV9zZWN0aW9uJzsgcGF0aDogQ29zU2VjdGlvbklkIH1cblxuZXhwb3J0IGludGVyZmFjZSBDb3NQYXRjaE9wc1BheWxvYWQgeyBvcGVyYXRpb25zOiBDb3NQYXRjaE9wW10gfVxuXG5jb25zdCBDT1NfVEFCX1NUQVJUID0gJzwhLS0gVEFCOiBDSEFOQ0UgT0YgU0FMRSAtLT4nXG5jb25zdCBDT1NfVEFCX0VORCA9ICc8IS0tIC9UQUI6IENIQU5DRSBPRiBTQUxFIC0tPidcblxuZnVuY3Rpb24gZW5zdXJlVGFiRW52ZWxvcGUoY29zQ29udGVudDogc3RyaW5nKTogc3RyaW5nIHtcbiAgY29uc3QgYm9keSA9IGNvc0NvbnRlbnQudHJpbSgpXG4gIGlmIChib2R5LmluY2x1ZGVzKENPU19UQUJfU1RBUlQpICYmIGJvZHkuaW5jbHVkZXMoQ09TX1RBQl9FTkQpKSByZXR1cm4gYm9keVxuICByZXR1cm4gW0NPU19UQUJfU1RBUlQsIGJvZHksIENPU19UQUJfRU5EXS5qb2luKCdcXG4nKVxufVxuXG5mdW5jdGlvbiBzZWN0aW9uU3RhcnQoaWQ6IENvc1NlY3Rpb25JZCk6IHN0cmluZyB7IHJldHVybiBgPCEtLSBTRUNUSU9OOiAke2lkfSAtLT5gIH1cbmZ1bmN0aW9uIHNlY3Rpb25FbmQoaWQ6IENvc1NlY3Rpb25JZCk6IHN0cmluZyB7IHJldHVybiBgPCEtLSAvU0VDVElPTjogJHtpZH0gLS0+YCB9XG5cbmNvbnN0IFNFQ1RJT05fT1JERVI6IENvc1NlY3Rpb25JZFtdID0gW1xuICAnQ09TL0RFQUxfSEVBTFRIJyxcbiAgJ0NPUy9NRURESUNDJyxcbiAgJ0NPUy9CQU5UJyxcbiAgJ0NPUy9ERUFMX1NDT1JFJyxcbiAgJ0NPUy9QUk9CQUJJTElUWScsXG4gICdDT1MvQk9PU1RFUlNfQkxPQ0tFUlMnLFxuICAnQ09TL05FWFRfU1RFUFMnLFxuXVxuXG5mdW5jdGlvbiBpbnNlcnRBdChhcnJheTogc3RyaW5nW10sIGluZGV4OiBudW1iZXIsIHZhbHVlOiBzdHJpbmcpIHtcbiAgYXJyYXkuc3BsaWNlKGluZGV4LCAwLCB2YWx1ZSlcbn1cblxuZnVuY3Rpb24gZ2V0Q29zU2VnbWVudChjb21iaW5lZE1hcmtkb3duPzogc3RyaW5nIHwgbnVsbCk6IHsgY29zOiBzdHJpbmc7IHN0YXJ0OiBudW1iZXI7IGVuZDogbnVtYmVyIH0gfCBudWxsIHtcbiAgaWYgKCFjb21iaW5lZE1hcmtkb3duKSByZXR1cm4gbnVsbFxuICBjb25zdCBzID0gY29tYmluZWRNYXJrZG93bi5pbmRleE9mKENPU19UQUJfU1RBUlQpXG4gIGNvbnN0IGUgPSBjb21iaW5lZE1hcmtkb3duLmluZGV4T2YoQ09TX1RBQl9FTkQpXG4gIGlmIChzID09PSAtMSB8fCBlID09PSAtMSB8fCBlIDw9IHMpIHJldHVybiBudWxsXG4gIGNvbnN0IGVuZElkeCA9IGUgKyBDT1NfVEFCX0VORC5sZW5ndGhcbiAgcmV0dXJuIHsgY29zOiBjb21iaW5lZE1hcmtkb3duLnNsaWNlKHMsIGVuZElkeCksIHN0YXJ0OiBzLCBlbmQ6IGVuZElkeCB9XG59XG5cbmZ1bmN0aW9uIGFwcGx5U2luZ2xlT3BUb0Nvcyhjb3NTZWdtZW50OiBzdHJpbmcsIG9wOiBDb3NQYXRjaE9wKTogc3RyaW5nIHtcbiAgY29uc3QgbGluZXMgPSBjb3NTZWdtZW50LnNwbGl0KCdcXG4nKVxuICBjb25zdCBzTWFya2VyID0gc2VjdGlvblN0YXJ0KG9wLnBhdGgpXG4gIGNvbnN0IGVNYXJrZXIgPSBzZWN0aW9uRW5kKG9wLnBhdGgpXG4gIGxldCBzSWR4ID0gLTFcbiAgbGV0IGVJZHggPSAtMVxuICBmb3IgKGxldCBpID0gMDsgaSA8IGxpbmVzLmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKGxpbmVzW2ldLmluY2x1ZGVzKHNNYXJrZXIpKSBzSWR4ID0gaVxuICAgIGlmIChsaW5lc1tpXS5pbmNsdWRlcyhlTWFya2VyKSkgeyBlSWR4ID0gaTsgaWYgKHNJZHggIT09IC0xKSBicmVhayB9XG4gIH1cblxuICAvLyBIZWxwZXI6IGZhbGxiYWNrIHRvIGhlYWRpbmctYmFzZWQgcmVwbGFjZSB3aGVuIG1hcmtlcnMgbWlzc2luZ1xuICBmdW5jdGlvbiBoZWFkaW5nRmFsbGJhY2tSZXBsYWNlKGNvbnRlbnRNZDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAvLyBFeHBlY3QgYSBzZWNvbmQtbGV2ZWwgaGVhZGluZyBgIyNgIHdpdGhpbiBjb250ZW50OyB0cnkgdG8gZmluZCBzYW1lIGhlYWRpbmdcbiAgICBjb25zdCBtID0gL15cXHMqIyNcXHMrKC4rKSQvbS5leGVjKGNvbnRlbnRNZClcbiAgICBpZiAoIW0pIHJldHVybiBjb3NTZWdtZW50IC8vIGNhbm5vdCBmYWxsYmFjayB3aXRob3V0IGEgaGVhZGluZ1xuICAgIGNvbnN0IGhlYWRpbmcgPSBtWzFdLnRyaW0oKVxuICAgIGNvbnN0IGFsbCA9IGNvc1NlZ21lbnRcbiAgICBjb25zdCBpZHggPSBhbGwuaW5kZXhPZihgIyMgJHtoZWFkaW5nfWApXG4gICAgaWYgKGlkeCA9PT0gLTEpIHJldHVybiBjb3NTZWdtZW50XG4gICAgLy8gcmVwbGFjZSBmcm9tIGhlYWRpbmcgdG8gbmV4dCBgXFxuIyMgYCBvciBUQUJfRU5EXG4gICAgY29uc3QgYWZ0ZXIgPSBhbGwuc2xpY2UoaWR4KVxuICAgIGNvbnN0IG5leHRSZWwgPSBhZnRlci5pbmRleE9mKCdcXG4jIyAnKVxuICAgIGNvbnN0IG5leHRUYWIgPSBhZnRlci5pbmRleE9mKENPU19UQUJfRU5EKVxuICAgIGxldCByZXBsYWNlRW5kID0gLTFcbiAgICBpZiAobmV4dFJlbCA+IDApIHJlcGxhY2VFbmQgPSBpZHggKyBuZXh0UmVsXG4gICAgZWxzZSBpZiAobmV4dFRhYiA+IDApIHJlcGxhY2VFbmQgPSBpZHggKyBuZXh0VGFiXG4gICAgZWxzZSByZXBsYWNlRW5kID0gYWxsLmxlbmd0aFxuICAgIHJldHVybiBhbGwuc2xpY2UoMCwgaWR4KSArIGNvbnRlbnRNZCArIGFsbC5zbGljZShyZXBsYWNlRW5kKVxuICB9XG5cbiAgc3dpdGNoIChvcC5vcCkge1xuICAgIGNhc2UgJ3JlbW92ZV9zZWN0aW9uJzoge1xuICAgICAgaWYgKHNJZHggIT09IC0xICYmIGVJZHggIT09IC0xICYmIGVJZHggPiBzSWR4KSB7XG4gICAgICAgIGNvbnN0IGJlZm9yZSA9IGxpbmVzLnNsaWNlKDAsIHNJZHgpXG4gICAgICAgIGNvbnN0IGFmdGVyID0gbGluZXMuc2xpY2UoZUlkeCArIDEpXG4gICAgICAgIHJldHVybiBbLi4uYmVmb3JlLCAuLi5hZnRlcl0uam9pbignXFxuJylcbiAgICAgIH1cbiAgICAgIC8vIElmIG5vIG1hcmtlcnMsIG5vdGhpbmcgdG8gcmVtb3ZlXG4gICAgICByZXR1cm4gY29zU2VnbWVudFxuICAgIH1cbiAgICBjYXNlICdyZXBsYWNlX3NlY3Rpb24nOiB7XG4gICAgICBpZiAoc0lkeCAhPT0gLTEgJiYgZUlkeCAhPT0gLTEgJiYgZUlkeCA+IHNJZHgpIHtcbiAgICAgICAgY29uc3QgYmVmb3JlID0gbGluZXMuc2xpY2UoMCwgc0lkeCArIDEpIC8vIGluY2x1ZGUgc3RhcnQgbWFya2VyXG4gICAgICAgIGNvbnN0IGFmdGVyID0gbGluZXMuc2xpY2UoZUlkeCkgLy8gaW5jbHVkZSBlbmQgbWFya2VyXG4gICAgICAgIGNvbnN0IGNvbnRlbnRMaW5lcyA9IG9wLmNvbnRlbnRfbWQucmVwbGFjZSgvXFxyXFxuPy9nLCAnXFxuJykuc3BsaXQoJ1xcbicpXG4gICAgICAgIHJldHVybiBbLi4uYmVmb3JlLCAuLi5jb250ZW50TGluZXMsIC4uLmFmdGVyXS5qb2luKCdcXG4nKVxuICAgICAgfVxuICAgICAgLy8gZmFsbGJhY2s6IGhlYWRpbmctYmFzZWQgcmVwbGFjZW1lbnRcbiAgICAgIHJldHVybiBoZWFkaW5nRmFsbGJhY2tSZXBsYWNlKG9wLmNvbnRlbnRfbWQpXG4gICAgfVxuICAgIGNhc2UgJ3Vwc2VydF9zZWN0aW9uJzoge1xuICAgICAgaWYgKHNJZHggIT09IC0xICYmIGVJZHggIT09IC0xICYmIGVJZHggPiBzSWR4KSB7XG4gICAgICAgIC8vIEFscmVhZHkgcHJlc2VudDsgcmVwbGFjZSBjb250ZW50IGJldHdlZW4gbWFya2Vyc1xuICAgICAgICBjb25zdCBiZWZvcmUgPSBsaW5lcy5zbGljZSgwLCBzSWR4ICsgMSlcbiAgICAgICAgY29uc3QgYWZ0ZXIgPSBsaW5lcy5zbGljZShlSWR4KVxuICAgICAgICBjb25zdCBjb250ZW50TGluZXMgPSBvcC5jb250ZW50X21kLnJlcGxhY2UoL1xcclxcbj8vZywgJ1xcbicpLnNwbGl0KCdcXG4nKVxuICAgICAgICByZXR1cm4gWy4uLmJlZm9yZSwgLi4uY29udGVudExpbmVzLCAuLi5hZnRlcl0uam9pbignXFxuJylcbiAgICAgIH1cbiAgICAgIC8vIEluc2VydCBhIG5ldyBzZWN0aW9uIGF0IGNhbm9uaWNhbCBwb3NpdGlvbiAoYnkgU0VDVElPTl9PUkRFUilcbiAgICAgIGNvbnN0IGluc2VydGlvbklkID0gb3AucGF0aFxuICAgICAgY29uc3Qgb3JkZXJJbmRleCA9IFNFQ1RJT05fT1JERVIuaW5kZXhPZihpbnNlcnRpb25JZClcbiAgICAgIC8vIEZpbmQgbmV4dCBleGlzdGluZyBzZWN0aW9uIGFmdGVyIGRlc2lyZWQgaW5kZXggdG8gaW5zZXJ0IGJlZm9yZVxuICAgICAgbGV0IGluc2VydExpbmUgPSBsaW5lcy5sZW5ndGggLSAxIC8vIGJlZm9yZSBUQUJfRU5EXG4gICAgICBmb3IgKGxldCBpID0gb3JkZXJJbmRleCArIDE7IGkgPCBTRUNUSU9OX09SREVSLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IG5leHRTID0gc2VjdGlvblN0YXJ0KFNFQ1RJT05fT1JERVJbaV0pXG4gICAgICAgIGNvbnN0IG5leHRJZHggPSBsaW5lcy5maW5kSW5kZXgobCA9PiBsLmluY2x1ZGVzKG5leHRTKSlcbiAgICAgICAgaWYgKG5leHRJZHggIT09IC0xKSB7IGluc2VydExpbmUgPSBuZXh0SWR4OyBicmVhayB9XG4gICAgICB9XG4gICAgICBjb25zdCBuZXdCbG9jayA9IFtcbiAgICAgICAgc01hcmtlcixcbiAgICAgICAgLi4ub3AuY29udGVudF9tZC5yZXBsYWNlKC9cXHJcXG4/L2csICdcXG4nKS5zcGxpdCgnXFxuJyksXG4gICAgICAgIGVNYXJrZXIsXG4gICAgICBdXG4gICAgICBjb25zdCBvdXQgPSBbLi4ubGluZXNdXG4gICAgICBpbnNlcnRBdChvdXQsIGluc2VydExpbmUsIG5ld0Jsb2NrLmpvaW4oJ1xcbicpKVxuICAgICAgcmV0dXJuIG91dC5qb2luKCdcXG4nKVxuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBhcHBseVBhdGNoT3BzVG9Db3MoY29zU2VnbWVudDogc3RyaW5nLCBvcHM6IENvc1BhdGNoT3BbXSk6IHN0cmluZyB7XG4gIGxldCBvdXQgPSBlbnN1cmVUYWJFbnZlbG9wZShjb3NTZWdtZW50KVxuICBmb3IgKGNvbnN0IG9wIG9mIG9wcykge1xuICAgIG91dCA9IGFwcGx5U2luZ2xlT3BUb0NvcyhvdXQsIG9wKVxuICB9XG4gIHJldHVybiBvdXRcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFwcGx5Q29zUGF0Y2goXG4gIHN1cGFiYXNlOiBhbnksXG4gIHVzZXJJZDogc3RyaW5nLFxuICBzZXNzaW9uSWQ6IHN0cmluZyxcbiAgb3BzOiBDb3NQYXRjaE9wW11cbik6IFByb21pc2U8eyBtYXJrZG93bjogc3RyaW5nIH0+IHtcbiAgY29uc3QgcmVwb3J0c1JlcG8gPSBuZXcgUmVwb3J0c1YzVGFic1JlcG9zaXRvcnkoc3VwYWJhc2UpXG4gIGNvbnN0IHNlc3Npb25zUmVwbyA9IG5ldyBTZXNzaW9uc1JlcG9zaXRvcnkoc3VwYWJhc2UpXG4gIGNvbnN0IGN1cnJlbnQgPSBhd2FpdCByZXBvcnRzUmVwby5maW5kQnlTZXNzaW9uSWQoc2Vzc2lvbklkLCB1c2VySWQpXG4gIGNvbnN0IGNvbWJpbmVkTWQ6IHN0cmluZyA9IChjdXJyZW50Py5yZXBvcnQgYXMgYW55KT8ubWFya2Rvd24gfHwgJydcbiAgY29uc3Qgc2VnID0gZ2V0Q29zU2VnbWVudChjb21iaW5lZE1kKVxuICBjb25zdCBjb3NPbmx5ID0gc2VnPy5jb3MgfHwgYCR7Q09TX1RBQl9TVEFSVH1cXG4jIENoYW5jZSBvZiBTYWxlXFxuXFxuJHtDT1NfVEFCX0VORH1gXG4gIGNvbnN0IHBhdGNoZWRDb3MgPSBhcHBseVBhdGNoT3BzVG9Db3MoY29zT25seSwgb3BzKVxuICBsZXQgbmV4dENvbWJpbmVkID0gY29tYmluZWRNZFxuICBpZiAoc2VnKSB7XG4gICAgbmV4dENvbWJpbmVkID0gY29tYmluZWRNZC5zbGljZSgwLCBzZWcuc3RhcnQpICsgcGF0Y2hlZENvcyArIGNvbWJpbmVkTWQuc2xpY2Uoc2VnLmVuZClcbiAgfSBlbHNlIHtcbiAgICBuZXh0Q29tYmluZWQgPSBbY29tYmluZWRNZC50cmltKCksIHBhdGNoZWRDb3NdLmZpbHRlcihCb29sZWFuKS5qb2luKCdcXG5cXG4nKVxuICB9XG4gIGF3YWl0IChzdXBhYmFzZSBhcyBhbnkpXG4gICAgLmZyb20oJ3Nlc3Npb25fcmVwb3J0c192M190YWJzJylcbiAgICAudXBkYXRlKHsgc3RhdHVzOiAncmVhZHknLCByZXBvcnRfanNvbjogeyAuLi4oY3VycmVudD8ucmVwb3J0IHx8IHt9KSwgbWFya2Rvd246IG5leHRDb21iaW5lZCB9LCBsYXN0X2Vycm9yOiBudWxsIH0pXG4gICAgLmVxKCdzZXNzaW9uX2lkJywgc2Vzc2lvbklkKVxuICAgIC50aGVuKCh7IGVycm9yIH06IGFueSkgPT4geyBpZiAoZXJyb3IpIHRocm93IGVycm9yIH0pXG4gIHRyeSB7IGF3YWl0IGluZGV4UmVwb3J0TWFya2Rvd24oc3VwYWJhc2UsIHNlc3Npb25JZCwgbmV4dENvbWJpbmVkKSB9IGNhdGNoIHt9XG5cbiAgLy8gVmVyc2lvbmluZzogc3RvcmUgcGF0Y2ggb3BzIGFzIGRpZmYgaW4gY29zX3ZlcnNpb25zXG4gIHRyeSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IHNlc3Npb25zUmVwby5maW5kQnlJZChzZXNzaW9uSWQsIHVzZXJJZClcbiAgICBjb25zdCBzdWJqZWN0SWQgPSAoc2Vzc2lvbiBhcyBhbnkpPy5zdWJqZWN0X2lkXG4gICAgaWYgKHN1YmplY3RJZCkge1xuICAgICAgY29uc3QgeyBkYXRhOiB2ZXJSb3cgfSA9IGF3YWl0IChzdXBhYmFzZSBhcyBhbnkpXG4gICAgICAgIC5mcm9tKCdjb3NfdmVyc2lvbnMnKVxuICAgICAgICAuc2VsZWN0KCd2ZXJzaW9uJylcbiAgICAgICAgLmVxKCdzdWJqZWN0X2lkJywgc3ViamVjdElkKVxuICAgICAgICAub3JkZXIoJ3ZlcnNpb24nLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcbiAgICAgICAgLmxpbWl0KDEpXG4gICAgICBjb25zdCBuZXh0VmVyc2lvbiA9ICh2ZXJSb3c/LlswXT8udmVyc2lvbiB8fCAwKSArIDFcbiAgICAgIGF3YWl0IChzdXBhYmFzZSBhcyBhbnkpXG4gICAgICAgIC5mcm9tKCdjb3NfdmVyc2lvbnMnKVxuICAgICAgICAuaW5zZXJ0KHtcbiAgICAgICAgICBzdWJqZWN0X2lkOiBzdWJqZWN0SWQsXG4gICAgICAgICAgc2Vzc2lvbl9pZDogc2Vzc2lvbklkLFxuICAgICAgICAgIHZlcnNpb246IG5leHRWZXJzaW9uLFxuICAgICAgICAgIG1hcmtkb3duOiBwYXRjaGVkQ29zLFxuICAgICAgICAgIG9wc19qc29uOiBvcHMsXG4gICAgICAgICAgcmVhc29uOiAndGFyZ2V0ZWRfcGF0Y2gnLFxuICAgICAgICAgIHNvdXJjZTogJ3BhdGNoJyxcbiAgICAgICAgfSlcbiAgICB9XG4gIH0gY2F0Y2gge31cbiAgcmV0dXJuIHsgbWFya2Rvd246IG5leHRDb21iaW5lZCB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZW5lcmF0ZUNvc1BhdGNoRnJvbU1vZGVsKFxuICBzdXBhYmFzZTogYW55LFxuICB1c2VySWQ6IHN0cmluZyxcbiAgc2Vzc2lvbklkOiBzdHJpbmdcbik6IFByb21pc2U8eyBhcHBsaWVkOiBib29sZWFuOyBvcGVyYXRpb25zPzogQ29zUGF0Y2hPcFtdOyByZWFzb24/OiBzdHJpbmcgfT4ge1xuICBjb25zdCBzZXNzaW9uc1JlcG8gPSBuZXcgU2Vzc2lvbnNSZXBvc2l0b3J5KHN1cGFiYXNlKVxuICBjb25zdCB0cmFuc2NyaXB0c1JlcG8gPSBuZXcgVHJhbnNjcmlwdHNSZXBvc2l0b3J5KHN1cGFiYXNlKVxuICBjb25zdCByZXBvcnRzUmVwbyA9IG5ldyBSZXBvcnRzVjNUYWJzUmVwb3NpdG9yeShzdXBhYmFzZSlcbiAgY29uc3QgW3Nlc3Npb24sIHRyYW5zY3JpcHRzLCByZXBvcnRdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgIHNlc3Npb25zUmVwby5maW5kQnlJZChzZXNzaW9uSWQsIHVzZXJJZCksXG4gICAgdHJhbnNjcmlwdHNSZXBvLmZpbmRCeVNlc3Npb25JZChzZXNzaW9uSWQsIHVzZXJJZCksXG4gICAgcmVwb3J0c1JlcG8uZmluZEJ5U2Vzc2lvbklkKHNlc3Npb25JZCwgdXNlcklkKSxcbiAgXSlcbiAgY29uc3QgZXhpc3Rpbmc6IHN0cmluZyB8IHVuZGVmaW5lZCA9IChyZXBvcnQ/LnJlcG9ydCBhcyBhbnkpPy5tYXJrZG93blxuICBjb25zdCBtZXNzYWdlczogQ2hhdE1lc3NhZ2VbXSA9IFtcbiAgICB7IHJvbGU6ICdzeXN0ZW0nLCBjb250ZW50OiBbXG4gICAgICAnWW91IGFyZSBhbiBleHBlcnQgc2FsZXMgYW5hbHlzdCBhbmQgdGVjaG5pY2FsIGVkaXRvci4nLFxuICAgICAgJ1Rhc2s6IFByb3Bvc2UgdGFyZ2V0ZWQgcGF0Y2ggb3BlcmF0aW9ucyB0byB1cGRhdGUgT05MWSB0aGUgQ2hhbmNlIG9mIFNhbGUgdGFiLicsXG4gICAgICAnVXNlIHN0cmljdCBKU09OIHZpYSBmdW5jdGlvbiB0b29sIG9ubHkuIERvIG5vdCBwcmludCByYXcgbWFya2Rvd24gaW4gYXNzaXN0YW50IG1lc3NhZ2VzLicsXG4gICAgICAnRWFjaCBzZWN0aW9uIG11c3QgYmUgYSBjb2hlc2l2ZSBtYXJrZG93biBmcmFnbWVudCB0aGF0IGNhbiByZXBsYWNlIHRoZSBzZWN0aW9uIGJvZHkuJyxcbiAgICAgICdTZWN0aW9ucyB1c2UgaW52aXNpYmxlIGFuY2hvcnM6IDwhLS0gU0VDVElPTjogQ09TL0lEIC0tPi4uLjwhLS0gL1NFQ1RJT046IENPUy9JRCAtLT4nLFxuICAgICAgJ1BhdGhzIGFsbG93ZWQ6IENPUy9ERUFMX0hFQUxUSCwgQ09TL01FRERJQ0MsIENPUy9CQU5ULCBDT1MvREVBTF9TQ09SRSwgQ09TL1BST0JBQklMSVRZLCBDT1MvQk9PU1RFUlNfQkxPQ0tFUlMsIENPUy9ORVhUX1NURVBTLicsXG4gICAgICAnUHJlZmVyIHJlcGxhY2Vfc2VjdGlvbjsgdXNlIHVwc2VydF9zZWN0aW9uIHdoZW4gbWlzc2luZzsgcmVtb3ZlX3NlY3Rpb24gcmFyZWx5LicsXG4gICAgXS5qb2luKCdcXG4nKSB9LFxuICAgIHsgcm9sZTogJ3VzZXInLCBjb250ZW50OiBbXG4gICAgICBgU0VTU0lPTl9JRDogJHtzZXNzaW9uSWR9YCxcbiAgICAgIGBTRVNTSU9OX01FVEE6ICR7SlNPTi5zdHJpbmdpZnkoeyBpZDogc2Vzc2lvbj8uaWQsIHR5cGU6IHNlc3Npb24/LnR5cGUsIHN0YXR1czogc2Vzc2lvbj8uc3RhdHVzLCBzdGFydGVkX2F0OiBzZXNzaW9uPy5zdGFydGVkX2F0LCBlbmRlZF9hdDogc2Vzc2lvbj8uZW5kZWRfYXQgfSl9YCxcbiAgICAgIGBFWElTVElOR19NQVJLRE9XTjogJHsoZXhpc3RpbmcgfHwgJycpLnNsaWNlKDAsIDgwMDApfWAsXG4gICAgICBgVFJBTlNDUklQVFM6ICR7SlNPTi5zdHJpbmdpZnkodHJhbnNjcmlwdHMuc2xpY2UoLTUwKS5tYXAodCA9PiAoeyB0czogdC50aW1lc3RhbXAgfHwgdC5jcmVhdGVkX2F0LCBzcGVha2VyOiB0LnNwZWFrZXIsIHRleHQ6IFN0cmluZyh0LmNvbnRlbnRfZW5jIHx8IHQudGV4dF9lbmMgfHwgJycpLnNsaWNlKDAsIDMwMCkgfSkpKX1gLFxuICAgIF0uam9pbignXFxuJykgfVxuICBdXG5cbiAgY29uc3QgdG9vbHM6IFRvb2xEZWZpbml0aW9uW10gPSBbXG4gICAge1xuICAgICAgdHlwZTogJ2Z1bmN0aW9uJyxcbiAgICAgIGZ1bmN0aW9uOiB7XG4gICAgICAgIG5hbWU6ICdzdWJtaXRfcGF0Y2hfb3BzJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdTdWJtaXQgdGhlIGZpbmFsIGxpc3Qgb2YgcGF0Y2ggb3BlcmF0aW9ucyB0byBhcHBseSB0byBDaGFuY2Ugb2YgU2FsZS4nLFxuICAgICAgICBwYXJhbWV0ZXJzOiB7XG4gICAgICAgICAgdHlwZTogJ29iamVjdCcsXG4gICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgb3BlcmF0aW9uczoge1xuICAgICAgICAgICAgICB0eXBlOiAnYXJyYXknLFxuICAgICAgICAgICAgICBtaW5JdGVtczogMSxcbiAgICAgICAgICAgICAgaXRlbXM6IHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgICBvcDogeyB0eXBlOiAnc3RyaW5nJywgZW51bTogWydyZXBsYWNlX3NlY3Rpb24nLCd1cHNlcnRfc2VjdGlvbicsJ3JlbW92ZV9zZWN0aW9uJ10gfSxcbiAgICAgICAgICAgICAgICAgIHBhdGg6IHsgdHlwZTogJ3N0cmluZycsIGVudW06IFsnQ09TL0RFQUxfSEVBTFRIJywnQ09TL01FRERJQ0MnLCdDT1MvQkFOVCcsJ0NPUy9ERUFMX1NDT1JFJywnQ09TL1BST0JBQklMSVRZJywnQ09TL0JPT1NURVJTX0JMT0NLRVJTJywnQ09TL05FWFRfU1RFUFMnXSB9LFxuICAgICAgICAgICAgICAgICAgY29udGVudF9tZDogeyB0eXBlOiAnc3RyaW5nJyB9LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFsnb3AnLCdwYXRoJ10sXG4gICAgICAgICAgICAgICAgYWRkaXRpb25hbFByb3BlcnRpZXM6IGZhbHNlLFxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVhc29uOiB7IHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICByZXF1aXJlZDogWydvcGVyYXRpb25zJ10sXG4gICAgICAgICAgYWRkaXRpb25hbFByb3BlcnRpZXM6IGZhbHNlLFxuICAgICAgICB9LFxuICAgICAgfVxuICAgIH1cbiAgXVxuXG4gIGNvbnN0IHN0YXRlOiB7IG9wcz86IENvc1BhdGNoT3BbXTsgcmVhc29uPzogc3RyaW5nIH0gPSB7fVxuICBjb25zdCBoYW5kbGVycyA9IHtcbiAgICBzdWJtaXRfcGF0Y2hfb3BzOiBhc3luYyAoYXJnczogYW55KTogUHJvbWlzZTxDaGF0VG9vbEhhbmRsZXJSZXN1bHQ+ID0+IHtcbiAgICAgIGNvbnN0IG9wczogQ29zUGF0Y2hPcFtdID0gQXJyYXkuaXNBcnJheShhcmdzPy5vcGVyYXRpb25zKSA/IGFyZ3Mub3BlcmF0aW9ucyA6IFtdXG4gICAgICBzdGF0ZS5vcHMgPSBvcHNcbiAgICAgIHN0YXRlLnJlYXNvbiA9IHR5cGVvZiBhcmdzPy5yZWFzb24gPT09ICdzdHJpbmcnID8gYXJncy5yZWFzb24gOiB1bmRlZmluZWRcbiAgICAgIHJldHVybiB7IGNvbnRlbnQ6ICdyZWNlaXZlZCcgfVxuICAgIH0sXG4gIH1cblxuICBsZXQgbGFzdEVycjogYW55ID0gbnVsbFxuICBmb3IgKGxldCBhdHRlbXB0ID0gMTsgYXR0ZW1wdCA8PSAyOyBhdHRlbXB0KyspIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgY2hhdFdpdGhUb29scyh7XG4gICAgICAgIG1vZGVsOiBwcm9jZXNzLmVudi5PUEVOUk9VVEVSX1RPT0xfTU9ERUwgfHwgcHJvY2Vzcy5lbnYuT1BFTlJPVVRFUl9NT0RFTCB8fCAnZ3B0LTRvLW1pbmknLFxuICAgICAgICBtZXNzYWdlcyxcbiAgICAgICAgdG9vbHMsXG4gICAgICAgIGhhbmRsZXJzLFxuICAgICAgICBwYXJhbGxlbFRvb2xDYWxsczogZmFsc2UsXG4gICAgICAgIG1heFRvb2xJdGVyYXRpb25zOiAxLFxuICAgICAgICByZXR1cm5PblRvb2xDYWxsOiB0cnVlLFxuICAgICAgICBwcm92aWRlclNvcnQ6ICdsYXRlbmN5JyxcbiAgICAgICAgdGVtcGVyYXR1cmU6IDAsXG4gICAgICAgIHRpbWVvdXRNczogMTIwXzAwMCxcbiAgICAgIH0pXG4gICAgICBsYXN0RXJyID0gbnVsbFxuICAgICAgYnJlYWtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBsYXN0RXJyID0gZVxuICAgICAgaWYgKGF0dGVtcHQgPCAyKSBhd2FpdCBuZXcgUHJvbWlzZShyID0+IHNldFRpbWVvdXQociwgYXR0ZW1wdCAqIDEwMDApKVxuICAgIH1cbiAgfVxuICBpZiAobGFzdEVycikgdGhyb3cgbGFzdEVyclxuXG4gIGlmICghc3RhdGUub3BzIHx8IHN0YXRlLm9wcy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4geyBhcHBsaWVkOiBmYWxzZSwgcmVhc29uOiAnTW9kZWwgZGlkIG5vdCBzdWJtaXQgcGF0Y2ggb3BlcmF0aW9ucy4nIH1cbiAgfVxuICBhd2FpdCBhcHBseUNvc1BhdGNoKHN1cGFiYXNlLCB1c2VySWQsIHNlc3Npb25JZCwgc3RhdGUub3BzKVxuICByZXR1cm4geyBhcHBsaWVkOiB0cnVlLCBvcGVyYXRpb25zOiBzdGF0ZS5vcHMsIHJlYXNvbjogc3RhdGUucmVhc29uIH1cbn1cbiJdLCJuYW1lcyI6WyJSZXBvcnRzVjNUYWJzUmVwb3NpdG9yeSIsIlNlc3Npb25zUmVwb3NpdG9yeSIsIlRyYW5zY3JpcHRzUmVwb3NpdG9yeSIsImluZGV4UmVwb3J0TWFya2Rvd24iLCJjaGF0V2l0aFRvb2xzIiwiQ09TX1RBQl9TVEFSVCIsIkNPU19UQUJfRU5EIiwiZW5zdXJlVGFiRW52ZWxvcGUiLCJjb3NDb250ZW50IiwiYm9keSIsInRyaW0iLCJpbmNsdWRlcyIsImpvaW4iLCJzZWN0aW9uU3RhcnQiLCJpZCIsInNlY3Rpb25FbmQiLCJTRUNUSU9OX09SREVSIiwiaW5zZXJ0QXQiLCJhcnJheSIsImluZGV4IiwidmFsdWUiLCJzcGxpY2UiLCJnZXRDb3NTZWdtZW50IiwiY29tYmluZWRNYXJrZG93biIsInMiLCJpbmRleE9mIiwiZSIsImVuZElkeCIsImxlbmd0aCIsImNvcyIsInNsaWNlIiwic3RhcnQiLCJlbmQiLCJhcHBseVNpbmdsZU9wVG9Db3MiLCJjb3NTZWdtZW50Iiwib3AiLCJsaW5lcyIsInNwbGl0Iiwic01hcmtlciIsInBhdGgiLCJlTWFya2VyIiwic0lkeCIsImVJZHgiLCJpIiwiaGVhZGluZ0ZhbGxiYWNrUmVwbGFjZSIsImNvbnRlbnRNZCIsIm0iLCJleGVjIiwiaGVhZGluZyIsImFsbCIsImlkeCIsImFmdGVyIiwibmV4dFJlbCIsIm5leHRUYWIiLCJyZXBsYWNlRW5kIiwiYmVmb3JlIiwiY29udGVudExpbmVzIiwiY29udGVudF9tZCIsInJlcGxhY2UiLCJpbnNlcnRpb25JZCIsIm9yZGVySW5kZXgiLCJpbnNlcnRMaW5lIiwibmV4dFMiLCJuZXh0SWR4IiwiZmluZEluZGV4IiwibCIsIm5ld0Jsb2NrIiwib3V0IiwiYXBwbHlQYXRjaE9wc1RvQ29zIiwib3BzIiwiYXBwbHlDb3NQYXRjaCIsInN1cGFiYXNlIiwidXNlcklkIiwic2Vzc2lvbklkIiwicmVwb3J0c1JlcG8iLCJzZXNzaW9uc1JlcG8iLCJjdXJyZW50IiwiZmluZEJ5U2Vzc2lvbklkIiwiY29tYmluZWRNZCIsInJlcG9ydCIsIm1hcmtkb3duIiwic2VnIiwiY29zT25seSIsInBhdGNoZWRDb3MiLCJuZXh0Q29tYmluZWQiLCJmaWx0ZXIiLCJCb29sZWFuIiwiZnJvbSIsInVwZGF0ZSIsInN0YXR1cyIsInJlcG9ydF9qc29uIiwibGFzdF9lcnJvciIsImVxIiwidGhlbiIsImVycm9yIiwic2Vzc2lvbiIsImZpbmRCeUlkIiwic3ViamVjdElkIiwic3ViamVjdF9pZCIsImRhdGEiLCJ2ZXJSb3ciLCJzZWxlY3QiLCJvcmRlciIsImFzY2VuZGluZyIsImxpbWl0IiwibmV4dFZlcnNpb24iLCJ2ZXJzaW9uIiwiaW5zZXJ0Iiwic2Vzc2lvbl9pZCIsIm9wc19qc29uIiwicmVhc29uIiwic291cmNlIiwiZ2VuZXJhdGVDb3NQYXRjaEZyb21Nb2RlbCIsInRyYW5zY3JpcHRzUmVwbyIsInRyYW5zY3JpcHRzIiwiUHJvbWlzZSIsImV4aXN0aW5nIiwibWVzc2FnZXMiLCJyb2xlIiwiY29udGVudCIsIkpTT04iLCJzdHJpbmdpZnkiLCJ0eXBlIiwic3RhcnRlZF9hdCIsImVuZGVkX2F0IiwibWFwIiwidCIsInRzIiwidGltZXN0YW1wIiwiY3JlYXRlZF9hdCIsInNwZWFrZXIiLCJ0ZXh0IiwiU3RyaW5nIiwiY29udGVudF9lbmMiLCJ0ZXh0X2VuYyIsInRvb2xzIiwiZnVuY3Rpb24iLCJuYW1lIiwiZGVzY3JpcHRpb24iLCJwYXJhbWV0ZXJzIiwicHJvcGVydGllcyIsIm9wZXJhdGlvbnMiLCJtaW5JdGVtcyIsIml0ZW1zIiwiZW51bSIsInJlcXVpcmVkIiwiYWRkaXRpb25hbFByb3BlcnRpZXMiLCJzdGF0ZSIsImhhbmRsZXJzIiwic3VibWl0X3BhdGNoX29wcyIsImFyZ3MiLCJBcnJheSIsImlzQXJyYXkiLCJ1bmRlZmluZWQiLCJsYXN0RXJyIiwiYXR0ZW1wdCIsIm1vZGVsIiwicHJvY2VzcyIsImVudiIsIk9QRU5ST1VURVJfVE9PTF9NT0RFTCIsIk9QRU5ST1VURVJfTU9ERUwiLCJwYXJhbGxlbFRvb2xDYWxscyIsIm1heFRvb2xJdGVyYXRpb25zIiwicmV0dXJuT25Ub29sQ2FsbCIsInByb3ZpZGVyU29ydCIsInRlbXBlcmF0dXJlIiwidGltZW91dE1zIiwiciIsInNldFRpbWVvdXQiLCJhcHBsaWVkIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/server/services/chance-of-sale-patch.ts\n");

/***/ })

};
;