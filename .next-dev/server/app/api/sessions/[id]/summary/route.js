/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/sessions/[id]/summary/route";
exports.ids = ["app/api/sessions/[id]/summary/route"];
exports.modules = {

/***/ "(rsc)/./node_modules/.pnpm/next@15.2.2_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fsessions%2F%5Bid%5D%2Fsummary%2Froute&page=%2Fapi%2Fsessions%2F%5Bid%5D%2Fsummary%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsessions%2F%5Bid%5D%2Fsummary%2Froute.ts&appDir=D%3A%5CDelta%20IV%5CSofwares%5Cglass%5Csandbox%5Cshadcn-crm-dashboard%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CDelta%20IV%5CSofwares%5Cglass%5Csandbox%5Cshadcn-crm-dashboard&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/next@15.2.2_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fsessions%2F%5Bid%5D%2Fsummary%2Froute&page=%2Fapi%2Fsessions%2F%5Bid%5D%2Fsummary%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsessions%2F%5Bid%5D%2Fsummary%2Froute.ts&appDir=D%3A%5CDelta%20IV%5CSofwares%5Cglass%5Csandbox%5Cshadcn-crm-dashboard%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CDelta%20IV%5CSofwares%5Cglass%5Csandbox%5Cshadcn-crm-dashboard&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/.pnpm/next@15.2.2_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/.pnpm/next@15.2.2_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/.pnpm/next@15.2.2_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var D_Delta_IV_Sofwares_glass_sandbox_shadcn_crm_dashboard_src_app_api_sessions_id_summary_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/sessions/[id]/summary/route.ts */ \"(rsc)/./src/app/api/sessions/[id]/summary/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/sessions/[id]/summary/route\",\n        pathname: \"/api/sessions/[id]/summary\",\n        filename: \"route\",\n        bundlePath: \"app/api/sessions/[id]/summary/route\"\n    },\n    resolvedPagePath: \"D:\\\\Delta IV\\\\Sofwares\\\\glass\\\\sandbox\\\\shadcn-crm-dashboard\\\\src\\\\app\\\\api\\\\sessions\\\\[id]\\\\summary\\\\route.ts\",\n    nextConfigOutput,\n    userland: D_Delta_IV_Sofwares_glass_sandbox_shadcn_crm_dashboard_src_app_api_sessions_id_summary_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbmV4dEAxNS4yLjJfcmVhY3QtZG9tQDE5LjEuMV9yZWFjdEAxOS4xLjFfX3JlYWN0QDE5LjEuMS9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIvaW5kZXguanM/bmFtZT1hcHAlMkZhcGklMkZzZXNzaW9ucyUyRiU1QmlkJTVEJTJGc3VtbWFyeSUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGc2Vzc2lvbnMlMkYlNUJpZCU1RCUyRnN1bW1hcnklMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZzZXNzaW9ucyUyRiU1QmlkJTVEJTJGc3VtbWFyeSUyRnJvdXRlLnRzJmFwcERpcj1EJTNBJTVDRGVsdGElMjBJViU1Q1NvZndhcmVzJTVDZ2xhc3MlNUNzYW5kYm94JTVDc2hhZGNuLWNybS1kYXNoYm9hcmQlNUNzcmMlNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUQlM0ElNUNEZWx0YSUyMElWJTVDU29md2FyZXMlNUNnbGFzcyU1Q3NhbmRib3glNUNzaGFkY24tY3JtLWRhc2hib2FyZCZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBK0Y7QUFDdkM7QUFDcUI7QUFDOEQ7QUFDM0k7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLHlHQUFtQjtBQUMzQztBQUNBLGNBQWMsa0VBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxzREFBc0Q7QUFDOUQ7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDMEY7O0FBRTFGIiwic291cmNlcyI6WyIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIkQ6XFxcXERlbHRhIElWXFxcXFNvZndhcmVzXFxcXGdsYXNzXFxcXHNhbmRib3hcXFxcc2hhZGNuLWNybS1kYXNoYm9hcmRcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxcc2Vzc2lvbnNcXFxcW2lkXVxcXFxzdW1tYXJ5XFxcXHJvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9zZXNzaW9ucy9baWRdL3N1bW1hcnkvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9zZXNzaW9ucy9baWRdL3N1bW1hcnlcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL3Nlc3Npb25zL1tpZF0vc3VtbWFyeS9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIkQ6XFxcXERlbHRhIElWXFxcXFNvZndhcmVzXFxcXGdsYXNzXFxcXHNhbmRib3hcXFxcc2hhZGNuLWNybS1kYXNoYm9hcmRcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxcc2Vzc2lvbnNcXFxcW2lkXVxcXFxzdW1tYXJ5XFxcXHJvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgd29ya0FzeW5jU3RvcmFnZSwgd29ya1VuaXRBc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgd29ya0FzeW5jU3RvcmFnZSxcbiAgICAgICAgd29ya1VuaXRBc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCB3b3JrQXN5bmNTdG9yYWdlLCB3b3JrVW5pdEFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/next@15.2.2_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fsessions%2F%5Bid%5D%2Fsummary%2Froute&page=%2Fapi%2Fsessions%2F%5Bid%5D%2Fsummary%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsessions%2F%5Bid%5D%2Fsummary%2Froute.ts&appDir=D%3A%5CDelta%20IV%5CSofwares%5Cglass%5Csandbox%5Cshadcn-crm-dashboard%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CDelta%20IV%5CSofwares%5Cglass%5Csandbox%5Cshadcn-crm-dashboard&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/next@15.2.2_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!*********************************************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/next@15.2.2_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \*********************************************************************************************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(rsc)/./src/app/api/sessions/[id]/summary/route.ts":
/*!****************************************************!*\
  !*** ./src/app/api/sessions/[id]/summary/route.ts ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   runtime: () => (/* binding */ runtime)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/.pnpm/next@15.2.2_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/api/server.js\");\n/* harmony import */ var _supabase_ssr__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/ssr */ \"(rsc)/./node_modules/.pnpm/@supabase+ssr@0.7.0_@supabase+supabase-js@2.57.4/node_modules/@supabase/ssr/dist/module/index.js\");\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/.pnpm/next@15.2.2_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/api/headers.js\");\n/* harmony import */ var _server_repositories_reports_v3_tabs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/server/repositories/reports-v3-tabs */ \"(rsc)/./src/server/repositories/reports-v3-tabs.ts\");\n/* harmony import */ var _server_services_summary_report__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/server/services/summary-report */ \"(rsc)/./src/server/services/summary-report.ts\");\n\n\n\n\n\nasync function getServerClient() {\n    const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_2__.cookies)();\n    return (0,_supabase_ssr__WEBPACK_IMPORTED_MODULE_1__.createServerClient)(\"https://hewpwluinbwaizwqhmjc.supabase.co\", \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhld3B3bHVpbmJ3YWl6d3FobWpjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5MTU5NTEsImV4cCI6MjA3MjQ5MTk1MX0.jhKzLYPdixxI8zcH20kkzL1WgP9RB33FeHtO0FRY7r4\", {\n        cookies: {\n            getAll () {\n                return cookieStore.getAll();\n            },\n            setAll (cookiesToSet) {\n                cookiesToSet.forEach(({ name, value, options })=>cookieStore.set(name, value, options));\n            }\n        }\n    });\n}\nasync function GET(request, { params }) {\n    try {\n        const supabase = await getServerClient();\n        const { data: { user } } = await supabase.auth.getUser();\n        if (!user) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Unauthorized'\n        }, {\n            status: 401\n        });\n        const { id } = await params;\n        const repo = new _server_repositories_reports_v3_tabs__WEBPACK_IMPORTED_MODULE_3__.ReportsV3TabsRepository(supabase);\n        const row = await repo.findBySessionId(id, user.id);\n        if (!row) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Not found'\n        }, {\n            status: 404\n        });\n        const rep = row.report || {};\n        const markdown = typeof rep.markdown === 'string' && rep.markdown.trim().length > 0 ? rep.markdown : typeof rep.raw_markdown === 'string' && rep.raw_markdown.trim().length > 0 ? rep.raw_markdown : null;\n        if (!markdown && (row.status === 'queued' || row.status === 'running')) {\n            // Best-effort: ensure generation is triggered when stale\n            Promise.resolve().then(async ()=>{\n                try {\n                    await fetch(`${new URL(request.url).origin}/api/sessions/${id}/summary`, {\n                        method: 'POST'\n                    });\n                } catch  {}\n            }).catch(()=>{});\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            session_id: row.session_id,\n            markdown,\n            status: row.status,\n            attempts: row.attempts,\n            last_error: row.last_error\n        });\n    } catch (error) {\n        console.error('[summary] GET error', error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Internal server error'\n        }, {\n            status: 500\n        });\n    }\n}\nasync function POST(request, { params }) {\n    try {\n        const supabase = await getServerClient();\n        const { data: { user } } = await supabase.auth.getUser();\n        if (!user) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Unauthorized'\n        }, {\n            status: 401\n        });\n        const { id } = await params;\n        // In-app generation preferred\n        Promise.resolve().then(async ()=>{\n            try {\n                await (0,_server_services_summary_report__WEBPACK_IMPORTED_MODULE_4__.generateSummaryReport)(supabase, user.id, id);\n            } catch (e) {\n                console.error('[summary] async generation error', e);\n                // Optional fallback: edge function trigger\n                if (process.env.SUMMARY_USE_EDGE === 'true') {\n                    try {\n                        const projectUrl = \"https://hewpwluinbwaizwqhmjc.supabase.co\";\n                        const projectRef = new URL(projectUrl).hostname.split('.')[0];\n                        const fnUrl = `https://${projectRef}.supabase.co/functions/v1/generate-reports`;\n                        const auth = process.env.SUPABASE_SERVICE_ROLE_KEY || \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhld3B3bHVpbmJ3YWl6d3FobWpjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5MTU5NTEsImV4cCI6MjA3MjQ5MTk1MX0.jhKzLYPdixxI8zcH20kkzL1WgP9RB33FeHtO0FRY7r4\";\n                        await fetch(fnUrl, {\n                            method: 'POST',\n                            headers: {\n                                'Content-Type': 'application/json',\n                                'Authorization': `Bearer ${auth}`\n                            },\n                            body: JSON.stringify({\n                                session_id: id\n                            })\n                        });\n                    } catch  {}\n                }\n            }\n        }).catch(()=>{});\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            accepted: true\n        }, {\n            status: 202\n        });\n    } catch (error) {\n        console.error('[summary] POST error', error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Failed to trigger summary generation'\n        }, {\n            status: 500\n        });\n    }\n}\nconst runtime = 'nodejs';\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9zZXNzaW9ucy9baWRdL3N1bW1hcnkvcm91dGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBdUQ7QUFDTDtBQUNaO0FBQ3lDO0FBQ1A7QUFFeEUsZUFBZUs7SUFDYixNQUFNQyxjQUFjLE1BQU1KLHFEQUFPQTtJQUNqQyxPQUFPRCxpRUFBa0JBLENBQ3ZCTSwwQ0FBb0MsRUFDcENBLGtOQUF5QyxFQUN6QztRQUNFTCxTQUFTO1lBQ1BTO2dCQUFXLE9BQU9MLFlBQVlLLE1BQU07WUFBRztZQUN2Q0MsUUFBT0MsWUFBWTtnQkFBSUEsYUFBYUMsT0FBTyxDQUFDLENBQUMsRUFBRUMsSUFBSSxFQUFFQyxLQUFLLEVBQUVDLE9BQU8sRUFBRSxHQUFLWCxZQUFZWSxHQUFHLENBQUNILE1BQU1DLE9BQU9DO1lBQVU7UUFDbkg7SUFDRjtBQUVKO0FBRU8sZUFBZUUsSUFDcEJDLE9BQW9CLEVBQ3BCLEVBQUVDLE1BQU0sRUFBdUM7SUFFL0MsSUFBSTtRQUNGLE1BQU1DLFdBQVcsTUFBTWpCO1FBQ3ZCLE1BQU0sRUFBRWtCLE1BQU0sRUFBRUMsSUFBSSxFQUFFLEVBQUUsR0FBRyxNQUFNRixTQUFTRyxJQUFJLENBQUNDLE9BQU87UUFDdEQsSUFBSSxDQUFDRixNQUFNLE9BQU94QixxREFBWUEsQ0FBQzJCLElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQWUsR0FBRztZQUFFQyxRQUFRO1FBQUk7UUFDN0UsTUFBTSxFQUFFQyxFQUFFLEVBQUUsR0FBRyxNQUFNVDtRQUNyQixNQUFNVSxPQUFPLElBQUk1Qix5RkFBdUJBLENBQUNtQjtRQUN6QyxNQUFNVSxNQUFNLE1BQU1ELEtBQUtFLGVBQWUsQ0FBQ0gsSUFBSU4sS0FBS00sRUFBRTtRQUNsRCxJQUFJLENBQUNFLEtBQUssT0FBT2hDLHFEQUFZQSxDQUFDMkIsSUFBSSxDQUFDO1lBQUVDLE9BQU87UUFBWSxHQUFHO1lBQUVDLFFBQVE7UUFBSTtRQUN6RSxNQUFNSyxNQUFXLElBQWFDLE1B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QUFFdUMsVUFBVTtRQUFLLEdBQUc7WUFBRXJDLFFBQVE7UUFBSTtJQUM3RCxFQUFFLE9BQU9ELE9BQU87UUFDZHdCLFFBQVF4QixLQUFLLENBQUMsd0JBQXdCQTtRQUN0QyxPQUFPNUIscURBQVlBLENBQUMyQixJQUFJLENBQUM7WUFBRUMsT0FBTztRQUF1QyxHQUFHO1lBQUVDLFFBQVE7UUFBSTtJQUM1RjtBQUNGO0FBQ08sTUFBTXNDLFVBQVUsU0FBUSIsInNvdXJjZXMiOlsiRDpcXERlbHRhIElWXFxTb2Z3YXJlc1xcZ2xhc3NcXHNhbmRib3hcXHNoYWRjbi1jcm0tZGFzaGJvYXJkXFxzcmNcXGFwcFxcYXBpXFxzZXNzaW9uc1xcW2lkXVxcc3VtbWFyeVxccm91dGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJ1xuaW1wb3J0IHsgY3JlYXRlU2VydmVyQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3NzcidcbmltcG9ydCB7IGNvb2tpZXMgfSBmcm9tICduZXh0L2hlYWRlcnMnXG5pbXBvcnQgeyBSZXBvcnRzVjNUYWJzUmVwb3NpdG9yeSB9IGZyb20gJ0Avc2VydmVyL3JlcG9zaXRvcmllcy9yZXBvcnRzLXYzLXRhYnMnXG5pbXBvcnQgeyBnZW5lcmF0ZVN1bW1hcnlSZXBvcnQgfSBmcm9tICdAL3NlcnZlci9zZXJ2aWNlcy9zdW1tYXJ5LXJlcG9ydCdcblxuYXN5bmMgZnVuY3Rpb24gZ2V0U2VydmVyQ2xpZW50KCkge1xuICBjb25zdCBjb29raWVTdG9yZSA9IGF3YWl0IGNvb2tpZXMoKVxuICByZXR1cm4gY3JlYXRlU2VydmVyQ2xpZW50KFxuICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCEsXG4gICAgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkhLFxuICAgIHtcbiAgICAgIGNvb2tpZXM6IHtcbiAgICAgICAgZ2V0QWxsKCkgeyByZXR1cm4gY29va2llU3RvcmUuZ2V0QWxsKCkgfSxcbiAgICAgICAgc2V0QWxsKGNvb2tpZXNUb1NldCkgeyBjb29raWVzVG9TZXQuZm9yRWFjaCgoeyBuYW1lLCB2YWx1ZSwgb3B0aW9ucyB9KSA9PiBjb29raWVTdG9yZS5zZXQobmFtZSwgdmFsdWUsIG9wdGlvbnMpKSB9LFxuICAgICAgfSxcbiAgICB9XG4gIClcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChcbiAgcmVxdWVzdDogTmV4dFJlcXVlc3QsXG4gIHsgcGFyYW1zIH06IHsgcGFyYW1zOiBQcm9taXNlPHsgaWQ6IHN0cmluZyB9PiB9XG4pIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGdldFNlcnZlckNsaWVudCgpXG4gICAgY29uc3QgeyBkYXRhOiB7IHVzZXIgfSB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKClcbiAgICBpZiAoIXVzZXIpIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnVW5hdXRob3JpemVkJyB9LCB7IHN0YXR1czogNDAxIH0pXG4gICAgY29uc3QgeyBpZCB9ID0gYXdhaXQgcGFyYW1zXG4gICAgY29uc3QgcmVwbyA9IG5ldyBSZXBvcnRzVjNUYWJzUmVwb3NpdG9yeShzdXBhYmFzZSBhcyBhbnkpXG4gICAgY29uc3Qgcm93ID0gYXdhaXQgcmVwby5maW5kQnlTZXNzaW9uSWQoaWQsIHVzZXIuaWQpXG4gICAgaWYgKCFyb3cpIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnTm90IGZvdW5kJyB9LCB7IHN0YXR1czogNDA0IH0pXG4gICAgY29uc3QgcmVwOiBhbnkgPSAocm93IGFzIGFueSkucmVwb3J0IHx8IHt9XG4gICAgY29uc3QgbWFya2Rvd24gPSAodHlwZW9mIHJlcC5tYXJrZG93biA9PT0gJ3N0cmluZycgJiYgcmVwLm1hcmtkb3duLnRyaW0oKS5sZW5ndGggPiAwKVxuICAgICAgPyByZXAubWFya2Rvd25cbiAgICAgIDogKHR5cGVvZiByZXAucmF3X21hcmtkb3duID09PSAnc3RyaW5nJyAmJiByZXAucmF3X21hcmtkb3duLnRyaW0oKS5sZW5ndGggPiAwKVxuICAgICAgICA/IHJlcC5yYXdfbWFya2Rvd25cbiAgICAgICAgOiBudWxsXG4gICAgaWYgKCFtYXJrZG93biAmJiAocm93LnN0YXR1cyA9PT0gJ3F1ZXVlZCcgfHwgcm93LnN0YXR1cyA9PT0gJ3J1bm5pbmcnKSkge1xuICAgICAgLy8gQmVzdC1lZmZvcnQ6IGVuc3VyZSBnZW5lcmF0aW9uIGlzIHRyaWdnZXJlZCB3aGVuIHN0YWxlXG4gICAgICBQcm9taXNlLnJlc29sdmUoKS50aGVuKGFzeW5jICgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBhd2FpdCBmZXRjaChgJHtuZXcgVVJMKHJlcXVlc3QudXJsKS5vcmlnaW59L2FwaS9zZXNzaW9ucy8ke2lkfS9zdW1tYXJ5YCwgeyBtZXRob2Q6ICdQT1NUJyB9KVxuICAgICAgICB9IGNhdGNoIHt9XG4gICAgICB9KS5jYXRjaCgoKSA9PiB7fSlcbiAgICB9XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgc2Vzc2lvbl9pZDogcm93LnNlc3Npb25faWQsIG1hcmtkb3duLCBzdGF0dXM6IHJvdy5zdGF0dXMsIGF0dGVtcHRzOiByb3cuYXR0ZW1wdHMsIGxhc3RfZXJyb3I6IHJvdy5sYXN0X2Vycm9yIH0pXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW3N1bW1hcnldIEdFVCBlcnJvcicsIGVycm9yKVxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyB9LCB7IHN0YXR1czogNTAwIH0pXG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QoXG4gIHJlcXVlc3Q6IE5leHRSZXF1ZXN0LFxuICB7IHBhcmFtcyB9OiB7IHBhcmFtczogUHJvbWlzZTx7IGlkOiBzdHJpbmcgfT4gfVxuKSB7XG4gIHRyeSB7XG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBnZXRTZXJ2ZXJDbGllbnQoKVxuICAgIGNvbnN0IHsgZGF0YTogeyB1c2VyIH0gfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpXG4gICAgaWYgKCF1c2VyKSByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ1VuYXV0aG9yaXplZCcgfSwgeyBzdGF0dXM6IDQwMSB9KVxuICAgIGNvbnN0IHsgaWQgfSA9IGF3YWl0IHBhcmFtc1xuXG4gICAgLy8gSW4tYXBwIGdlbmVyYXRpb24gcHJlZmVycmVkXG4gICAgUHJvbWlzZS5yZXNvbHZlKCkudGhlbihhc3luYyAoKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBnZW5lcmF0ZVN1bW1hcnlSZXBvcnQoc3VwYWJhc2UgYXMgYW55LCB1c2VyLmlkLCBpZClcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignW3N1bW1hcnldIGFzeW5jIGdlbmVyYXRpb24gZXJyb3InLCBlKVxuICAgICAgICAvLyBPcHRpb25hbCBmYWxsYmFjazogZWRnZSBmdW5jdGlvbiB0cmlnZ2VyXG4gICAgICAgIGlmIChwcm9jZXNzLmVudi5TVU1NQVJZX1VTRV9FREdFID09PSAndHJ1ZScpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcHJvamVjdFVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCFcbiAgICAgICAgICAgIGNvbnN0IHByb2plY3RSZWYgPSBuZXcgVVJMKHByb2plY3RVcmwpLmhvc3RuYW1lLnNwbGl0KCcuJylbMF1cbiAgICAgICAgICAgIGNvbnN0IGZuVXJsID0gYGh0dHBzOi8vJHtwcm9qZWN0UmVmfS5zdXBhYmFzZS5jby9mdW5jdGlvbnMvdjEvZ2VuZXJhdGUtcmVwb3J0c2BcbiAgICAgICAgICAgIGNvbnN0IGF1dGggPSBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIHx8IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIVxuICAgICAgICAgICAgYXdhaXQgZmV0Y2goZm5VcmwsIHsgbWV0aG9kOiAnUE9TVCcsIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJywgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7YXV0aH1gIH0sIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgc2Vzc2lvbl9pZDogaWQgfSkgfSlcbiAgICAgICAgICB9IGNhdGNoIHt9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KS5jYXRjaCgoKSA9PiB7fSlcblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGFjY2VwdGVkOiB0cnVlIH0sIHsgc3RhdHVzOiAyMDIgfSlcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbc3VtbWFyeV0gUE9TVCBlcnJvcicsIGVycm9yKVxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnRmFpbGVkIHRvIHRyaWdnZXIgc3VtbWFyeSBnZW5lcmF0aW9uJyB9LCB7IHN0YXR1czogNTAwIH0pXG4gIH1cbn1cbmV4cG9ydCBjb25zdCBydW50aW1lID0gJ25vZGVqcydcbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJjcmVhdGVTZXJ2ZXJDbGllbnQiLCJjb29raWVzIiwiUmVwb3J0c1YzVGFic1JlcG9zaXRvcnkiLCJnZW5lcmF0ZVN1bW1hcnlSZXBvcnQiLCJnZXRTZXJ2ZXJDbGllbnQiLCJjb29raWVTdG9yZSIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsImdldEFsbCIsInNldEFsbCIsImNvb2tpZXNUb1NldCIsImZvckVhY2giLCJuYW1lIiwidmFsdWUiLCJvcHRpb25zIiwic2V0IiwiR0VUIiwicmVxdWVzdCIsInBhcmFtcyIsInN1cGFiYXNlIiwiZGF0YSIsInVzZXIiLCJhdXRoIiwiZ2V0VXNlciIsImpzb24iLCJlcnJvciIsInN0YXR1cyIsImlkIiwicmVwbyIsInJvdyIsImZpbmRCeVNlc3Npb25JZCIsInJlcCIsInJlcG9ydCIsIm1hcmtkb3duIiwidHJpbSIsImxlbmd0aCIsInJhd19tYXJrZG93biIsIlByb21pc2UiLCJyZXNvbHZlIiwidGhlbiIsImZldGNoIiwiVVJMIiwidXJsIiwib3JpZ2luIiwibWV0aG9kIiwiY2F0Y2giLCJzZXNzaW9uX2lkIiwiYXR0ZW1wdHMiLCJsYXN0X2Vycm9yIiwiY29uc29sZSIsIlBPU1QiLCJlIiwiU1VNTUFSWV9VU0VfRURHRSIsInByb2plY3RVcmwiLCJwcm9qZWN0UmVmIiwiaG9zdG5hbWUiLCJzcGxpdCIsImZuVXJsIiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsImhlYWRlcnMiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImFjY2VwdGVkIiwicnVudGltZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/sessions/[id]/summary/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/repositories/reports-v3-tabs.ts":
/*!****************************************************!*\
  !*** ./src/server/repositories/reports-v3-tabs.ts ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ReportsV3TabsRepository: () => (/* binding */ ReportsV3TabsRepository)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/.pnpm/@supabase+supabase-js@2.57.4/node_modules/@supabase/supabase-js/dist/module/index.js\");\n\nconst supabaseUrl = \"https://hewpwluinbwaizwqhmjc.supabase.co\";\nconst supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhld3B3bHVpbmJ3YWl6d3FobWpjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5MTU5NTEsImV4cCI6MjA3MjQ5MTk1MX0.jhKzLYPdixxI8zcH20kkzL1WgP9RB33FeHtO0FRY7r4\";\nconst defaultClient = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey);\nfunction mapDbReportTabs(row) {\n    return {\n        session_id: row.session_id,\n        report: row.report_json && Object.keys(row.report_json).length > 0 ? row.report_json : null,\n        status: row.status,\n        attempts: row.attempts ?? 0,\n        last_error: row.last_error ?? null,\n        created_at: row.created_at,\n        updated_at: row.updated_at\n    };\n}\nclass ReportsV3TabsRepository {\n    constructor(supabase = defaultClient){\n        this.supabase = supabase;\n    }\n    async findBySessionId(sessionId, _userId) {\n        const { data: row, error } = await this.supabase.from('session_reports_v3_tabs').select('session_id, report_json, status, attempts, last_error, created_at, updated_at').eq('session_id', sessionId).single();\n        if (error) {\n            if (error.code === 'PGRST116') return null;\n            console.error('[reports-v3-tabs] findBySessionId error', {\n                code: error.code,\n                message: error.message,\n                sessionId\n            });\n            return null;\n        }\n        return mapDbReportTabs(row);\n    }\n    async upsertQueued(sessionId) {\n        const payload = {\n            session_id: sessionId,\n            status: 'queued',\n            report_json: {},\n            attempts: 0,\n            last_error: null\n        };\n        const { data, error } = await this.supabase.from('session_reports_v3_tabs').upsert(payload, {\n            onConflict: 'session_id'\n        }).select('session_id, report_json, status, attempts, last_error, created_at, updated_at').single();\n        if (error) throw new Error(`Failed to upsert queued tabs report: ${error.message}`);\n        return mapDbReportTabs(data);\n    }\n    async setRunning(sessionId) {\n        const { data, error } = await this.supabase.from('session_reports_v3_tabs').update({\n            status: 'running'\n        }).eq('session_id', sessionId).select('session_id, report_json, status, attempts, last_error, created_at, updated_at').single();\n        if (error) throw new Error(`Failed to set tabs running: ${error.message}`);\n        return mapDbReportTabs(data);\n    }\n    async incrementAttempts(sessionId) {\n        const { data, error } = await this.supabase.rpc('increment_report_tabs_attempts', {\n            p_session_id: sessionId\n        });\n        // If helper function not present, fall back to update with expression\n        if (error) {\n            const { data: row, error: updErr } = await this.supabase.from('session_reports_v3_tabs').update({\n                attempts: await (async ()=>{\n                    const { data: cur } = await this.supabase.from('session_reports_v3_tabs').select('attempts').eq('session_id', sessionId).single();\n                    return (cur?.attempts ?? 0) + 1;\n                })()\n            }).eq('session_id', sessionId).select('session_id, report_json, status, attempts, last_error, created_at, updated_at').single();\n            if (updErr) throw new Error(`Failed to increment tabs attempts: ${updErr.message}`);\n            return mapDbReportTabs(row);\n        }\n        // If RPC succeeded, fetch to map\n        const { data: row2, error: selErr } = await this.supabase.from('session_reports_v3_tabs').select('session_id, report_json, status, attempts, last_error, created_at, updated_at').eq('session_id', sessionId).single();\n        if (selErr) throw new Error(`Failed to fetch tabs attempts: ${selErr.message}`);\n        return mapDbReportTabs(row2);\n    }\n    async setReady(sessionId, report) {\n        const { data, error } = await this.supabase.from('session_reports_v3_tabs').update({\n            status: 'ready',\n            report_json: report,\n            last_error: null\n        }).eq('session_id', sessionId).select('session_id, report_json, status, attempts, last_error, created_at, updated_at').single();\n        if (error) throw new Error(`Failed to set tabs ready: ${error.message}`);\n        return mapDbReportTabs(data);\n    }\n    async setFailed(sessionId, errorMsg) {\n        const { data, error } = await this.supabase.from('session_reports_v3_tabs').update({\n            status: 'failed',\n            last_error: errorMsg\n        }).eq('session_id', sessionId).select('session_id, report_json, status, attempts, last_error, created_at, updated_at').single();\n        if (error) throw new Error(`Failed to set tabs failed: ${error.message}`);\n        return mapDbReportTabs(data);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3JlcG9zaXRvcmllcy9yZXBvcnRzLXYzLXRhYnMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBb0Q7QUFFcEQsTUFBTUMsY0FBY0MsMENBQW9DO0FBQ3hELE1BQU1HLGtCQUFrQkgsa05BQXlDO0FBQ2pFLE1BQU1LLGdCQUFnQlAsbUVBQVlBLENBQUNDLGFBQWFJO0FBTWhELFNBQVNHLGdCQUFnQkMsR0FBUTtJQUNoQyxPQUFPO1FBQ05DLFlBQVlELElBQUlDLFVBQVU7UUFDMUJDLFFBQVEsSUFBS0MsV0FBVyxJQUFJQyxPQUFPQyxJQUFJLENBQUNMLElBQUlHLFdBQVcsRUFBRUcsTUFBTSxHQUFHLElBQUtOLElBQUlHLFdBQVcsR0FBRztRQUN6RkksUUFBUVAsSUFBSU8sTUFBTTtRQUNsQkMsVUFBVVIsSUFBSVEsUUFBUSxJQUFJO1FBQzFCQyxZQUFZVCxJQUFJUyxVQUFVLElBQUk7UUFDOUJDLFlBQVlWLElBQUlVLFVBQVU7UUFDMUJDLFlBQVlYLElBQUlXLFVBQVU7SUFDM0I7QUFDRDtBQUVPLE1BQU1DO0lBQ1pDLFlBQVksV0FBc0NmLGFBQWEsQ0FBRTthQUE3Q2dCLFdBQUFBO0lBQThDO0lBRWxFLE1BQU1DLGdCQUFnQkMsU0FBaUIsRUFBRUMsT0FBZSxFQUFFO1FBQ3pELE1BQU0sRUFBRUMsTUFBTWxCLEdBQUcsRUFBRW1CLEtBQUssRUFBRSxHQUFHLE1BQU0sSUFBSSxDQUFDTCxRQUFRLENBQzlDTSxJQUFJLENBQUMsMkJBQ0xDLE1BQU0sQ0FBQyxpRkFDUEMsRUFBRSxDQUFDLGNBQWNOLFdBQ2pCTyxNQUFNO1FBQ1IsSUFBSUosT0FBTztZQUNWLElBQUksTUFBZUssSUFBSSxLQUFLLFlBQVksT0FBTztZQUMvQ0MsUUFBUU4sS0FBSyxDQUFDLDJDQUEyQztnQkFBRUssTUFBTSxNQUFlQSxJQUFJO2dCQUFFRSxTQUFTUCxNQUFNTyxPQUFPO2dCQUFFVjtZQUFVO1lBQ3hILE9BQU87UUFDUjtRQUNBLE9BQU9qQixnQkFBZ0JD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QUMsMEJBQTBCLEVBQUVaLE1BQU1PLE9BQU8sRUFBRTtRQUN2RSxPQUFPM0IsZ0JBQWdCbUI7SUFDeEI7SUFFQSxNQUFNd0IsVUFBVTFCLFNBQWlCLEVBQUUyQixRQUFnQixFQUFFO1FBQ3BELE1BQU0sRUFBRXpCLElBQUksRUFBRUMsS0FBSyxFQUFFLEdBQUcsTUFBTSxJQUFJLENBQUNMLFFBQVEsQ0FDekNNLElBQUksQ0FBQywyQkFDTGEsTUFBTSxDQUFDO1lBQUUxQixRQUFRO1lBQVVFLFlBQVlrQztRQUFTLEdBQ2hEckIsRUFBRSxDQUFDLGNBQWNOLFdBQ2pCSyxNQUFNLENBQUMsaUZBQ1BFLE1BQU07UUFDUixJQUFJSixPQUFPLE1BQU0sSUFBSVksTUFBTSxDQUFDLDJCQUEyQixFQUFFWixNQUFNTyxPQUFPLEVBQUU7UUFDeEUsT0FBTzNCLGdCQUFnQm1CO0lBQ3hCO0FBQ0QiLCJzb3VyY2VzIjpbIkQ6XFxEZWx0YSBJVlxcU29md2FyZXNcXGdsYXNzXFxzYW5kYm94XFxzaGFkY24tY3JtLWRhc2hib2FyZFxcc3JjXFxzZXJ2ZXJcXHJlcG9zaXRvcmllc1xccmVwb3J0cy12My10YWJzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcydcclxuXHJcbmNvbnN0IHN1cGFiYXNlVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIVxyXG5jb25zdCBzdXBhYmFzZUFub25LZXkgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSFcclxuY29uc3QgZGVmYXVsdENsaWVudCA9IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VBbm9uS2V5KVxyXG5cclxudHlwZSBTdXBhYmFzZUNsaWVudEFueSA9IHR5cGVvZiBkZWZhdWx0Q2xpZW50XHJcblxyXG5leHBvcnQgdHlwZSBSZXBvcnREYXRhVjNUYWJzID0gYW55XHJcblxyXG5mdW5jdGlvbiBtYXBEYlJlcG9ydFRhYnMocm93OiBhbnkpOiB7IHNlc3Npb25faWQ6IHN0cmluZzsgcmVwb3J0OiBSZXBvcnREYXRhVjNUYWJzIHwgbnVsbDsgc3RhdHVzOiBzdHJpbmc7IGF0dGVtcHRzOiBudW1iZXI7IGxhc3RfZXJyb3I/OiBzdHJpbmcgfCBudWxsOyBjcmVhdGVkX2F0Pzogc3RyaW5nOyB1cGRhdGVkX2F0Pzogc3RyaW5nIH0ge1xyXG5cdHJldHVybiB7XHJcblx0XHRzZXNzaW9uX2lkOiByb3cuc2Vzc2lvbl9pZCxcclxuXHRcdHJlcG9ydDogKHJvdy5yZXBvcnRfanNvbiAmJiBPYmplY3Qua2V5cyhyb3cucmVwb3J0X2pzb24pLmxlbmd0aCA+IDApID8gcm93LnJlcG9ydF9qc29uIDogbnVsbCxcclxuXHRcdHN0YXR1czogcm93LnN0YXR1cyxcclxuXHRcdGF0dGVtcHRzOiByb3cuYXR0ZW1wdHMgPz8gMCxcclxuXHRcdGxhc3RfZXJyb3I6IHJvdy5sYXN0X2Vycm9yID8/IG51bGwsXHJcblx0XHRjcmVhdGVkX2F0OiByb3cuY3JlYXRlZF9hdCxcclxuXHRcdHVwZGF0ZWRfYXQ6IHJvdy51cGRhdGVkX2F0LFxyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFJlcG9ydHNWM1RhYnNSZXBvc2l0b3J5IHtcclxuXHRjb25zdHJ1Y3Rvcihwcml2YXRlIHN1cGFiYXNlOiBTdXBhYmFzZUNsaWVudEFueSA9IGRlZmF1bHRDbGllbnQpIHt9XHJcblxyXG5cdGFzeW5jIGZpbmRCeVNlc3Npb25JZChzZXNzaW9uSWQ6IHN0cmluZywgX3VzZXJJZDogc3RyaW5nKSB7XHJcblx0XHRjb25zdCB7IGRhdGE6IHJvdywgZXJyb3IgfSA9IGF3YWl0IHRoaXMuc3VwYWJhc2VcclxuXHRcdFx0LmZyb20oJ3Nlc3Npb25fcmVwb3J0c192M190YWJzJylcclxuXHRcdFx0LnNlbGVjdCgnc2Vzc2lvbl9pZCwgcmVwb3J0X2pzb24sIHN0YXR1cywgYXR0ZW1wdHMsIGxhc3RfZXJyb3IsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXQnKVxyXG5cdFx0XHQuZXEoJ3Nlc3Npb25faWQnLCBzZXNzaW9uSWQpXHJcblx0XHRcdC5zaW5nbGUoKVxyXG5cdFx0aWYgKGVycm9yKSB7XHJcblx0XHRcdGlmICgoZXJyb3IgYXMgYW55KS5jb2RlID09PSAnUEdSU1QxMTYnKSByZXR1cm4gbnVsbFxyXG5cdFx0XHRjb25zb2xlLmVycm9yKCdbcmVwb3J0cy12My10YWJzXSBmaW5kQnlTZXNzaW9uSWQgZXJyb3InLCB7IGNvZGU6IChlcnJvciBhcyBhbnkpLmNvZGUsIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsIHNlc3Npb25JZCB9KVxyXG5cdFx0XHRyZXR1cm4gbnVsbFxyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIG1hcERiUmVwb3J0VGFicyhyb3cpXHJcblx0fVxyXG5cclxuXHRhc3luYyB1cHNlcnRRdWV1ZWQoc2Vzc2lvbklkOiBzdHJpbmcpIHtcclxuXHRcdGNvbnN0IHBheWxvYWQgPSB7IFxyXG5cdFx0XHRzZXNzaW9uX2lkOiBzZXNzaW9uSWQsIFxyXG5cdFx0XHRzdGF0dXM6ICdxdWV1ZWQnIGFzIGNvbnN0LCBcclxuXHRcdFx0cmVwb3J0X2pzb246IHt9LFxyXG5cdFx0XHRhdHRlbXB0czogMCxcclxuXHRcdFx0bGFzdF9lcnJvcjogbnVsbFxyXG5cdFx0fVxyXG5cdFx0Y29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxyXG5cdFx0XHQuZnJvbSgnc2Vzc2lvbl9yZXBvcnRzX3YzX3RhYnMnKVxyXG5cdFx0XHQudXBzZXJ0KHBheWxvYWQsIHsgb25Db25mbGljdDogJ3Nlc3Npb25faWQnIH0pXHJcblx0XHRcdC5zZWxlY3QoJ3Nlc3Npb25faWQsIHJlcG9ydF9qc29uLCBzdGF0dXMsIGF0dGVtcHRzLCBsYXN0X2Vycm9yLCBjcmVhdGVkX2F0LCB1cGRhdGVkX2F0JylcclxuXHRcdFx0LnNpbmdsZSgpXHJcblx0XHRpZiAoZXJyb3IpIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHVwc2VydCBxdWV1ZWQgdGFicyByZXBvcnQ6ICR7ZXJyb3IubWVzc2FnZX1gKVxyXG5cdFx0cmV0dXJuIG1hcERiUmVwb3J0VGFicyhkYXRhKVxyXG5cdH1cclxuXHJcblx0YXN5bmMgc2V0UnVubmluZyhzZXNzaW9uSWQ6IHN0cmluZykge1xyXG5cdFx0Y29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxyXG5cdFx0XHQuZnJvbSgnc2Vzc2lvbl9yZXBvcnRzX3YzX3RhYnMnKVxyXG5cdFx0XHQudXBkYXRlKHsgc3RhdHVzOiAncnVubmluZycgfSlcclxuXHRcdFx0LmVxKCdzZXNzaW9uX2lkJywgc2Vzc2lvbklkKVxyXG5cdFx0XHQuc2VsZWN0KCdzZXNzaW9uX2lkLCByZXBvcnRfanNvbiwgc3RhdHVzLCBhdHRlbXB0cywgbGFzdF9lcnJvciwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdCcpXHJcblx0XHRcdC5zaW5nbGUoKVxyXG5cdFx0aWYgKGVycm9yKSB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBzZXQgdGFicyBydW5uaW5nOiAke2Vycm9yLm1lc3NhZ2V9YClcclxuXHRcdHJldHVybiBtYXBEYlJlcG9ydFRhYnMoZGF0YSlcclxuXHR9XHJcblxyXG5cdGFzeW5jIGluY3JlbWVudEF0dGVtcHRzKHNlc3Npb25JZDogc3RyaW5nKSB7XHJcblx0XHRjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCB0aGlzLnN1cGFiYXNlXHJcblx0XHRcdC5ycGMoJ2luY3JlbWVudF9yZXBvcnRfdGFic19hdHRlbXB0cycsIHsgcF9zZXNzaW9uX2lkOiBzZXNzaW9uSWQgfSlcclxuXHRcdC8vIElmIGhlbHBlciBmdW5jdGlvbiBub3QgcHJlc2VudCwgZmFsbCBiYWNrIHRvIHVwZGF0ZSB3aXRoIGV4cHJlc3Npb25cclxuXHRcdGlmIChlcnJvcikge1xyXG5cdFx0XHRjb25zdCB7IGRhdGE6IHJvdywgZXJyb3I6IHVwZEVyciB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxyXG5cdFx0XHRcdC5mcm9tKCdzZXNzaW9uX3JlcG9ydHNfdjNfdGFicycpXHJcblx0XHRcdFx0LnVwZGF0ZSh7IGF0dGVtcHRzOiAoYXdhaXQgKGFzeW5jICgpID0+IHtcclxuXHRcdFx0XHRcdGNvbnN0IHsgZGF0YTogY3VyIH0gPSBhd2FpdCB0aGlzLnN1cGFiYXNlXHJcblx0XHRcdFx0XHRcdC5mcm9tKCdzZXNzaW9uX3JlcG9ydHNfdjNfdGFicycpXHJcblx0XHRcdFx0XHRcdC5zZWxlY3QoJ2F0dGVtcHRzJylcclxuXHRcdFx0XHRcdFx0LmVxKCdzZXNzaW9uX2lkJywgc2Vzc2lvbklkKVxyXG5cdFx0XHRcdFx0XHQuc2luZ2xlKClcclxuXHRcdFx0XHRcdHJldHVybiAoY3VyPy5hdHRlbXB0cyA/PyAwKSArIDFcclxuXHRcdFx0XHR9KSgpKSB9KVxyXG5cdFx0XHRcdC5lcSgnc2Vzc2lvbl9pZCcsIHNlc3Npb25JZClcclxuXHRcdFx0XHQuc2VsZWN0KCdzZXNzaW9uX2lkLCByZXBvcnRfanNvbiwgc3RhdHVzLCBhdHRlbXB0cywgbGFzdF9lcnJvciwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdCcpXHJcblx0XHRcdFx0LnNpbmdsZSgpXHJcblx0XHRcdGlmICh1cGRFcnIpIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGluY3JlbWVudCB0YWJzIGF0dGVtcHRzOiAke3VwZEVyci5tZXNzYWdlfWApXHJcblx0XHRcdHJldHVybiBtYXBEYlJlcG9ydFRhYnMocm93KVxyXG5cdFx0fVxyXG5cdFx0Ly8gSWYgUlBDIHN1Y2NlZWRlZCwgZmV0Y2ggdG8gbWFwXHJcblx0XHRjb25zdCB7IGRhdGE6IHJvdzIsIGVycm9yOiBzZWxFcnIgfSA9IGF3YWl0IHRoaXMuc3VwYWJhc2VcclxuXHRcdFx0LmZyb20oJ3Nlc3Npb25fcmVwb3J0c192M190YWJzJylcclxuXHRcdFx0LnNlbGVjdCgnc2Vzc2lvbl9pZCwgcmVwb3J0X2pzb24sIHN0YXR1cywgYXR0ZW1wdHMsIGxhc3RfZXJyb3IsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXQnKVxyXG5cdFx0XHQuZXEoJ3Nlc3Npb25faWQnLCBzZXNzaW9uSWQpXHJcblx0XHRcdC5zaW5nbGUoKVxyXG5cdFx0aWYgKHNlbEVycikgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZmV0Y2ggdGFicyBhdHRlbXB0czogJHtzZWxFcnIubWVzc2FnZX1gKVxyXG5cdFx0cmV0dXJuIG1hcERiUmVwb3J0VGFicyhyb3cyKVxyXG5cdH1cclxuXHJcblx0YXN5bmMgc2V0UmVhZHkoc2Vzc2lvbklkOiBzdHJpbmcsIHJlcG9ydDogUmVwb3J0RGF0YVYzVGFicykge1xyXG5cdFx0Y29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxyXG5cdFx0XHQuZnJvbSgnc2Vzc2lvbl9yZXBvcnRzX3YzX3RhYnMnKVxyXG5cdFx0XHQudXBkYXRlKHsgc3RhdHVzOiAncmVhZHknLCByZXBvcnRfanNvbjogcmVwb3J0LCBsYXN0X2Vycm9yOiBudWxsIH0pXHJcblx0XHRcdC5lcSgnc2Vzc2lvbl9pZCcsIHNlc3Npb25JZClcclxuXHRcdFx0LnNlbGVjdCgnc2Vzc2lvbl9pZCwgcmVwb3J0X2pzb24sIHN0YXR1cywgYXR0ZW1wdHMsIGxhc3RfZXJyb3IsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXQnKVxyXG5cdFx0XHQuc2luZ2xlKClcclxuXHRcdGlmIChlcnJvcikgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gc2V0IHRhYnMgcmVhZHk6ICR7ZXJyb3IubWVzc2FnZX1gKVxyXG5cdFx0cmV0dXJuIG1hcERiUmVwb3J0VGFicyhkYXRhKVxyXG5cdH1cclxuXHJcblx0YXN5bmMgc2V0RmFpbGVkKHNlc3Npb25JZDogc3RyaW5nLCBlcnJvck1zZzogc3RyaW5nKSB7XHJcblx0XHRjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCB0aGlzLnN1cGFiYXNlXHJcblx0XHRcdC5mcm9tKCdzZXNzaW9uX3JlcG9ydHNfdjNfdGFicycpXHJcblx0XHRcdC51cGRhdGUoeyBzdGF0dXM6ICdmYWlsZWQnLCBsYXN0X2Vycm9yOiBlcnJvck1zZyB9KVxyXG5cdFx0XHQuZXEoJ3Nlc3Npb25faWQnLCBzZXNzaW9uSWQpXHJcblx0XHRcdC5zZWxlY3QoJ3Nlc3Npb25faWQsIHJlcG9ydF9qc29uLCBzdGF0dXMsIGF0dGVtcHRzLCBsYXN0X2Vycm9yLCBjcmVhdGVkX2F0LCB1cGRhdGVkX2F0JylcclxuXHRcdFx0LnNpbmdsZSgpXHJcblx0XHRpZiAoZXJyb3IpIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHNldCB0YWJzIGZhaWxlZDogJHtlcnJvci5tZXNzYWdlfWApXHJcblx0XHRyZXR1cm4gbWFwRGJSZXBvcnRUYWJzKGRhdGEpXHJcblx0fVxyXG59XHJcblxyXG5cclxuXHJcblxyXG5cclxuIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInN1cGFiYXNlQW5vbktleSIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIiwiZGVmYXVsdENsaWVudCIsIm1hcERiUmVwb3J0VGFicyIsInJvdyIsInNlc3Npb25faWQiLCJyZXBvcnQiLCJyZXBvcnRfanNvbiIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJzdGF0dXMiLCJhdHRlbXB0cyIsImxhc3RfZXJyb3IiLCJjcmVhdGVkX2F0IiwidXBkYXRlZF9hdCIsIlJlcG9ydHNWM1RhYnNSZXBvc2l0b3J5IiwiY29uc3RydWN0b3IiLCJzdXBhYmFzZSIsImZpbmRCeVNlc3Npb25JZCIsInNlc3Npb25JZCIsIl91c2VySWQiLCJkYXRhIiwiZXJyb3IiLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJzaW5nbGUiLCJjb2RlIiwiY29uc29sZSIsIm1lc3NhZ2UiLCJ1cHNlcnRRdWV1ZWQiLCJwYXlsb2FkIiwidXBzZXJ0Iiwib25Db25mbGljdCIsIkVycm9yIiwic2V0UnVubmluZyIsInVwZGF0ZSIsImluY3JlbWVudEF0dGVtcHRzIiwicnBjIiwicF9zZXNzaW9uX2lkIiwidXBkRXJyIiwiY3VyIiwicm93MiIsInNlbEVyciIsInNldFJlYWR5Iiwic2V0RmFpbGVkIiwiZXJyb3JNc2ciXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/server/repositories/reports-v3-tabs.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/repositories/sessions.ts":
/*!*********************************************!*\
  !*** ./src/server/repositories/sessions.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SessionsRepository: () => (/* binding */ SessionsRepository)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/.pnpm/@supabase+supabase-js@2.57.4/node_modules/@supabase/supabase-js/dist/module/index.js\");\n\n// Use untyped client until schema is applied and types regenerated\nconst supabaseUrl = \"https://hewpwluinbwaizwqhmjc.supabase.co\";\nconst supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhld3B3bHVpbmJ3YWl6d3FobWpjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5MTU5NTEsImV4cCI6MjA3MjQ5MTk1MX0.jhKzLYPdixxI8zcH20kkzL1WgP9RB33FeHtO0FRY7r4\";\nconst defaultClient = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey);\nfunction mapDbSession(row) {\n    const startedAt = row.started_at ? new Date(row.started_at) : null;\n    const fallbackTitle = startedAt ? `Session @ ${startedAt.toLocaleTimeString('en-GB', {\n        hour12: false\n    })}` : 'Session';\n    // Heuristic: if title_enc looks like base64/opaque, use fallback for display\n    const looksEncoded = typeof row.title_enc === 'string' && /^[A-Za-z0-9+/=]{20,}$/.test(row.title_enc);\n    return {\n        id: row.id,\n        owner_id: row.user_id,\n        subject_id: row.subject_id || null,\n        title: row.title_enc && !looksEncoded ? row.title_enc : fallbackTitle,\n        type: row.session_type,\n        status: row.ended_at ? 'completed' : 'active',\n        started_at: row.started_at,\n        ended_at: row.ended_at,\n        created_at: row.started_at,\n        updated_at: row.updated_at\n    };\n}\nclass SessionsRepository {\n    constructor(supabase = defaultClient){\n        this.supabase = supabase;\n    }\n    async findAll(options) {\n        const { filters = {}, sort = 'started_at', direction = 'desc', page = 1, pageSize = 10, userId } = options;\n        const sortColumn = [\n            'started_at',\n            'updated_at',\n            'ended_at'\n        ].includes(sort) ? sort : 'started_at';\n        let query = this.supabase.from('sessions').select('id,user_id,subject_id,title_enc,session_type,started_at,ended_at,updated_at', {\n            count: 'estimated'\n        }).eq('user_id', userId);\n        // Apply filters\n        if (filters.search) {\n            query = query.ilike('title_enc', `%${filters.search}%`);\n        }\n        if (filters.status && filters.status !== 'all') {\n            if (filters.status === 'active') {\n                query = query.is('ended_at', null);\n            } else if (filters.status === 'completed' || filters.status === 'cancelled') {\n                query = query.not('ended_at', 'is', null);\n            }\n        }\n        if (filters.type) {\n            query = query.eq('session_type', filters.type);\n        }\n        if (filters.dateFrom) {\n            query = query.gte('started_at', filters.dateFrom);\n        }\n        if (filters.dateTo) {\n            query = query.lte('started_at', filters.dateTo);\n        }\n        // Apply sorting\n        query = query.order(sortColumn, {\n            ascending: direction === 'asc'\n        });\n        // Apply pagination (1-based to 0-based conversion)\n        const from = (page - 1) * pageSize;\n        const to = from + pageSize - 1;\n        query = query.range(from, to);\n        const { data: rows, error, count } = await query;\n        if (error) {\n            throw new Error(`Failed to fetch sessions: ${error.message}`);\n        }\n        const baseRows = rows || [];\n        // Enrich with contact phone via subject lookup (prefer customer over lead)\n        const phoneBySubject = {};\n        const subjectIds = Array.from(new Set(baseRows.map((r)=>r.subject_id).filter((v)=>!!v)));\n        if (subjectIds.length > 0) {\n            // Fetch customer phones in bulk\n            const { data: custRows, error: custErr } = await this.supabase.from('customers').select('subject_id, phone').in('subject_id', subjectIds).eq('owner_id', userId);\n            if (!custErr && Array.isArray(custRows)) {\n                for (const r of custRows){\n                    if (r.subject_id && r.phone) phoneBySubject[r.subject_id] = r.phone;\n                }\n            }\n            // Fetch lead phones where customer missing\n            const missing = subjectIds.filter((id)=>!phoneBySubject[id]);\n            if (missing.length > 0) {\n                const { data: leadRows } = await this.supabase.from('leads').select('subject_id, phone').in('subject_id', missing).eq('owner_id', userId);\n                if (Array.isArray(leadRows)) {\n                    for (const r of leadRows){\n                        if (r.subject_id && r.phone && !phoneBySubject[r.subject_id]) {\n                            phoneBySubject[r.subject_id] = r.phone;\n                        }\n                    }\n                }\n            }\n        }\n        const sessions = baseRows.map((r)=>{\n            const s = mapDbSession(r);\n            const phone = r.subject_id ? phoneBySubject[r.subject_id] : undefined;\n            return phone ? {\n                ...s,\n                phone\n            } : s;\n        });\n        const total = count || 0;\n        const totalPages = Math.ceil(total / pageSize);\n        return {\n            sessions,\n            total,\n            page,\n            pageSize,\n            totalPages\n        };\n    }\n    async findById(id, userId) {\n        const { data: row, error } = await this.supabase.from('sessions').select('id,user_id,subject_id,title_enc,session_type,started_at,ended_at,updated_at').eq('id', id).eq('user_id', userId).single();\n        if (error) {\n            if (error.code === 'PGRST116') {\n                return null // Not found\n                ;\n            }\n            throw new Error(`Failed to fetch session: ${error.message}`);\n        }\n        return mapDbSession(row);\n    }\n    async create(sessionData, userId) {\n        const requestedType = sessionData?.type || 'ask';\n        const { data: newSessionId, error: rpcError } = await this.supabase.rpc('get_or_create_active_session', {\n            requested_type: requestedType\n        });\n        if (rpcError) {\n            throw new Error(`Failed to create session: ${rpcError.message}`);\n        }\n        const { data: row, error } = await this.supabase.from('sessions').select('id,user_id,subject_id,title_enc,session_type,started_at,ended_at,updated_at').eq('id', newSessionId).eq('user_id', userId).single();\n        if (error) {\n            throw new Error(`Failed to fetch created session: ${error.message}`);\n        }\n        return mapDbSession(row);\n    }\n    async update(id, sessionData, userId) {\n        // Support title update and ending a session\n        if (sessionData?.status === 'completed' || sessionData?.status === 'cancelled') {\n            const { error: endErr } = await this.supabase.rpc('end_session', {\n                session_id: id\n            });\n            if (endErr) throw new Error(`Failed to end session: ${endErr.message}`);\n        }\n        if (sessionData?.title) {\n            const { error: updErr } = await this.supabase.from('sessions').update({\n                title_enc: sessionData.title\n            }).eq('id', id).eq('user_id', userId);\n            if (updErr) throw new Error(`Failed to update session: ${updErr.message}`);\n        }\n        const { data: row, error } = await this.supabase.from('sessions').select('id,user_id,subject_id,title_enc,session_type,started_at,ended_at,updated_at').eq('id', id).eq('user_id', userId).single();\n        if (error) throw new Error(`Failed to fetch session: ${error.message}`);\n        return mapDbSession(row);\n    }\n    async delete(id, userId) {\n        const { error } = await this.supabase.from('sessions').delete().eq('id', id).eq('user_id', userId);\n        if (error) throw new Error(`Failed to delete session: ${error.message}`);\n    }\n    async getStats(userId) {\n        const [total, active, completed] = await Promise.all([\n            this.supabase.from('sessions').select('*', {\n                count: 'exact',\n                head: true\n            }).eq('user_id', userId),\n            this.supabase.from('sessions').select('*', {\n                count: 'exact',\n                head: true\n            }).eq('user_id', userId).is('ended_at', null),\n            this.supabase.from('sessions').select('*', {\n                count: 'exact',\n                head: true\n            }).eq('user_id', userId).not('ended_at', 'is', null)\n        ]);\n        return {\n            total: total.count || 0,\n            active: active.count || 0,\n            completed: completed.count || 0,\n            cancelled: 0\n        };\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3JlcG9zaXRvcmllcy9zZXNzaW9ucy50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUFvRDtBQUVwRCxtRUFBbUU7QUFDbkUsTUFBTUMsY0FBY0MsMENBQW9DO0FBQ3hELE1BQU1HLGtCQUFrQkgsa05BQXlDO0FBQ2pFLE1BQU1LLGdCQUFnQlAsbUVBQVlBLENBQUNDLGFBQWFJO0FBMEJoRCxTQUFTRyxhQUFhQyxHQUFRO0lBQzdCLE1BQU1DLFlBQVlELElBQUlFLFVBQVUsR0FBRyxJQUFJQyxLQUFLSCxJQUFJRSxVQUFVLElBQUk7SUFDOUQsTUFBTUUsZ0JBQWdCSCxZQUFZLENBQUMsVUFBVSxFQUFFQSxVQUFVSSxrQkFBa0IsQ0FBQyxTQUFTO1FBQUVDLFFBQVE7SUFBTSxJQUFJLEdBQUc7SUFDNUcsNkVBQTZFO0lBQzdFLE1BQU1DLGVBQWUsT0FBT1AsSUFBSVEsU0FBUyxLQUFLLFlBQVksd0JBQXdCQyxJQUFJLENBQUNULElBQUlRLFNBQVM7SUFDcEcsT0FBTztRQUNORSxJQUFJVixJQUFJVSxFQUFFO1FBQ1ZDLFVBQVVYLElBQUlZLE9BQU87UUFDckJDLFlBQVliLElBQUlhLFVBQVUsSUFBSTtRQUM5QkMsT0FBTyxJQUFLTixTQUFTLElBQUksQ0FBQ0QsZUFBZ0JQLElBQUlRLFNBQVMsR0FBR0o7UUFDMURXLE1BQU1mLElBQUlnQixZQUFZO1FBQ3RCQyxRQUFRakIsSUFBSWtCLFFBQVEsR0FBRyxjQUFjO1FBQ3JDaEIsWUFBWUYsSUFBSUUsVUFBVTtRQUMxQmdCLFVBQVVsQixJQUFJa0IsUUFBUTtRQUN0QkMsWUFBWW5CLElBQUlFLFVBQVU7UUFDMUJrQixZQUFZcEIsSUFBSW9CLFVBQVU7SUFDM0I7QUFDRDtBQUVPLE1BQU1DO0lBQ1RDLFlBQVksV0FBc0N4QixhQUFhLENBQUU7YUFBN0N5QixXQUFBQTtJQUE4QztJQUVsRSxNQUFNQyxRQUFRQyxPQUEyQixFQU10QztRQUNMLE1BQU0sRUFDTEMsVUFBVSxDQUFDLENBQUMsRUFD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UUFDaEIsSUFBSXNCLE9BQU8sTUFBTSxJQUFJQyxNQUFNLENBQUMsMEJBQTBCLEVBQUVELE1BQU1FLE9BQU8sRUFBRTtJQUN4RTtJQUVBLE1BQU13QyxTQUFTaEUsTUFBYyxFQUsxQjtRQUNGLE1BQU0sQ0FBQzZDLE9BQU9vQixRQUFRQyxVQUFVLEdBQUcsTUFBTUMsUUFBUUMsR0FBRyxDQUFDO1lBQ3BELElBQUksQ0FBQzVFLFFBQVEsQ0FBQ1ksSUFBSSxDQUFDLFlBQVlDLE1BQU0sQ0FBQyxLQUFLO2dCQUFFQyxPQUFPO2dCQUFTK0QsTUFBTTtZQUFLLEdBQUc5RCxFQUFFLENBQUMsV0FBV1A7WUFDekYsSUFBSSxDQUFDUixRQUFRLENBQUNZLElBQUksQ0FBQyxZQUFZQyxNQUFNLENBQUMsS0FBSztnQkFBRUMsT0FBTztnQkFBUytELE1BQU07WUFBSyxHQUFHOUQsRUFBRSxDQUFDLFdBQVdQLFFBQVFVLEVBQUUsQ0FBQyxZQUFZO1lBQ2hILElBQUksQ0FBQ2xCLFFBQVEsQ0FBQ1ksSUFBSSxDQUFDLFlBQVlDLE1BQU0sQ0FBQyxLQUFLO2dCQUFFQyxPQUFPO2dCQUFTK0QsTUFBTTtZQUFLLEdBQUc5RCxFQUFFLENBQUMsV0FBV1AsUUFBUVcsR0FBRyxDQUFDLFlBQVksTUFBTTtTQUN2SDtRQUVELE9BQU87WUFDTmtDLE9BQU8sTUFBT3ZDLEtBQUssSUFBZTtZQUNsQzJELFFBQVEsT0FBUTNELEtBQUssSUFBZTtZQUNwQzRELFdBQVcsVUFBVzVELEtBQUssSUFBZTtZQUMxQ2dFLFdBQVc7UUFDWjtJQUNEO0FBQ0QiLCJzb3VyY2VzIjpbIkQ6XFxEZWx0YSBJVlxcU29md2FyZXNcXGdsYXNzXFxzYW5kYm94XFxzaGFkY24tY3JtLWRhc2hib2FyZFxcc3JjXFxzZXJ2ZXJcXHJlcG9zaXRvcmllc1xcc2Vzc2lvbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJ1xuXG4vLyBVc2UgdW50eXBlZCBjbGllbnQgdW50aWwgc2NoZW1hIGlzIGFwcGxpZWQgYW5kIHR5cGVzIHJlZ2VuZXJhdGVkXG5jb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCFcbmNvbnN0IHN1cGFiYXNlQW5vbktleSA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIVxuY29uc3QgZGVmYXVsdENsaWVudCA9IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VBbm9uS2V5KVxuXG4vLyBUZW1wb3JhcnkgdHlwZXMgdW50aWwgc2NoZW1hIGlzIGFwcGxpZWRcbnR5cGUgU2Vzc2lvbiA9IGFueVxudHlwZSBTZXNzaW9uSW5zZXJ0ID0gYW55XG50eXBlIFNlc3Npb25VcGRhdGUgPSBhbnlcblxudHlwZSBTdXBhYmFzZUNsaWVudEFueSA9IHR5cGVvZiBkZWZhdWx0Q2xpZW50XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2Vzc2lvbkZpbHRlcnMge1xuXHRzZWFyY2g/OiBzdHJpbmdcblx0c3RhdHVzPzogJ2FsbCcgfCAnYWN0aXZlJyB8ICdjb21wbGV0ZWQnIHwgJ2NhbmNlbGxlZCdcblx0ZGF0ZUZyb20/OiBzdHJpbmdcblx0ZGF0ZVRvPzogc3RyaW5nXG5cdHR5cGU/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTZXNzaW9uTGlzdE9wdGlvbnMge1xuXHRmaWx0ZXJzPzogU2Vzc2lvbkZpbHRlcnNcblx0c29ydD86IHN0cmluZ1xuXHRkaXJlY3Rpb24/OiAnYXNjJyB8ICdkZXNjJ1xuXHRwYWdlPzogbnVtYmVyXG5cdHBhZ2VTaXplPzogbnVtYmVyXG5cdHVzZXJJZDogc3RyaW5nXG59XG5cbmZ1bmN0aW9uIG1hcERiU2Vzc2lvbihyb3c6IGFueSk6IGFueSB7XG5cdGNvbnN0IHN0YXJ0ZWRBdCA9IHJvdy5zdGFydGVkX2F0ID8gbmV3IERhdGUocm93LnN0YXJ0ZWRfYXQpIDogbnVsbFxuXHRjb25zdCBmYWxsYmFja1RpdGxlID0gc3RhcnRlZEF0ID8gYFNlc3Npb24gQCAke3N0YXJ0ZWRBdC50b0xvY2FsZVRpbWVTdHJpbmcoJ2VuLUdCJywgeyBob3VyMTI6IGZhbHNlIH0pfWAgOiAnU2Vzc2lvbidcblx0Ly8gSGV1cmlzdGljOiBpZiB0aXRsZV9lbmMgbG9va3MgbGlrZSBiYXNlNjQvb3BhcXVlLCB1c2UgZmFsbGJhY2sgZm9yIGRpc3BsYXlcblx0Y29uc3QgbG9va3NFbmNvZGVkID0gdHlwZW9mIHJvdy50aXRsZV9lbmMgPT09ICdzdHJpbmcnICYmIC9eW0EtWmEtejAtOSsvPV17MjAsfSQvLnRlc3Qocm93LnRpdGxlX2VuYylcblx0cmV0dXJuIHtcblx0XHRpZDogcm93LmlkLFxuXHRcdG93bmVyX2lkOiByb3cudXNlcl9pZCxcblx0XHRzdWJqZWN0X2lkOiByb3cuc3ViamVjdF9pZCB8fCBudWxsLFxuXHRcdHRpdGxlOiAocm93LnRpdGxlX2VuYyAmJiAhbG9va3NFbmNvZGVkKSA/IHJvdy50aXRsZV9lbmMgOiBmYWxsYmFja1RpdGxlLFxuXHRcdHR5cGU6IHJvdy5zZXNzaW9uX3R5cGUsXG5cdFx0c3RhdHVzOiByb3cuZW5kZWRfYXQgPyAnY29tcGxldGVkJyA6ICdhY3RpdmUnLFxuXHRcdHN0YXJ0ZWRfYXQ6IHJvdy5zdGFydGVkX2F0LFxuXHRcdGVuZGVkX2F0OiByb3cuZW5kZWRfYXQsXG5cdFx0Y3JlYXRlZF9hdDogcm93LnN0YXJ0ZWRfYXQsXG5cdFx0dXBkYXRlZF9hdDogcm93LnVwZGF0ZWRfYXQsXG5cdH1cbn1cblxuZXhwb3J0IGNsYXNzIFNlc3Npb25zUmVwb3NpdG9yeSB7XG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBzdXBhYmFzZTogU3VwYWJhc2VDbGllbnRBbnkgPSBkZWZhdWx0Q2xpZW50KSB7fVxuXG4gICAgYXN5bmMgZmluZEFsbChvcHRpb25zOiBTZXNzaW9uTGlzdE9wdGlvbnMpOiBQcm9taXNlPHtcbiAgICAgICAgc2Vzc2lvbnM6IFNlc3Npb25bXVxuICAgICAgICB0b3RhbDogbnVtYmVyXG4gICAgICAgIHBhZ2U6IG51bWJlclxuICAgICAgICBwYWdlU2l6ZTogbnVtYmVyXG4gICAgICAgIHRvdGFsUGFnZXM6IG51bWJlclxuICAgIH0+IHtcblx0XHRjb25zdCB7XG5cdFx0XHRmaWx0ZXJzID0ge30sXG5cdFx0XHRzb3J0ID0gJ3N0YXJ0ZWRfYXQnLFxuXHRcdFx0ZGlyZWN0aW9uID0gJ2Rlc2MnLFxuXHRcdFx0cGFnZSA9IDEsXG5cdFx0XHRwYWdlU2l6ZSA9IDEwLFxuXHRcdFx0dXNlcklkXG5cdFx0fSA9IG9wdGlvbnNcblxuXHRcdGNvbnN0IHNvcnRDb2x1bW4gPSBbJ3N0YXJ0ZWRfYXQnLCd1cGRhdGVkX2F0JywnZW5kZWRfYXQnXS5pbmNsdWRlcyhzb3J0KSA/IHNvcnQgOiAnc3RhcnRlZF9hdCdcblxuXHRcdGxldCBxdWVyeSA9IHRoaXMuc3VwYWJhc2Vcblx0XHRcdC5mcm9tKCdzZXNzaW9ucycpXG5cdFx0XHQuc2VsZWN0KCdpZCx1c2VyX2lkLHN1YmplY3RfaWQsdGl0bGVfZW5jLHNlc3Npb25fdHlwZSxzdGFydGVkX2F0LGVuZGVkX2F0LHVwZGF0ZWRfYXQnLCB7IGNvdW50OiAnZXN0aW1hdGVkJyB9KVxuXHRcdFx0LmVxKCd1c2VyX2lkJywgdXNlcklkKVxuXG5cdFx0Ly8gQXBwbHkgZmlsdGVyc1xuXHRcdGlmIChmaWx0ZXJzLnNlYXJjaCkge1xuXHRcdFx0cXVlcnkgPSBxdWVyeS5pbGlrZSgndGl0bGVfZW5jJywgYCUke2ZpbHRlcnMuc2VhcmNofSVgKVxuXHRcdH1cblxuXHRcdGlmIChmaWx0ZXJzLnN0YXR1cyAmJiBmaWx0ZXJzLnN0YXR1cyAhPT0gJ2FsbCcpIHtcblx0XHRcdGlmIChmaWx0ZXJzLnN0YXR1cyA9PT0gJ2FjdGl2ZScpIHtcblx0XHRcdFx0cXVlcnkgPSBxdWVyeS5pcygnZW5kZWRfYXQnLCBudWxsKVxuXHRcdFx0fSBlbHNlIGlmIChmaWx0ZXJzLnN0YXR1cyA9PT0gJ2NvbXBsZXRlZCcgfHwgZmlsdGVycy5zdGF0dXMgPT09ICdjYW5jZWxsZWQnKSB7XG5cdFx0XHRcdHF1ZXJ5ID0gcXVlcnkubm90KCdlbmRlZF9hdCcsICdpcycsIG51bGwpXG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKGZpbHRlcnMudHlwZSkge1xuXHRcdFx0cXVlcnkgPSBxdWVyeS5lcSgnc2Vzc2lvbl90eXBlJywgZmlsdGVycy50eXBlKVxuXHRcdH1cblxuXHRcdGlmIChmaWx0ZXJzLmRhdGVGcm9tKSB7XG5cdFx0XHRxdWVyeSA9IHF1ZXJ5Lmd0ZSgnc3RhcnRlZF9hdCcsIGZpbHRlcnMuZGF0ZUZyb20pXG5cdFx0fVxuXG5cdFx0aWYgKGZpbHRlcnMuZGF0ZVRvKSB7XG5cdFx0XHRxdWVyeSA9IHF1ZXJ5Lmx0ZSgnc3RhcnRlZF9hdCcsIGZpbHRlcnMuZGF0ZVRvKVxuXHRcdH1cblxuXHRcdC8vIEFwcGx5IHNvcnRpbmdcblx0XHRxdWVyeSA9IHF1ZXJ5Lm9yZGVyKHNvcnRDb2x1bW4sIHsgYXNjZW5kaW5nOiBkaXJlY3Rpb24gPT09ICdhc2MnIH0pXG5cblx0XHQvLyBBcHBseSBwYWdpbmF0aW9uICgxLWJhc2VkIHRvIDAtYmFzZWQgY29udmVyc2lvbilcblx0XHRjb25zdCBmcm9tID0gKHBhZ2UgLSAxKSAqIHBhZ2VTaXplXG5cdFx0Y29uc3QgdG8gPSBmcm9tICsgcGFnZVNpemUgLSAxXG5cdFx0cXVlcnkgPSBxdWVyeS5yYW5nZShmcm9tLCB0bylcblxuICAgICAgICBjb25zdCB7IGRhdGE6IHJvd3MsIGVycm9yLCBjb3VudCB9ID0gYXdhaXQgcXVlcnlcblxuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGZldGNoIHNlc3Npb25zOiAke2Vycm9yLm1lc3NhZ2V9YClcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGJhc2VSb3dzID0gcm93cyB8fCBbXVxuXG4gICAgICAgIC8vIEVucmljaCB3aXRoIGNvbnRhY3QgcGhvbmUgdmlhIHN1YmplY3QgbG9va3VwIChwcmVmZXIgY3VzdG9tZXIgb3ZlciBsZWFkKVxuICAgICAgICBjb25zdCBwaG9uZUJ5U3ViamVjdDogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHt9XG4gICAgICAgIGNvbnN0IHN1YmplY3RJZHMgPSBBcnJheS5mcm9tKG5ldyBTZXQoXG4gICAgICAgICAgICBiYXNlUm93cy5tYXAoKHI6IGFueSkgPT4gci5zdWJqZWN0X2lkKS5maWx0ZXIoKHY6IGFueSkgPT4gISF2KVxuICAgICAgICApKSBhcyBzdHJpbmdbXVxuXG4gICAgICAgIGlmIChzdWJqZWN0SWRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIC8vIEZldGNoIGN1c3RvbWVyIHBob25lcyBpbiBidWxrXG4gICAgICAgICAgICBjb25zdCB7IGRhdGE6IGN1c3RSb3dzLCBlcnJvcjogY3VzdEVyciB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxuICAgICAgICAgICAgICAgIC5mcm9tKCdjdXN0b21lcnMnKVxuICAgICAgICAgICAgICAgIC5zZWxlY3QoJ3N1YmplY3RfaWQsIHBob25lJylcbiAgICAgICAgICAgICAgICAuaW4oJ3N1YmplY3RfaWQnLCBzdWJqZWN0SWRzKVxuICAgICAgICAgICAgICAgIC5lcSgnb3duZXJfaWQnLCB1c2VySWQpXG4gICAgICAgICAgICBpZiAoIWN1c3RFcnIgJiYgQXJyYXkuaXNBcnJheShjdXN0Um93cykpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHIgb2YgY3VzdFJvd3MpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHIuc3ViamVjdF9pZCAmJiByLnBob25lKSBwaG9uZUJ5U3ViamVjdFtyLnN1YmplY3RfaWRdID0gci5waG9uZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRmV0Y2ggbGVhZCBwaG9uZXMgd2hlcmUgY3VzdG9tZXIgbWlzc2luZ1xuICAgICAgICAgICAgY29uc3QgbWlzc2luZyA9IHN1YmplY3RJZHMuZmlsdGVyKGlkID0+ICFwaG9uZUJ5U3ViamVjdFtpZF0pXG4gICAgICAgICAgICBpZiAobWlzc2luZy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBkYXRhOiBsZWFkUm93cyB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxuICAgICAgICAgICAgICAgICAgICAuZnJvbSgnbGVhZHMnKVxuICAgICAgICAgICAgICAgICAgICAuc2VsZWN0KCdzdWJqZWN0X2lkLCBwaG9uZScpXG4gICAgICAgICAgICAgICAgICAgIC5pbignc3ViamVjdF9pZCcsIG1pc3NpbmcpXG4gICAgICAgICAgICAgICAgICAgIC5lcSgnb3duZXJfaWQnLCB1c2VySWQpXG4gICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkobGVhZFJvd3MpKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgciBvZiBsZWFkUm93cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHIuc3ViamVjdF9pZCAmJiByLnBob25lICYmICFwaG9uZUJ5U3ViamVjdFtyLnN1YmplY3RfaWRdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGhvbmVCeVN1YmplY3Rbci5zdWJqZWN0X2lkXSA9IHIucGhvbmVcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHNlc3Npb25zID0gYmFzZVJvd3MubWFwKChyOiBhbnkpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHMgPSBtYXBEYlNlc3Npb24ocilcbiAgICAgICAgICAgIGNvbnN0IHBob25lID0gci5zdWJqZWN0X2lkID8gcGhvbmVCeVN1YmplY3Rbci5zdWJqZWN0X2lkXSA6IHVuZGVmaW5lZFxuICAgICAgICAgICAgcmV0dXJuIHBob25lID8geyAuLi5zLCBwaG9uZSB9IDogc1xuICAgICAgICB9KVxuICAgICAgICBjb25zdCB0b3RhbCA9IGNvdW50IHx8IDBcbiAgICAgICAgY29uc3QgdG90YWxQYWdlcyA9IE1hdGguY2VpbCh0b3RhbCAvIHBhZ2VTaXplKVxuXG4gICAgICAgIHJldHVybiB7IHNlc3Npb25zLCB0b3RhbCwgcGFnZSwgcGFnZVNpemUsIHRvdGFsUGFnZXMgfVxuICAgIH1cblxuXHRhc3luYyBmaW5kQnlJZChpZDogc3RyaW5nLCB1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8U2Vzc2lvbiB8IG51bGw+IHtcblx0XHRjb25zdCB7IGRhdGE6IHJvdywgZXJyb3IgfSA9IGF3YWl0IHRoaXMuc3VwYWJhc2Vcblx0XHRcdC5mcm9tKCdzZXNzaW9ucycpXG5cdFx0XHQuc2VsZWN0KCdpZCx1c2VyX2lkLHN1YmplY3RfaWQsdGl0bGVfZW5jLHNlc3Npb25fdHlwZSxzdGFydGVkX2F0LGVuZGVkX2F0LHVwZGF0ZWRfYXQnKVxuXHRcdFx0LmVxKCdpZCcsIGlkKVxuXHRcdFx0LmVxKCd1c2VyX2lkJywgdXNlcklkKVxuXHRcdFx0LnNpbmdsZSgpXG5cblx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdGlmICgoZXJyb3IgYXMgYW55KS5jb2RlID09PSAnUEdSU1QxMTYnKSB7XG5cdFx0XHRcdHJldHVybiBudWxsIC8vIE5vdCBmb3VuZFxuXHRcdFx0fVxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZmV0Y2ggc2Vzc2lvbjogJHtlcnJvci5tZXNzYWdlfWApXG5cdFx0fVxuXG5cdFx0cmV0dXJuIG1hcERiU2Vzc2lvbihyb3cpXG5cdH1cblxuXHRhc3luYyBjcmVhdGUoc2Vzc2lvbkRhdGE6IFNlc3Npb25JbnNlcnQsIHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxTZXNzaW9uPiB7XG5cdFx0Y29uc3QgcmVxdWVzdGVkVHlwZSA9IChzZXNzaW9uRGF0YSBhcyBhbnkpPy50eXBlIHx8ICdhc2snXG5cdFx0Y29uc3QgeyBkYXRhOiBuZXdTZXNzaW9uSWQsIGVycm9yOiBycGNFcnJvciB9ID0gYXdhaXQgKHRoaXMuc3VwYWJhc2UgYXMgYW55KVxuXHRcdFx0LnJwYygnZ2V0X29yX2NyZWF0ZV9hY3RpdmVfc2Vzc2lvbicsIHsgcmVxdWVzdGVkX3R5cGU6IHJlcXVlc3RlZFR5cGUgfSlcblxuXHRcdGlmIChycGNFcnJvcikge1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gY3JlYXRlIHNlc3Npb246ICR7cnBjRXJyb3IubWVzc2FnZX1gKVxuXHRcdH1cblxuXHRcdGNvbnN0IHsgZGF0YTogcm93LCBlcnJvciB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxuXHRcdFx0LmZyb20oJ3Nlc3Npb25zJylcblx0XHRcdC5zZWxlY3QoJ2lkLHVzZXJfaWQsc3ViamVjdF9pZCx0aXRsZV9lbmMsc2Vzc2lvbl90eXBlLHN0YXJ0ZWRfYXQsZW5kZWRfYXQsdXBkYXRlZF9hdCcpXG5cdFx0XHQuZXEoJ2lkJywgbmV3U2Vzc2lvbklkKVxuXHRcdFx0LmVxKCd1c2VyX2lkJywgdXNlcklkKVxuXHRcdFx0LnNpbmdsZSgpXG5cblx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGZldGNoIGNyZWF0ZWQgc2Vzc2lvbjogJHtlcnJvci5tZXNzYWdlfWApXG5cdFx0fVxuXG5cdFx0cmV0dXJuIG1hcERiU2Vzc2lvbihyb3cpXG5cdH1cblxuXHRhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgc2Vzc2lvbkRhdGE6IFNlc3Npb25VcGRhdGUsIHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxTZXNzaW9uPiB7XG5cdFx0Ly8gU3VwcG9ydCB0aXRsZSB1cGRhdGUgYW5kIGVuZGluZyBhIHNlc3Npb25cblx0XHRpZiAoKHNlc3Npb25EYXRhIGFzIGFueSk/LnN0YXR1cyA9PT0gJ2NvbXBsZXRlZCcgfHwgKHNlc3Npb25EYXRhIGFzIGFueSk/LnN0YXR1cyA9PT0gJ2NhbmNlbGxlZCcpIHtcblx0XHRcdGNvbnN0IHsgZXJyb3I6IGVuZEVyciB9ID0gYXdhaXQgKHRoaXMuc3VwYWJhc2UgYXMgYW55KS5ycGMoJ2VuZF9zZXNzaW9uJywgeyBzZXNzaW9uX2lkOiBpZCB9KVxuXHRcdFx0aWYgKGVuZEVycikgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZW5kIHNlc3Npb246ICR7ZW5kRXJyLm1lc3NhZ2V9YClcblx0XHR9XG5cblx0XHRpZiAoKHNlc3Npb25EYXRhIGFzIGFueSk/LnRpdGxlKSB7XG5cdFx0XHRjb25zdCB7IGVycm9yOiB1cGRFcnIgfSA9IGF3YWl0IHRoaXMuc3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oJ3Nlc3Npb25zJylcblx0XHRcdFx0LnVwZGF0ZSh7IHRpdGxlX2VuYzogKHNlc3Npb25EYXRhIGFzIGFueSkudGl0bGUgfSlcblx0XHRcdFx0LmVxKCdpZCcsIGlkKVxuXHRcdFx0XHQuZXEoJ3VzZXJfaWQnLCB1c2VySWQpXG5cdFx0XHRpZiAodXBkRXJyKSB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byB1cGRhdGUgc2Vzc2lvbjogJHt1cGRFcnIubWVzc2FnZX1gKVxuXHRcdH1cblxuXHRcdGNvbnN0IHsgZGF0YTogcm93LCBlcnJvciB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxuXHRcdFx0LmZyb20oJ3Nlc3Npb25zJylcblx0XHRcdC5zZWxlY3QoJ2lkLHVzZXJfaWQsc3ViamVjdF9pZCx0aXRsZV9lbmMsc2Vzc2lvbl90eXBlLHN0YXJ0ZWRfYXQsZW5kZWRfYXQsdXBkYXRlZF9hdCcpXG5cdFx0XHQuZXEoJ2lkJywgaWQpXG5cdFx0XHQuZXEoJ3VzZXJfaWQnLCB1c2VySWQpXG5cdFx0XHQuc2luZ2xlKClcblx0XHRpZiAoZXJyb3IpIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGZldGNoIHNlc3Npb246ICR7ZXJyb3IubWVzc2FnZX1gKVxuXHRcdHJldHVybiBtYXBEYlNlc3Npb24ocm93KVxuXHR9XG5cblx0YXN5bmMgZGVsZXRlKGlkOiBzdHJpbmcsIHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0Y29uc3QgeyBlcnJvciB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxuXHRcdFx0LmZyb20oJ3Nlc3Npb25zJylcblx0XHRcdC5kZWxldGUoKVxuXHRcdFx0LmVxKCdpZCcsIGlkKVxuXHRcdFx0LmVxKCd1c2VyX2lkJywgdXNlcklkKVxuXHRcdGlmIChlcnJvcikgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZGVsZXRlIHNlc3Npb246ICR7ZXJyb3IubWVzc2FnZX1gKVxuXHR9XG5cblx0YXN5bmMgZ2V0U3RhdHModXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPHtcblx0XHR0b3RhbDogbnVtYmVyXG5cdFx0YWN0aXZlOiBudW1iZXJcblx0XHRjb21wbGV0ZWQ6IG51bWJlclxuXHRcdGNhbmNlbGxlZDogbnVtYmVyXG5cdH0+IHtcblx0XHRjb25zdCBbdG90YWwsIGFjdGl2ZSwgY29tcGxldGVkXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcblx0XHRcdHRoaXMuc3VwYWJhc2UuZnJvbSgnc2Vzc2lvbnMnKS5zZWxlY3QoJyonLCB7IGNvdW50OiAnZXhhY3QnLCBoZWFkOiB0cnVlIH0pLmVxKCd1c2VyX2lkJywgdXNlcklkKSxcblx0XHRcdHRoaXMuc3VwYWJhc2UuZnJvbSgnc2Vzc2lvbnMnKS5zZWxlY3QoJyonLCB7IGNvdW50OiAnZXhhY3QnLCBoZWFkOiB0cnVlIH0pLmVxKCd1c2VyX2lkJywgdXNlcklkKS5pcygnZW5kZWRfYXQnLCBudWxsKSxcblx0XHRcdHRoaXMuc3VwYWJhc2UuZnJvbSgnc2Vzc2lvbnMnKS5zZWxlY3QoJyonLCB7IGNvdW50OiAnZXhhY3QnLCBoZWFkOiB0cnVlIH0pLmVxKCd1c2VyX2lkJywgdXNlcklkKS5ub3QoJ2VuZGVkX2F0JywgJ2lzJywgbnVsbCksXG5cdFx0XSlcblxuXHRcdHJldHVybiB7XG5cdFx0XHR0b3RhbDogKHRvdGFsLmNvdW50IGFzIG51bWJlcikgfHwgMCxcblx0XHRcdGFjdGl2ZTogKGFjdGl2ZS5jb3VudCBhcyBudW1iZXIpIHx8IDAsXG5cdFx0XHRjb21wbGV0ZWQ6IChjb21wbGV0ZWQuY291bnQgYXMgbnVtYmVyKSB8fCAwLFxuXHRcdFx0Y2FuY2VsbGVkOiAwLFxuXHRcdH1cblx0fVxufVxuIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInN1cGFiYXNlQW5vbktleSIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIiwiZGVmYXVsdENsaWVudCIsIm1hcERiU2Vzc2lvbiIsInJvdyIsInN0YXJ0ZWRBdCIsInN0YXJ0ZWRfYXQiLCJEYXRlIiwiZmFsbGJhY2tUaXRsZSIsInRvTG9jYWxlVGltZVN0cmluZyIsImhvdXIxMiIsImxvb2tzRW5jb2RlZCIsInRpdGxlX2VuYyIsInRlc3QiLCJpZCIsIm93bmVyX2lkIiwidXNlcl9pZCIsInN1YmplY3RfaWQiLCJ0aXRsZSIsInR5cGUiLCJzZXNzaW9uX3R5cGUiLCJzdGF0dXMiLCJlbmRlZF9hdCIsImNyZWF0ZWRfYXQiLCJ1cGRhdGVkX2F0IiwiU2Vzc2lvbnNSZXBvc2l0b3J5IiwiY29uc3RydWN0b3IiLCJzdXBhYmFzZSIsImZpbmRBbGwiLCJvcHRpb25zIiwiZmlsdGVycyIsInNvcnQiLCJkaXJlY3Rpb24iLCJwYWdlIiwicGFnZVNpemUiLCJ1c2VySWQiLCJzb3J0Q29sdW1uIiwiaW5jbHVkZXMiLCJxdWVyeSIsImZyb20iLCJzZWxlY3QiLCJjb3VudCIsImVxIiwic2VhcmNoIiwiaWxpa2UiLCJpcyIsIm5vdCIsImRhdGVGcm9tIiwiZ3RlIiwiZGF0ZVRvIiwibHRlIiwib3JkZXIiLCJhc2NlbmRpbmciLCJ0byIsInJhbmdlIiwiZGF0YSIsInJvd3MiLCJlcnJvciIsIkVycm9yIiwibWVzc2FnZSIsImJhc2VSb3dzIiwicGhvbmVCeVN1YmplY3QiLCJzdWJqZWN0SWRzIiwiQXJyYXkiLCJTZXQiLCJtYXAiLCJyIiwiZmlsdGVyIiwidiIsImxlbmd0aCIsImN1c3RSb3dzIiwiY3VzdEVyciIsImluIiwiaXNBcnJheSIsInBob25lIiwibWlzc2luZyIsImxlYWRSb3dzIiwic2Vzc2lvbnMiLCJzIiwidW5kZWZpbmVkIiwidG90YWwiLCJ0b3RhbFBhZ2VzIiwiTWF0aCIsImNlaWwiLCJmaW5kQnlJZCIsInNpbmdsZSIsImNvZGUiLCJjcmVhdGUiLCJzZXNzaW9uRGF0YSIsInJlcXVlc3RlZFR5cGUiLCJuZXdTZXNzaW9uSWQiLCJycGNFcnJvciIsInJwYyIsInJlcXVlc3RlZF90eXBlIiwidXBkYXRlIiwiZW5kRXJyIiwic2Vzc2lvbl9pZCIsInVwZEVyciIsImRlbGV0ZSIsImdldFN0YXRzIiwiYWN0aXZlIiwiY29tcGxldGVkIiwiUHJvbWlzZSIsImFsbCIsImhlYWQiLCJjYW5jZWxsZWQiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/server/repositories/sessions.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/repositories/transcripts.ts":
/*!************************************************!*\
  !*** ./src/server/repositories/transcripts.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   TranscriptsRepository: () => (/* binding */ TranscriptsRepository)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/.pnpm/@supabase+supabase-js@2.57.4/node_modules/@supabase/supabase-js/dist/module/index.js\");\n\n// Use untyped client until schema is applied and types regenerated\nconst supabaseUrl = \"https://hewpwluinbwaizwqhmjc.supabase.co\";\nconst supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhld3B3bHVpbmJ3YWl6d3FobWpjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5MTU5NTEsImV4cCI6MjA3MjQ5MTk1MX0.jhKzLYPdixxI8zcH20kkzL1WgP9RB33FeHtO0FRY7r4\";\nconst defaultClient = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey);\nfunction mapDbTranscript(row) {\n    return {\n        id: row.id,\n        session_id: row.session_id,\n        content_enc: row.text_enc,\n        speaker: row.speaker,\n        timestamp: row.created_at,\n        created_at: row.created_at\n    };\n}\nclass TranscriptsRepository {\n    constructor(supabase = defaultClient){\n        this.supabase = supabase;\n    }\n    async findAll(options) {\n        const { filters = {}, sort = 'created_at', direction = 'asc', page = 1, pageSize = 50 } = options;\n        const sortColumn = [\n            'created_at'\n        ].includes(sort) ? sort : 'created_at';\n        let query = this.supabase.from('transcripts').select('id,session_id,speaker,text_enc,created_at', {\n            count: 'exact'\n        });\n        if (filters.sessionId) {\n            query = query.eq('session_id', filters.sessionId);\n        }\n        if (filters.search) {\n            query = query.ilike('text_enc', `%${filters.search}%`);\n        }\n        if (filters.speaker) {\n            query = query.eq('speaker', filters.speaker);\n        }\n        if (filters.dateFrom) {\n            query = query.gte('created_at', filters.dateFrom);\n        }\n        if (filters.dateTo) {\n            query = query.lte('created_at', filters.dateTo);\n        }\n        query = query.order(sortColumn, {\n            ascending: direction === 'asc'\n        });\n        const from = (page - 1) * pageSize;\n        const to = from + pageSize - 1;\n        query = query.range(from, to);\n        const { data: rows, error, count } = await query;\n        if (error) throw new Error(`Failed to fetch transcripts: ${error.message}`);\n        const transcripts = (rows || []).map(mapDbTranscript);\n        const total = count || 0;\n        const totalPages = Math.ceil(total / pageSize);\n        return {\n            transcripts,\n            total,\n            page,\n            pageSize,\n            totalPages\n        };\n    }\n    async findBySessionId(sessionId, _userId) {\n        const { data: rows, error } = await this.supabase.from('transcripts').select('id,session_id,speaker,text_enc,created_at').eq('session_id', sessionId).order('created_at', {\n            ascending: true\n        });\n        if (error) throw new Error(`Failed to fetch session transcripts: ${error.message}`);\n        return (rows || []).map(mapDbTranscript);\n    }\n    async findById(id, _userId) {\n        const { data: row, error } = await this.supabase.from('transcripts').select('id,session_id,speaker,text_enc,created_at').eq('id', id).single();\n        if (error) {\n            if (error.code === 'PGRST116') return null;\n            throw new Error(`Failed to fetch transcript: ${error.message}`);\n        }\n        return mapDbTranscript(row);\n    }\n    async create(transcriptData, _userId) {\n        const sessionId = transcriptData.session_id;\n        const speaker = transcriptData.speaker || 'Speaker';\n        const textEnc = transcriptData.content_enc || transcriptData.text_enc;\n        const clientTranscriptId = transcriptData.client_transcript_id || transcriptData.clientId || null;\n        let newId = null;\n        let rpcErr = null;\n        if (clientTranscriptId) {\n            const { data, error } = await this.supabase.rpc('add_transcript_safe', {\n                p_session_id: sessionId,\n                p_speaker: speaker,\n                p_text_enc: textEnc,\n                p_client_transcript_id: clientTranscriptId\n            });\n            newId = data;\n            rpcErr = error;\n            if (rpcErr) {\n                const fallback = await this.supabase.rpc('add_transcript', {\n                    session_id: sessionId,\n                    speaker,\n                    text_enc: textEnc\n                });\n                newId = fallback.data;\n                rpcErr = fallback.error;\n            }\n        } else {\n            const res = await this.supabase.rpc('add_transcript', {\n                session_id: sessionId,\n                speaker,\n                text_enc: textEnc\n            });\n            newId = res.data;\n            rpcErr = res.error;\n        }\n        if (rpcErr) throw new Error(`Failed to create transcript: ${rpcErr.message}`);\n        const { data: row, error } = await this.supabase.from('transcripts').select('id,session_id,speaker,text_enc,created_at').eq('id', newId).single();\n        if (error) throw new Error(`Failed to fetch created transcript: ${error.message}`);\n        return mapDbTranscript(row);\n    }\n    async update(id, transcriptData, _userId) {\n        const updates = {};\n        if (transcriptData.content_enc) updates.text_enc = transcriptData.content_enc;\n        if (transcriptData.speaker) updates.speaker = transcriptData.speaker;\n        const { error: updErr } = await this.supabase.from('transcripts').update(updates).eq('id', id);\n        if (updErr) throw new Error(`Failed to update transcript: ${updErr.message}`);\n        const { data: row, error } = await this.supabase.from('transcripts').select('id,session_id,speaker,text_enc,created_at').eq('id', id).single();\n        if (error) throw new Error(`Failed to fetch transcript: ${error.message}`);\n        return mapDbTranscript(row);\n    }\n    async delete(id, _userId) {\n        const { error } = await this.supabase.from('transcripts').delete().eq('id', id);\n        if (error) throw new Error(`Failed to delete transcript: ${error.message}`);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3JlcG9zaXRvcmllcy90cmFuc2NyaXB0cy50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUFvRDtBQUVwRCxtRUFBbUU7QUFDbkUsTUFBTUMsY0FBY0MsMENBQW9DO0FBQ3hELE1BQU1HLGtCQUFrQkgsa05BQXlDO0FBQ2pFLE1BQU1LLGdCQUFnQlAsbUVBQVlBLENBQUNDLGFBQWFJO0FBMEJoRCxTQUFTRyxnQkFBZ0JDLEdBQVE7SUFDaEMsT0FBTztRQUNOQyxJQUFJRCxJQUFJQyxFQUFFO1FBQ1ZDLFlBQVlGLElBQUlFLFVBQVU7UUFDMUJDLGFBQWFILElBQUlJLFFBQVE7UUFDekJDLFNBQVNMLElBQUlLLE9BQU87UUFDcEJDLFdBQVdOLElBQUlPLFVBQVU7UUFDekJBLFlBQVlQLElBQUlPLFVBQVU7SUFDM0I7QUFDRDtBQUVPLE1BQU1DO0lBQ1pDLFlBQVksV0FBc0NYLGFBQWEsQ0FBRTthQUE3Q1ksV0FBQUE7SUFBOEM7SUFFbEUsTUFBTUMsUUFBUUMsT0FBOEIsRUFNekM7UUFDRixNQUFNLEVBQ0xDLFVBQVUsQ0FBQyxDQUFDLEVBQ1pDLE9BQU8sWUFBWSxFQUNuQkMsWUFBWSxLQUFLLEVBQ2pCQyxPQUFPLENBQUMsRUFDUkMsV0FBVyxFQUFFLEVBQ2IsR0FBR0w7UUFFSixNQUFNTSxhQUFhO1lBQUM7U0FBYSxDQUFDQyxRQUFRLENBQUNMLFFBQVFBLE9BQU87UUFFMUQsSUFBSU0sUUFBUSxJQUFJLENBQUNWLFFBQVEsQ0FDdkJXLElBQUksQ0FBQyxlQUNMQyxNQUFNLENBQUMsNkNBQTZDO1lBQUVDLE9BQU87UUFBUTtRQUV2RSxJQUFJVixRQUFRVyxTQUFTLEVBQUU7WUFDdEJKLFFBQVFBLE1BQU1LLEVBQUUsQ0FBQyxjQUFjWixRQUFRVyxTQUFTO1FBQ2pEO1FBRUEsSUFBSVgsUUFBUWEsTUFBTSxFQUFFO1lBQ25CTixRQUFRQSxNQUFNTyxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUMsRUFBRWQsUUFBUWEsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUN0RDtRQUVBLElBQUliLFFBQVFSLE9BQU8sRUFBRTtZQUNwQmUsUUFBUUEsTUFBTUssRUFBRSxDQUFDLFdBQVdaLFFBQVFSLE9BQU87UUFDNUM7UUFFQSxJQUFJUSxRQUFRZSxRQUFRLEVBQUU7WUFDckJSLFFBQVFBLE1BQU1TLEdBQUcsQ0FBQyxjQUFjaEIsUUFBUWUsUUFBUTtRQUNqRDtRQUVBLElBQUlmLFFBQVFpQixNQUFNLEVBQUU7WUFDbkJWLFFBQVFBLE1BQU1XLEdBQUcsQ0FBQyxjQUFjbEIsUUFBUWlCLE1BQU07UUFDL0M7UUFFQVYsUUFBUUEsTUFBTVksS0FBSyxDQUFDZCxZQUFZO1lBQUVlLFdBQVdsQixjQUFjO1FBQU07UUFFakUsTUFBTU0sT0FBTyxDQUFDTCxPQUFPLEtBQUtDO1FBQzFCLE1BQU1pQixLQUFLYixPQUFPSixXQUFXO1FBQzdCRyxRQUFRQSxNQUFNZSxLQUFLLENBQUNkLE1BQU1hO1FBRTFCLE1BQU0sRUFBRUUsTUFBTUMsSUFBSSxFQUFFQyxLQUFLLEVBQUVmLEtBQUssRUFBRSxHQUFHLE1BQU1IO1FBQzNDLElBQUlrQixPQUFPLE1BQU0sSUFBSUMsTUFBTSxDQUFDLDZCQUE2QixFQUFFRCxNQUFNRSxPQUFPLEVBQUU7UUFFMUUsTUFBTUMsY0FBYyxDQUFDSixRQUFRLEVBQUUsRUFBRUssR0FBRyxDQUFDM0M7UUFDckMsTUFBTTRDLFFBQVFwQixTQUFTO1FBQ3ZCLE1BQU1xQixhQUFhQyxLQUFLQyxJQUFJLENBQUNILFFBQVExQjtRQUVyQyxPQUFPO1lBQUV3QjtZQUFhRTtZQUFPM0I7WUFBTUM7WUFBVTJCO1FBQVc7SUFDekQ7SUFFQSxNQUFNRyxnQkFBZ0J2QixTQUFpQixFQUFFd0IsT0FBZSxFQUF5QjtRQUNoRixNQUFNLEVBQUVaLE1BQU1DLElBQUksRUFBRUMsS0FBSyxFQUFFLEdBQUcsTUFBTSxJQUFJLENBQUM1QixRQUFRLENBQy9DVyxJQUFJLENBQUMsZUFDTEMsTUFBTSxDQUFDLDZDQUNQRyxFQUFFLENBQUMsY0FBY0QsV0FDakJRLEtBQUssQ0FBQyxjQUFjO1lBQUVDLFdBQVc7UUFBSztRQUN4QyxJQUFJSyxPQUFPLE1BQU0sSUFBSUMsTUFBTSxDQUFDLHFDQUFxQyxFQUFFRCxNQUFNRSxPQUFPLEVBQUU7UUFDbEYsT0FBTyxDQUFDSCxRQUFRLEVBQUUsRUFBRUssR0FBRyxDQUFDM0M7SUFDekI7SUFFQSxNQUFNa0QsU0FBU2hELEVBQVUsRUFBRStDLE9BQWUsRUFBOEI7UUFDdkUsTUFBTSxFQUFFWixNQUFNcEMsR0FBRyxFQUFFc0MsS0FBSyxFQUFFLEdBQUcsTUFBTSxJQUFJLENBQUM1QixRQUFRLENBQzlDVyxJQUFJLENBQUMsZUFDTEMsTUFBTSxDQUFDLDZDQUNQRyxFQUFFLENBQUMsTUFBTXhCLElBQ1RpRCxNQUFNO1FBQ1IsSUFBSVosT0FBTztZQUNWLElBQUksTUFBZWEsSUFBSSxLQUFLLFlBQVksT0FBTztZQUMvQyxNQUFNLElBQUlaLE1BQU0sQ0FBQyw0QkFBNEIsRUFBRUQsTUFBTUUsT0FBTyxFQUFFO1FBQy9EO1FBQ0EsT0FBT3pDLGdCQUFnQkM7SUFDeEI7SUFFQSxNQUFNb0QsT0FBT0MsY0FBZ0MsRUFBRUwsT0FBZSxFQUF1QjtRQUNwRixNQUFNeEIsWUFBWSxlQUF3QnRCLFVBQVU7UUFDcEQsTUFBTUcsVUFBVSxlQUF3QkEsT0FBTyxJQUFJO1FBQ25ELE1BQU1pRCxVQUFVLGVBQXdCbkQsV0FBVyxJQUFJLGVBQXdCQyxRQUFRO1FBRXZGLE1BQU1tRCxxQkFBcUIsZUFBd0JDLG9CQUFvQixJQUFJLGVBQXdCQyxRQUFRLElBQUk7UUFFL0csSUFBSUMsUUFBYTtRQUNqQixJQUFJQyxTQUFjO1FBRWxCLElBQUlKLG9CQUFvQjtZQUN2QixNQUFNLEVBQUVuQixJQUFJLEVBQUVFLEtBQUssRUFBRSxHQUFHLE1BQU0sSUFBSyxDQUFDNUIsUUFBUSxDQUMxQ2tELEdBQUcsQ0FBQyx1QkFBdUI7Z0JBQUVDLGNBQWNyQztnQkFBV3NDLFdBQVd6RDtnQkFBUzBELFlBQVlUO2dCQUFTVSx3QkFBd0JUO1lBQW1CO1lBQzVJRyxRQUFRdEI7WUFDUnVCLFNBQVNyQjtZQUNULElBQUlxQixRQUFRO2dCQUNYLE1BQU1NLFdBQVcsTUFBTSxJQUFLLENBQUN2RCxRQUFRLENBQ25Da0QsR0FBRyxDQUFDLGtCQUFrQjtvQkFBRTFELFlBQVlzQjtvQkFBV25CO29CQUFTRCxVQUFVa0Q7Z0JBQVE7Z0JBQzVFSSxRQUFRTyxTQUFTN0IsSUFBSTtnQkFDckJ1QixTQUFTTSxTQUFTM0IsS0FBSztZQUN4QjtRQUNELE9BQU87WUFDTixNQUFNNEIsTUFBTSxNQUFNLElBQUssQ0FBQ3hELFFBQVEsQ0FDOUJrRCxHQUFHLENBQUMsa0JBQWtCO2dCQUFFMUQsWUFBWXNCO2dCQUFXbkI7Z0JBQVNELFVBQVVrRDtZQUFRO1lBQzVFSSxRQUFRUSxJQUFJOUIsSUFBSTtZQUNoQnVCLFNBQVNPLElBQUk1QixLQUFLO1FBQ25CO1FBQ0EsSUFBSXFCLFFBQVEsTUFBTSxJQUFJcEIsTUFBTSxDQUFDLDZCQUE2QixFQUFFb0IsT0FBT25CLE9BQU8sRUFBRTtRQUU1RSxNQUFNLEVBQUVKLE1BQU1wQyxHQUFHLEVBQUVzQyxLQUFLLEVBQUUsR0FBRyxNQUFNLElBQUksQ0FBQzVCLFFBQVEsQ0FDOUNXLElBQUksQ0FBQyxlQUNMQyxNQUFNLENBQUMsNkNBQ1BHLEVBQUUsQ0FBQyxNQUFNaUMsT0FDVFIsTUFBTTtRQUNSLElBQUlaLE9BQU8sTUFBTSxJQUFJQyxNQUFNLENBQUMsb0NBQW9DLEVBQUVELE1BQU1FLE9BQU8sRUFBRTtRQUNqRixPQUFPekMsZ0JBQWdCQztJQUN4QjtJQUVBLE1BQU1tRSxPQUFPbEUsRUFBVSxFQUFFb0QsY0FBZ0MsRUFBRUwsT0FBZSxFQUF1QjtRQUNoRyxNQUFNb0IsVUFBZSxDQUFDO1FBQ3RCLElBQUksZUFBd0JqRSxXQUFXLEVBQUVpRSxRQUFRaEUsUUFBUSxHQUFHLGVBQXdCRCxXQUFXO1FBQy9GLElBQUksZUFBd0JFLE9BQU8sRUFBRStELFFBQVEvRCxPQUFPLEdBQUcsZUFBd0JBLE9BQU87UUFDdEYsTUFBTSxFQUFFaUMsT0FBTytCLE1BQU0sRUFBRSxHQUFHLE1BQU0sSUFBSSxDQUFDM0QsUUFBUSxDQUFDVyxJQUFJLENBQUMsZUFBZThDLE1BQU0sQ0FBQ0MsU0FBUzNDLEVBQUUsQ0FBQyxNQUFNeEI7UUFDM0YsSUFBSW9FLFFBQVEsTUFBTSxJQUFJOUIsTUFBTSxDQUFDLDZCQUE2QixFQUFFOEIsT0FBTzdCLE9BQU8sRUFBRTtRQUM1RSxNQUFNLEVBQUVKLE1BQU1wQyxHQUFHLEVBQUVzQyxLQUFLLEVBQUUsR0FBRyxNQUFNLElBQUksQ0FBQzVCLFFBQVEsQ0FDOUNXLElBQUksQ0FBQyxlQUNMQyxNQUFNLENBQUMsNkNBQ1BHLEVBQUUsQ0FBQyxNQUFNeEIsSUFDVGlELE1BQU07UUFDUixJQUFJWixPQUFPLE1BQU0sSUFBSUMsTUFBTSxDQUFDLDRCQUE0QixFQUFFRCxNQUFNRSxPQUFPLEVBQUU7UUFDekUsT0FBT3pDLGdCQUFnQkM7SUFDeEI7SUFFQSxNQUFNc0UsT0FBT3JFLEVBQVUsRUFBRStDLE9BQWUsRUFBaUI7UUFDeEQsTUFBTSxFQUFFVixLQUFLLEVBQUUsR0FBRyxNQUFNLElBQUksQ0FBQzVCLFFBQVEsQ0FBQ1csSUFBSSxDQUFDLGVBQWVpRCxNQUFNLEdBQUc3QyxFQUFFLENBQUMsTUFBTXhCO1FBQzVFLElBQUlxQyxPQUFPLE1BQU0sSUFBSUMsTUFBTSxDQUFDLDZCQUE2QixFQUFFRCxNQUFNRSxPQUFPLEVBQUU7SUFDM0U7QUFDRCIsInNvdXJjZXMiOlsiRDpcXERlbHRhIElWXFxTb2Z3YXJlc1xcZ2xhc3NcXHNhbmRib3hcXHNoYWRjbi1jcm0tZGFzaGJvYXJkXFxzcmNcXHNlcnZlclxccmVwb3NpdG9yaWVzXFx0cmFuc2NyaXB0cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnXG5cbi8vIFVzZSB1bnR5cGVkIGNsaWVudCB1bnRpbCBzY2hlbWEgaXMgYXBwbGllZCBhbmQgdHlwZXMgcmVnZW5lcmF0ZWRcbmNvbnN0IHN1cGFiYXNlVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIVxuY29uc3Qgc3VwYWJhc2VBbm9uS2V5ID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkhXG5jb25zdCBkZWZhdWx0Q2xpZW50ID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZUFub25LZXkpXG5cbi8vIFRlbXBvcmFyeSB0eXBlcyB1bnRpbCBzY2hlbWEgaXMgYXBwbGllZFxudHlwZSBUcmFuc2NyaXB0ID0gYW55XG50eXBlIFRyYW5zY3JpcHRJbnNlcnQgPSBhbnlcbnR5cGUgVHJhbnNjcmlwdFVwZGF0ZSA9IGFueVxuXG50eXBlIFN1cGFiYXNlQ2xpZW50QW55ID0gdHlwZW9mIGRlZmF1bHRDbGllbnRcblxuZXhwb3J0IGludGVyZmFjZSBUcmFuc2NyaXB0RmlsdGVycyB7XG5cdHNlYXJjaD86IHN0cmluZ1xuXHRzZXNzaW9uSWQ/OiBzdHJpbmdcblx0ZGF0ZUZyb20/OiBzdHJpbmdcblx0ZGF0ZVRvPzogc3RyaW5nXG5cdHNwZWFrZXI/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUcmFuc2NyaXB0TGlzdE9wdGlvbnMge1xuXHRmaWx0ZXJzPzogVHJhbnNjcmlwdEZpbHRlcnNcblx0c29ydD86IHN0cmluZ1xuXHRkaXJlY3Rpb24/OiAnYXNjJyB8ICdkZXNjJ1xuXHRwYWdlPzogbnVtYmVyXG5cdHBhZ2VTaXplPzogbnVtYmVyXG5cdHVzZXJJZDogc3RyaW5nXG59XG5cbmZ1bmN0aW9uIG1hcERiVHJhbnNjcmlwdChyb3c6IGFueSk6IGFueSB7XG5cdHJldHVybiB7XG5cdFx0aWQ6IHJvdy5pZCxcblx0XHRzZXNzaW9uX2lkOiByb3cuc2Vzc2lvbl9pZCxcblx0XHRjb250ZW50X2VuYzogcm93LnRleHRfZW5jLFxuXHRcdHNwZWFrZXI6IHJvdy5zcGVha2VyLFxuXHRcdHRpbWVzdGFtcDogcm93LmNyZWF0ZWRfYXQsXG5cdFx0Y3JlYXRlZF9hdDogcm93LmNyZWF0ZWRfYXQsXG5cdH1cbn1cblxuZXhwb3J0IGNsYXNzIFRyYW5zY3JpcHRzUmVwb3NpdG9yeSB7XG5cdGNvbnN0cnVjdG9yKHByaXZhdGUgc3VwYWJhc2U6IFN1cGFiYXNlQ2xpZW50QW55ID0gZGVmYXVsdENsaWVudCkge31cblxuXHRhc3luYyBmaW5kQWxsKG9wdGlvbnM6IFRyYW5zY3JpcHRMaXN0T3B0aW9ucyk6IFByb21pc2U8e1xuXHRcdHRyYW5zY3JpcHRzOiBUcmFuc2NyaXB0W11cblx0XHR0b3RhbDogbnVtYmVyXG5cdFx0cGFnZTogbnVtYmVyXG5cdFx0cGFnZVNpemU6IG51bWJlclxuXHRcdHRvdGFsUGFnZXM6IG51bWJlclxuXHR9PiB7XG5cdFx0Y29uc3Qge1xuXHRcdFx0ZmlsdGVycyA9IHt9LFxuXHRcdFx0c29ydCA9ICdjcmVhdGVkX2F0Jyxcblx0XHRcdGRpcmVjdGlvbiA9ICdhc2MnLFxuXHRcdFx0cGFnZSA9IDEsXG5cdFx0XHRwYWdlU2l6ZSA9IDUwLFxuXHRcdH0gPSBvcHRpb25zXG5cblx0XHRjb25zdCBzb3J0Q29sdW1uID0gWydjcmVhdGVkX2F0J10uaW5jbHVkZXMoc29ydCkgPyBzb3J0IDogJ2NyZWF0ZWRfYXQnXG5cblx0XHRsZXQgcXVlcnkgPSB0aGlzLnN1cGFiYXNlXG5cdFx0XHQuZnJvbSgndHJhbnNjcmlwdHMnKVxuXHRcdFx0LnNlbGVjdCgnaWQsc2Vzc2lvbl9pZCxzcGVha2VyLHRleHRfZW5jLGNyZWF0ZWRfYXQnLCB7IGNvdW50OiAnZXhhY3QnIH0pXG5cblx0XHRpZiAoZmlsdGVycy5zZXNzaW9uSWQpIHtcblx0XHRcdHF1ZXJ5ID0gcXVlcnkuZXEoJ3Nlc3Npb25faWQnLCBmaWx0ZXJzLnNlc3Npb25JZClcblx0XHR9XG5cblx0XHRpZiAoZmlsdGVycy5zZWFyY2gpIHtcblx0XHRcdHF1ZXJ5ID0gcXVlcnkuaWxpa2UoJ3RleHRfZW5jJywgYCUke2ZpbHRlcnMuc2VhcmNofSVgKVxuXHRcdH1cblxuXHRcdGlmIChmaWx0ZXJzLnNwZWFrZXIpIHtcblx0XHRcdHF1ZXJ5ID0gcXVlcnkuZXEoJ3NwZWFrZXInLCBmaWx0ZXJzLnNwZWFrZXIpXG5cdFx0fVxuXG5cdFx0aWYgKGZpbHRlcnMuZGF0ZUZyb20pIHtcblx0XHRcdHF1ZXJ5ID0gcXVlcnkuZ3RlKCdjcmVhdGVkX2F0JywgZmlsdGVycy5kYXRlRnJvbSlcblx0XHR9XG5cblx0XHRpZiAoZmlsdGVycy5kYXRlVG8pIHtcblx0XHRcdHF1ZXJ5ID0gcXVlcnkubHRlKCdjcmVhdGVkX2F0JywgZmlsdGVycy5kYXRlVG8pXG5cdFx0fVxuXG5cdFx0cXVlcnkgPSBxdWVyeS5vcmRlcihzb3J0Q29sdW1uLCB7IGFzY2VuZGluZzogZGlyZWN0aW9uID09PSAnYXNjJyB9KVxuXG5cdFx0Y29uc3QgZnJvbSA9IChwYWdlIC0gMSkgKiBwYWdlU2l6ZVxuXHRcdGNvbnN0IHRvID0gZnJvbSArIHBhZ2VTaXplIC0gMVxuXHRcdHF1ZXJ5ID0gcXVlcnkucmFuZ2UoZnJvbSwgdG8pXG5cblx0XHRjb25zdCB7IGRhdGE6IHJvd3MsIGVycm9yLCBjb3VudCB9ID0gYXdhaXQgcXVlcnlcblx0XHRpZiAoZXJyb3IpIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGZldGNoIHRyYW5zY3JpcHRzOiAke2Vycm9yLm1lc3NhZ2V9YClcblxuXHRcdGNvbnN0IHRyYW5zY3JpcHRzID0gKHJvd3MgfHwgW10pLm1hcChtYXBEYlRyYW5zY3JpcHQpXG5cdFx0Y29uc3QgdG90YWwgPSBjb3VudCB8fCAwXG5cdFx0Y29uc3QgdG90YWxQYWdlcyA9IE1hdGguY2VpbCh0b3RhbCAvIHBhZ2VTaXplKVxuXG5cdFx0cmV0dXJuIHsgdHJhbnNjcmlwdHMsIHRvdGFsLCBwYWdlLCBwYWdlU2l6ZSwgdG90YWxQYWdlcyB9XG5cdH1cblxuXHRhc3luYyBmaW5kQnlTZXNzaW9uSWQoc2Vzc2lvbklkOiBzdHJpbmcsIF91c2VySWQ6IHN0cmluZyk6IFByb21pc2U8VHJhbnNjcmlwdFtdPiB7XG5cdFx0Y29uc3QgeyBkYXRhOiByb3dzLCBlcnJvciB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxuXHRcdFx0LmZyb20oJ3RyYW5zY3JpcHRzJylcblx0XHRcdC5zZWxlY3QoJ2lkLHNlc3Npb25faWQsc3BlYWtlcix0ZXh0X2VuYyxjcmVhdGVkX2F0Jylcblx0XHRcdC5lcSgnc2Vzc2lvbl9pZCcsIHNlc3Npb25JZClcblx0XHRcdC5vcmRlcignY3JlYXRlZF9hdCcsIHsgYXNjZW5kaW5nOiB0cnVlIH0pXG5cdFx0aWYgKGVycm9yKSB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBmZXRjaCBzZXNzaW9uIHRyYW5zY3JpcHRzOiAke2Vycm9yLm1lc3NhZ2V9YClcblx0XHRyZXR1cm4gKHJvd3MgfHwgW10pLm1hcChtYXBEYlRyYW5zY3JpcHQpXG5cdH1cblxuXHRhc3luYyBmaW5kQnlJZChpZDogc3RyaW5nLCBfdXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPFRyYW5zY3JpcHQgfCBudWxsPiB7XG5cdFx0Y29uc3QgeyBkYXRhOiByb3csIGVycm9yIH0gPSBhd2FpdCB0aGlzLnN1cGFiYXNlXG5cdFx0XHQuZnJvbSgndHJhbnNjcmlwdHMnKVxuXHRcdFx0LnNlbGVjdCgnaWQsc2Vzc2lvbl9pZCxzcGVha2VyLHRleHRfZW5jLGNyZWF0ZWRfYXQnKVxuXHRcdFx0LmVxKCdpZCcsIGlkKVxuXHRcdFx0LnNpbmdsZSgpXG5cdFx0aWYgKGVycm9yKSB7XG5cdFx0XHRpZiAoKGVycm9yIGFzIGFueSkuY29kZSA9PT0gJ1BHUlNUMTE2JykgcmV0dXJuIG51bGxcblx0XHRcdHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGZldGNoIHRyYW5zY3JpcHQ6ICR7ZXJyb3IubWVzc2FnZX1gKVxuXHRcdH1cblx0XHRyZXR1cm4gbWFwRGJUcmFuc2NyaXB0KHJvdylcblx0fVxuXG5cdGFzeW5jIGNyZWF0ZSh0cmFuc2NyaXB0RGF0YTogVHJhbnNjcmlwdEluc2VydCwgX3VzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxUcmFuc2NyaXB0PiB7XG5cdFx0Y29uc3Qgc2Vzc2lvbklkID0gKHRyYW5zY3JpcHREYXRhIGFzIGFueSkuc2Vzc2lvbl9pZFxuXHRcdGNvbnN0IHNwZWFrZXIgPSAodHJhbnNjcmlwdERhdGEgYXMgYW55KS5zcGVha2VyIHx8ICdTcGVha2VyJ1xuXHRcdGNvbnN0IHRleHRFbmMgPSAodHJhbnNjcmlwdERhdGEgYXMgYW55KS5jb250ZW50X2VuYyB8fCAodHJhbnNjcmlwdERhdGEgYXMgYW55KS50ZXh0X2VuY1xuXG5cdFx0Y29uc3QgY2xpZW50VHJhbnNjcmlwdElkID0gKHRyYW5zY3JpcHREYXRhIGFzIGFueSkuY2xpZW50X3RyYW5zY3JpcHRfaWQgfHwgKHRyYW5zY3JpcHREYXRhIGFzIGFueSkuY2xpZW50SWQgfHwgbnVsbFxuXG5cdFx0bGV0IG5ld0lkOiBhbnkgPSBudWxsXG5cdFx0bGV0IHJwY0VycjogYW55ID0gbnVsbFxuXG5cdFx0aWYgKGNsaWVudFRyYW5zY3JpcHRJZCkge1xuXHRcdFx0Y29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgKHRoaXMuc3VwYWJhc2UgYXMgYW55KVxuXHRcdFx0XHQucnBjKCdhZGRfdHJhbnNjcmlwdF9zYWZlJywgeyBwX3Nlc3Npb25faWQ6IHNlc3Npb25JZCwgcF9zcGVha2VyOiBzcGVha2VyLCBwX3RleHRfZW5jOiB0ZXh0RW5jLCBwX2NsaWVudF90cmFuc2NyaXB0X2lkOiBjbGllbnRUcmFuc2NyaXB0SWQgfSlcblx0XHRcdG5ld0lkID0gZGF0YVxuXHRcdFx0cnBjRXJyID0gZXJyb3Jcblx0XHRcdGlmIChycGNFcnIpIHtcblx0XHRcdFx0Y29uc3QgZmFsbGJhY2sgPSBhd2FpdCAodGhpcy5zdXBhYmFzZSBhcyBhbnkpXG5cdFx0XHRcdFx0LnJwYygnYWRkX3RyYW5zY3JpcHQnLCB7IHNlc3Npb25faWQ6IHNlc3Npb25JZCwgc3BlYWtlciwgdGV4dF9lbmM6IHRleHRFbmMgfSlcblx0XHRcdFx0bmV3SWQgPSBmYWxsYmFjay5kYXRhXG5cdFx0XHRcdHJwY0VyciA9IGZhbGxiYWNrLmVycm9yXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNvbnN0IHJlcyA9IGF3YWl0ICh0aGlzLnN1cGFiYXNlIGFzIGFueSlcblx0XHRcdFx0LnJwYygnYWRkX3RyYW5zY3JpcHQnLCB7IHNlc3Npb25faWQ6IHNlc3Npb25JZCwgc3BlYWtlciwgdGV4dF9lbmM6IHRleHRFbmMgfSlcblx0XHRcdG5ld0lkID0gcmVzLmRhdGFcblx0XHRcdHJwY0VyciA9IHJlcy5lcnJvclxuXHRcdH1cblx0XHRpZiAocnBjRXJyKSB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBjcmVhdGUgdHJhbnNjcmlwdDogJHtycGNFcnIubWVzc2FnZX1gKVxuXG5cdFx0Y29uc3QgeyBkYXRhOiByb3csIGVycm9yIH0gPSBhd2FpdCB0aGlzLnN1cGFiYXNlXG5cdFx0XHQuZnJvbSgndHJhbnNjcmlwdHMnKVxuXHRcdFx0LnNlbGVjdCgnaWQsc2Vzc2lvbl9pZCxzcGVha2VyLHRleHRfZW5jLGNyZWF0ZWRfYXQnKVxuXHRcdFx0LmVxKCdpZCcsIG5ld0lkKVxuXHRcdFx0LnNpbmdsZSgpXG5cdFx0aWYgKGVycm9yKSB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBmZXRjaCBjcmVhdGVkIHRyYW5zY3JpcHQ6ICR7ZXJyb3IubWVzc2FnZX1gKVxuXHRcdHJldHVybiBtYXBEYlRyYW5zY3JpcHQocm93KVxuXHR9XG5cblx0YXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIHRyYW5zY3JpcHREYXRhOiBUcmFuc2NyaXB0VXBkYXRlLCBfdXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPFRyYW5zY3JpcHQ+IHtcblx0XHRjb25zdCB1cGRhdGVzOiBhbnkgPSB7fVxuXHRcdGlmICgodHJhbnNjcmlwdERhdGEgYXMgYW55KS5jb250ZW50X2VuYykgdXBkYXRlcy50ZXh0X2VuYyA9ICh0cmFuc2NyaXB0RGF0YSBhcyBhbnkpLmNvbnRlbnRfZW5jXG5cdFx0aWYgKCh0cmFuc2NyaXB0RGF0YSBhcyBhbnkpLnNwZWFrZXIpIHVwZGF0ZXMuc3BlYWtlciA9ICh0cmFuc2NyaXB0RGF0YSBhcyBhbnkpLnNwZWFrZXJcblx0XHRjb25zdCB7IGVycm9yOiB1cGRFcnIgfSA9IGF3YWl0IHRoaXMuc3VwYWJhc2UuZnJvbSgndHJhbnNjcmlwdHMnKS51cGRhdGUodXBkYXRlcykuZXEoJ2lkJywgaWQpXG5cdFx0aWYgKHVwZEVycikgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gdXBkYXRlIHRyYW5zY3JpcHQ6ICR7dXBkRXJyLm1lc3NhZ2V9YClcblx0XHRjb25zdCB7IGRhdGE6IHJvdywgZXJyb3IgfSA9IGF3YWl0IHRoaXMuc3VwYWJhc2Vcblx0XHRcdC5mcm9tKCd0cmFuc2NyaXB0cycpXG5cdFx0XHQuc2VsZWN0KCdpZCxzZXNzaW9uX2lkLHNwZWFrZXIsdGV4dF9lbmMsY3JlYXRlZF9hdCcpXG5cdFx0XHQuZXEoJ2lkJywgaWQpXG5cdFx0XHQuc2luZ2xlKClcblx0XHRpZiAoZXJyb3IpIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGZldGNoIHRyYW5zY3JpcHQ6ICR7ZXJyb3IubWVzc2FnZX1gKVxuXHRcdHJldHVybiBtYXBEYlRyYW5zY3JpcHQocm93KVxuXHR9XG5cblx0YXN5bmMgZGVsZXRlKGlkOiBzdHJpbmcsIF91c2VySWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuXHRcdGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHRoaXMuc3VwYWJhc2UuZnJvbSgndHJhbnNjcmlwdHMnKS5kZWxldGUoKS5lcSgnaWQnLCBpZClcblx0XHRpZiAoZXJyb3IpIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGRlbGV0ZSB0cmFuc2NyaXB0OiAke2Vycm9yLm1lc3NhZ2V9YClcblx0fVxufVxuIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInN1cGFiYXNlQW5vbktleSIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIiwiZGVmYXVsdENsaWVudCIsIm1hcERiVHJhbnNjcmlwdCIsInJvdyIsImlkIiwic2Vzc2lvbl9pZCIsImNvbnRlbnRfZW5jIiwidGV4dF9lbmMiLCJzcGVha2VyIiwidGltZXN0YW1wIiwiY3JlYXRlZF9hdCIsIlRyYW5zY3JpcHRzUmVwb3NpdG9yeSIsImNvbnN0cnVjdG9yIiwic3VwYWJhc2UiLCJmaW5kQWxsIiwib3B0aW9ucyIsImZpbHRlcnMiLCJzb3J0IiwiZGlyZWN0aW9uIiwicGFnZSIsInBhZ2VTaXplIiwic29ydENvbHVtbiIsImluY2x1ZGVzIiwicXVlcnkiLCJmcm9tIiwic2VsZWN0IiwiY291bnQiLCJzZXNzaW9uSWQiLCJlcSIsInNlYXJjaCIsImlsaWtlIiwiZGF0ZUZyb20iLCJndGUiLCJkYXRlVG8iLCJsdGUiLCJvcmRlciIsImFzY2VuZGluZyIsInRvIiwicmFuZ2UiLCJkYXRhIiwicm93cyIsImVycm9yIiwiRXJyb3IiLCJtZXNzYWdlIiwidHJhbnNjcmlwdHMiLCJtYXAiLCJ0b3RhbCIsInRvdGFsUGFnZXMiLCJNYXRoIiwiY2VpbCIsImZpbmRCeVNlc3Npb25JZCIsIl91c2VySWQiLCJmaW5kQnlJZCIsInNpbmdsZSIsImNvZGUiLCJjcmVhdGUiLCJ0cmFuc2NyaXB0RGF0YSIsInRleHRFbmMiLCJjbGllbnRUcmFuc2NyaXB0SWQiLCJjbGllbnRfdHJhbnNjcmlwdF9pZCIsImNsaWVudElkIiwibmV3SWQiLCJycGNFcnIiLCJycGMiLCJwX3Nlc3Npb25faWQiLCJwX3NwZWFrZXIiLCJwX3RleHRfZW5jIiwicF9jbGllbnRfdHJhbnNjcmlwdF9pZCIsImZhbGxiYWNrIiwicmVzIiwidXBkYXRlIiwidXBkYXRlcyIsInVwZEVyciIsImRlbGV0ZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/repositories/transcripts.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/services/markdown-indexer.ts":
/*!*************************************************!*\
  !*** ./src/server/services/markdown-indexer.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   indexReportMarkdown: () => (/* binding */ indexReportMarkdown)\n/* harmony export */ });\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_0__);\n\nfunction normalizeNewlines(s) {\n    return (s || '').replace(/\\r\\n?/g, '\\n');\n}\nfunction slugify(s) {\n    return (s || '').toLowerCase().replace(/[^a-z0-9\\s\\-]/g, '').trim().replace(/\\s+/g, '-').replace(/-+/g, '-');\n}\nfunction extractSections(markdown, root) {\n    const text = normalizeNewlines(markdown);\n    const lines = text.split('\\n');\n    const sections = [];\n    const stack = [];\n    const flush = (startIndex, endIndex)=>{\n        if (stack.length === 0) return;\n        const node = stack[stack.length - 1];\n        const title = node.title;\n        const level = node.level;\n        const pathSlugs = [\n            root,\n            ...stack.map((s)=>s.slug)\n        ];\n        const slug_path = pathSlugs.join('/');\n        const content_markdown = lines.slice(startIndex, endIndex).join('\\n');\n        sections.push({\n            slug_path,\n            level,\n            title,\n            content_markdown,\n            start_line: startIndex + 1,\n            end_line: endIndex + 1\n        });\n    };\n    // We capture content for each heading until the next heading of same or higher level\n    let contentStart = 0;\n    for(let i = 0; i < lines.length; i++){\n        const m = /^(#{1,6})\\s+(.*)$/.exec(lines[i]);\n        if (!m) continue;\n        const level = m[1].length;\n        const title = m[2].trim();\n        // Close previous node\n        if (stack.length > 0) {\n            flush(contentStart, i - 1);\n        }\n        // Adjust stack to current level\n        while(stack.length > 0 && stack[stack.length - 1].level >= level){\n            stack.pop();\n        }\n        const slug = slugify(title);\n        stack.push({\n            level,\n            title,\n            slug,\n            start: i\n        });\n        contentStart = i + 1;\n    }\n    // Flush last\n    if (stack.length > 0) {\n        flush(contentStart, lines.length - 1);\n    }\n    return sections;\n}\nfunction extractTabSegment(all, tab) {\n    const text = normalizeNewlines(all);\n    const parts = text.split(/(```[\\s\\S]*?```)/g);\n    const mkStart = (name)=>new RegExp(`<!--\\\\s*TAB:\\\\s*${name}\\\\s*-->`, 'i');\n    const mkEnd = (name)=>new RegExp(`<!--\\\\s*\\\\/\\\\s*TAB:\\\\s*${name}\\\\s*-->`, 'i');\n    const startExec = mkStart('EXECUTIVE\\\\s+SUMMARY');\n    const endExec = mkEnd('EXECUTIVE\\\\s+SUMMARY');\n    const startChance = mkStart('CHANCE\\\\s+OF\\\\s+SALE');\n    const endChance = mkEnd('CHANCE\\\\s+OF\\\\s+SALE');\n    let cur = 'none';\n    const out = [];\n    for (const part of parts){\n        if (part.startsWith('```')) {\n            if (cur !== 'none') out.push(part);\n            continue;\n        }\n        const isStartExec = startExec.test(part);\n        const isEndExec = endExec.test(part);\n        const isStartChance = startChance.test(part);\n        const isEndChance = endChance.test(part);\n        if (isStartExec || isStartChance || isEndExec || isEndChance) {\n            // strip markers\n            const cleaned = part.replace(startExec, '').replace(endExec, '').replace(startChance, '').replace(endChance, '');\n            if (cleaned && cur !== 'none') out.push(cleaned);\n            if (isStartExec) cur = 'exec';\n            else if (isStartChance) cur = 'chance';\n            else if (isEndExec && cur === 'exec') cur = 'none';\n            else if (isEndChance && cur === 'chance') cur = 'none';\n            continue;\n        }\n        if (cur !== 'none') out.push(part);\n    }\n    const combined = out.join('');\n    const trimmed = combined.replace(/^\\n+|\\s+$/g, '').trim();\n    if (!trimmed) return undefined;\n    return trimmed;\n}\nasync function indexReportMarkdown(supabase, sessionId, allMarkdown) {\n    const execMd = extractTabSegment(allMarkdown, 'exec');\n    const chanceMd = extractTabSegment(allMarkdown, 'chance');\n    // Delete only the roots we will re-insert\n    const rootsToReplace = [];\n    if (execMd) rootsToReplace.push('executive_summary');\n    if (chanceMd) rootsToReplace.push('chance_of_sale');\n    for (const root of rootsToReplace){\n        await supabase.from('report_sections').delete().eq('session_id', sessionId).eq('report_kind', 'tabs').like('slug_path', `${root}%`).then(()=>{}, ()=>{});\n    }\n    const rows = [];\n    const pushSections = (md, root)=>{\n        // Prefer SECTION anchor parsing for deterministic paths; fallback to heading-based\n        const anchorRegex = /<!--\\s*SECTION:\\s*([A-Z0-9_\\/\\-]+)\\s*-->[\\s\\S]*?<!--\\s*\\/SECTION:\\s*\\1\\s*-->/g;\n        const blocks = [];\n        let m;\n        while((m = anchorRegex.exec(md)) !== null){\n            const id = m[1];\n            const full = m[0];\n            const inner = full.replace(new RegExp(`<!--\\\\s*SECTION:\\\\s*${id}\\\\s*-->`), '').replace(new RegExp(`<!--\\\\s*\\\\/SECTION:\\\\s*${id}\\\\s*-->`), '');\n            blocks.push({\n                id,\n                content: inner\n            });\n        }\n        if (blocks.length > 0) {\n            for (const b of blocks){\n                rows.push({\n                    session_id: sessionId,\n                    report_kind: 'tabs',\n                    node_id: (0,crypto__WEBPACK_IMPORTED_MODULE_0__.randomUUID)(),\n                    slug_path: `${root}/${b.id}`,\n                    level: 2,\n                    title: b.id,\n                    content_markdown: normalizeNewlines(b.content).trim(),\n                    start_line: 0,\n                    end_line: 0\n                });\n            }\n        } else {\n            const secs = extractSections(md, root);\n            for (const s of secs){\n                rows.push({\n                    session_id: sessionId,\n                    report_kind: 'tabs',\n                    node_id: (0,crypto__WEBPACK_IMPORTED_MODULE_0__.randomUUID)(),\n                    slug_path: s.slug_path,\n                    level: s.level,\n                    title: s.title,\n                    content_markdown: s.content_markdown,\n                    start_line: s.start_line,\n                    end_line: s.end_line\n                });\n            }\n        }\n    };\n    if (execMd) pushSections(execMd, 'executive_summary');\n    if (chanceMd) pushSections(chanceMd, 'chance_of_sale');\n    if (rows.length > 0) {\n        await supabase.from('report_sections').insert(rows).then(()=>{}, ()=>{});\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3NlcnZpY2VzL21hcmtkb3duLWluZGV4ZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQ21DO0FBRW5DLFNBQVNDLGtCQUFrQkMsQ0FBUztJQUNsQyxPQUFPLENBQUNBLEtBQUssRUFBQyxFQUFHQyxPQUFPLENBQUMsVUFBVTtBQUNyQztBQVdBLFNBQVNDLFFBQVFGLENBQVM7SUFDeEIsT0FBTyxDQUFDQSxLQUFLLEVBQUMsRUFDWEcsV0FBVyxHQUNYRixPQUFPLENBQUMsa0JBQWtCLElBQzFCRyxJQUFJLEdBQ0pILE9BQU8sQ0FBQyxRQUFRLEtBQ2hCQSxPQUFPLENBQUMsT0FBTztBQUNwQjtBQUVBLFNBQVNJLGdCQUFnQkMsUUFBZ0IsRUFBRUMsSUFBNEM7SUFDckYsTUFBTUMsT0FBT1Qsa0JBQWtCTztJQUMvQixNQUFNRyxRQUFRRCxLQUFLRSxLQUFLLENBQUM7SUFDekIsTUFBTUMsV0FBc0IsRUFBRTtJQUc5QixNQUFNQyxRQUFxQixFQUFFO0lBRTdCLE1BQU1DLFFBQVEsQ0FBQ0MsWUFBb0JDO1FBQ2pDLElBQUlILE1BQU1JLE1BQU0sS0FBSyxHQUFHO1FBQ3hCLE1BQU1DLE9BQU9MLEtBQUssQ0FBQ0EsTUFBTUksTUFBTSxHQUFHLEVBQUU7UUFDcEMsTUFBTUUsUUFBUUQsS0FBS0MsS0FBSztRQUN4QixNQUFNQyxRQUFRRixLQUFLRSxLQUFLO1FBQ3hCLE1BQU1DLFlBQVk7WUFBQ2I7ZUFBU0ssTUFBTVMsR0FBRyxDQUFDckIsQ0FBQUEsSUFBS0EsRUFBRXNCLElBQUk7U0FBRTtRQUNuRCxNQUFNQyxZQUFZSCxVQUFVSSxJQUFJLENBQUM7UUFDakMsTUFBTUMsbUJBQW1CaEIsTUFBTWlCLEtBQUssQ0FBQ1osWUFBWUMsVUFBVVMsSUFBSSxDQUFDO1FBQ2hFYixTQUFTZ0IsSUFBSSxDQUFDO1lBQUVKO1lBQVdKO1lBQU9EO1lBQU9PO1lBQWtCRyxZQUFZZCxhQUFhO1lBQUdlLFVBQVVkLFdBQVc7UUFBRTtJQUNoSDtJQUVB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YXNoYm9hcmRcXHNyY1xcc2VydmVyXFxzZXJ2aWNlc1xcbWFya2Rvd24taW5kZXhlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IFN1cGFiYXNlQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJ1xuaW1wb3J0IHsgcmFuZG9tVVVJRCB9IGZyb20gJ2NyeXB0bydcblxuZnVuY3Rpb24gbm9ybWFsaXplTmV3bGluZXMoczogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIChzIHx8ICcnKS5yZXBsYWNlKC9cXHJcXG4/L2csICdcXG4nKVxufVxuXG5leHBvcnQgdHlwZSBTZWN0aW9uID0ge1xuICBzbHVnX3BhdGg6IHN0cmluZ1xuICBsZXZlbDogbnVtYmVyXG4gIHRpdGxlOiBzdHJpbmdcbiAgY29udGVudF9tYXJrZG93bjogc3RyaW5nXG4gIHN0YXJ0X2xpbmU6IG51bWJlclxuICBlbmRfbGluZTogbnVtYmVyXG59XG5cbmZ1bmN0aW9uIHNsdWdpZnkoczogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIChzIHx8ICcnKVxuICAgIC50b0xvd2VyQ2FzZSgpXG4gICAgLnJlcGxhY2UoL1teYS16MC05XFxzXFwtXS9nLCAnJylcbiAgICAudHJpbSgpXG4gICAgLnJlcGxhY2UoL1xccysvZywgJy0nKVxuICAgIC5yZXBsYWNlKC8tKy9nLCAnLScpXG59XG5cbmZ1bmN0aW9uIGV4dHJhY3RTZWN0aW9ucyhtYXJrZG93bjogc3RyaW5nLCByb290OiAnZXhlY3V0aXZlX3N1bW1hcnknIHwgJ2NoYW5jZV9vZl9zYWxlJyk6IFNlY3Rpb25bXSB7XG4gIGNvbnN0IHRleHQgPSBub3JtYWxpemVOZXdsaW5lcyhtYXJrZG93bilcbiAgY29uc3QgbGluZXMgPSB0ZXh0LnNwbGl0KCdcXG4nKVxuICBjb25zdCBzZWN0aW9uczogU2VjdGlvbltdID0gW11cblxuICB0eXBlIFN0YWNrTm9kZSA9IHsgbGV2ZWw6IG51bWJlcjsgdGl0bGU6IHN0cmluZzsgc2x1Zzogc3RyaW5nOyBzdGFydDogbnVtYmVyIH1cbiAgY29uc3Qgc3RhY2s6IFN0YWNrTm9kZVtdID0gW11cblxuICBjb25zdCBmbHVzaCA9IChzdGFydEluZGV4OiBudW1iZXIsIGVuZEluZGV4OiBudW1iZXIpID0+IHtcbiAgICBpZiAoc3RhY2subGVuZ3RoID09PSAwKSByZXR1cm5cbiAgICBjb25zdCBub2RlID0gc3RhY2tbc3RhY2subGVuZ3RoIC0gMV1cbiAgICBjb25zdCB0aXRsZSA9IG5vZGUudGl0bGVcbiAgICBjb25zdCBsZXZlbCA9IG5vZGUubGV2ZWxcbiAgICBjb25zdCBwYXRoU2x1Z3MgPSBbcm9vdCwgLi4uc3RhY2subWFwKHMgPT4gcy5zbHVnKV1cbiAgICBjb25zdCBzbHVnX3BhdGggPSBwYXRoU2x1Z3Muam9pbignLycpXG4gICAgY29uc3QgY29udGVudF9tYXJrZG93biA9IGxpbmVzLnNsaWNlKHN0YXJ0SW5kZXgsIGVuZEluZGV4KS5qb2luKCdcXG4nKVxuICAgIHNlY3Rpb25zLnB1c2goeyBzbHVnX3BhdGgsIGxldmVsLCB0aXRsZSwgY29udGVudF9tYXJrZG93biwgc3RhcnRfbGluZTogc3RhcnRJbmRleCArIDEsIGVuZF9saW5lOiBlbmRJbmRleCArIDEgfSlcbiAgfVxuXG4gIC8vIFdlIGNhcHR1cmUgY29udGVudCBmb3IgZWFjaCBoZWFkaW5nIHVudGlsIHRoZSBuZXh0IGhlYWRpbmcgb2Ygc2FtZSBvciBoaWdoZXIgbGV2ZWxcbiAgbGV0IGNvbnRlbnRTdGFydCA9IDBcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaW5lcy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IG0gPSAvXigjezEsNn0pXFxzKyguKikkLy5leGVjKGxpbmVzW2ldKVxuICAgIGlmICghbSkgY29udGludWVcbiAgICBjb25zdCBsZXZlbCA9IG1bMV0ubGVuZ3RoXG4gICAgY29uc3QgdGl0bGUgPSBtWzJdLnRyaW0oKVxuICAgIC8vIENsb3NlIHByZXZpb3VzIG5vZGVcbiAgICBpZiAoc3RhY2subGVuZ3RoID4gMCkge1xuICAgICAgZmx1c2goY29udGVudFN0YXJ0LCBpIC0gMSlcbiAgICB9XG4gICAgLy8gQWRqdXN0IHN0YWNrIHRvIGN1cnJlbnQgbGV2ZWxcbiAgICB3aGlsZSAoc3RhY2subGVuZ3RoID4gMCAmJiBzdGFja1tzdGFjay5sZW5ndGggLSAxXS5sZXZlbCA+PSBsZXZlbCkge1xuICAgICAgc3RhY2sucG9wKClcbiAgICB9XG4gICAgY29uc3Qgc2x1ZyA9IHNsdWdpZnkodGl0bGUpXG4gICAgc3RhY2sucHVzaCh7IGxldmVsLCB0aXRsZSwgc2x1Zywgc3RhcnQ6IGkgfSlcbiAgICBjb250ZW50U3RhcnQgPSBpICsgMVxuICB9XG4gIC8vIEZsdXNoIGxhc3RcbiAgaWYgKHN0YWNrLmxlbmd0aCA+IDApIHtcbiAgICBmbHVzaChjb250ZW50U3RhcnQsIGxpbmVzLmxlbmd0aCAtIDEpXG4gIH1cbiAgcmV0dXJuIHNlY3Rpb25zXG59XG5cbmZ1bmN0aW9uIGV4dHJhY3RUYWJTZWdtZW50KGFsbDogc3RyaW5nLCB0YWI6ICdleGVjJyB8ICdjaGFuY2UnKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgY29uc3QgdGV4dCA9IG5vcm1hbGl6ZU5ld2xpbmVzKGFsbClcbiAgY29uc3QgcGFydHMgPSB0ZXh0LnNwbGl0KC8oYGBgW1xcc1xcU10qP2BgYCkvZylcbiAgY29uc3QgbWtTdGFydCA9IChuYW1lOiBzdHJpbmcpID0+IG5ldyBSZWdFeHAoYDwhLS1cXFxccypUQUI6XFxcXHMqJHtuYW1lfVxcXFxzKi0tPmAsICdpJylcbiAgY29uc3QgbWtFbmQgPSAobmFtZTogc3RyaW5nKSA9PiBuZXcgUmVnRXhwKGA8IS0tXFxcXHMqXFxcXC9cXFxccypUQUI6XFxcXHMqJHtuYW1lfVxcXFxzKi0tPmAsICdpJylcbiAgY29uc3Qgc3RhcnRFeGVjID0gbWtTdGFydCgnRVhFQ1VUSVZFXFxcXHMrU1VNTUFSWScpXG4gIGNvbnN0IGVuZEV4ZWMgPSBta0VuZCgnRVhFQ1VUSVZFXFxcXHMrU1VNTUFSWScpXG4gIGNvbnN0IHN0YXJ0Q2hhbmNlID0gbWtTdGFydCgnQ0hBTkNFXFxcXHMrT0ZcXFxccytTQUxFJylcbiAgY29uc3QgZW5kQ2hhbmNlID0gbWtFbmQoJ0NIQU5DRVxcXFxzK09GXFxcXHMrU0FMRScpXG5cbiAgbGV0IGN1cjogJ25vbmUnIHwgJ2V4ZWMnIHwgJ2NoYW5jZScgPSAnbm9uZSdcbiAgY29uc3Qgb3V0OiBzdHJpbmdbXSA9IFtdXG4gIGZvciAoY29uc3QgcGFydCBvZiBwYXJ0cykge1xuICAgIGlmIChwYXJ0LnN0YXJ0c1dpdGgoJ2BgYCcpKSB7XG4gICAgICBpZiAoY3VyICE9PSAnbm9uZScpIG91dC5wdXNoKHBhcnQpXG4gICAgICBjb250aW51ZVxuICAgIH1cbiAgICBjb25zdCBpc1N0YXJ0RXhlYyA9IHN0YXJ0RXhlYy50ZXN0KHBhcnQpXG4gICAgY29uc3QgaXNFbmRFeGVjID0gZW5kRXhlYy50ZXN0KHBhcnQpXG4gICAgY29uc3QgaXNTdGFydENoYW5jZSA9IHN0YXJ0Q2hhbmNlLnRlc3QocGFydClcbiAgICBjb25zdCBpc0VuZENoYW5jZSA9IGVuZENoYW5jZS50ZXN0KHBhcnQpXG5cbiAgICBpZiAoaXNTdGFydEV4ZWMgfHwgaXNTdGFydENoYW5jZSB8fCBpc0VuZEV4ZWMgfHwgaXNFbmRDaGFuY2UpIHtcbiAgICAgIC8vIHN0cmlwIG1hcmtlcnNcbiAgICAgIGNvbnN0IGNsZWFuZWQgPSBwYXJ0XG4gICAgICAgIC5yZXBsYWNlKHN0YXJ0RXhlYywgJycpXG4gICAgICAgIC5yZXBsYWNlKGVuZEV4ZWMsICcnKVxuICAgICAgICAucmVwbGFjZShzdGFydENoYW5jZSwgJycpXG4gICAgICAgIC5yZXBsYWNlKGVuZENoYW5jZSwgJycpXG4gICAgICBpZiAoY2xlYW5lZCAmJiBjdXIgIT09ICdub25lJykgb3V0LnB1c2goY2xlYW5lZClcbiAgICAgIGlmIChpc1N0YXJ0RXhlYykgY3VyID0gJ2V4ZWMnXG4gICAgICBlbHNlIGlmIChpc1N0YXJ0Q2hhbmNlKSBjdXIgPSAnY2hhbmNlJ1xuICAgICAgZWxzZSBpZiAoaXNFbmRFeGVjICYmIGN1ciA9PT0gJ2V4ZWMnKSBjdXIgPSAnbm9uZSdcbiAgICAgIGVsc2UgaWYgKGlzRW5kQ2hhbmNlICYmIGN1ciA9PT0gJ2NoYW5jZScpIGN1ciA9ICdub25lJ1xuICAgICAgY29udGludWVcbiAgICB9XG4gICAgaWYgKGN1ciAhPT0gJ25vbmUnKSBvdXQucHVzaChwYXJ0KVxuICB9XG4gIGNvbnN0IGNvbWJpbmVkID0gb3V0LmpvaW4oJycpXG4gIGNvbnN0IHRyaW1tZWQgPSBjb21iaW5lZC5yZXBsYWNlKC9eXFxuK3xcXHMrJC9nLCAnJykudHJpbSgpXG4gIGlmICghdHJpbW1lZCkgcmV0dXJuIHVuZGVmaW5lZFxuICByZXR1cm4gdHJpbW1lZFxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaW5kZXhSZXBvcnRNYXJrZG93bihcbiAgc3VwYWJhc2U6IFN1cGFiYXNlQ2xpZW50LFxuICBzZXNzaW9uSWQ6IHN0cmluZyxcbiAgYWxsTWFya2Rvd246IHN0cmluZ1xuKTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnN0IGV4ZWNNZCA9IGV4dHJhY3RUYWJTZWdtZW50KGFsbE1hcmtkb3duLCAnZXhlYycpXG4gIGNvbnN0IGNoYW5jZU1kID0gZXh0cmFjdFRhYlNlZ21lbnQoYWxsTWFya2Rvd24sICdjaGFuY2UnKVxuXG4gIC8vIERlbGV0ZSBvbmx5IHRoZSByb290cyB3ZSB3aWxsIHJlLWluc2VydFxuICBjb25zdCByb290c1RvUmVwbGFjZTogQXJyYXk8J2V4ZWN1dGl2ZV9zdW1tYXJ5JyB8ICdjaGFuY2Vfb2Zfc2FsZSc+ID0gW11cbiAgaWYgKGV4ZWNNZCkgcm9vdHNUb1JlcGxhY2UucHVzaCgnZXhlY3V0aXZlX3N1bW1hcnknKVxuICBpZiAoY2hhbmNlTWQpIHJvb3RzVG9SZXBsYWNlLnB1c2goJ2NoYW5jZV9vZl9zYWxlJylcbiAgZm9yIChjb25zdCByb290IG9mIHJvb3RzVG9SZXBsYWNlKSB7XG4gICAgYXdhaXQgKHN1cGFiYXNlIGFzIGFueSlcbiAgICAgIC5mcm9tKCdyZXBvcnRfc2VjdGlvbnMnKVxuICAgICAgLmRlbGV0ZSgpXG4gICAgICAuZXEoJ3Nlc3Npb25faWQnLCBzZXNzaW9uSWQpXG4gICAgICAuZXEoJ3JlcG9ydF9raW5kJywgJ3RhYnMnKVxuICAgICAgLmxpa2UoJ3NsdWdfcGF0aCcsIGAke3Jvb3R9JWApXG4gICAgICAudGhlbigoKSA9PiB7fSwgKCkgPT4ge30pXG4gIH1cblxuICBjb25zdCByb3dzOiBhbnlbXSA9IFtdXG4gIGNvbnN0IHB1c2hTZWN0aW9ucyA9IChtZDogc3RyaW5nLCByb290OiAnZXhlY3V0aXZlX3N1bW1hcnknfCdjaGFuY2Vfb2Zfc2FsZScpID0+IHtcbiAgICAvLyBQcmVmZXIgU0VDVElPTiBhbmNob3IgcGFyc2luZyBmb3IgZGV0ZXJtaW5pc3RpYyBwYXRoczsgZmFsbGJhY2sgdG8gaGVhZGluZy1iYXNlZFxuICAgIGNvbnN0IGFuY2hvclJlZ2V4ID0gLzwhLS1cXHMqU0VDVElPTjpcXHMqKFtBLVowLTlfXFwvXFwtXSspXFxzKi0tPltcXHNcXFNdKj88IS0tXFxzKlxcL1NFQ1RJT046XFxzKlxcMVxccyotLT4vZ1xuICAgIGNvbnN0IGJsb2NrczogQXJyYXk8eyBpZDogc3RyaW5nOyBjb250ZW50OiBzdHJpbmcgfT4gPSBbXVxuICAgIGxldCBtOiBSZWdFeHBFeGVjQXJyYXkgfCBudWxsXG4gICAgd2hpbGUgKChtID0gYW5jaG9yUmVnZXguZXhlYyhtZCkpICE9PSBudWxsKSB7XG4gICAgICBjb25zdCBpZCA9IG1bMV1cbiAgICAgIGNvbnN0IGZ1bGwgPSBtWzBdXG4gICAgICBjb25zdCBpbm5lciA9IGZ1bGxcbiAgICAgICAgLnJlcGxhY2UobmV3IFJlZ0V4cChgPCEtLVxcXFxzKlNFQ1RJT046XFxcXHMqJHtpZH1cXFxccyotLT5gKSwgJycpXG4gICAgICAgIC5yZXBsYWNlKG5ldyBSZWdFeHAoYDwhLS1cXFxccypcXFxcL1NFQ1RJT046XFxcXHMqJHtpZH1cXFxccyotLT5gKSwgJycpXG4gICAgICBibG9ja3MucHVzaCh7IGlkLCBjb250ZW50OiBpbm5lciB9KVxuICAgIH1cbiAgICBpZiAoYmxvY2tzLmxlbmd0aCA+IDApIHtcbiAgICAgIGZvciAoY29uc3QgYiBvZiBibG9ja3MpIHtcbiAgICAgICAgcm93cy5wdXNoKHtcbiAgICAgICAgICBzZXNzaW9uX2lkOiBzZXNzaW9uSWQsXG4gICAgICAgICAgcmVwb3J0X2tpbmQ6ICd0YWJzJyxcbiAgICAgICAgICBub2RlX2lkOiByYW5kb21VVUlEKCksXG4gICAgICAgICAgc2x1Z19wYXRoOiBgJHtyb290fS8ke2IuaWR9YCxcbiAgICAgICAgICBsZXZlbDogMixcbiAgICAgICAgICB0aXRsZTogYi5pZCxcbiAgICAgICAgICBjb250ZW50X21hcmtkb3duOiBub3JtYWxpemVOZXdsaW5lcyhiLmNvbnRlbnQpLnRyaW0oKSxcbiAgICAgICAgICBzdGFydF9saW5lOiAwLFxuICAgICAgICAgIGVuZF9saW5lOiAwLFxuICAgICAgICB9KVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBzZWNzID0gZXh0cmFjdFNlY3Rpb25zKG1kLCByb290KVxuICAgICAgZm9yIChjb25zdCBzIG9mIHNlY3MpIHtcbiAgICAgICAgcm93cy5wdXNoKHtcbiAgICAgICAgICBzZXNzaW9uX2lkOiBzZXNzaW9uSWQsXG4gICAgICAgICAgcmVwb3J0X2tpbmQ6ICd0YWJzJyxcbiAgICAgICAgICBub2RlX2lkOiByYW5kb21VVUlEKCksXG4gICAgICAgICAgc2x1Z19wYXRoOiBzLnNsdWdfcGF0aCxcbiAgICAgICAgICBsZXZlbDogcy5sZXZlbCxcbiAgICAgICAgICB0aXRsZTogcy50aXRsZSxcbiAgICAgICAgICBjb250ZW50X21hcmtkb3duOiBzLmNvbnRlbnRfbWFya2Rvd24sXG4gICAgICAgICAgc3RhcnRfbGluZTogcy5zdGFydF9saW5lLFxuICAgICAgICAgIGVuZF9saW5lOiBzLmVuZF9saW5lLFxuICAgICAgICB9KVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGlmIChleGVjTWQpIHB1c2hTZWN0aW9ucyhleGVjTWQsICdleGVjdXRpdmVfc3VtbWFyeScpXG4gIGlmIChjaGFuY2VNZCkgcHVzaFNlY3Rpb25zKGNoYW5jZU1kLCAnY2hhbmNlX29mX3NhbGUnKVxuXG4gIGlmIChyb3dzLmxlbmd0aCA+IDApIHtcbiAgICBhd2FpdCAoc3VwYWJhc2UgYXMgYW55KS5mcm9tKCdyZXBvcnRfc2VjdGlvbnMnKS5pbnNlcnQocm93cykudGhlbigoKSA9PiB7fSwgKCkgPT4ge30pXG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJyYW5kb21VVUlEIiwibm9ybWFsaXplTmV3bGluZXMiLCJzIiwicmVwbGFjZSIsInNsdWdpZnkiLCJ0b0xvd2VyQ2FzZSIsInRyaW0iLCJleHRyYWN0U2VjdGlvbnMiLCJtYXJrZG93biIsInJvb3QiLCJ0ZXh0IiwibGluZXMiLCJzcGxpdCIsInNlY3Rpb25zIiwic3RhY2siLCJmbHVzaCIsInN0YXJ0SW5kZXgiLCJlbmRJbmRleCIsImxlbmd0aCIsIm5vZGUiLCJ0aXRsZSIsImxldmVsIiwicGF0aFNsdWdzIiwibWFwIiwic2x1ZyIsInNsdWdfcGF0aCIsImpvaW4iLCJjb250ZW50X21hcmtkb3duIiwic2xpY2UiLCJwdXNoIiwic3RhcnRfbGluZSIsImVuZF9saW5lIiwiY29udGVudFN0YXJ0IiwiaSIsIm0iLCJleGVjIiwicG9wIiwic3RhcnQiLCJleHRyYWN0VGFiU2VnbWVudCIsImFsbCIsInRhYiIsInBhcnRzIiwibWtTdGFydCIsIm5hbWUiLCJSZWdFeHAiLCJta0VuZCIsInN0YXJ0RXhlYyIsImVuZEV4ZWMiLCJzdGFydENoYW5jZSIsImVuZENoYW5jZSIsImN1ciIsIm91dCIsInBhcnQiLCJzdGFydHNXaXRoIiwiaXNTdGFydEV4ZWMiLCJ0ZXN0IiwiaXNFbmRFeGVjIiwiaXNTdGFydENoYW5jZSIsImlzRW5kQ2hhbmNlIiwiY2xlYW5lZCIsImNvbWJpbmVkIiwidHJpbW1lZCIsInVuZGVmaW5lZCIsImluZGV4UmVwb3J0TWFya2Rvd24iLCJzdXBhYmFzZSIsInNlc3Npb25JZCIsImFsbE1hcmtkb3duIiwiZXhlY01kIiwiY2hhbmNlTWQiLCJyb290c1RvUmVwbGFjZSIsImZyb20iLCJkZWxldGUiLCJlcSIsImxpa2UiLCJ0aGVuIiwicm93cyIsInB1c2hTZWN0aW9ucyIsIm1kIiwiYW5jaG9yUmVnZXgiLCJibG9ja3MiLCJpZCIsImZ1bGwiLCJpbm5lciIsImNvbnRlbnQiLCJiIiwic2Vzc2lvbl9pZCIsInJlcG9ydF9raW5kIiwibm9kZV9pZCIsInNlY3MiLCJpbnNlcnQiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/server/services/markdown-indexer.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/services/openrouter.ts":
/*!*******************************************!*\
  !*** ./src/server/services/openrouter.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   chatJsonSchema: () => (/* binding */ chatJsonSchema),\n/* harmony export */   chatText: () => (/* binding */ chatText),\n/* harmony export */   chatWithTools: () => (/* binding */ chatWithTools),\n/* harmony export */   normalizeProviderSort: () => (/* binding */ normalizeProviderSort)\n/* harmony export */ });\nconst OPENROUTER_URL = 'https://openrouter.ai/api/v1/chat/completions';\n// Normalize provider sort to current OpenRouter API values.\n// Backwards compatible mapping for legacy values used in older code.\nfunction normalizeProviderSort(sort) {\n    const envDefault = (process.env.OPENROUTER_PROVIDER_SORT || '').toLowerCase();\n    const candidate = (sort || envDefault || 'price').toLowerCase();\n    if (candidate === 'price') return 'price';\n    if (candidate === 'throughput') return 'throughput';\n    if (candidate === 'latency') return 'latency';\n    // legacy aliases\n    if (candidate === 'speed') return 'latency';\n    if (candidate === 'quality') return 'latency';\n    return 'price';\n}\nfunction buildHeaders() {\n    const headers = {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${process.env.OPENROUTER_API_KEY}`\n    };\n    if (process.env.OPENROUTER_HTTP_REFERER) headers['HTTP-Referer'] = process.env.OPENROUTER_HTTP_REFERER;\n    if (process.env.OPENROUTER_X_TITLE) headers['X-Title'] = process.env.OPENROUTER_X_TITLE;\n    return headers;\n}\nfunction messageCharLength(message) {\n    const content = message.content;\n    if (typeof content === 'string') return content.length;\n    return 0;\n}\nfunction estimateTokens(messages) {\n    const charCount = messages.reduce((sum, m)=>sum + messageCharLength(m), 0);\n    // Very rough heuristic: ~4 chars per token for English text\n    const approxTokens = Math.ceil(charCount / 4);\n    return {\n        approxTokens,\n        charCount\n    };\n}\nasync function chatJsonSchema(opts) {\n    const body = {\n        model: opts.model,\n        messages: opts.messages,\n        response_format: {\n            type: 'json_schema',\n            json_schema: {\n                name: opts.schema.name,\n                strict: opts.schema.strict,\n                schema: opts.schema.schema\n            }\n        },\n        provider: {\n            sort: normalizeProviderSort(opts.providerSort)\n        },\n        temperature: typeof opts.temperature === 'number' ? opts.temperature : 0.1,\n        max_tokens: typeof opts.maxTokens === 'number' ? opts.maxTokens : 16000\n    };\n    const controller = new AbortController();\n    const timeout = setTimeout(()=>controller.abort(), typeof opts.timeoutMs === 'number' ? opts.timeoutMs : 90000);\n    const shouldDebug = Boolean(opts.debug || process.env.OPENROUTER_DEBUG === 'true' || process.env.REPORT_DEBUG_OPENROUTER === 'true');\n    const headers = buildHeaders();\n    const { approxTokens, charCount } = estimateTokens(opts.messages);\n    const requestSizeBytes = Buffer.byteLength(JSON.stringify(body), 'utf8');\n    const t0 = Date.now();\n    try {\n        if (shouldDebug) {\n            console.info('[openrouter] debug request', {\n                model: opts.model,\n                input_tokens_approx: approxTokens,\n                input_chars: charCount,\n                request_size_bytes: requestSizeBytes,\n                provider_sort: body.provider?.sort,\n                max_tokens: body.max_tokens,\n                temperature: body.temperature\n            });\n        }\n        const res = await fetch(OPENROUTER_URL, {\n            method: 'POST',\n            headers,\n            body: JSON.stringify(body),\n            signal: controller.signal\n        });\n        const latencyMs = Date.now() - t0;\n        if (!res.ok) {\n            const errText = await res.text().catch(()=>'');\n            if (shouldDebug) console.error('[openrouter] debug error', {\n                status: res.status,\n                latency_ms: latencyMs,\n                error: errText?.slice?.(0, 500)\n            });\n            throw new Error(`OpenRouter ${res.status}: ${errText}`);\n        }\n        const json = await res.json();\n        if (shouldDebug) {\n            console.info('[openrouter] debug response', {\n                latency_ms: latencyMs,\n                usage: json?.usage || null,\n                finish_reason: json?.choices?.[0]?.finish_reason || null\n            });\n        }\n        const content = json?.choices?.[0]?.message?.content;\n        return {\n            content,\n            raw: json\n        };\n    } finally{\n        clearTimeout(timeout);\n    }\n}\nasync function chatText(opts) {\n    const body = {\n        model: opts.model,\n        messages: opts.messages,\n        provider: {\n            sort: normalizeProviderSort(opts.providerSort)\n        },\n        temperature: typeof opts.temperature === 'number' ? opts.temperature : 0.3,\n        max_tokens: typeof opts.maxTokens === 'number' ? opts.maxTokens : 4000\n    };\n    const controller = new AbortController();\n    const timeout = setTimeout(()=>controller.abort(), typeof opts.timeoutMs === 'number' ? opts.timeoutMs : 90000);\n    const shouldDebug = Boolean(opts.debug || process.env.OPENROUTER_DEBUG === 'true' || process.env.REPORT_DEBUG_OPENROUTER === 'true');\n    const headers = buildHeaders();\n    const { approxTokens, charCount } = (()=>{\n        const charCount = (opts.messages || []).reduce((s, m)=>s + (m.content?.length || 0), 0);\n        return {\n            approxTokens: Math.ceil(charCount / 4),\n            charCount\n        };\n    })();\n    const requestSizeBytes = (()=>{\n        try {\n            if (typeof Buffer !== 'undefined') return Buffer.byteLength(JSON.stringify(body), 'utf8');\n        } catch  {}\n        try {\n            return new TextEncoder().encode(JSON.stringify(body)).length;\n        } catch  {}\n        try {\n            return (JSON.stringify(body) || '').length;\n        } catch  {\n            return 0;\n        }\n    })();\n    const t0 = Date.now();\n    try {\n        if (shouldDebug) {\n            console.info('[openrouter:text] debug request', {\n                model: opts.model,\n                input_tokens_approx: approxTokens,\n                input_chars: charCount,\n                request_size_bytes: requestSizeBytes,\n                provider_sort: body.provider?.sort,\n                max_tokens: body.max_tokens,\n                temperature: body.temperature\n            });\n        }\n        const res = await fetch(OPENROUTER_URL, {\n            method: 'POST',\n            headers,\n            body: JSON.stringify(body),\n            signal: controller.signal\n        });\n        const latencyMs = Date.now() - t0;\n        if (!res.ok) {\n            const errText = await res.text().catch(()=>'');\n            if (shouldDebug) console.error('[openrouter:text] debug error', {\n                status: res.status,\n                latency_ms: latencyMs,\n                error: errText?.slice?.(0, 500)\n            });\n            throw new Error(`OpenRouter ${res.status}: ${errText}`);\n        }\n        const json = await res.json();\n        if (shouldDebug) {\n            console.info('[openrouter:text] debug response', {\n                latency_ms: latencyMs,\n                usage: json?.usage || null,\n                finish_reason: json?.choices?.[0]?.finish_reason || null\n            });\n        }\n        const content = json?.choices?.[0]?.message?.content;\n        return {\n            content,\n            raw: json\n        };\n    } finally{\n        clearTimeout(timeout);\n    }\n}\nasync function chatWithTools(opts) {\n    const conversation = [\n        ...opts.messages\n    ];\n    const toolCalls = [];\n    const maxIterations = Math.max(1, opts.maxToolIterations ?? 3);\n    const shouldDebug = Boolean(opts.debug || process.env.OPENROUTER_DEBUG === 'true' || process.env.REPORT_DEBUG_OPENROUTER === 'true');\n    for(let iteration = 0; iteration < maxIterations; iteration++){\n        const body = {\n            model: opts.model,\n            messages: conversation,\n            tools: opts.tools,\n            provider: {\n                sort: normalizeProviderSort(opts.providerSort)\n            },\n            tool_choice: opts.toolChoice ?? 'auto',\n            parallel_tool_calls: typeof opts.parallelToolCalls === 'boolean' ? opts.parallelToolCalls : undefined,\n            temperature: typeof opts.temperature === 'number' ? opts.temperature : 0,\n            max_tokens: typeof opts.maxTokens === 'number' ? opts.maxTokens : undefined\n        };\n        const controller = new AbortController();\n        const timeout = setTimeout(()=>controller.abort(), typeof opts.timeoutMs === 'number' ? opts.timeoutMs : 120000);\n        const headers = buildHeaders();\n        const { approxTokens, charCount } = estimateTokens(conversation);\n        const requestSizeBytes = (()=>{\n            try {\n                if (typeof Buffer !== 'undefined') return Buffer.byteLength(JSON.stringify(body), 'utf8');\n            } catch  {}\n            try {\n                return new TextEncoder().encode(JSON.stringify(body)).length;\n            } catch  {}\n            try {\n                return (JSON.stringify(body) || '').length;\n            } catch  {\n                return 0;\n            }\n        })();\n        const t0 = Date.now();\n        try {\n            if (shouldDebug) {\n                console.info('[openrouter:tools] debug request', {\n                    iteration,\n                    model: opts.model,\n                    input_tokens_approx: approxTokens,\n                    input_chars: charCount,\n                    request_size_bytes: requestSizeBytes,\n                    provider_sort: body.provider?.sort,\n                    tool_choice: body.tool_choice,\n                    parallel_tool_calls: body.parallel_tool_calls\n                });\n            }\n            const res = await fetch(OPENROUTER_URL, {\n                method: 'POST',\n                headers,\n                body: JSON.stringify(body),\n                signal: controller.signal\n            });\n            const latencyMs = Date.now() - t0;\n            if (!res.ok) {\n                const errText = await res.text().catch(()=>'');\n                if (shouldDebug) console.error('[openrouter:tools] debug error', {\n                    status: res.status,\n                    latency_ms: latencyMs,\n                    error: errText?.slice?.(0, 500)\n                });\n                throw new Error(`OpenRouter ${res.status}: ${errText}`);\n            }\n            const json = await res.json();\n            const choice = json?.choices?.[0];\n            if (!choice?.message) throw new Error('OpenRouter response missing message for tool call flow');\n            if (shouldDebug) {\n                console.info('[openrouter:tools] debug response', {\n                    iteration,\n                    latency_ms: latencyMs,\n                    finish_reason: choice?.finish_reason || null,\n                    tool_calls: choice?.message?.tool_calls?.map((t)=>t?.function?.name) || []\n                });\n            }\n            const assistantMessage = choice.message;\n            conversation.push(assistantMessage);\n            const calls = assistantMessage.tool_calls || [];\n            if (calls.length > 0) {\n                for (const call of calls){\n                    const handler = opts.handlers?.[call.function?.name];\n                    if (!handler) throw new Error(`Unhandled tool call: ${call.function?.name}`);\n                    let parsedArgs = {};\n                    try {\n                        parsedArgs = call.function?.arguments ? JSON.parse(call.function.arguments) : {};\n                    } catch (error) {\n                        throw new Error(`Failed to parse tool arguments for ${call.function?.name}: ${error.message}`);\n                    }\n                    const handlerResult = await handler(parsedArgs, {\n                        toolCall: call\n                    });\n                    const content = typeof handlerResult.content === 'string' ? handlerResult.content : JSON.stringify(handlerResult.content ?? {});\n                    conversation.push({\n                        role: 'tool',\n                        tool_call_id: call.id,\n                        content\n                    });\n                    toolCalls.push({\n                        tool: call.function.name,\n                        arguments: parsedArgs,\n                        response: handlerResult,\n                        toolCallId: call.id\n                    });\n                }\n                if (opts.returnOnToolCall) {\n                    return {\n                        finalMessage: assistantMessage,\n                        raw: json,\n                        toolCalls,\n                        transcript: conversation\n                    };\n                }\n                continue;\n            }\n            return {\n                finalMessage: assistantMessage,\n                raw: json,\n                toolCalls,\n                transcript: conversation\n            };\n        } finally{\n            clearTimeout(timeout);\n        }\n    }\n    throw new Error('Tool calling loop exceeded maximum iterations without completion');\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3NlcnZpY2VzL29wZW5yb3V0ZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQW9DQSxNQUFNQSxpQkFBaUI7QUFFdkIsNERBQTREO0FBQzVELHFFQUFxRTtBQUM5RCxTQUFTQyxzQkFBc0JDLElBQXdCO0lBQzdELE1BQU1DLGFBQWEsQ0FBQ0MsUUFBUUMsR0FBRyxDQUFDQyx3QkFBd0IsSUFBSSxFQUFDLEVBQUdDLFdBQVc7SUFDM0UsTUFBTUMsWUFBWSxDQUFDTixRQUFRQyxjQUFjLE9BQU0sRUFBR0ksV0FBVztJQUM3RCxJQUFJQyxjQUFjLFNBQVMsT0FBTztJQUNsQyxJQUFJQSxjQUFjLGNBQWMsT0FBTztJQUN2QyxJQUFJQSxjQUFjLFdBQVcsT0FBTztJQUNwQyxpQkFBaUI7SUFDakIsSUFBSUEsY0FBYyxTQUFTLE9BQU87SUFDbEMsSUFBSUEsY0FBYyxXQUFXLE9BQU87SUFDcEMsT0FBTztBQUNSO0FBRUEsU0FBU0M7SUFDUixNQUFNQyxVQUFrQztRQUN2QyxnQkFBZ0I7UUFDaEIsaUJBQWlCLENBQUMsT0FBTyxFQUFFTixRQUFRQyxHQUFHLENBQUNNLGtCQUFrQixFQUFFO0lBQzVEO0lBQ0EsSUFBSVAsUUFBUUMsR0FBRyxDQUFDTyx1QkFBdUIsRUFBRUYsT0FBTyxDQUFDLGVBQWUsR0FBR04sUUFBUUMsR0FBRyxDQUFDTyx1QkFBdUI7SUFDdEcsSUFBSVIsUUFBUUMsR0FBRyxDQUFDUSxrQkFBa0IsRUFBRUgsT0FBTyxDQUFDLFVBQVUsR0FBR04sUUFBUUMsR0FBRyxDQUFDUSxrQkFBa0I7SUFDdkYsT0FBT0g7QUFDUjtBQUVBLFNBQVNJLGtCQUFrQkMsT0FBb0I7SUFDOUMsTUFBTUMsVUFBVUQsUUFBUUMsT0FBTztJQUMvQixJQUFJLE9BQU9BLFlBQVksVUFBVSxPQUFPQSxRQUFRQyxNQUFNO0lBQ3RELE9BQU87QUFDUjtBQUVBLFNBQVNDLGVBQWVDLFFBQXVCO0lBQzlDLE1BQU1DLFlBQVlELFNBQVNFLE1BQU0sQ0FB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LE9BQU87Z0JBQUVtQyxjQUFjbEI7Z0JBQWtCeEIsS0FBS0o7Z0JBQU1ZO2dCQUFXbUMsWUFBWXBDO1lBQWE7UUFDekYsU0FBVTtZQUNUTixhQUFhMUM7UUFDZDtJQUNEO0lBQ0EsTUFBTSxJQUFJb0MsTUFBTTtBQUNqQiIsInNvdXJjZXMiOlsiRDpcXERlbHRhIElWXFxTb2Z3YXJlc1xcZ2xhc3NcXHNhbmRib3hcXHNoYWRjbi1jcm0tZGFzaGJvYXJkXFxzcmNcXHNlcnZlclxcc2VydmljZXNcXG9wZW5yb3V0ZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IHR5cGUgQ2hhdFJvbGUgPSAnc3lzdGVtJyB8ICd1c2VyJyB8ICdhc3Npc3RhbnQnIHwgJ3Rvb2wnXG5cbmV4cG9ydCBpbnRlcmZhY2UgVG9vbENhbGwge1xuXHRpZDogc3RyaW5nXG5cdHR5cGU6ICdmdW5jdGlvbidcblx0ZnVuY3Rpb246IHtcblx0XHRuYW1lOiBzdHJpbmdcblx0XHRhcmd1bWVudHM6IHN0cmluZ1xuXHR9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2hhdE1lc3NhZ2Uge1xuXHRyb2xlOiBDaGF0Um9sZVxuXHRjb250ZW50Pzogc3RyaW5nXG5cdG5hbWU/OiBzdHJpbmdcblx0dG9vbF9jYWxsX2lkPzogc3RyaW5nXG5cdHRvb2xfY2FsbHM/OiBUb29sQ2FsbFtdXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSnNvblNjaGVtYVNwZWMge1xuXHRuYW1lOiBzdHJpbmdcblx0c3RyaWN0OiBib29sZWFuXG5cdHNjaGVtYTogYW55XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2hhdEpzb25TY2hlbWFPcHRpb25zIHtcblx0bW9kZWw6IHN0cmluZ1xuXHRtZXNzYWdlczogQ2hhdE1lc3NhZ2VbXVxuXHRzY2hlbWE6IEpzb25TY2hlbWFTcGVjXG5cdHRlbXBlcmF0dXJlPzogbnVtYmVyXG5cdG1heFRva2Vucz86IG51bWJlclxuXHRwcm92aWRlclNvcnQ/OiAncHJpY2UnIHwgJ3Rocm91Z2hwdXQnIHwgJ2xhdGVuY3knXG5cdHRpbWVvdXRNcz86IG51bWJlclxuXHRkZWJ1Zz86IGJvb2xlYW5cbn1cblxuY29uc3QgT1BFTlJPVVRFUl9VUkwgPSAnaHR0cHM6Ly9vcGVucm91dGVyLmFpL2FwaS92MS9jaGF0L2NvbXBsZXRpb25zJ1xuXG4vLyBOb3JtYWxpemUgcHJvdmlkZXIgc29ydCB0byBjdXJyZW50IE9wZW5Sb3V0ZXIgQVBJIHZhbHVlcy5cbi8vIEJhY2t3YXJkcyBjb21wYXRpYmxlIG1hcHBpbmcgZm9yIGxlZ2FjeSB2YWx1ZXMgdXNlZCBpbiBvbGRlciBjb2RlLlxuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZVByb3ZpZGVyU29ydChzb3J0OiBzdHJpbmcgfCB1bmRlZmluZWQpOiAncHJpY2UnIHwgJ3Rocm91Z2hwdXQnIHwgJ2xhdGVuY3knIHtcblx0Y29uc3QgZW52RGVmYXVsdCA9IChwcm9jZXNzLmVudi5PUEVOUk9VVEVSX1BST1ZJREVSX1NPUlQgfHwgJycpLnRvTG93ZXJDYXNlKClcblx0Y29uc3QgY2FuZGlkYXRlID0gKHNvcnQgfHwgZW52RGVmYXVsdCB8fCAncHJpY2UnKS50b0xvd2VyQ2FzZSgpXG5cdGlmIChjYW5kaWRhdGUgPT09ICdwcmljZScpIHJldHVybiAncHJpY2UnXG5cdGlmIChjYW5kaWRhdGUgPT09ICd0aHJvdWdocHV0JykgcmV0dXJuICd0aHJvdWdocHV0J1xuXHRpZiAoY2FuZGlkYXRlID09PSAnbGF0ZW5jeScpIHJldHVybiAnbGF0ZW5jeSdcblx0Ly8gbGVnYWN5IGFsaWFzZXNcblx0aWYgKGNhbmRpZGF0ZSA9PT0gJ3NwZWVkJykgcmV0dXJuICdsYXRlbmN5J1xuXHRpZiAoY2FuZGlkYXRlID09PSAncXVhbGl0eScpIHJldHVybiAnbGF0ZW5jeSdcblx0cmV0dXJuICdwcmljZSdcbn1cblxuZnVuY3Rpb24gYnVpbGRIZWFkZXJzKCk6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4ge1xuXHRjb25zdCBoZWFkZXJzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xuXHRcdCdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG5cdFx0J0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7cHJvY2Vzcy5lbnYuT1BFTlJPVVRFUl9BUElfS0VZfWAsXG5cdH1cblx0aWYgKHByb2Nlc3MuZW52Lk9QRU5ST1VURVJfSFRUUF9SRUZFUkVSKSBoZWFkZXJzWydIVFRQLVJlZmVyZXInXSA9IHByb2Nlc3MuZW52Lk9QRU5ST1VURVJfSFRUUF9SRUZFUkVSXG5cdGlmIChwcm9jZXNzLmVudi5PUEVOUk9VVEVSX1hfVElUTEUpIGhlYWRlcnNbJ1gtVGl0bGUnXSA9IHByb2Nlc3MuZW52Lk9QRU5ST1VURVJfWF9USVRMRVxuXHRyZXR1cm4gaGVhZGVyc1xufVxuXG5mdW5jdGlvbiBtZXNzYWdlQ2hhckxlbmd0aChtZXNzYWdlOiBDaGF0TWVzc2FnZSk6IG51bWJlciB7XG5cdGNvbnN0IGNvbnRlbnQgPSBtZXNzYWdlLmNvbnRlbnRcblx0aWYgKHR5cGVvZiBjb250ZW50ID09PSAnc3RyaW5nJykgcmV0dXJuIGNvbnRlbnQubGVuZ3RoXG5cdHJldHVybiAwXG59XG5cbmZ1bmN0aW9uIGVzdGltYXRlVG9rZW5zKG1lc3NhZ2VzOiBDaGF0TWVzc2FnZVtdKTogeyBhcHByb3hUb2tlbnM6IG51bWJlcjsgY2hhckNvdW50OiBudW1iZXIgfSB7XG5cdGNvbnN0IGNoYXJDb3VudCA9IG1lc3NhZ2VzLnJlZHVjZSgoc3VtLCBtKSA9PiBzdW0gKyBtZXNzYWdlQ2hhckxlbmd0aChtKSwgMClcblx0Ly8gVmVyeSByb3VnaCBoZXVyaXN0aWM6IH40IGNoYXJzIHBlciB0b2tlbiBmb3IgRW5nbGlzaCB0ZXh0XG5cdGNvbnN0IGFwcHJveFRva2VucyA9IE1hdGguY2VpbChjaGFyQ291bnQgLyA0KVxuXHRyZXR1cm4geyBhcHByb3hUb2tlbnMsIGNoYXJDb3VudCB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGF0SnNvblNjaGVtYShvcHRzOiBDaGF0SnNvblNjaGVtYU9wdGlvbnMpOiBQcm9taXNlPHsgY29udGVudDogc3RyaW5nOyByYXc6IGFueSB9PiB7XG5cdGNvbnN0IGJvZHk6IGFueSA9IHtcblx0XHRtb2RlbDogb3B0cy5tb2RlbCxcblx0XHRtZXNzYWdlczogb3B0cy5tZXNzYWdlcyxcblx0XHRyZXNwb25zZV9mb3JtYXQ6IHtcblx0XHRcdHR5cGU6ICdqc29uX3NjaGVtYScsXG5cdFx0XHRqc29uX3NjaGVtYToge1xuXHRcdFx0XHRuYW1lOiBvcHRzLnNjaGVtYS5uYW1lLFxuXHRcdFx0XHRzdHJpY3Q6IG9wdHMuc2NoZW1hLnN0cmljdCxcblx0XHRcdFx0c2NoZW1hOiBvcHRzLnNjaGVtYS5zY2hlbWEsXG5cdFx0XHR9LFxuXHRcdH0sXG5cdFx0cHJvdmlkZXI6IHsgc29ydDogbm9ybWFsaXplUHJvdmlkZXJTb3J0KG9wdHMucHJvdmlkZXJTb3J0KSB9LFxuXHRcdHRlbXBlcmF0dXJlOiB0eXBlb2Ygb3B0cy50ZW1wZXJhdHVyZSA9PT0gJ251bWJlcicgPyBvcHRzLnRlbXBlcmF0dXJlIDogMC4xLFxuXHRcdG1heF90b2tlbnM6IHR5cGVvZiBvcHRzLm1heFRva2VucyA9PT0gJ251bWJlcicgPyBvcHRzLm1heFRva2VucyA6IDE2MDAwLFxuXHR9XG5cblx0Y29uc3QgY29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKVxuXHRjb25zdCB0aW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiBjb250cm9sbGVyLmFib3J0KCksIHR5cGVvZiBvcHRzLnRpbWVvdXRNcyA9PT0gJ251bWJlcicgPyBvcHRzLnRpbWVvdXRNcyA6IDkwXzAwMClcblx0Y29uc3Qgc2hvdWxkRGVidWcgPSBCb29sZWFuKG9wdHMuZGVidWcgfHwgcHJvY2Vzcy5lbnYuT1BFTlJPVVRFUl9ERUJVRyA9PT0gJ3RydWUnIHx8IHByb2Nlc3MuZW52LlJFUE9SVF9ERUJVR19PUEVOUk9VVEVSID09PSAndHJ1ZScpXG5cblx0Y29uc3QgaGVhZGVycyA9IGJ1aWxkSGVhZGVycygpXG5cdGNvbnN0IHsgYXBwcm94VG9rZW5zLCBjaGFyQ291bnQgfSA9IGVzdGltYXRlVG9rZW5zKG9wdHMubWVzc2FnZXMpXG5cdGNvbnN0IHJlcXVlc3RTaXplQnl0ZXMgPSBCdWZmZXIuYnl0ZUxlbmd0aChKU09OLnN0cmluZ2lmeShib2R5KSwgJ3V0ZjgnKVxuXHRjb25zdCB0MCA9IERhdGUubm93KClcblx0dHJ5IHtcblx0XHRpZiAoc2hvdWxkRGVidWcpIHtcblx0XHRcdGNvbnNvbGUuaW5mbygnW29wZW5yb3V0ZXJdIGRlYnVnIHJlcXVlc3QnLCB7XG5cdFx0XHRcdG1vZGVsOiBvcHRzLm1vZGVsLFxuXHRcdFx0XHRpbnB1dF90b2tlbnNfYXBwcm94OiBhcHByb3hUb2tlbnMsXG5cdFx0XHRcdGlucHV0X2NoYXJzOiBjaGFyQ291bnQsXG5cdFx0XHRcdHJlcXVlc3Rfc2l6ZV9ieXRlczogcmVxdWVzdFNpemVCeXRlcyxcblx0XHRcdFx0cHJvdmlkZXJfc29ydDogYm9keS5wcm92aWRlcj8uc29ydCxcblx0XHRcdFx0bWF4X3Rva2VuczogYm9keS5tYXhfdG9rZW5zLFxuXHRcdFx0XHR0ZW1wZXJhdHVyZTogYm9keS50ZW1wZXJhdHVyZSxcblx0XHRcdH0pXG5cdFx0fVxuXHRcdGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKE9QRU5ST1VURVJfVVJMLCB7XG5cdFx0XHRtZXRob2Q6ICdQT1NUJyxcblx0XHRcdGhlYWRlcnMsXG5cdFx0XHRib2R5OiBKU09OLnN0cmluZ2lmeShib2R5KSxcblx0XHRcdHNpZ25hbDogY29udHJvbGxlci5zaWduYWwsXG5cdFx0fSlcblx0XHRjb25zdCBsYXRlbmN5TXMgPSBEYXRlLm5vdygpIC0gdDBcblx0XHRpZiAoIXJlcy5vaykge1xuXHRcdFx0Y29uc3QgZXJyVGV4dCA9IGF3YWl0IHJlcy50ZXh0KCkuY2F0Y2goKCkgPT4gJycpXG5cdFx0XHRpZiAoc2hvdWxkRGVidWcpIGNvbnNvbGUuZXJyb3IoJ1tvcGVucm91dGVyXSBkZWJ1ZyBlcnJvcicsIHsgc3RhdHVzOiByZXMuc3RhdHVzLCBsYXRlbmN5X21zOiBsYXRlbmN5TXMsIGVycm9yOiBlcnJUZXh0Py5zbGljZT8uKDAsIDUwMCkgfSlcblx0XHRcdHRocm93IG5ldyBFcnJvcihgT3BlblJvdXRlciAke3Jlcy5zdGF0dXN9OiAke2VyclRleHR9YClcblx0XHR9XG5cdFx0Y29uc3QganNvbiA9IGF3YWl0IHJlcy5qc29uKClcblx0XHRpZiAoc2hvdWxkRGVidWcpIHtcblx0XHRcdGNvbnNvbGUuaW5mbygnW29wZW5yb3V0ZXJdIGRlYnVnIHJlc3BvbnNlJywge1xuXHRcdFx0XHRsYXRlbmN5X21zOiBsYXRlbmN5TXMsXG5cdFx0XHRcdHVzYWdlOiBqc29uPy51c2FnZSB8fCBudWxsLFxuXHRcdFx0XHRmaW5pc2hfcmVhc29uOiBqc29uPy5jaG9pY2VzPy5bMF0/LmZpbmlzaF9yZWFzb24gfHwgbnVsbCxcblx0XHRcdH0pXG5cdFx0fVxuXHRcdGNvbnN0IGNvbnRlbnQgPSBqc29uPy5jaG9pY2VzPy5bMF0/Lm1lc3NhZ2U/LmNvbnRlbnRcblx0XHRyZXR1cm4geyBjb250ZW50LCByYXc6IGpzb24gfVxuXHR9IGZpbmFsbHkge1xuXHRcdGNsZWFyVGltZW91dCh0aW1lb3V0KVxuXHR9XG59XG5cbi8vIFRleHQgKG1hcmtkb3duKSBjaGF0IHdpdGhvdXQgSlNPTiBzY2hlbWEgZW5mb3JjZW1lbnRcbmV4cG9ydCBpbnRlcmZhY2UgQ2hhdFRleHRPcHRpb25zIHtcbiAgbW9kZWw6IHN0cmluZ1xuICBtZXNzYWdlczogQ2hhdE1lc3NhZ2VbXVxuICB0ZW1wZXJhdHVyZT86IG51bWJlclxuICBtYXhUb2tlbnM/OiBudW1iZXJcbiAgcHJvdmlkZXJTb3J0PzogJ3ByaWNlJyB8ICd0aHJvdWdocHV0JyB8ICdsYXRlbmN5J1xuICB0aW1lb3V0TXM/OiBudW1iZXJcbiAgZGVidWc/OiBib29sZWFuXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGF0VGV4dChvcHRzOiBDaGF0VGV4dE9wdGlvbnMpOiBQcm9taXNlPHsgY29udGVudDogc3RyaW5nOyByYXc6IGFueSB9PiB7XG4gIGNvbnN0IGJvZHk6IGFueSA9IHtcbiAgICBtb2RlbDogb3B0cy5tb2RlbCxcbiAgICBtZXNzYWdlczogb3B0cy5tZXNzYWdlcyxcbiAgICBwcm92aWRlcjogeyBzb3J0OiBub3JtYWxpemVQcm92aWRlclNvcnQob3B0cy5wcm92aWRlclNvcnQpIH0sXG4gICAgdGVtcGVyYXR1cmU6IHR5cGVvZiBvcHRzLnRlbXBlcmF0dXJlID09PSAnbnVtYmVyJyA/IG9wdHMudGVtcGVyYXR1cmUgOiAwLjMsXG4gICAgbWF4X3Rva2VuczogdHlwZW9mIG9wdHMubWF4VG9rZW5zID09PSAnbnVtYmVyJyA/IG9wdHMubWF4VG9rZW5zIDogNDAwMCxcbiAgfVxuXG4gIGNvbnN0IGNvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKClcbiAgY29uc3QgdGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4gY29udHJvbGxlci5hYm9ydCgpLCB0eXBlb2Ygb3B0cy50aW1lb3V0TXMgPT09ICdudW1iZXInID8gb3B0cy50aW1lb3V0TXMgOiA5MF8wMDApXG4gIGNvbnN0IHNob3VsZERlYnVnID0gQm9vbGVhbihvcHRzLmRlYnVnIHx8IHByb2Nlc3MuZW52Lk9QRU5ST1VURVJfREVCVUcgPT09ICd0cnVlJyB8fCBwcm9jZXNzLmVudi5SRVBPUlRfREVCVUdfT1BFTlJPVVRFUiA9PT0gJ3RydWUnKVxuXG4gIGNvbnN0IGhlYWRlcnMgPSBidWlsZEhlYWRlcnMoKVxuICBjb25zdCB7IGFwcHJveFRva2VucywgY2hhckNvdW50IH0gPSAoKCk6IHsgYXBwcm94VG9rZW5zOiBudW1iZXI7IGNoYXJDb3VudDogbnVtYmVyIH0gPT4ge1xuICAgIGNvbnN0IGNoYXJDb3VudCA9IChvcHRzLm1lc3NhZ2VzIHx8IFtdKS5yZWR1Y2UoKHMsIG0pID0+IHMgKyAobS5jb250ZW50Py5sZW5ndGggfHwgMCksIDApXG4gICAgcmV0dXJuIHsgYXBwcm94VG9rZW5zOiBNYXRoLmNlaWwoY2hhckNvdW50IC8gNCksIGNoYXJDb3VudCB9XG4gIH0pKClcbiAgY29uc3QgcmVxdWVzdFNpemVCeXRlcyA9ICgoKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGlmICh0eXBlb2YgQnVmZmVyICE9PSAndW5kZWZpbmVkJykgcmV0dXJuIEJ1ZmZlci5ieXRlTGVuZ3RoKEpTT04uc3RyaW5naWZ5KGJvZHkpLCAndXRmOCcpXG4gICAgfSBjYXRjaCB7fVxuICAgIHRyeSB7IHJldHVybiBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoSlNPTi5zdHJpbmdpZnkoYm9keSkpLmxlbmd0aCB9IGNhdGNoIHt9XG4gICAgdHJ5IHsgcmV0dXJuIChKU09OLnN0cmluZ2lmeShib2R5KSB8fCAnJykubGVuZ3RoIH0gY2F0Y2ggeyByZXR1cm4gMCB9XG4gIH0pKClcbiAgY29uc3QgdDAgPSBEYXRlLm5vdygpXG4gIHRyeSB7XG4gICAgaWYgKHNob3VsZERlYnVnKSB7XG4gICAgICBjb25zb2xlLmluZm8oJ1tvcGVucm91dGVyOnRleHRdIGRlYnVnIHJlcXVlc3QnLCB7XG4gICAgICAgIG1vZGVsOiBvcHRzLm1vZGVsLFxuICAgICAgICBpbnB1dF90b2tlbnNfYXBwcm94OiBhcHByb3hUb2tlbnMsXG4gICAgICAgIGlucHV0X2NoYXJzOiBjaGFyQ291bnQsXG4gICAgICAgIHJlcXVlc3Rfc2l6ZV9ieXRlczogcmVxdWVzdFNpemVCeXRlcyxcbiAgICAgICAgcHJvdmlkZXJfc29ydDogYm9keS5wcm92aWRlcj8uc29ydCxcbiAgICAgICAgbWF4X3Rva2VuczogYm9keS5tYXhfdG9rZW5zLFxuICAgICAgICB0ZW1wZXJhdHVyZTogYm9keS50ZW1wZXJhdHVyZSxcbiAgICAgIH0pXG4gICAgfVxuICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKE9QRU5ST1VURVJfVVJMLCB7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGhlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShib2R5KSxcbiAgICAgIHNpZ25hbDogY29udHJvbGxlci5zaWduYWwsXG4gICAgfSlcbiAgICBjb25zdCBsYXRlbmN5TXMgPSBEYXRlLm5vdygpIC0gdDBcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgY29uc3QgZXJyVGV4dCA9IGF3YWl0IHJlcy50ZXh0KCkuY2F0Y2goKCkgPT4gJycpXG4gICAgICBpZiAoc2hvdWxkRGVidWcpIGNvbnNvbGUuZXJyb3IoJ1tvcGVucm91dGVyOnRleHRdIGRlYnVnIGVycm9yJywgeyBzdGF0dXM6IHJlcy5zdGF0dXMsIGxhdGVuY3lfbXM6IGxhdGVuY3lNcywgZXJyb3I6IGVyclRleHQ/LnNsaWNlPy4oMCwgNTAwKSB9KVxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBPcGVuUm91dGVyICR7cmVzLnN0YXR1c306ICR7ZXJyVGV4dH1gKVxuICAgIH1cbiAgICBjb25zdCBqc29uID0gYXdhaXQgcmVzLmpzb24oKVxuICAgIGlmIChzaG91bGREZWJ1Zykge1xuICAgICAgY29uc29sZS5pbmZvKCdbb3BlbnJvdXRlcjp0ZXh0XSBkZWJ1ZyByZXNwb25zZScsIHtcbiAgICAgICAgbGF0ZW5jeV9tczogbGF0ZW5jeU1zLFxuICAgICAgICB1c2FnZToganNvbj8udXNhZ2UgfHwgbnVsbCxcbiAgICAgICAgZmluaXNoX3JlYXNvbjoganNvbj8uY2hvaWNlcz8uWzBdPy5maW5pc2hfcmVhc29uIHx8IG51bGwsXG4gICAgICB9KVxuICAgIH1cbiAgICBjb25zdCBjb250ZW50ID0ganNvbj8uY2hvaWNlcz8uWzBdPy5tZXNzYWdlPy5jb250ZW50XG4gICAgcmV0dXJuIHsgY29udGVudCwgcmF3OiBqc29uIH1cbiAgfSBmaW5hbGx5IHtcbiAgICBjbGVhclRpbWVvdXQodGltZW91dClcbiAgfVxufVxuXG5leHBvcnQgdHlwZSBUb29sRGVmaW5pdGlvbiA9IHtcblx0dHlwZTogJ2Z1bmN0aW9uJ1xuXHRmdW5jdGlvbjoge1xuXHRcdG5hbWU6IHN0cmluZ1xuXHRcdGRlc2NyaXB0aW9uPzogc3RyaW5nXG5cdFx0cGFyYW1ldGVycz86IFJlY29yZDxzdHJpbmcsIGFueT5cblx0fVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENoYXRUb29sSGFuZGxlclJlc3VsdCB7XG5cdGNvbnRlbnQ6IHN0cmluZ1xuXHRtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT5cbn1cblxuZXhwb3J0IHR5cGUgQ2hhdFRvb2xIYW5kbGVyID0gKGFyZ3M6IGFueSwgY29udGV4dDogeyB0b29sQ2FsbDogVG9vbENhbGwgfSkgPT4gUHJvbWlzZTxDaGF0VG9vbEhhbmRsZXJSZXN1bHQ+IHwgQ2hhdFRvb2xIYW5kbGVyUmVzdWx0XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2hhdFdpdGhUb29sc09wdGlvbnMge1xuXHRtb2RlbDogc3RyaW5nXG5cdG1lc3NhZ2VzOiBDaGF0TWVzc2FnZVtdXG5cdHRvb2xzOiBUb29sRGVmaW5pdGlvbltdXG5cdGhhbmRsZXJzOiBSZWNvcmQ8c3RyaW5nLCBDaGF0VG9vbEhhbmRsZXI+XG5cdHRvb2xDaG9pY2U/OiAnYXV0bycgfCAnbm9uZScgfCB7IHR5cGU6ICdmdW5jdGlvbic7IGZ1bmN0aW9uOiB7IG5hbWU6IHN0cmluZyB9IH1cblx0cGFyYWxsZWxUb29sQ2FsbHM/OiBib29sZWFuXG5cdG1heFRvb2xJdGVyYXRpb25zPzogbnVtYmVyXG5cdHByb3ZpZGVyU29ydD86ICdwcmljZScgfCAndGhyb3VnaHB1dCcgfCAnbGF0ZW5jeSdcblx0dGVtcGVyYXR1cmU/OiBudW1iZXJcblx0bWF4VG9rZW5zPzogbnVtYmVyXG5cdHRpbWVvdXRNcz86IG51bWJlclxuXHRkZWJ1Zz86IGJvb2xlYW5cblx0cmV0dXJuT25Ub29sQ2FsbD86IGJvb2xlYW5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBDaGF0VG9vbENhbGxMb2cge1xuXHR0b29sOiBzdHJpbmdcblx0YXJndW1lbnRzOiBhbnlcblx0cmVzcG9uc2U6IENoYXRUb29sSGFuZGxlclJlc3VsdFxuXHR0b29sQ2FsbElkOiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBDaGF0V2l0aFRvb2xzUmVzdWx0IHtcblx0ZmluYWxNZXNzYWdlPzogQ2hhdE1lc3NhZ2Vcblx0cmF3OiBhbnlcblx0dG9vbENhbGxzOiBDaGF0VG9vbENhbGxMb2dbXVxuXHR0cmFuc2NyaXB0OiBDaGF0TWVzc2FnZVtdXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGF0V2l0aFRvb2xzKG9wdHM6IENoYXRXaXRoVG9vbHNPcHRpb25zKTogUHJvbWlzZTxDaGF0V2l0aFRvb2xzUmVzdWx0PiB7XG5cdGNvbnN0IGNvbnZlcnNhdGlvbjogQ2hhdE1lc3NhZ2VbXSA9IFsuLi5vcHRzLm1lc3NhZ2VzXVxuXHRjb25zdCB0b29sQ2FsbHM6IENoYXRUb29sQ2FsbExvZ1tdID0gW11cblx0Y29uc3QgbWF4SXRlcmF0aW9ucyA9IE1hdGgubWF4KDEsIG9wdHMubWF4VG9vbEl0ZXJhdGlvbnMgPz8gMylcblx0Y29uc3Qgc2hvdWxkRGVidWcgPSBCb29sZWFuKG9wdHMuZGVidWcgfHwgcHJvY2Vzcy5lbnYuT1BFTlJPVVRFUl9ERUJVRyA9PT0gJ3RydWUnIHx8IHByb2Nlc3MuZW52LlJFUE9SVF9ERUJVR19PUEVOUk9VVEVSID09PSAndHJ1ZScpXG5cblx0Zm9yIChsZXQgaXRlcmF0aW9uID0gMDsgaXRlcmF0aW9uIDwgbWF4SXRlcmF0aW9uczsgaXRlcmF0aW9uKyspIHtcblx0XHRjb25zdCBib2R5OiBhbnkgPSB7XG5cdFx0XHRtb2RlbDogb3B0cy5tb2RlbCxcblx0XHRcdG1lc3NhZ2VzOiBjb252ZXJzYXRpb24sXG5cdFx0XHR0b29sczogb3B0cy50b29scyxcblx0XHRcdHByb3ZpZGVyOiB7IHNvcnQ6IG5vcm1hbGl6ZVByb3ZpZGVyU29ydChvcHRzLnByb3ZpZGVyU29ydCkgfSxcblx0XHRcdHRvb2xfY2hvaWNlOiBvcHRzLnRvb2xDaG9pY2UgPz8gJ2F1dG8nLFxuXHRcdFx0cGFyYWxsZWxfdG9vbF9jYWxsczogdHlwZW9mIG9wdHMucGFyYWxsZWxUb29sQ2FsbHMgPT09ICdib29sZWFuJyA/IG9wdHMucGFyYWxsZWxUb29sQ2FsbHMgOiB1bmRlZmluZWQsXG5cdFx0XHR0ZW1wZXJhdHVyZTogdHlwZW9mIG9wdHMudGVtcGVyYXR1cmUgPT09ICdudW1iZXInID8gb3B0cy50ZW1wZXJhdHVyZSA6IDAsXG5cdFx0XHRtYXhfdG9rZW5zOiB0eXBlb2Ygb3B0cy5tYXhUb2tlbnMgPT09ICdudW1iZXInID8gb3B0cy5tYXhUb2tlbnMgOiB1bmRlZmluZWQsXG5cdFx0fVxuXG5cdFx0Y29uc3QgY29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKVxuXHRcdGNvbnN0IHRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IGNvbnRyb2xsZXIuYWJvcnQoKSwgdHlwZW9mIG9wdHMudGltZW91dE1zID09PSAnbnVtYmVyJyA/IG9wdHMudGltZW91dE1zIDogMTIwXzAwMClcblx0XHRjb25zdCBoZWFkZXJzID0gYnVpbGRIZWFkZXJzKClcblx0XHRjb25zdCB7IGFwcHJveFRva2VucywgY2hhckNvdW50IH0gPSBlc3RpbWF0ZVRva2Vucyhjb252ZXJzYXRpb24pXG4gIGNvbnN0IHJlcXVlc3RTaXplQnl0ZXMgPSAoKCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBpZiAodHlwZW9mIEJ1ZmZlciAhPT0gJ3VuZGVmaW5lZCcpIHJldHVybiBCdWZmZXIuYnl0ZUxlbmd0aChKU09OLnN0cmluZ2lmeShib2R5KSwgJ3V0ZjgnKVxuICAgIH0gY2F0Y2gge31cbiAgICB0cnkgeyByZXR1cm4gbmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKEpTT04uc3RyaW5naWZ5KGJvZHkpKS5sZW5ndGggfSBjYXRjaCB7fVxuICAgIHRyeSB7IHJldHVybiAoSlNPTi5zdHJpbmdpZnkoYm9keSkgfHwgJycpLmxlbmd0aCB9IGNhdGNoIHsgcmV0dXJuIDAgfVxuICB9KSgpXG5cdFx0Y29uc3QgdDAgPSBEYXRlLm5vdygpXG5cdFx0dHJ5IHtcblx0XHRcdGlmIChzaG91bGREZWJ1Zykge1xuXHRcdFx0XHRjb25zb2xlLmluZm8oJ1tvcGVucm91dGVyOnRvb2xzXSBkZWJ1ZyByZXF1ZXN0Jywge1xuXHRcdFx0XHRcdGl0ZXJhdGlvbixcblx0XHRcdFx0XHRtb2RlbDogb3B0cy5tb2RlbCxcblx0XHRcdFx0XHRpbnB1dF90b2tlbnNfYXBwcm94OiBhcHByb3hUb2tlbnMsXG5cdFx0XHRcdFx0aW5wdXRfY2hhcnM6IGNoYXJDb3VudCxcblx0XHRcdFx0XHRyZXF1ZXN0X3NpemVfYnl0ZXM6IHJlcXVlc3RTaXplQnl0ZXMsXG5cdFx0XHRcdFx0cHJvdmlkZXJfc29ydDogYm9keS5wcm92aWRlcj8uc29ydCxcblx0XHRcdFx0XHR0b29sX2Nob2ljZTogYm9keS50b29sX2Nob2ljZSxcblx0XHRcdFx0XHRwYXJhbGxlbF90b29sX2NhbGxzOiBib2R5LnBhcmFsbGVsX3Rvb2xfY2FsbHMsXG5cdFx0XHRcdH0pXG5cdFx0XHR9XG5cdFx0XHRjb25zdCByZXMgPSBhd2FpdCBmZXRjaChPUEVOUk9VVEVSX1VSTCwge1xuXHRcdFx0XHRtZXRob2Q6ICdQT1NUJyxcblx0XHRcdFx0aGVhZGVycyxcblx0XHRcdFx0Ym9keTogSlNPTi5zdHJpbmdpZnkoYm9keSksXG5cdFx0XHRcdHNpZ25hbDogY29udHJvbGxlci5zaWduYWwsXG5cdFx0XHR9KVxuXHRcdFx0Y29uc3QgbGF0ZW5jeU1zID0gRGF0ZS5ub3coKSAtIHQwXG5cdFx0XHRpZiAoIXJlcy5vaykge1xuXHRcdFx0XHRjb25zdCBlcnJUZXh0ID0gYXdhaXQgcmVzLnRleHQoKS5jYXRjaCgoKSA9PiAnJylcblx0XHRcdFx0aWYgKHNob3VsZERlYnVnKSBjb25zb2xlLmVycm9yKCdbb3BlbnJvdXRlcjp0b29sc10gZGVidWcgZXJyb3InLCB7IHN0YXR1czogcmVzLnN0YXR1cywgbGF0ZW5jeV9tczogbGF0ZW5jeU1zLCBlcnJvcjogZXJyVGV4dD8uc2xpY2U/LigwLCA1MDApIH0pXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihgT3BlblJvdXRlciAke3Jlcy5zdGF0dXN9OiAke2VyclRleHR9YClcblx0XHRcdH1cblx0XHRcdGNvbnN0IGpzb24gPSBhd2FpdCByZXMuanNvbigpXG5cdFx0XHRjb25zdCBjaG9pY2UgPSBqc29uPy5jaG9pY2VzPy5bMF1cblx0XHRcdGlmICghY2hvaWNlPy5tZXNzYWdlKSB0aHJvdyBuZXcgRXJyb3IoJ09wZW5Sb3V0ZXIgcmVzcG9uc2UgbWlzc2luZyBtZXNzYWdlIGZvciB0b29sIGNhbGwgZmxvdycpXG5cdFx0XHRpZiAoc2hvdWxkRGVidWcpIHtcblx0XHRcdFx0Y29uc29sZS5pbmZvKCdbb3BlbnJvdXRlcjp0b29sc10gZGVidWcgcmVzcG9uc2UnLCB7XG5cdFx0XHRcdFx0aXRlcmF0aW9uLFxuXHRcdFx0XHRcdGxhdGVuY3lfbXM6IGxhdGVuY3lNcyxcblx0XHRcdFx0XHRmaW5pc2hfcmVhc29uOiBjaG9pY2U/LmZpbmlzaF9yZWFzb24gfHwgbnVsbCxcblx0XHRcdFx0XHR0b29sX2NhbGxzOiBjaG9pY2U/Lm1lc3NhZ2U/LnRvb2xfY2FsbHM/Lm1hcCgodDogVG9vbENhbGwpID0+IHQ/LmZ1bmN0aW9uPy5uYW1lKSB8fCBbXSxcblx0XHRcdFx0fSlcblx0XHRcdH1cblx0XHRcdGNvbnN0IGFzc2lzdGFudE1lc3NhZ2UgPSBjaG9pY2UubWVzc2FnZSBhcyBDaGF0TWVzc2FnZVxuXHRcdFx0Y29udmVyc2F0aW9uLnB1c2goYXNzaXN0YW50TWVzc2FnZSlcblx0XHRcdGNvbnN0IGNhbGxzID0gYXNzaXN0YW50TWVzc2FnZS50b29sX2NhbGxzIHx8IFtdXG5cdFx0XHRpZiAoY2FsbHMubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRmb3IgKGNvbnN0IGNhbGwgb2YgY2FsbHMpIHtcblx0XHRcdFx0XHRjb25zdCBoYW5kbGVyID0gb3B0cy5oYW5kbGVycz8uW2NhbGwuZnVuY3Rpb24/Lm5hbWVdXG5cdFx0XHRcdFx0aWYgKCFoYW5kbGVyKSB0aHJvdyBuZXcgRXJyb3IoYFVuaGFuZGxlZCB0b29sIGNhbGw6ICR7Y2FsbC5mdW5jdGlvbj8ubmFtZX1gKVxuXHRcdFx0XHRcdGxldCBwYXJzZWRBcmdzOiBhbnkgPSB7fVxuXHRcdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0XHRwYXJzZWRBcmdzID0gY2FsbC5mdW5jdGlvbj8uYXJndW1lbnRzID8gSlNPTi5wYXJzZShjYWxsLmZ1bmN0aW9uLmFyZ3VtZW50cykgOiB7fVxuXHRcdFx0XHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBwYXJzZSB0b29sIGFyZ3VtZW50cyBmb3IgJHtjYWxsLmZ1bmN0aW9uPy5uYW1lfTogJHsoZXJyb3IgYXMgRXJyb3IpLm1lc3NhZ2V9YClcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0Y29uc3QgaGFuZGxlclJlc3VsdCA9IGF3YWl0IGhhbmRsZXIocGFyc2VkQXJncywgeyB0b29sQ2FsbDogY2FsbCB9KVxuXHRcdFx0XHRcdGNvbnN0IGNvbnRlbnQgPSB0eXBlb2YgaGFuZGxlclJlc3VsdC5jb250ZW50ID09PSAnc3RyaW5nJyA/IGhhbmRsZXJSZXN1bHQuY29udGVudCA6IEpTT04uc3RyaW5naWZ5KGhhbmRsZXJSZXN1bHQuY29udGVudCA/PyB7fSlcblx0XHRcdFx0XHRjb252ZXJzYXRpb24ucHVzaCh7XG5cdFx0XHRcdFx0XHRyb2xlOiAndG9vbCcsXG5cdFx0XHRcdFx0XHR0b29sX2NhbGxfaWQ6IGNhbGwuaWQsXG5cdFx0XHRcdFx0XHRjb250ZW50LFxuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0dG9vbENhbGxzLnB1c2goe1xuXHRcdFx0XHRcdFx0dG9vbDogY2FsbC5mdW5jdGlvbi5uYW1lLFxuXHRcdFx0XHRcdFx0YXJndW1lbnRzOiBwYXJzZWRBcmdzLFxuXHRcdFx0XHRcdFx0cmVzcG9uc2U6IGhhbmRsZXJSZXN1bHQsXG5cdFx0XHRcdFx0XHR0b29sQ2FsbElkOiBjYWxsLmlkLFxuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdH1cblx0XHRcdFx0aWYgKG9wdHMucmV0dXJuT25Ub29sQ2FsbCkge1xuXHRcdFx0XHRcdHJldHVybiB7IGZpbmFsTWVzc2FnZTogYXNzaXN0YW50TWVzc2FnZSwgcmF3OiBqc29uLCB0b29sQ2FsbHMsIHRyYW5zY3JpcHQ6IGNvbnZlcnNhdGlvbiB9XG5cdFx0XHRcdH1cblx0XHRcdFx0Y29udGludWVcblx0XHRcdH1cblx0XHRcdHJldHVybiB7IGZpbmFsTWVzc2FnZTogYXNzaXN0YW50TWVzc2FnZSwgcmF3OiBqc29uLCB0b29sQ2FsbHMsIHRyYW5zY3JpcHQ6IGNvbnZlcnNhdGlvbiB9XG5cdFx0fSBmaW5hbGx5IHtcblx0XHRcdGNsZWFyVGltZW91dCh0aW1lb3V0KVxuXHRcdH1cblx0fVxuXHR0aHJvdyBuZXcgRXJyb3IoJ1Rvb2wgY2FsbGluZyBsb29wIGV4Y2VlZGVkIG1heGltdW0gaXRlcmF0aW9ucyB3aXRob3V0IGNvbXBsZXRpb24nKVxufVxuIl0sIm5hbWVzIjpbIk9QRU5ST1VURVJfVVJMIiwibm9ybWFsaXplUHJvdmlkZXJTb3J0Iiwic29ydCIsImVudkRlZmF1bHQiLCJwcm9jZXNzIiwiZW52IiwiT1BFTlJPVVRFUl9QUk9WSURFUl9TT1JUIiwidG9Mb3dlckNhc2UiLCJjYW5kaWRhdGUiLCJidWlsZEhlYWRlcnMiLCJoZWFkZXJzIiwiT1BFTlJPVVRFUl9BUElfS0VZIiwiT1BFTlJPVVRFUl9IVFRQX1JFRkVSRVIiLCJPUEVOUk9VVEVSX1hfVElUTEUiLCJtZXNzYWdlQ2hhckxlbmd0aCIsIm1lc3NhZ2UiLCJjb250ZW50IiwibGVuZ3RoIiwiZXN0aW1hdGVUb2tlbnMiLCJtZXNzYWdlcyIsImNoYXJDb3VudCIsInJlZHVjZSIsInN1bSIsIm0iLCJhcHByb3hUb2tlbnMiLCJNYXRoIiwiY2VpbCIsImNoYXRKc29uU2NoZW1hIiwib3B0cyIsImJvZHkiLCJtb2RlbCIsInJlc3BvbnNlX2Zvcm1hdCIsInR5cGUiLCJqc29uX3NjaGVtYSIsIm5hbWUiLCJzY2hlbWEiLCJzdHJpY3QiLCJwcm92aWRlciIsInByb3ZpZGVyU29ydCIsInRlbXBlcmF0dXJlIiwibWF4X3Rva2VucyIsIm1heFRva2VucyIsImNvbnRyb2xsZXIiLCJBYm9ydENvbnRyb2xsZXIiLCJ0aW1lb3V0Iiwic2V0VGltZW91dCIsImFib3J0IiwidGltZW91dE1zIiwic2hvdWxkRGVidWciLCJCb29sZWFuIiwiZGVidWciLCJPUEVOUk9VVEVSX0RFQlVHIiwiUkVQT1JUX0RFQlVHX09QRU5ST1VURVIiLCJyZXF1ZXN0U2l6ZUJ5dGVzIiwiQnVmZmVyIiwiYnl0ZUxlbmd0aCIsIkpTT04iLCJzdHJpbmdpZnkiLCJ0MCIsIkRhdGUiLCJub3ciLCJjb25zb2xlIiwiaW5mbyIsImlucHV0X3Rva2Vuc19hcHByb3giLCJpbnB1dF9jaGFycyIsInJlcXVlc3Rfc2l6ZV9ieXRlcyIsInByb3ZpZGVyX3NvcnQiLCJyZXMiLCJmZXRjaCIsIm1ldGhvZCIsInNpZ25hbCIsImxhdGVuY3lNcyIsIm9rIiwiZXJyVGV4dCIsInRleHQiLCJjYXRjaCIsImVycm9yIiwic3RhdHVzIiwibGF0ZW5jeV9tcyIsInNsaWNlIiwiRXJyb3IiLCJqc29uIiwidXNhZ2UiLCJmaW5pc2hfcmVhc29uIiwiY2hvaWNlcyIsInJhdyIsImNsZWFyVGltZW91dCIsImNoYXRUZXh0IiwicyIsIlRleHRFbmNvZGVyIiwiZW5jb2RlIiwiY2hhdFdpdGhUb29scyIsImNvbnZlcnNhdGlvbiIsInRvb2xDYWxscyIsIm1heEl0ZXJhdGlvbnMiLCJtYXgiLCJtYXhUb29sSXRlcmF0aW9ucyIsIml0ZXJhdGlvbiIsInRvb2xzIiwidG9vbF9jaG9pY2UiLCJ0b29sQ2hvaWNlIiwicGFyYWxsZWxfdG9vbF9jYWxscyIsInBhcmFsbGVsVG9vbENhbGxzIiwidW5kZWZpbmVkIiwiY2hvaWNlIiwidG9vbF9jYWxscyIsIm1hcCIsInQiLCJmdW5jdGlvbiIsImFzc2lzdGFudE1lc3NhZ2UiLCJwdXNoIiwiY2FsbHMiLCJjYWxsIiwiaGFuZGxlciIsImhhbmRsZXJzIiwicGFyc2VkQXJncyIsImFyZ3VtZW50cyIsInBhcnNlIiwiaGFuZGxlclJlc3VsdCIsInRvb2xDYWxsIiwicm9sZSIsInRvb2xfY2FsbF9pZCIsImlkIiwidG9vbCIsInJlc3BvbnNlIiwidG9vbENhbGxJZCIsInJldHVybk9uVG9vbENhbGwiLCJmaW5hbE1lc3NhZ2UiLCJ0cmFuc2NyaXB0Il0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/server/services/openrouter.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/services/summary-report.ts":
/*!***********************************************!*\
  !*** ./src/server/services/summary-report.ts ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generateSummaryReport: () => (/* binding */ generateSummaryReport)\n/* harmony export */ });\n/* harmony import */ var _server_repositories_reports_v3_tabs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/server/repositories/reports-v3-tabs */ \"(rsc)/./src/server/repositories/reports-v3-tabs.ts\");\n/* harmony import */ var _server_repositories_sessions__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/server/repositories/sessions */ \"(rsc)/./src/server/repositories/sessions.ts\");\n/* harmony import */ var _server_repositories_transcripts__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/server/repositories/transcripts */ \"(rsc)/./src/server/repositories/transcripts.ts\");\n/* harmony import */ var _server_services_openrouter__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/server/services/openrouter */ \"(rsc)/./src/server/services/openrouter.ts\");\n/* harmony import */ var _server_services_markdown_indexer__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/server/services/markdown-indexer */ \"(rsc)/./src/server/services/markdown-indexer.ts\");\n\n\n\n\n\nfunction buildSummarySystemPrompt() {\n    return [\n        // Preserve your original tone and density requirements, remove unrelated tabs, add stable anchors\n        'You are an enterprise sales analyst. Generate ONLY the Executive Summary tab as Markdown.',\n        'Output MUST be wrapped with these exact markers and include section anchors for reliable updates:',\n        '<!-- TAB: EXECUTIVE SUMMARY -->',\n        '# Executive Summary',\n        '',\n        '<!-- SECTION: EXEC/CALL_OVERVIEW -->',\n        '## Call Overview',\n        'Write a concise paragraph capturing sequence, tone, flow, rep approach, engagement.',\n        '<!-- /SECTION: EXEC/CALL_OVERVIEW -->',\n        '',\n        '<!-- SECTION: EXEC/PAINS -->',\n        '## Pain Points of the Prospect',\n        '- Include timestamps and short evidence quotes where relevant.',\n        '<!-- /SECTION: EXEC/PAINS -->',\n        '',\n        '<!-- SECTION: EXEC/OBJECTIONS -->',\n        '## Objections Raised',\n        '- List with timestamps; reflect how they were handled if applicable.',\n        '<!-- /SECTION: EXEC/OBJECTIONS -->',\n        '',\n        '<!-- SECTION: EXEC/BUYING_SIGNALS -->',\n        '## Buying Signals',\n        '- Verbal or implied indications of interest.',\n        '<!-- /SECTION: EXEC/BUYING_SIGNALS -->',\n        '',\n        '<!-- SECTION: EXEC/KEY_DETAILS -->',\n        '## Key Details to Remember',\n        '- Team size, decision makers, priorities, budget, timelines.',\n        '<!-- /SECTION: EXEC/KEY_DETAILS -->',\n        '',\n        '<!-- SECTION: EXEC/MISSED_OPPS -->',\n        '## Missed Opportunities',\n        '- Areas the rep could have probed further or strengthened the deal.',\n        '<!-- /SECTION: EXEC/MISSED_OPPS -->',\n        '',\n        '<!-- SECTION: EXEC/IMPROVEMENTS -->',\n        '## Areas to Improve',\n        '- Specific, actionable points for the rep.',\n        '<!-- /SECTION: EXEC/IMPROVEMENTS -->',\n        '',\n        '<!-- SECTION: EXEC/NEXT_STEPS -->',\n        '## To-Do List / Next Steps',\n        '- Bullets with owner & deadline.',\n        '<!-- /SECTION: EXEC/NEXT_STEPS -->',\n        '',\n        '<!-- /TAB: EXECUTIVE SUMMARY -->',\n        '',\n        'Do NOT include Chance of Sale or Sales Rep Performance tabs.'\n    ].join('\\n');\n}\nfunction assembleSummaryUserPrompt(session, transcripts) {\n    const parts = [];\n    parts.push(`# SESSION\\nID: ${session?.id}\\nType: ${session?.type || session?.session_type || ''}\\nStartedAt: ${session?.started_at || ''}`);\n    const segments = transcripts.map((t)=>({\n            ts: t.timestamp,\n            speaker: t.speaker,\n            text: t.content_enc\n        }));\n    parts.push(`# TRANSCRIPTS\\n${JSON.stringify(segments)}`);\n    return parts.join('\\n\\n');\n}\nasync function generateSummaryReport(supabase, userId, sessionId) {\n    console.info('[summary] generate start', {\n        sessionId\n    });\n    const repo = new _server_repositories_reports_v3_tabs__WEBPACK_IMPORTED_MODULE_0__.ReportsV3TabsRepository(supabase);\n    const sessionsRepo = new _server_repositories_sessions__WEBPACK_IMPORTED_MODULE_1__.SessionsRepository(supabase);\n    const transcriptsRepo = new _server_repositories_transcripts__WEBPACK_IMPORTED_MODULE_2__.TranscriptsRepository(supabase);\n    const existing = await repo.findBySessionId(sessionId, userId);\n    if (!existing) {\n        await repo.upsertQueued(sessionId);\n    }\n    try {\n        await repo.setRunning(sessionId);\n    } catch  {}\n    const session = await sessionsRepo.findById(sessionId, userId);\n    if (!session) throw new Error('Session not found');\n    const transcripts = await transcriptsRepo.findBySessionId(sessionId, userId);\n    console.info('[summary] inputs', {\n        transcripts: transcripts.length\n    });\n    const system = buildSummarySystemPrompt();\n    const user = assembleSummaryUserPrompt(session, transcripts);\n    const model = process.env.OPENROUTER_MODEL || 'qwen/qwen3-235b-a22b:free';\n    let txt = null;\n    for(let attempt = 1; attempt <= 2; attempt++){\n        try {\n            const r = await (0,_server_services_openrouter__WEBPACK_IMPORTED_MODULE_3__.chatText)({\n                model,\n                messages: [\n                    {\n                        role: 'system',\n                        content: system\n                    },\n                    {\n                        role: 'user',\n                        content: user\n                    }\n                ],\n                temperature: 0.2,\n                maxTokens: 4000,\n                timeoutMs: 180000,\n                debug: true\n            });\n            txt = {\n                content: (r.content || '').trim()\n            };\n            break;\n        } catch (e) {\n            if (attempt < 2) await new Promise((r)=>setTimeout(r, attempt * 1000));\n            else throw e;\n        }\n    }\n    const markdown = (txt?.content || '').trim();\n    if (!markdown) throw new Error('Empty summary markdown');\n    console.info('[summary] LLM ok', {\n        content_len: markdown.length\n    });\n    // Merge into report_json { markdown: combinedMarkdown }\n    // We keep combined tabs structure: only EXECUTIVE SUMMARY is ensured here.\n    const current = await repo.findBySessionId(sessionId, userId);\n    const existingMd = current?.report?.markdown;\n    let combined = markdown;\n    if (existingMd && existingMd.includes('<!-- TAB: CHANCE OF SALE -->')) {\n        // attempt to preserve existing CoS by stitching sections\n        const cosStart = existingMd.indexOf('<!-- TAB: CHANCE OF SALE -->');\n        if (cosStart >= 0) {\n            const cosPart = existingMd.slice(cosStart);\n            combined = [\n                markdown.replace(/\\s+$/, '').trim(),\n                '',\n                cosPart\n            ].join('\\n\\n');\n        }\n    }\n    await supabase.from('session_reports_v3_tabs').update({\n        status: 'ready',\n        report_json: {\n            ...current?.report || {},\n            markdown: combined\n        },\n        last_error: null\n    }).eq('session_id', sessionId).then(({ error })=>{\n        if (error) throw error;\n    });\n    console.info('[summary] saved combined markdown', {\n        combined_len: combined.length\n    });\n    // Index sections for querying later\n    try {\n        await (0,_server_services_markdown_indexer__WEBPACK_IMPORTED_MODULE_4__.indexReportMarkdown)(supabase, sessionId, combined);\n    } catch  {}\n    return {\n        markdown: combined\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3NlcnZpY2VzL3N1bW1hcnktcmVwb3J0LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUErRTtBQUNaO0FBQ007QUFDbEI7QUFDaUI7QUFFeEUsU0FBU0s7SUFDUCxPQUFPO1FBQ0wsa0dBQWtHO1FBQ2xHO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtLQUNELENBQUNDLElBQUksQ0FBQztBQUNUO0FBRUEsU0FBU0MsMEJBQTBCQyxPQUFZLEVBQUVDLFdBQWtCO0lBQ2pFLE1BQU1DLFFBQWtCLEVBQUU7SUFDMUJBLE1BQU1DLElBQUksQ0FBQyxDQUFDLGVBQWUsRUFBRUgsU0FBU0ksR0FBRyxRQUFRLEVBQUVKLFNBQVNLLFFBQVFMLFNBQVNNLGdCQUFnQixHQUFHLGFBQWEsRUFBRU4sU0FBU08sY0FBYyxJQUFJO0lBQzFJLE1BQU1DLFdBQVdQLFlBQVlRLEdBQUcsQ0FBQ0MsQ0FBQUEsSUFBTTtZQUFFQyxJQUFJRCxFQUFFRSxTQUFTO1lBQUVDLFNBQVNILEVBQUVHLE9BQU87WUFBRUMsTUFBTUosRUFBRUssV0FBVztRQUFDO0lBQ2xHYixNQUFNQyxJQUFJLENBQUMsQ0FBQyxlQUFlLEVBQUVhLEtBQUtDLFNBQVMsQ0FBQ1QsV0FBVztJQUN2RCxPQUFPTixNQUFNSixJQUFJLENBQUM7QUFDcEI7QUFFTyxlQUFlb0Isc0JBQ3BCQyxRQUFhLEVBQ2JDLE1BQWMsRUFDZEMsU0FBaUI7SUFFakJDLFFBQVFDLElBQUksQ0FBQyw0QkFBNEI7UUFBRUY7SUFBVTtJ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ZixTQUFTMUIsTUFBTTtJQUFDO0lBRWxGLG9DQUFvQztJQUNwQyxJQUFJO1FBQUUsTUFBTXJDLHNGQUFtQkEsQ0FBQ3VCLFVBQVVFLFdBQVdzQztJQUFVLEVBQUUsT0FBTSxDQUFDO0lBRXhFLE9BQU87UUFBRUwsVUFBVUs7SUFBUztBQUM5QiIsInNvdXJjZXMiOlsiRDpcXERlbHRhIElWXFxTb2Z3YXJlc1xcZ2xhc3NcXHNhbmRib3hcXHNoYWRjbi1jcm0tZGFzaGJvYXJkXFxzcmNcXHNlcnZlclxcc2VydmljZXNcXHN1bW1hcnktcmVwb3J0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJlcG9ydHNWM1RhYnNSZXBvc2l0b3J5IH0gZnJvbSAnQC9zZXJ2ZXIvcmVwb3NpdG9yaWVzL3JlcG9ydHMtdjMtdGFicydcbmltcG9ydCB7IFNlc3Npb25zUmVwb3NpdG9yeSB9IGZyb20gJ0Avc2VydmVyL3JlcG9zaXRvcmllcy9zZXNzaW9ucydcbmltcG9ydCB7IFRyYW5zY3JpcHRzUmVwb3NpdG9yeSB9IGZyb20gJ0Avc2VydmVyL3JlcG9zaXRvcmllcy90cmFuc2NyaXB0cydcbmltcG9ydCB7IGNoYXRUZXh0IH0gZnJvbSAnQC9zZXJ2ZXIvc2VydmljZXMvb3BlbnJvdXRlcidcbmltcG9ydCB7IGluZGV4UmVwb3J0TWFya2Rvd24gfSBmcm9tICdAL3NlcnZlci9zZXJ2aWNlcy9tYXJrZG93bi1pbmRleGVyJ1xuXG5mdW5jdGlvbiBidWlsZFN1bW1hcnlTeXN0ZW1Qcm9tcHQoKTogc3RyaW5nIHtcbiAgcmV0dXJuIFtcbiAgICAvLyBQcmVzZXJ2ZSB5b3VyIG9yaWdpbmFsIHRvbmUgYW5kIGRlbnNpdHkgcmVxdWlyZW1lbnRzLCByZW1vdmUgdW5yZWxhdGVkIHRhYnMsIGFkZCBzdGFibGUgYW5jaG9yc1xuICAgICdZb3UgYXJlIGFuIGVudGVycHJpc2Ugc2FsZXMgYW5hbHlzdC4gR2VuZXJhdGUgT05MWSB0aGUgRXhlY3V0aXZlIFN1bW1hcnkgdGFiIGFzIE1hcmtkb3duLicsXG4gICAgJ091dHB1dCBNVVNUIGJlIHdyYXBwZWQgd2l0aCB0aGVzZSBleGFjdCBtYXJrZXJzIGFuZCBpbmNsdWRlIHNlY3Rpb24gYW5jaG9ycyBmb3IgcmVsaWFibGUgdXBkYXRlczonLFxuICAgICc8IS0tIFRBQjogRVhFQ1VUSVZFIFNVTU1BUlkgLS0+JyxcbiAgICAnIyBFeGVjdXRpdmUgU3VtbWFyeScsXG4gICAgJycsXG4gICAgJzwhLS0gU0VDVElPTjogRVhFQy9DQUxMX09WRVJWSUVXIC0tPicsXG4gICAgJyMjIENhbGwgT3ZlcnZpZXcnLFxuICAgICdXcml0ZSBhIGNvbmNpc2UgcGFyYWdyYXBoIGNhcHR1cmluZyBzZXF1ZW5jZSwgdG9uZSwgZmxvdywgcmVwIGFwcHJvYWNoLCBlbmdhZ2VtZW50LicsXG4gICAgJzwhLS0gL1NFQ1RJT046IEVYRUMvQ0FMTF9PVkVSVklFVyAtLT4nLFxuICAgICcnLFxuICAgICc8IS0tIFNFQ1RJT046IEVYRUMvUEFJTlMgLS0+JyxcbiAgICAnIyMgUGFpbiBQb2ludHMgb2YgdGhlIFByb3NwZWN0JyxcbiAgICAnLSBJbmNsdWRlIHRpbWVzdGFtcHMgYW5kIHNob3J0IGV2aWRlbmNlIHF1b3RlcyB3aGVyZSByZWxldmFudC4nLFxuICAgICc8IS0tIC9TRUNUSU9OOiBFWEVDL1BBSU5TIC0tPicsXG4gICAgJycsXG4gICAgJzwhLS0gU0VDVElPTjogRVhFQy9PQkpFQ1RJT05TIC0tPicsXG4gICAgJyMjIE9iamVjdGlvbnMgUmFpc2VkJyxcbiAgICAnLSBMaXN0IHdpdGggdGltZXN0YW1wczsgcmVmbGVjdCBob3cgdGhleSB3ZXJlIGhhbmRsZWQgaWYgYXBwbGljYWJsZS4nLFxuICAgICc8IS0tIC9TRUNUSU9OOiBFWEVDL09CSkVDVElPTlMgLS0+JyxcbiAgICAnJyxcbiAgICAnPCEtLSBTRUNUSU9OOiBFWEVDL0JVWUlOR19TSUdOQUxTIC0tPicsXG4gICAgJyMjIEJ1eWluZyBTaWduYWxzJyxcbiAgICAnLSBWZXJiYWwgb3IgaW1wbGllZCBpbmRpY2F0aW9ucyBvZiBpbnRlcmVzdC4nLFxuICAgICc8IS0tIC9TRUNUSU9OOiBFWEVDL0JVWUlOR19TSUdOQUxTIC0tPicsXG4gICAgJycsXG4gICAgJzwhLS0gU0VDVElPTjogRVhFQy9LRVlfREVUQUlMUyAtLT4nLFxuICAgICcjIyBLZXkgRGV0YWlscyB0byBSZW1lbWJlcicsXG4gICAgJy0gVGVhbSBzaXplLCBkZWNpc2lvbiBtYWtlcnMsIHByaW9yaXRpZXMsIGJ1ZGdldCwgdGltZWxpbmVzLicsXG4gICAgJzwhLS0gL1NFQ1RJT046IEVYRUMvS0VZX0RFVEFJTFMgLS0+JyxcbiAgICAnJyxcbiAgICAnPCEtLSBTRUNUSU9OOiBFWEVDL01JU1NFRF9PUFBTIC0tPicsXG4gICAgJyMjIE1pc3NlZCBPcHBvcnR1bml0aWVzJyxcbiAgICAnLSBBcmVhcyB0aGUgcmVwIGNvdWxkIGhhdmUgcHJvYmVkIGZ1cnRoZXIgb3Igc3RyZW5ndGhlbmVkIHRoZSBkZWFsLicsXG4gICAgJzwhLS0gL1NFQ1RJT046IEVYRUMvTUlTU0VEX09QUFMgLS0+JyxcbiAgICAnJyxcbiAgICAnPCEtLSBTRUNUSU9OOiBFWEVDL0lNUFJPVkVNRU5UUyAtLT4nLFxuICAgICcjIyBBcmVhcyB0byBJbXByb3ZlJyxcbiAgICAnLSBTcGVjaWZpYywgYWN0aW9uYWJsZSBwb2ludHMgZm9yIHRoZSByZXAuJyxcbiAgICAnPCEtLSAvU0VDVElPTjogRVhFQy9JTVBST1ZFTUVOVFMgLS0+JyxcbiAgICAnJyxcbiAgICAnPCEtLSBTRUNUSU9OOiBFWEVDL05FWFRfU1RFUFMgLS0+JyxcbiAgICAnIyMgVG8tRG8gTGlzdCAvIE5leHQgU3RlcHMnLFxuICAgICctIEJ1bGxldHMgd2l0aCBvd25lciAmIGRlYWRsaW5lLicsXG4gICAgJzwhLS0gL1NFQ1RJT046IEVYRUMvTkVYVF9TVEVQUyAtLT4nLFxuICAgICcnLFxuICAgICc8IS0tIC9UQUI6IEVYRUNVVElWRSBTVU1NQVJZIC0tPicsXG4gICAgJycsXG4gICAgJ0RvIE5PVCBpbmNsdWRlIENoYW5jZSBvZiBTYWxlIG9yIFNhbGVzIFJlcCBQZXJmb3JtYW5jZSB0YWJzLicsXG4gIF0uam9pbignXFxuJylcbn1cblxuZnVuY3Rpb24gYXNzZW1ibGVTdW1tYXJ5VXNlclByb21wdChzZXNzaW9uOiBhbnksIHRyYW5zY3JpcHRzOiBhbnlbXSk6IHN0cmluZyB7XG4gIGNvbnN0IHBhcnRzOiBzdHJpbmdbXSA9IFtdXG4gIHBhcnRzLnB1c2goYCMgU0VTU0lPTlxcbklEOiAke3Nlc3Npb24/LmlkfVxcblR5cGU6ICR7c2Vzc2lvbj8udHlwZSB8fCBzZXNzaW9uPy5zZXNzaW9uX3R5cGUgfHwgJyd9XFxuU3RhcnRlZEF0OiAke3Nlc3Npb24/LnN0YXJ0ZWRfYXQgfHwgJyd9YClcbiAgY29uc3Qgc2VnbWVudHMgPSB0cmFuc2NyaXB0cy5tYXAodCA9PiAoeyB0czogdC50aW1lc3RhbXAsIHNwZWFrZXI6IHQuc3BlYWtlciwgdGV4dDogdC5jb250ZW50X2VuYyB9KSlcbiAgcGFydHMucHVzaChgIyBUUkFOU0NSSVBUU1xcbiR7SlNPTi5zdHJpbmdpZnkoc2VnbWVudHMpfWApXG4gIHJldHVybiBwYXJ0cy5qb2luKCdcXG5cXG4nKVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVTdW1tYXJ5UmVwb3J0KFxuICBzdXBhYmFzZTogYW55LFxuICB1c2VySWQ6IHN0cmluZyxcbiAgc2Vzc2lvbklkOiBzdHJpbmdcbik6IFByb21pc2U8eyBtYXJrZG93bjogc3RyaW5nIH0+IHtcbiAgY29uc29sZS5pbmZvKCdbc3VtbWFyeV0gZ2VuZXJhdGUgc3RhcnQnLCB7IHNlc3Npb25JZCB9KVxuICBjb25zdCByZXBvID0gbmV3IFJlcG9ydHNWM1RhYnNSZXBvc2l0b3J5KHN1cGFiYXNlKVxuICBjb25zdCBzZXNzaW9uc1JlcG8gPSBuZXcgU2Vzc2lvbnNSZXBvc2l0b3J5KHN1cGFiYXNlKVxuICBjb25zdCB0cmFuc2NyaXB0c1JlcG8gPSBuZXcgVHJhbnNjcmlwdHNSZXBvc2l0b3J5KHN1cGFiYXNlKVxuXG4gIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgcmVwby5maW5kQnlTZXNzaW9uSWQoc2Vzc2lvbklkLCB1c2VySWQpXG4gIGlmICghZXhpc3RpbmcpIHtcbiAgICBhd2FpdCByZXBvLnVwc2VydFF1ZXVlZChzZXNzaW9uSWQpXG4gIH1cbiAgdHJ5IHsgYXdhaXQgcmVwby5zZXRSdW5uaW5nKHNlc3Npb25JZCkgfSBjYXRjaCB7fVxuXG4gIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBzZXNzaW9uc1JlcG8uZmluZEJ5SWQoc2Vzc2lvbklkLCB1c2VySWQpXG4gIGlmICghc2Vzc2lvbikgdGhyb3cgbmV3IEVycm9yKCdTZXNzaW9uIG5vdCBmb3VuZCcpXG4gIGNvbnN0IHRyYW5zY3JpcHRzID0gYXdhaXQgdHJhbnNjcmlwdHNSZXBvLmZpbmRCeVNlc3Npb25JZChzZXNzaW9uSWQsIHVzZXJJZClcbiAgY29uc29sZS5pbmZvKCdbc3VtbWFyeV0gaW5wdXRzJywgeyB0cmFuc2NyaXB0czogdHJhbnNjcmlwdHMubGVuZ3RoIH0pXG5cbiAgY29uc3Qgc3lzdGVtID0gYnVpbGRTdW1tYXJ5U3lzdGVtUHJvbXB0KClcbiAgY29uc3QgdXNlciA9IGFzc2VtYmxlU3VtbWFyeVVzZXJQcm9tcHQoc2Vzc2lvbiwgdHJhbnNjcmlwdHMpXG4gIGNvbnN0IG1vZGVsID0gKHByb2Nlc3MuZW52Lk9QRU5ST1VURVJfTU9ERUwgfHwgJ3F3ZW4vcXdlbjMtMjM1Yi1hMjJiOmZyZWUnKVxuXG4gIGxldCB0eHQ6IHsgY29udGVudDogc3RyaW5nIH0gfCBudWxsID0gbnVsbFxuICBmb3IgKGxldCBhdHRlbXB0ID0gMTsgYXR0ZW1wdCA8PSAyOyBhdHRlbXB0KyspIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgciA9IGF3YWl0IGNoYXRUZXh0KHtcbiAgICAgICAgbW9kZWwsXG4gICAgICAgIG1lc3NhZ2VzOiBbXG4gICAgICAgICAgeyByb2xlOiAnc3lzdGVtJywgY29udGVudDogc3lzdGVtIH0sXG4gICAgICAgICAgeyByb2xlOiAndXNlcicsIGNvbnRlbnQ6IHVzZXIgfSxcbiAgICAgICAgXSxcbiAgICAgICAgdGVtcGVyYXR1cmU6IDAuMixcbiAgICAgICAgbWF4VG9rZW5zOiA0MDAwLFxuICAgICAgICB0aW1lb3V0TXM6IDE4MF8wMDAsXG4gICAgICAgIGRlYnVnOiB0cnVlLFxuICAgICAgfSlcbiAgICAgIHR4dCA9IHsgY29udGVudDogKHIuY29udGVudCB8fCAnJykudHJpbSgpIH1cbiAgICAgIGJyZWFrXG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgaWYgKGF0dGVtcHQgPCAyKSBhd2FpdCBuZXcgUHJvbWlzZShyID0+IHNldFRpbWVvdXQociwgYXR0ZW1wdCAqIDEwMDApKVxuICAgICAgZWxzZSB0aHJvdyBlXG4gICAgfVxuICB9XG4gIGNvbnN0IG1hcmtkb3duID0gKHR4dD8uY29udGVudCB8fCAnJykudHJpbSgpXG4gIGlmICghbWFya2Rvd24pIHRocm93IG5ldyBFcnJvcignRW1wdHkgc3VtbWFyeSBtYXJrZG93bicpXG4gIGNvbnNvbGUuaW5mbygnW3N1bW1hcnldIExMTSBvaycsIHsgY29udGVudF9sZW46IG1hcmtkb3duLmxlbmd0aCB9KVxuXG4gIC8vIE1lcmdlIGludG8gcmVwb3J0X2pzb24geyBtYXJrZG93bjogY29tYmluZWRNYXJrZG93biB9XG4gIC8vIFdlIGtlZXAgY29tYmluZWQgdGFicyBzdHJ1Y3R1cmU6IG9ubHkgRVhFQ1VUSVZFIFNVTU1BUlkgaXMgZW5zdXJlZCBoZXJlLlxuICBjb25zdCBjdXJyZW50ID0gYXdhaXQgcmVwby5maW5kQnlTZXNzaW9uSWQoc2Vzc2lvbklkLCB1c2VySWQpXG4gIGNvbnN0IGV4aXN0aW5nTWQ6IHN0cmluZyB8IHVuZGVmaW5lZCA9IChjdXJyZW50Py5yZXBvcnQgYXMgYW55KT8ubWFya2Rvd25cbiAgbGV0IGNvbWJpbmVkID0gbWFya2Rvd25cbiAgaWYgKGV4aXN0aW5nTWQgJiYgZXhpc3RpbmdNZC5pbmNsdWRlcygnPCEtLSBUQUI6IENIQU5DRSBPRiBTQUxFIC0tPicpKSB7XG4gICAgLy8gYXR0ZW1wdCB0byBwcmVzZXJ2ZSBleGlzdGluZyBDb1MgYnkgc3RpdGNoaW5nIHNlY3Rpb25zXG4gICAgY29uc3QgY29zU3RhcnQgPSBleGlzdGluZ01kLmluZGV4T2YoJzwhLS0gVEFCOiBDSEFOQ0UgT0YgU0FMRSAtLT4nKVxuICAgIGlmIChjb3NTdGFydCA+PSAwKSB7XG4gICAgICBjb25zdCBjb3NQYXJ0ID0gZXhpc3RpbmdNZC5zbGljZShjb3NTdGFydClcbiAgICAgIGNvbWJpbmVkID0gW21hcmtkb3duLnJlcGxhY2UoL1xccyskLywnJykudHJpbSgpLCAnJywgY29zUGFydF0uam9pbignXFxuXFxuJylcbiAgICB9XG4gIH1cblxuICBhd2FpdCAoc3VwYWJhc2UgYXMgYW55KVxuICAgIC5mcm9tKCdzZXNzaW9uX3JlcG9ydHNfdjNfdGFicycpXG4gICAgLnVwZGF0ZSh7IHN0YXR1czogJ3JlYWR5JywgcmVwb3J0X2pzb246IHsgLi4uKGN1cnJlbnQ/LnJlcG9ydCB8fCB7fSksIG1hcmtkb3duOiBjb21iaW5lZCB9LCBsYXN0X2Vycm9yOiBudWxsIH0pXG4gICAgLmVxKCdzZXNzaW9uX2lkJywgc2Vzc2lvbklkKVxuICAgIC50aGVuKCh7IGVycm9yIH06IGFueSkgPT4geyBpZiAoZXJyb3IpIHRocm93IGVycm9yIH0pXG4gIGNvbnNvbGUuaW5mbygnW3N1bW1hcnldIHNhdmVkIGNvbWJpbmVkIG1hcmtkb3duJywgeyBjb21iaW5lZF9sZW46IGNvbWJpbmVkLmxlbmd0aCB9KVxuXG4gIC8vIEluZGV4IHNlY3Rpb25zIGZvciBxdWVyeWluZyBsYXRlclxuICB0cnkgeyBhd2FpdCBpbmRleFJlcG9ydE1hcmtkb3duKHN1cGFiYXNlLCBzZXNzaW9uSWQsIGNvbWJpbmVkKSB9IGNhdGNoIHt9XG5cbiAgcmV0dXJuIHsgbWFya2Rvd246IGNvbWJpbmVkIH1cbn1cbiJdLCJuYW1lcyI6WyJSZXBvcnRzVjNUYWJzUmVwb3NpdG9yeSIsIlNlc3Npb25zUmVwb3NpdG9yeSIsIlRyYW5zY3JpcHRzUmVwb3NpdG9yeSIsImNoYXRUZXh0IiwiaW5kZXhSZXBvcnRNYXJrZG93biIsImJ1aWxkU3VtbWFyeVN5c3RlbVByb21wdCIsImpvaW4iLCJhc3NlbWJsZVN1bW1hcnlVc2VyUHJvbXB0Iiwic2Vzc2lvbiIsInRyYW5zY3JpcHRzIiwicGFydHMiLCJwdXNoIiwiaWQiLCJ0eXBlIiwic2Vzc2lvbl90eXBlIiwic3RhcnRlZF9hdCIsInNlZ21lbnRzIiwibWFwIiwidCIsInRzIiwidGltZXN0YW1wIiwic3BlYWtlciIsInRleHQiLCJjb250ZW50X2VuYyIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZW5lcmF0ZVN1bW1hcnlSZXBvcnQiLCJzdXBhYmFzZSIsInVzZXJJZCIsInNlc3Npb25JZCIsImNvbnNvbGUiLCJpbmZvIiwicmVwbyIsInNlc3Npb25zUmVwbyIsInRyYW5zY3JpcHRzUmVwbyIsImV4aXN0aW5nIiwiZmluZEJ5U2Vzc2lvbklkIiwidXBzZXJ0UXVldWVkIiwic2V0UnVubmluZyIsImZpbmRCeUlkIiwiRXJyb3IiLCJsZW5ndGgiLCJzeXN0ZW0iLCJ1c2VyIiwibW9kZWwiLCJwcm9jZXNzIiwiZW52IiwiT1BFTlJPVVRFUl9NT0RFTCIsInR4dCIsImF0dGVtcHQiLCJyIiwibWVzc2FnZXMiLCJyb2xlIiwiY29udGVudCIsInRlbXBlcmF0dXJlIiwibWF4VG9rZW5zIiwidGltZW91dE1zIiwiZGVidWciLCJ0cmltIiwiZSIsIlByb21pc2UiLCJzZXRUaW1lb3V0IiwibWFya2Rvd24iLCJjb250ZW50X2xlbiIsImN1cnJlbnQiLCJleGlzdGluZ01kIiwicmVwb3J0IiwiY29tYmluZWQiLCJpbmNsdWRlcyIsImNvc1N0YXJ0IiwiaW5kZXhPZiIsImNvc1BhcnQiLCJzbGljZSIsInJlcGxhY2UiLCJmcm9tIiwidXBkYXRlIiwic3RhdHVzIiwicmVwb3J0X2pzb24iLCJsYXN0X2Vycm9yIiwiZXEiLCJ0aGVuIiwiZXJyb3IiLCJjb21iaW5lZF9sZW4iXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/server/services/summary-report.ts\n");

/***/ }),

/***/ "(ssr)/./node_modules/.pnpm/next@15.2.2_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!*********************************************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/next@15.2.2_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \*********************************************************************************************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

"use strict";
module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("zlib");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next@15.2.2_react-dom@19.1.1_react@19.1.1__react@19.1.1","vendor-chunks/tr46@0.0.3","vendor-chunks/@supabase+auth-js@2.71.1","vendor-chunks/@supabase+realtime-js@2.15.5","vendor-chunks/@supabase+postgrest-js@1.21.4","vendor-chunks/@supabase+node-fetch@2.6.15","vendor-chunks/@supabase+storage-js@2.12.1","vendor-chunks/whatwg-url@5.0.0","vendor-chunks/@supabase+ssr@0.7.0_@supabase+supabase-js@2.57.4","vendor-chunks/@supabase+supabase-js@2.57.4","vendor-chunks/cookie@1.0.2","vendor-chunks/@supabase+functions-js@2.4.6","vendor-chunks/webidl-conversions@3.0.1"], () => (__webpack_exec__("(rsc)/./node_modules/.pnpm/next@15.2.2_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fsessions%2F%5Bid%5D%2Fsummary%2Froute&page=%2Fapi%2Fsessions%2F%5Bid%5D%2Fsummary%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsessions%2F%5Bid%5D%2Fsummary%2Froute.ts&appDir=D%3A%5CDelta%20IV%5CSofwares%5Cglass%5Csandbox%5Cshadcn-crm-dashboard%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CDelta%20IV%5CSofwares%5Cglass%5Csandbox%5Cshadcn-crm-dashboard&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();