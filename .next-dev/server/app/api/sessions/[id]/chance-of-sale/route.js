/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/sessions/[id]/chance-of-sale/route";
exports.ids = ["app/api/sessions/[id]/chance-of-sale/route"];
exports.modules = {

/***/ "(rsc)/./node_modules/.pnpm/next@15.2.2_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fsessions%2F%5Bid%5D%2Fchance-of-sale%2Froute&page=%2Fapi%2Fsessions%2F%5Bid%5D%2Fchance-of-sale%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsessions%2F%5Bid%5D%2Fchance-of-sale%2Froute.ts&appDir=D%3A%5CDelta%20IV%5CSofwares%5Cglass%5Csandbox%5Cshadcn-crm-dashboard%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CDelta%20IV%5CSofwares%5Cglass%5Csandbox%5Cshadcn-crm-dashboard&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/next@15.2.2_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fsessions%2F%5Bid%5D%2Fchance-of-sale%2Froute&page=%2Fapi%2Fsessions%2F%5Bid%5D%2Fchance-of-sale%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsessions%2F%5Bid%5D%2Fchance-of-sale%2Froute.ts&appDir=D%3A%5CDelta%20IV%5CSofwares%5Cglass%5Csandbox%5Cshadcn-crm-dashboard%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CDelta%20IV%5CSofwares%5Cglass%5Csandbox%5Cshadcn-crm-dashboard&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/.pnpm/next@15.2.2_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/.pnpm/next@15.2.2_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/.pnpm/next@15.2.2_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var D_Delta_IV_Sofwares_glass_sandbox_shadcn_crm_dashboard_src_app_api_sessions_id_chance_of_sale_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/sessions/[id]/chance-of-sale/route.ts */ \"(rsc)/./src/app/api/sessions/[id]/chance-of-sale/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/sessions/[id]/chance-of-sale/route\",\n        pathname: \"/api/sessions/[id]/chance-of-sale\",\n        filename: \"route\",\n        bundlePath: \"app/api/sessions/[id]/chance-of-sale/route\"\n    },\n    resolvedPagePath: \"D:\\\\Delta IV\\\\Sofwares\\\\glass\\\\sandbox\\\\shadcn-crm-dashboard\\\\src\\\\app\\\\api\\\\sessions\\\\[id]\\\\chance-of-sale\\\\route.ts\",\n    nextConfigOutput,\n    userland: D_Delta_IV_Sofwares_glass_sandbox_shadcn_crm_dashboard_src_app_api_sessions_id_chance_of_sale_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbmV4dEAxNS4yLjJfcmVhY3QtZG9tQDE5LjEuMV9yZWFjdEAxOS4xLjFfX3JlYWN0QDE5LjEuMS9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIvaW5kZXguanM/bmFtZT1hcHAlMkZhcGklMkZzZXNzaW9ucyUyRiU1QmlkJTVEJTJGY2hhbmNlLW9mLXNhbGUlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRnNlc3Npb25zJTJGJTVCaWQlNUQlMkZjaGFuY2Utb2Ytc2FsZSUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRnNlc3Npb25zJTJGJTVCaWQlNUQlMkZjaGFuY2Utb2Ytc2FsZSUyRnJvdXRlLnRzJmFwcERpcj1EJTNBJTVDRGVsdGElMjBJViU1Q1NvZndhcmVzJTVDZ2xhc3MlNUNzYW5kYm94JTVDc2hhZGNuLWNybS1kYXNoYm9hcmQlNUNzcmMlNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUQlM0ElNUNEZWx0YSUyMElWJTVDU29md2FyZXMlNUNnbGFzcyU1Q3NhbmRib3glNUNzaGFkY24tY3JtLWRhc2hib2FyZCZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBK0Y7QUFDdkM7QUFDcUI7QUFDcUU7QUFDbEo7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLHlHQUFtQjtBQUMzQztBQUNBLGNBQWMsa0VBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxzREFBc0Q7QUFDOUQ7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDMEY7O0FBRTFGIiwic291cmNlcyI6WyIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIkQ6XFxcXERlbHRhIElWXFxcXFNvZndhcmVzXFxcXGdsYXNzXFxcXHNhbmRib3hcXFxcc2hhZGNuLWNybS1kYXNoYm9hcmRcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxcc2Vzc2lvbnNcXFxcW2lkXVxcXFxjaGFuY2Utb2Ytc2FsZVxcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvc2Vzc2lvbnMvW2lkXS9jaGFuY2Utb2Ytc2FsZS9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3Nlc3Npb25zL1tpZF0vY2hhbmNlLW9mLXNhbGVcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL3Nlc3Npb25zL1tpZF0vY2hhbmNlLW9mLXNhbGUvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJEOlxcXFxEZWx0YSBJVlxcXFxTb2Z3YXJlc1xcXFxnbGFzc1xcXFxzYW5kYm94XFxcXHNoYWRjbi1jcm0tZGFzaGJvYXJkXFxcXHNyY1xcXFxhcHBcXFxcYXBpXFxcXHNlc3Npb25zXFxcXFtpZF1cXFxcY2hhbmNlLW9mLXNhbGVcXFxccm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyB3b3JrQXN5bmNTdG9yYWdlLCB3b3JrVW5pdEFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICB3b3JrQXN5bmNTdG9yYWdlLFxuICAgICAgICB3b3JrVW5pdEFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHdvcmtBc3luY1N0b3JhZ2UsIHdvcmtVbml0QXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/next@15.2.2_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fsessions%2F%5Bid%5D%2Fchance-of-sale%2Froute&page=%2Fapi%2Fsessions%2F%5Bid%5D%2Fchance-of-sale%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsessions%2F%5Bid%5D%2Fchance-of-sale%2Froute.ts&appDir=D%3A%5CDelta%20IV%5CSofwares%5Cglass%5Csandbox%5Cshadcn-crm-dashboard%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CDelta%20IV%5CSofwares%5Cglass%5Csandbox%5Cshadcn-crm-dashboard&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/next@15.2.2_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!*********************************************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/next@15.2.2_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \*********************************************************************************************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(rsc)/./src/app/api/sessions/[id]/chance-of-sale/route.ts":
/*!***********************************************************!*\
  !*** ./src/app/api/sessions/[id]/chance-of-sale/route.ts ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   runtime: () => (/* binding */ runtime)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/.pnpm/next@15.2.2_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/api/server.js\");\n/* harmony import */ var _supabase_ssr__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/ssr */ \"(rsc)/./node_modules/.pnpm/@supabase+ssr@0.7.0_@supabase+supabase-js@2.57.4/node_modules/@supabase/ssr/dist/module/index.js\");\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/.pnpm/next@15.2.2_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/api/headers.js\");\n/* harmony import */ var _server_repositories_reports_v3_tabs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/server/repositories/reports-v3-tabs */ \"(rsc)/./src/server/repositories/reports-v3-tabs.ts\");\n/* harmony import */ var _server_services_chance_of_sale_report__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/server/services/chance-of-sale-report */ \"(rsc)/./src/server/services/chance-of-sale-report.ts\");\n/* harmony import */ var _server_services_chance_of_sale_decision__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/server/services/chance-of-sale-decision */ \"(rsc)/./src/server/services/chance-of-sale-decision.ts\");\n\n\n\n\n\n\nasync function getServerClient() {\n    const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_2__.cookies)();\n    return (0,_supabase_ssr__WEBPACK_IMPORTED_MODULE_1__.createServerClient)(\"https://hewpwluinbwaizwqhmjc.supabase.co\", \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhld3B3bHVpbmJ3YWl6d3FobWpjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5MTU5NTEsImV4cCI6MjA3MjQ5MTk1MX0.jhKzLYPdixxI8zcH20kkzL1WgP9RB33FeHtO0FRY7r4\", {\n        cookies: {\n            getAll () {\n                return cookieStore.getAll();\n            },\n            setAll (cookiesToSet) {\n                cookiesToSet.forEach(({ name, value, options })=>cookieStore.set(name, value, options));\n            }\n        }\n    });\n}\nasync function GET(request, { params }) {\n    try {\n        const supabase = await getServerClient();\n        const { data: { user } } = await supabase.auth.getUser();\n        if (!user) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Unauthorized'\n        }, {\n            status: 401\n        });\n        const { id } = await params;\n        const repo = new _server_repositories_reports_v3_tabs__WEBPACK_IMPORTED_MODULE_3__.ReportsV3TabsRepository(supabase);\n        const row = await repo.findBySessionId(id, user.id);\n        if (!row) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Not found'\n        }, {\n            status: 404\n        });\n        const rep = row.report || {};\n        const base = typeof rep.markdown === 'string' && rep.markdown.trim().length > 0 ? rep.markdown : typeof rep.raw_markdown === 'string' && rep.raw_markdown.trim().length > 0 ? rep.raw_markdown : null;\n        // Extract only Chance of Sale portion (marker based)\n        let chance = null;\n        if (base) {\n            const start = base.indexOf('<!-- TAB: CHANCE OF SALE -->');\n            const end = base.indexOf('<!-- /TAB: CHANCE OF SALE -->');\n            chance = start >= 0 && end > start ? base.slice(start, end + '<!-- /TAB: CHANCE OF SALE -->'.length) : base;\n            // Strip markers (tolerate minor typos)\n            chance = chance.replace(/<!--[^]*?-->/g, '').replace(/<!-+\\s*\\/?\\s*(TAB|SECTION):[^]*?-->/gi, '').trim();\n        }\n        if (!chance) {\n            // Missing slice from a ready row -> treat as stale/missing and trigger regeneration, return failed to stop UI polling.\n            Promise.resolve().then(async ()=>{\n                try {\n                    await fetch(`${new URL(request.url).origin}/api/sessions/${id}/chance-of-sale`, {\n                        method: 'POST'\n                    });\n                } catch  {}\n            }).catch(()=>{});\n            const last_error = row?.last_error || 'TAB_MISSING_CHANCE_OF_SALE';\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                session_id: row.session_id,\n                markdown: null,\n                status: 'failed',\n                attempts: row.attempts,\n                last_error\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            session_id: row.session_id,\n            markdown: chance,\n            status: row.status,\n            attempts: row.attempts,\n            last_error: row.last_error\n        });\n    } catch (error) {\n        console.error('[chance-of-sale] GET error', error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Internal server error'\n        }, {\n            status: 500\n        });\n    }\n}\nasync function POST(request, { params }) {\n    try {\n        const supabase = await getServerClient();\n        const { data: { user } } = await supabase.auth.getUser();\n        if (!user) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Unauthorized'\n        }, {\n            status: 401\n        });\n        const { id } = await params;\n        // Rate limiting per user: max 3 CoS updates per 10 minutes\n        try {\n            const cutoff = new Date(Date.now() - 10 * 60 * 1000).toISOString();\n            const { data: recent, error: rlErr } = await supabase.from('cos_versions').select('id').eq('created_by', user.id).gte('created_at', cutoff);\n            if (!rlErr && (recent?.length || 0) >= 3) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: 'Rate limit exceeded: Try again later.'\n                }, {\n                    status: 429\n                });\n            }\n        } catch  {}\n        const decision = await (0,_server_services_chance_of_sale_decision__WEBPACK_IMPORTED_MODULE_5__.decideChanceOfSaleUpdate)(supabase, user.id, id);\n        if (decision.action === 'skip') {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                accepted: false,\n                decision\n            }, {\n                status: 200\n            });\n        }\n        // In-app generation preferred: If an existing CoS exists, run targeted patch; else full generation\n        Promise.resolve().then(async ()=>{\n            try {\n                const repo = new (await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! @/server/repositories/reports-v3-tabs */ \"(rsc)/./src/server/repositories/reports-v3-tabs.ts\"))).ReportsV3TabsRepository(supabase);\n                const row = await repo.findBySessionId(id, user.id);\n                const rep = row?.report || {};\n                const combined = typeof rep.markdown === 'string' && rep.markdown || typeof rep.raw_markdown === 'string' && rep.raw_markdown || '';\n                const hasCos = combined.includes('<!-- TAB: CHANCE OF SALE -->');\n                if (hasCos) {\n                    const { generateCosPatchFromModel } = await __webpack_require__.e(/*! import() */ \"_rsc_src_server_services_chance-of-sale-patch_ts\").then(__webpack_require__.bind(__webpack_require__, /*! @/server/services/chance-of-sale-patch */ \"(rsc)/./src/server/services/chance-of-sale-patch.ts\"));\n                    await generateCosPatchFromModel(supabase, user.id, id);\n                } else {\n                    await (0,_server_services_chance_of_sale_report__WEBPACK_IMPORTED_MODULE_4__.generateChanceOfSaleReport)(supabase, user.id, id);\n                }\n            } catch (e) {\n                console.error('[chance-of-sale] async generation error', e);\n                if (process.env.COS_USE_EDGE === 'true') {\n                    try {\n                        const projectUrl = \"https://hewpwluinbwaizwqhmjc.supabase.co\";\n                        const projectRef = new URL(projectUrl).hostname.split('.')[0];\n                        const fnUrl = `https://${projectRef}.supabase.co/functions/v1/generate-reports`;\n                        const auth = process.env.SUPABASE_SERVICE_ROLE_KEY || \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhld3B3bHVpbmJ3YWl6d3FobWpjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5MTU5NTEsImV4cCI6MjA3MjQ5MTk1MX0.jhKzLYPdixxI8zcH20kkzL1WgP9RB33FeHtO0FRY7r4\";\n                        await fetch(fnUrl, {\n                            method: 'POST',\n                            headers: {\n                                'Content-Type': 'application/json',\n                                'Authorization': `Bearer ${auth}`\n                            },\n                            body: JSON.stringify({\n                                session_id: id,\n                                decision\n                            })\n                        });\n                    } catch  {}\n                }\n            }\n        }).catch(()=>{});\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            accepted: true,\n            decision\n        }, {\n            status: 202\n        });\n    } catch (error) {\n        console.error('[chance-of-sale] POST error', error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Failed to trigger chance-of-sale generation'\n        }, {\n            status: 500\n        });\n    }\n}\nconst runtime = 'nodejs';\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9zZXNzaW9ucy9baWRdL2NoYW5jZS1vZi1zYWxlL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUF1RDtBQUNMO0FBQ1o7QUFDeUM7QUFDSztBQUNBO0FBRXBGLGVBQWVNO0lBQ2IsTUFBTUMsY0FBYyxNQUFNTCxxREFBT0E7SUFDakMsT0FBT0QsaUVBQWtCQSxDQUN2Qk8sMENBQW9DLEVBQ3BDQSxrTkFBeUMsRUFDekM7UUFDRU4sU0FBUztZQUNQVTtnQkFBVyxPQUFPTCxZQUFZSyxNQUFNO1lBQUc7WUFDdkNDLFFBQU9DLFlBQVk7Z0JBQUlBLGFBQWFDLE9BQU8sQ0FBQyxDQUFDLEVBQUVDLElBQUksRUFBRUMsS0FBSyxFQUFFQyxPQUFPLEVBQUUsR0FBS1gsWUFBWVksR0FBRyxDQUFDSCxNQUFNQyxPQUFPQztZQUFVO1FBQ25IO0lBQ0Y7QUFFSjtBQUVPLGVBQWVFLElBQ3BCQyxPQUFvQixFQUNwQixFQUFFQyxNQUFNLEVBQXVDO0lBRS9DLElBQUk7UUFDRixNQUFNQyxXQUFXLE1BQU1qQjtRQUN2QixNQUFNLEVBQUVrQixNQUFNLEVBQUVDLElBQUksRUFBRSxFQUFFLEdBQUcsTUFBTUYsU0FBU0csSUFBSSxDQUFDQyxPQUFPO1FBQ3RELElBQUksQ0FBQ0YsTUFBTSxPQUFPekIscURBQVlBLENBQUM0QixJQUFJLENBQUM7WUFBRUMsT0FBTztRQUFlLEdBQUc7WUFBRUMsUUFBUTtRQUFJO1FBQzdFLE1BQU0sRUFBRUMsRUFBRSxFQUFFLEdBQUcsTUFBTVQ7UUFDckIsTUFBTVUsT0FBTyxJQUFJN0IseUZBQXVCQSxDQUFDb0I7UUFDekMsTUFBTVUsTUFBTSxNQUFNRCxLQUFLRSxlQUFlLENBQUNILElBQUlOLEtBQUtNLEVBQUU7UUFDbEQsSUFBSSxDQUFDRSxLQUFLLE9BQU9qQyxxREFBWUEsQ0FBQzRCLElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQVksR0FBRztZQUFFQyxRQUFRO1FBQUk7UUFDekUsTUFBTUssTUFBVyxJQUFhQyxNQUFNLElBQUksQ0FBQztRQUN6QyxNQUFNQyxPQUFzQixPQUFRRixJQUFJRyxRQUFRLEtBQUssWUFBWUgsSUFBSUcsUUFBUSxDQUFDQyxJQUFJLEdBQUdDLE1BQU0sR0FBRyxJQUMxRkwsSUFBSUcsUUFBUSxHQUNaLE9BQVFILElBQUlNLFlBQVksS0FBSyxZQUFZTixJQUFJTSxZQUFZLENBQUNGLElBQUksR0FBR0MsTUFBTSxHQUFHLElBQ3hFTCxJQUFJTSxZQUFZLEdBQ2hCO1FBQ04scURBQXFEO1FBQ3JELElBQUlDLFNBQXdCO1FBQzVCLElBQUlMLE1BQU07WUFDUixNQUFNTSxRQUFRTixLQUFLTyxPQUFPLENBQUM7WUFDM0IsTUFBTUMsTUFBTVIsS0FBS08sT0FBTyxDQUFDO1lBQ3pCRixTQUFTLFNBQVUsS0FBS0csTUFBTUYsUUFBU04sS0FBS1MsS0FBSyxDQUFDSCxPQUFPRSxNQUFNLGdDQUFnQ0wsTUFBTSxJQUFJSDtZQUN6Ryx1Q0FBdUM7WUFDdkNLLFNBQVNBLE9BQ05LLE9BQU8sQ0FBQyxpQkFBaUIsSUFDekJBLE9BQU8sQ0FBQyx5Q0FBeUMsSUFDakRSLElBQUk7UUFDVDtRQUNBLElBQUksQ0FBQ0csUUFBUTtZQUNYLHVIQUF1SDtZQUN2SE0sUUFBUUMsT0FBTyxHQUFHQyxJQUFJLENBQUM7Z0JBQ3JCLElBQUk7b0JBQUUsTUFBTUMsTUFBTSxHQUFHLElBQUlDLElBQUkvQixRQUFRZ0MsR0FBRyxFQUFFQyxNQUFNLENBQUMsY0FBYyxFQUFFdkIsR0FBRyxlQUFlLENBQUMsRUFBRTt3QkFBRXdCLFFBQVE7b0JBQU87Z0JBQUcsRUFBRSxPQUFNLENBQUM7WUFDckgsR0FBR0MsS0FBSyxDQUFDLEtBQU87WUFDaEIsTUFBTUMsYUFBYXhCLEtBQUt3QixjQUFjO1lBQ3RDLE9BQU96RCxxREFBWUEsQ0FBQzRCLElBQUksQ0FBQztnQkFBRThCLFlBQVl6QixJQUFJeUIsVUFBVTtnQkFBRXBCLFVBQVU7Z0JBQU1SLFFBQVE7Z0JBQVU2QixVQUFVMUIsSUFBSTBCLFFBQVE7Z0JBQUVGO1lBQVc7UUFDOUg7UUFDQSxPQUFPekQscURBQVlBLENBQUM0QixJQUFJLENBQUM7WUFBRThCLFlBQVl6QixJQUFJeUIsVUFBVTtZQUFFcEIsVUFBVUk7WUFBUVosUUFBUUcsSUFBSUgsTUFBTTtZQUFFNkIsVUFBVTFCLElBQUkwQixRQUFRO1lBQUVGLFlBQVl4QixJQUFJd0IsVUFBVTtRQUFDO0lBQ2xKLEVBQUUsT0FBTzVCLE9BQU87UUFDZCtCLFFBQVEvQixLQUFLLENBQUMsOEJBQThCQTtRQUM1QyxPQUFPN0IscURBQVlBLENBQUM0QixJQUFJLENBQUM7WUFBRUMsT0FBTztRQUF3QixHQUFHO1lBQUVDLFFBQVE7UUFBSTtJQUM3RTtBQUNGO0FBRU8sZUFBZStCLEtBQ3BCeEMsT0FBb0IsRUFDcEIsRUFBRUMsTUFBTSxFQUF1QztJQUUvQyxJQUFJO1FBQ0YsTUFBTUMsV0FBVyxNQUFNakI7UUFDdkIsTUFBTSxFQUFFa0IsTUFBTSxFQUFFQyxJQUFJLEVBQUUsRUFBRSxHQUFHLE1BQU1GLFNBQVNHLElBQUksQ0FBQ0MsT0FBTztRQUN0RCxJQUFJLENBQUNGLE1BQU0sT0FBT3pCLHFEQUFZQSxDQUFDNEIsSUFBSSxDQUFDO1lBQUVDLE9BQU87UUFBZSxHQUFHO1lBQUVDLFFBQVE7UUFBSTtRQUM3RSxNQUFNLEVBQUVDLEVBQUUsRUFBRSxHQUFHLE1BQU1UO1FBRXJCLDJEQUEyRDtRQUMzRCxJQUFJO1lBQ0YsTUFBTXdDLFNBQVMsSUFBSUMsS0FBS0EsS0FBS0MsR0FBRyxLQUFLLEtBQUssS0FBSyxNQUFNQyxXQUFXO1lBQ2hFLE1BQU0sRUFBRXpDLE1BQU0wQyxNQUFNLEVBQUVyQyxPQUFPc0MsS0FBSyxFQUFFLEdBQUcsTUFBTSxTQUMxQ0MsSUFBSSxDQUFDLGdCQUNMQyxNQUFNLENBQUMsTUFDUEMsRUFBRSxDQUFDLGNBQWM3QyxLQUFLTSxFQUFFLEVBQ3hCd0MsR0FBRyxDQUFDLGNBQWNUO1lBQ3JCLElBQUksQ0FBQ0ssU0FBUyxDQUFDRCxRQUFRMUIsVUFBVSxNQUFNLEdBQUc7Z0JBQ3hDLE9BQU94QyxxREFBWUEsQ0FBQzRCLElBQUksQ0FBQztvQkFBRUMsT0FBTztnQkFBd0MsR0FBRztvQkFBRUMsUUFBUTtnQkFBSTtZQUM3RjtRQUNGLEVBQUUsT0FBTSxDQUFDO1FBRVQsTUFBTTBDLFdBQVcsTUFBTW5FLGtHQUF3QkEsQ0FBQ2tCLFVBQWlCRSxLQUFLTSxFQUFFLEVBQUVBO1FBQzFFLElBQUl5QyxTQUFTQyxNQUFNLEtBQUssUUFBUTtZQUM5QixPQUFPekUscURBQVlBLENBQUM0QixJQUFJLENBQUM7Z0JBQUU4QyxVQUFVO2dCQUFPRjtZQUFTLEdBQUc7Z0JBQUUxQyxRQUFRO1lBQUk7UUFDeEU7UUFFQSxtR0FBbUc7UUFDbkdrQixRQUFRQyxPQUFPLEdBQUdDLElBQUksQ0FBQztZQUNyQixJQUFJO2dCQUNGLE1BQU1sQixPQUFPLElBQUksQ0FBQyxNQUFNLHVMQUE4QyxFQUFHN0IsdUJBQXVCLENBQUNvQjtnQkFDakcsTUFBTVUsTUFBTSxNQUFNRCxLQUFLRSxlQUFlLENBQUNILElBQUlOLEtBQUtNLEVBQUU7Z0JBQ2xELE1BQU1JLE1BQVcsS0FBTUMsVUFBa0IsQ0FBQztnQkFDMUMsTUFBTXVDLFdBQW1CLE9BQVF4QyxJQUFJRyxRQUFRLEtBQUssWUFBWUgsSUFBSUcsUUFBUSxJQUFNLE9BQU9ILElBQUlNLFlBQVksS0FBSyxZQUFZTixJQUFJTSxZQUFZLElBQUs7Z0JBQzdJLE1BQU1tQyxTQUFTRCxTQUFTRSxRQUFRLENBQUM7Z0JBQ2pDLElBQUlELFFBQVE7b0JBQ1YsTUFBTSxFQUFFRSx5QkFBeUIsRUFBRSxHQUFHLE1BQU0sa1BBQWdEO29CQUM1RixNQUFNQSwwQkFBMEJ2RCxVQUFpQkUsS0FBS00sRUFBRSxFQUFFQTtnQkFDNUQsT0FBTztvQkFDTCxNQUFNM0Isa0dBQTBCQSxDQUFDbUIsVUFBaUJFLEtBQUtNLEVBQUUsRUFBRUE7Z0JBQzdEO1lBQ0YsRUFBRSxPQUFPZ0QsR0FBRztnQkFDVm5CLFFBQVEvQixLQUFLLENBQUMsMkNBQTJDa0Q7Z0JBQ3pELElBQUl2RSxRQUFRQyxHQUFHLENBQUN1RSxZQUFZLEtBQUssUUFBUTtvQkFDdkMsSUFBSTt3QkFDRixNQUFNQyxhQUFhekUsMENBQW9DO3dCQUN2RCxNQUFNMEUsYUFBYSxJQUFJOUIsSUFBSTZCLFlBQVlFLFFBQVEsQ0FBQ0MsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFO3dCQUM3RCxNQUFNQyxRQUFRLENBQUMsUUFBUSxFQUFFSCxXQUFXLDBDQUEwQyxDQUFDO3dCQUMvRSxNQUFNeEQsT0FBT2xCLFFBQVFDLEdBQUcsQ0FBQzZFLHlCQUF5QixJQUFJOUUsa05BQXlDO3dCQUMvRixNQUFNMkMsTUFBTWtDLE9BQU87NEJBQUU5QixRQUFROzRCQUFRZ0MsU0FBUztnQ0FBRSxnQkFBZ0I7Z0NBQW9CLGlCQUFpQixDQUFDLE9BQU8sRUFBRTdELE1BQU07NEJBQUM7NEJBQUc4RCxNQUFNQyxLQUFLQyxTQUFTLENBQUM7Z0NBQUVoQyxZQUFZM0I7Z0NBQUl5Qzs0QkFBUzt3QkFBRztvQkFDOUssRUFBRSxPQUFNLENBQUM7Z0JBQ1g7WUFDRjtRQUNGLEdBQUdoQixLQUFLLENBQUMsS0FBTztRQUVoQixPQUFPeEQscURBQVlBLENBQUM0QixJQUFJLENBQUM7WUFBRThDLFVBQVU7WUFBTUY7UUFBUyxHQUFHO1lBQUUxQyxRQUFRO1FBQUk7SUFDdkUsRUFBRSxPQUFPRCxPQUFPO1FBQ2QrQixRQUFRL0IsS0FBSyxDQUFDLCtCQUErQkE7UUFDN0MsT0FBTzdCLHFEQUFZQSxDQUFDNEIsSUFBSSxDQUFDO1lBQUVDLE9BQU87UUFBOEMsR0FBRztZQUFFQyxRQUFRO1FBQUk7SUFDbkc7QUFDRjtBQUNPLE1BQU02RCxVQUFVLFNBQVEiLCJzb3VyY2VzIjpbIkQ6XFxEZWx0YSBJVlxcU29md2FyZXNcXGdsYXNzXFxzYW5kYm94XFxzaGFkY24tY3JtLWRhc2hib2FyZFxcc3JjXFxhcHBcXGFwaVxcc2Vzc2lvbnNcXFtpZF1cXGNoYW5jZS1vZi1zYWxlXFxyb3V0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInXG5pbXBvcnQgeyBjcmVhdGVTZXJ2ZXJDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3NyJ1xuaW1wb3J0IHsgY29va2llcyB9IGZyb20gJ25leHQvaGVhZGVycydcbmltcG9ydCB7IFJlcG9ydHNWM1RhYnNSZXBvc2l0b3J5IH0gZnJvbSAnQC9zZXJ2ZXIvcmVwb3NpdG9yaWVzL3JlcG9ydHMtdjMtdGFicydcbmltcG9ydCB7IGdlbmVyYXRlQ2hhbmNlT2ZTYWxlUmVwb3J0IH0gZnJvbSAnQC9zZXJ2ZXIvc2VydmljZXMvY2hhbmNlLW9mLXNhbGUtcmVwb3J0J1xuaW1wb3J0IHsgZGVjaWRlQ2hhbmNlT2ZTYWxlVXBkYXRlIH0gZnJvbSAnQC9zZXJ2ZXIvc2VydmljZXMvY2hhbmNlLW9mLXNhbGUtZGVjaXNpb24nXG5cbmFzeW5jIGZ1bmN0aW9uIGdldFNlcnZlckNsaWVudCgpIHtcbiAgY29uc3QgY29va2llU3RvcmUgPSBhd2FpdCBjb29raWVzKClcbiAgcmV0dXJuIGNyZWF0ZVNlcnZlckNsaWVudChcbiAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwhLFxuICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZISxcbiAgICB7XG4gICAgICBjb29raWVzOiB7XG4gICAgICAgIGdldEFsbCgpIHsgcmV0dXJuIGNvb2tpZVN0b3JlLmdldEFsbCgpIH0sXG4gICAgICAgIHNldEFsbChjb29raWVzVG9TZXQpIHsgY29va2llc1RvU2V0LmZvckVhY2goKHsgbmFtZSwgdmFsdWUsIG9wdGlvbnMgfSkgPT4gY29va2llU3RvcmUuc2V0KG5hbWUsIHZhbHVlLCBvcHRpb25zKSkgfSxcbiAgICAgIH0sXG4gICAgfVxuICApXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQoXG4gIHJlcXVlc3Q6IE5leHRSZXF1ZXN0LFxuICB7IHBhcmFtcyB9OiB7IHBhcmFtczogUHJvbWlzZTx7IGlkOiBzdHJpbmcgfT4gfVxuKSB7XG4gIHRyeSB7XG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBnZXRTZXJ2ZXJDbGllbnQoKVxuICAgIGNvbnN0IHsgZGF0YTogeyB1c2VyIH0gfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpXG4gICAgaWYgKCF1c2VyKSByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ1VuYXV0aG9yaXplZCcgfSwgeyBzdGF0dXM6IDQwMSB9KVxuICAgIGNvbnN0IHsgaWQgfSA9IGF3YWl0IHBhcmFtc1xuICAgIGNvbnN0IHJlcG8gPSBuZXcgUmVwb3J0c1YzVGFic1JlcG9zaXRvcnkoc3VwYWJhc2UgYXMgYW55KVxuICAgIGNvbnN0IHJvdyA9IGF3YWl0IHJlcG8uZmluZEJ5U2Vzc2lvbklkKGlkLCB1c2VyLmlkKVxuICAgIGlmICghcm93KSByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ05vdCBmb3VuZCcgfSwgeyBzdGF0dXM6IDQwNCB9KVxuICAgIGNvbnN0IHJlcDogYW55ID0gKHJvdyBhcyBhbnkpLnJlcG9ydCB8fCB7fVxuICAgIGNvbnN0IGJhc2U6IHN0cmluZyB8IG51bGwgPSAodHlwZW9mIHJlcC5tYXJrZG93biA9PT0gJ3N0cmluZycgJiYgcmVwLm1hcmtkb3duLnRyaW0oKS5sZW5ndGggPiAwKVxuICAgICAgPyByZXAubWFya2Rvd25cbiAgICAgIDogKHR5cGVvZiByZXAucmF3X21hcmtkb3duID09PSAnc3RyaW5nJyAmJiByZXAucmF3X21hcmtkb3duLnRyaW0oKS5sZW5ndGggPiAwKVxuICAgICAgICA/IHJlcC5yYXdfbWFya2Rvd25cbiAgICAgICAgOiBudWxsXG4gICAgLy8gRXh0cmFjdCBvbmx5IENoYW5jZSBvZiBTYWxlIHBvcnRpb24gKG1hcmtlciBiYXNlZClcbiAgICBsZXQgY2hhbmNlOiBzdHJpbmcgfCBudWxsID0gbnVsbFxuICAgIGlmIChiYXNlKSB7XG4gICAgICBjb25zdCBzdGFydCA9IGJhc2UuaW5kZXhPZignPCEtLSBUQUI6IENIQU5DRSBPRiBTQUxFIC0tPicpXG4gICAgICBjb25zdCBlbmQgPSBiYXNlLmluZGV4T2YoJzwhLS0gL1RBQjogQ0hBTkNFIE9GIFNBTEUgLS0+JylcbiAgICAgIGNoYW5jZSA9IChzdGFydCA+PSAwICYmIGVuZCA+IHN0YXJ0KSA/IGJhc2Uuc2xpY2Uoc3RhcnQsIGVuZCArICc8IS0tIC9UQUI6IENIQU5DRSBPRiBTQUxFIC0tPicubGVuZ3RoKSA6IGJhc2VcbiAgICAgIC8vIFN0cmlwIG1hcmtlcnMgKHRvbGVyYXRlIG1pbm9yIHR5cG9zKVxuICAgICAgY2hhbmNlID0gY2hhbmNlXG4gICAgICAgIC5yZXBsYWNlKC88IS0tW15dKj8tLT4vZywgJycpXG4gICAgICAgIC5yZXBsYWNlKC88IS0rXFxzKlxcLz9cXHMqKFRBQnxTRUNUSU9OKTpbXl0qPy0tPi9naSwgJycpXG4gICAgICAgIC50cmltKClcbiAgICB9XG4gICAgaWYgKCFjaGFuY2UpIHtcbiAgICAgIC8vIE1pc3Npbmcgc2xpY2UgZnJvbSBhIHJlYWR5IHJvdyAtPiB0cmVhdCBhcyBzdGFsZS9taXNzaW5nIGFuZCB0cmlnZ2VyIHJlZ2VuZXJhdGlvbiwgcmV0dXJuIGZhaWxlZCB0byBzdG9wIFVJIHBvbGxpbmcuXG4gICAgICBQcm9taXNlLnJlc29sdmUoKS50aGVuKGFzeW5jICgpID0+IHtcbiAgICAgICAgdHJ5IHsgYXdhaXQgZmV0Y2goYCR7bmV3IFVSTChyZXF1ZXN0LnVybCkub3JpZ2lufS9hcGkvc2Vzc2lvbnMvJHtpZH0vY2hhbmNlLW9mLXNhbGVgLCB7IG1ldGhvZDogJ1BPU1QnIH0pIH0gY2F0Y2gge31cbiAgICAgIH0pLmNhdGNoKCgpID0+IHt9KVxuICAgICAgY29uc3QgbGFzdF9lcnJvciA9IHJvdz8ubGFzdF9lcnJvciB8fCAnVEFCX01JU1NJTkdfQ0hBTkNFX09GX1NBTEUnXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBzZXNzaW9uX2lkOiByb3cuc2Vzc2lvbl9pZCwgbWFya2Rvd246IG51bGwsIHN0YXR1czogJ2ZhaWxlZCcsIGF0dGVtcHRzOiByb3cuYXR0ZW1wdHMsIGxhc3RfZXJyb3IgfSlcbiAgICB9XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgc2Vzc2lvbl9pZDogcm93LnNlc3Npb25faWQsIG1hcmtkb3duOiBjaGFuY2UsIHN0YXR1czogcm93LnN0YXR1cywgYXR0ZW1wdHM6IHJvdy5hdHRlbXB0cywgbGFzdF9lcnJvcjogcm93Lmxhc3RfZXJyb3IgfSlcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbY2hhbmNlLW9mLXNhbGVdIEdFVCBlcnJvcicsIGVycm9yKVxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyB9LCB7IHN0YXR1czogNTAwIH0pXG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QoXG4gIHJlcXVlc3Q6IE5leHRSZXF1ZXN0LFxuICB7IHBhcmFtcyB9OiB7IHBhcmFtczogUHJvbWlzZTx7IGlkOiBzdHJpbmcgfT4gfVxuKSB7XG4gIHRyeSB7XG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBnZXRTZXJ2ZXJDbGllbnQoKVxuICAgIGNvbnN0IHsgZGF0YTogeyB1c2VyIH0gfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpXG4gICAgaWYgKCF1c2VyKSByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ1VuYXV0aG9yaXplZCcgfSwgeyBzdGF0dXM6IDQwMSB9KVxuICAgIGNvbnN0IHsgaWQgfSA9IGF3YWl0IHBhcmFtc1xuXG4gICAgLy8gUmF0ZSBsaW1pdGluZyBwZXIgdXNlcjogbWF4IDMgQ29TIHVwZGF0ZXMgcGVyIDEwIG1pbnV0ZXNcbiAgICB0cnkge1xuICAgICAgY29uc3QgY3V0b2ZmID0gbmV3IERhdGUoRGF0ZS5ub3coKSAtIDEwICogNjAgKiAxMDAwKS50b0lTT1N0cmluZygpXG4gICAgICBjb25zdCB7IGRhdGE6IHJlY2VudCwgZXJyb3I6IHJsRXJyIH0gPSBhd2FpdCAoc3VwYWJhc2UgYXMgYW55KVxuICAgICAgICAuZnJvbSgnY29zX3ZlcnNpb25zJylcbiAgICAgICAgLnNlbGVjdCgnaWQnKVxuICAgICAgICAuZXEoJ2NyZWF0ZWRfYnknLCB1c2VyLmlkKVxuICAgICAgICAuZ3RlKCdjcmVhdGVkX2F0JywgY3V0b2ZmKVxuICAgICAgaWYgKCFybEVyciAmJiAocmVjZW50Py5sZW5ndGggfHwgMCkgPj0gMykge1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ1JhdGUgbGltaXQgZXhjZWVkZWQ6IFRyeSBhZ2FpbiBsYXRlci4nIH0sIHsgc3RhdHVzOiA0MjkgfSlcbiAgICAgIH1cbiAgICB9IGNhdGNoIHt9XG5cbiAgICBjb25zdCBkZWNpc2lvbiA9IGF3YWl0IGRlY2lkZUNoYW5jZU9mU2FsZVVwZGF0ZShzdXBhYmFzZSBhcyBhbnksIHVzZXIuaWQsIGlkKVxuICAgIGlmIChkZWNpc2lvbi5hY3Rpb24gPT09ICdza2lwJykge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgYWNjZXB0ZWQ6IGZhbHNlLCBkZWNpc2lvbiB9LCB7IHN0YXR1czogMjAwIH0pXG4gICAgfVxuXG4gICAgLy8gSW4tYXBwIGdlbmVyYXRpb24gcHJlZmVycmVkOiBJZiBhbiBleGlzdGluZyBDb1MgZXhpc3RzLCBydW4gdGFyZ2V0ZWQgcGF0Y2g7IGVsc2UgZnVsbCBnZW5lcmF0aW9uXG4gICAgUHJvbWlzZS5yZXNvbHZlKCkudGhlbihhc3luYyAoKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCByZXBvID0gbmV3IChhd2FpdCBpbXBvcnQoJ0Avc2VydmVyL3JlcG9zaXRvcmllcy9yZXBvcnRzLXYzLXRhYnMnKSkuUmVwb3J0c1YzVGFic1JlcG9zaXRvcnkoc3VwYWJhc2UgYXMgYW55KVxuICAgICAgICBjb25zdCByb3cgPSBhd2FpdCByZXBvLmZpbmRCeVNlc3Npb25JZChpZCwgdXNlci5pZClcbiAgICAgICAgY29uc3QgcmVwOiBhbnkgPSAocm93Py5yZXBvcnQgYXMgYW55KSB8fCB7fVxuICAgICAgICBjb25zdCBjb21iaW5lZDogc3RyaW5nID0gKHR5cGVvZiByZXAubWFya2Rvd24gPT09ICdzdHJpbmcnICYmIHJlcC5tYXJrZG93bikgfHwgKHR5cGVvZiByZXAucmF3X21hcmtkb3duID09PSAnc3RyaW5nJyAmJiByZXAucmF3X21hcmtkb3duKSB8fCAnJ1xuICAgICAgICBjb25zdCBoYXNDb3MgPSBjb21iaW5lZC5pbmNsdWRlcygnPCEtLSBUQUI6IENIQU5DRSBPRiBTQUxFIC0tPicpXG4gICAgICAgIGlmIChoYXNDb3MpIHtcbiAgICAgICAgICBjb25zdCB7IGdlbmVyYXRlQ29zUGF0Y2hGcm9tTW9kZWwgfSA9IGF3YWl0IGltcG9ydCgnQC9zZXJ2ZXIvc2VydmljZXMvY2hhbmNlLW9mLXNhbGUtcGF0Y2gnKVxuICAgICAgICAgIGF3YWl0IGdlbmVyYXRlQ29zUGF0Y2hGcm9tTW9kZWwoc3VwYWJhc2UgYXMgYW55LCB1c2VyLmlkLCBpZClcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBhd2FpdCBnZW5lcmF0ZUNoYW5jZU9mU2FsZVJlcG9ydChzdXBhYmFzZSBhcyBhbnksIHVzZXIuaWQsIGlkKVxuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tjaGFuY2Utb2Ytc2FsZV0gYXN5bmMgZ2VuZXJhdGlvbiBlcnJvcicsIGUpXG4gICAgICAgIGlmIChwcm9jZXNzLmVudi5DT1NfVVNFX0VER0UgPT09ICd0cnVlJykge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBwcm9qZWN0VXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIVxuICAgICAgICAgICAgY29uc3QgcHJvamVjdFJlZiA9IG5ldyBVUkwocHJvamVjdFVybCkuaG9zdG5hbWUuc3BsaXQoJy4nKVswXVxuICAgICAgICAgICAgY29uc3QgZm5VcmwgPSBgaHR0cHM6Ly8ke3Byb2plY3RSZWZ9LnN1cGFiYXNlLmNvL2Z1bmN0aW9ucy92MS9nZW5lcmF0ZS1yZXBvcnRzYFxuICAgICAgICAgICAgY29uc3QgYXV0aCA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkgfHwgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkhXG4gICAgICAgICAgICBhd2FpdCBmZXRjaChmblVybCwgeyBtZXRob2Q6ICdQT1NUJywgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLCAnQXV0aG9yaXphdGlvbic6IGBCZWFyZXIgJHthdXRofWAgfSwgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBzZXNzaW9uX2lkOiBpZCwgZGVjaXNpb24gfSkgfSlcbiAgICAgICAgICB9IGNhdGNoIHt9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KS5jYXRjaCgoKSA9PiB7fSlcblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGFjY2VwdGVkOiB0cnVlLCBkZWNpc2lvbiB9LCB7IHN0YXR1czogMjAyIH0pXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW2NoYW5jZS1vZi1zYWxlXSBQT1NUIGVycm9yJywgZXJyb3IpXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdGYWlsZWQgdG8gdHJpZ2dlciBjaGFuY2Utb2Ytc2FsZSBnZW5lcmF0aW9uJyB9LCB7IHN0YXR1czogNTAwIH0pXG4gIH1cbn1cbmV4cG9ydCBjb25zdCBydW50aW1lID0gJ25vZGVqcydcbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJjcmVhdGVTZXJ2ZXJDbGllbnQiLCJjb29raWVzIiwiUmVwb3J0c1YzVGFic1JlcG9zaXRvcnkiLCJnZW5lcmF0ZUNoYW5jZU9mU2FsZVJlcG9ydCIsImRlY2lkZUNoYW5jZU9mU2FsZVVwZGF0ZSIsImdldFNlcnZlckNsaWVudCIsImNvb2tpZVN0b3JlIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIiwiZ2V0QWxsIiwic2V0QWxsIiwiY29va2llc1RvU2V0IiwiZm9yRWFjaCIsIm5hbWUiLCJ2YWx1ZSIsIm9wdGlvbnMiLCJzZXQiLCJHRVQiLCJyZXF1ZXN0IiwicGFyYW1zIiwic3VwYWJhc2UiLCJkYXRhIiwidXNlciIsImF1dGgiLCJnZXRVc2VyIiwianNvbiIsImVycm9yIiwic3RhdHVzIiwiaWQiLCJyZXBvIiwicm93IiwiZmluZEJ5U2Vzc2lvbklkIiwicmVwIiwicmVwb3J0IiwiYmFzZSIsIm1hcmtkb3duIiwidHJpbSIsImxlbmd0aCIsInJhd19tYXJrZG93biIsImNoYW5jZSIsInN0YXJ0IiwiaW5kZXhPZiIsImVuZCIsInNsaWNlIiwicmVwbGFjZSIsIlByb21pc2UiLCJyZXNvbHZlIiwidGhlbiIsImZldGNoIiwiVVJMIiwidXJsIiwib3JpZ2luIiwibWV0aG9kIiwiY2F0Y2giLCJsYXN0X2Vycm9yIiwic2Vzc2lvbl9pZCIsImF0dGVtcHRzIiwiY29uc29sZSIsIlBPU1QiLCJjdXRvZmYiLCJEYXRlIiwibm93IiwidG9JU09TdHJpbmciLCJyZWNlbnQiLCJybEVyciIsImZyb20iLCJzZWxlY3QiLCJlcSIsImd0ZSIsImRlY2lzaW9uIiwiYWN0aW9uIiwiYWNjZXB0ZWQiLCJjb21iaW5lZCIsImhhc0NvcyIsImluY2x1ZGVzIiwiZ2VuZXJhdGVDb3NQYXRjaEZyb21Nb2RlbCIsImUiLCJDT1NfVVNFX0VER0UiLCJwcm9qZWN0VXJsIiwicHJvamVjdFJlZiIsImhvc3RuYW1lIiwic3BsaXQiLCJmblVybCIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiLCJoZWFkZXJzIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJydW50aW1lIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/sessions/[id]/chance-of-sale/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/repositories/reports-v3-tabs.ts":
/*!****************************************************!*\
  !*** ./src/server/repositories/reports-v3-tabs.ts ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ReportsV3TabsRepository: () => (/* binding */ ReportsV3TabsRepository)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/.pnpm/@supabase+supabase-js@2.57.4/node_modules/@supabase/supabase-js/dist/module/index.js\");\n\nconst supabaseUrl = \"https://hewpwluinbwaizwqhmjc.supabase.co\";\nconst supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhld3B3bHVpbmJ3YWl6d3FobWpjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5MTU5NTEsImV4cCI6MjA3MjQ5MTk1MX0.jhKzLYPdixxI8zcH20kkzL1WgP9RB33FeHtO0FRY7r4\";\nconst defaultClient = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey);\nfunction mapDbReportTabs(row) {\n    return {\n        session_id: row.session_id,\n        report: row.report_json && Object.keys(row.report_json).length > 0 ? row.report_json : null,\n        status: row.status,\n        attempts: row.attempts ?? 0,\n        last_error: row.last_error ?? null,\n        created_at: row.created_at,\n        updated_at: row.updated_at\n    };\n}\nclass ReportsV3TabsRepository {\n    constructor(supabase = defaultClient){\n        this.supabase = supabase;\n    }\n    async findBySessionId(sessionId, _userId) {\n        const { data: row, error } = await this.supabase.from('session_reports_v3_tabs').select('session_id, report_json, status, attempts, last_error, created_at, updated_at').eq('session_id', sessionId).single();\n        if (error) {\n            if (error.code === 'PGRST116') return null;\n            console.error('[reports-v3-tabs] findBySessionId error', {\n                code: error.code,\n                message: error.message,\n                sessionId\n            });\n            return null;\n        }\n        return mapDbReportTabs(row);\n    }\n    async upsertQueued(sessionId) {\n        const payload = {\n            session_id: sessionId,\n            status: 'queued',\n            report_json: {},\n            attempts: 0,\n            last_error: null\n        };\n        const { data, error } = await this.supabase.from('session_reports_v3_tabs').upsert(payload, {\n            onConflict: 'session_id'\n        }).select('session_id, report_json, status, attempts, last_error, created_at, updated_at').single();\n        if (error) throw new Error(`Failed to upsert queued tabs report: ${error.message}`);\n        return mapDbReportTabs(data);\n    }\n    async setRunning(sessionId) {\n        const { data, error } = await this.supabase.from('session_reports_v3_tabs').update({\n            status: 'running'\n        }).eq('session_id', sessionId).select('session_id, report_json, status, attempts, last_error, created_at, updated_at').single();\n        if (error) throw new Error(`Failed to set tabs running: ${error.message}`);\n        return mapDbReportTabs(data);\n    }\n    async incrementAttempts(sessionId) {\n        const { data, error } = await this.supabase.rpc('increment_report_tabs_attempts', {\n            p_session_id: sessionId\n        });\n        // If helper function not present, fall back to update with expression\n        if (error) {\n            const { data: row, error: updErr } = await this.supabase.from('session_reports_v3_tabs').update({\n                attempts: await (async ()=>{\n                    const { data: cur } = await this.supabase.from('session_reports_v3_tabs').select('attempts').eq('session_id', sessionId).single();\n                    return (cur?.attempts ?? 0) + 1;\n                })()\n            }).eq('session_id', sessionId).select('session_id, report_json, status, attempts, last_error, created_at, updated_at').single();\n            if (updErr) throw new Error(`Failed to increment tabs attempts: ${updErr.message}`);\n            return mapDbReportTabs(row);\n        }\n        // If RPC succeeded, fetch to map\n        const { data: row2, error: selErr } = await this.supabase.from('session_reports_v3_tabs').select('session_id, report_json, status, attempts, last_error, created_at, updated_at').eq('session_id', sessionId).single();\n        if (selErr) throw new Error(`Failed to fetch tabs attempts: ${selErr.message}`);\n        return mapDbReportTabs(row2);\n    }\n    async setReady(sessionId, report) {\n        const { data, error } = await this.supabase.from('session_reports_v3_tabs').update({\n            status: 'ready',\n            report_json: report,\n            last_error: null\n        }).eq('session_id', sessionId).select('session_id, report_json, status, attempts, last_error, created_at, updated_at').single();\n        if (error) throw new Error(`Failed to set tabs ready: ${error.message}`);\n        return mapDbReportTabs(data);\n    }\n    async setFailed(sessionId, errorMsg) {\n        const { data, error } = await this.supabase.from('session_reports_v3_tabs').update({\n            status: 'failed',\n            last_error: errorMsg\n        }).eq('session_id', sessionId).select('session_id, report_json, status, attempts, last_error, created_at, updated_at').single();\n        if (error) throw new Error(`Failed to set tabs failed: ${error.message}`);\n        return mapDbReportTabs(data);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3JlcG9zaXRvcmllcy9yZXBvcnRzLXYzLXRhYnMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBb0Q7QUFFcEQsTUFBTUMsY0FBY0MsMENBQW9DO0FBQ3hELE1BQU1HLGtCQUFrQkgsa05BQXlDO0FBQ2pFLE1BQU1LLGdCQUFnQlAsbUVBQVlBLENBQUNDLGFBQWFJO0FBTWhELFNBQVNHLGdCQUFnQkMsR0FBUTtJQUNoQyxPQUFPO1FBQ05DLFlBQVlELElBQUlDLFVBQVU7UUFDMUJDLFFBQVEsSUFBS0MsV0FBVyxJQUFJQyxPQUFPQyxJQUFJLENBQUNMLElBQUlHLFdBQVcsRUFBRUcsTUFBTSxHQUFHLElBQUtOLElBQUlHLFdBQVcsR0FBRztRQUN6RkksUUFBUVAsSUFBSU8sTUFBTTtRQUNsQkMsVUFBVVIsSUFBSVEsUUFBUSxJQUFJO1FBQzFCQyxZQUFZVCxJQUFJUyxVQUFVLElBQUk7UUFDOUJDLFlBQVlWLElBQUlVLFVBQVU7UUFDMUJDLFlBQVlYLElBQUlXLFVBQVU7SUFDM0I7QUFDRDtBQUVPLE1BQU1DO0lBQ1pDLFlBQVksV0FBc0NmLGFBQWEsQ0FBRTthQUE3Q2dCLFdBQUFBO0lBQThDO0lBRWxFLE1BQU1DLGdCQUFnQkMsU0FBaUIsRUFBRUMsT0FBZSxFQUFFO1FBQ3pELE1BQU0sRUFBRUMsTUFBTWxCLEdBQUcsRUFBRW1CLEtBQUssRUFBRSxHQUFHLE1BQU0sSUFBSSxDQUFDTCxRQUFRLENBQzlDTSxJQUFJLENBQUMsMkJBQ0xDLE1BQU0sQ0FBQyxpRkFDUEMsRUFBRSxDQUFDLGNBQWNOLFdBQ2pCTyxNQUFNO1FBQ1IsSUFBSUosT0FBTztZQUNWLElBQUksTUFBZUssSUFBSSxLQUFLLFlBQVksT0FBTztZQUMvQ0MsUUFBUU4sS0FBSyxDQUFDLDJDQUEyQztnQkFBRUssTUFBTSxNQUFlQSxJQUFJO2dCQUFFRSxTQUFTUCxNQUFNTyxPQUFPO2dCQUFFVjtZQUFVO1lBQ3hILE9BQU87UUFDUjtRQUNBLE9BQU9qQixnQkFBZ0JD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QUMsMEJBQTBCLEVBQUVaLE1BQU1PLE9BQU8sRUFBRTtRQUN2RSxPQUFPM0IsZ0JBQWdCbUI7SUFDeEI7SUFFQSxNQUFNd0IsVUFBVTFCLFNBQWlCLEVBQUUyQixRQUFnQixFQUFFO1FBQ3BELE1BQU0sRUFBRXpCLElBQUksRUFBRUMsS0FBSyxFQUFFLEdBQUcsTUFBTSxJQUFJLENBQUNMLFFBQVEsQ0FDekNNLElBQUksQ0FBQywyQkFDTGEsTUFBTSxDQUFDO1lBQUUxQixRQUFRO1lBQVVFLFlBQVlrQztRQUFTLEdBQ2hEckIsRUFBRSxDQUFDLGNBQWNOLFdBQ2pCSyxNQUFNLENBQUMsaUZBQ1BFLE1BQU07UUFDUixJQUFJSixPQUFPLE1BQU0sSUFBSVksTUFBTSxDQUFDLDJCQUEyQixFQUFFWixNQUFNTyxPQUFPLEVBQUU7UUFDeEUsT0FBTzNCLGdCQUFnQm1CO0lBQ3hCO0FBQ0QiLCJzb3VyY2VzIjpbIkQ6XFxEZWx0YSBJVlxcU29md2FyZXNcXGdsYXNzXFxzYW5kYm94XFxzaGFkY24tY3JtLWRhc2hib2FyZFxcc3JjXFxzZXJ2ZXJcXHJlcG9zaXRvcmllc1xccmVwb3J0cy12My10YWJzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcydcclxuXHJcbmNvbnN0IHN1cGFiYXNlVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIVxyXG5jb25zdCBzdXBhYmFzZUFub25LZXkgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSFcclxuY29uc3QgZGVmYXVsdENsaWVudCA9IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VBbm9uS2V5KVxyXG5cclxudHlwZSBTdXBhYmFzZUNsaWVudEFueSA9IHR5cGVvZiBkZWZhdWx0Q2xpZW50XHJcblxyXG5leHBvcnQgdHlwZSBSZXBvcnREYXRhVjNUYWJzID0gYW55XHJcblxyXG5mdW5jdGlvbiBtYXBEYlJlcG9ydFRhYnMocm93OiBhbnkpOiB7IHNlc3Npb25faWQ6IHN0cmluZzsgcmVwb3J0OiBSZXBvcnREYXRhVjNUYWJzIHwgbnVsbDsgc3RhdHVzOiBzdHJpbmc7IGF0dGVtcHRzOiBudW1iZXI7IGxhc3RfZXJyb3I/OiBzdHJpbmcgfCBudWxsOyBjcmVhdGVkX2F0Pzogc3RyaW5nOyB1cGRhdGVkX2F0Pzogc3RyaW5nIH0ge1xyXG5cdHJldHVybiB7XHJcblx0XHRzZXNzaW9uX2lkOiByb3cuc2Vzc2lvbl9pZCxcclxuXHRcdHJlcG9ydDogKHJvdy5yZXBvcnRfanNvbiAmJiBPYmplY3Qua2V5cyhyb3cucmVwb3J0X2pzb24pLmxlbmd0aCA+IDApID8gcm93LnJlcG9ydF9qc29uIDogbnVsbCxcclxuXHRcdHN0YXR1czogcm93LnN0YXR1cyxcclxuXHRcdGF0dGVtcHRzOiByb3cuYXR0ZW1wdHMgPz8gMCxcclxuXHRcdGxhc3RfZXJyb3I6IHJvdy5sYXN0X2Vycm9yID8/IG51bGwsXHJcblx0XHRjcmVhdGVkX2F0OiByb3cuY3JlYXRlZF9hdCxcclxuXHRcdHVwZGF0ZWRfYXQ6IHJvdy51cGRhdGVkX2F0LFxyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFJlcG9ydHNWM1RhYnNSZXBvc2l0b3J5IHtcclxuXHRjb25zdHJ1Y3Rvcihwcml2YXRlIHN1cGFiYXNlOiBTdXBhYmFzZUNsaWVudEFueSA9IGRlZmF1bHRDbGllbnQpIHt9XHJcblxyXG5cdGFzeW5jIGZpbmRCeVNlc3Npb25JZChzZXNzaW9uSWQ6IHN0cmluZywgX3VzZXJJZDogc3RyaW5nKSB7XHJcblx0XHRjb25zdCB7IGRhdGE6IHJvdywgZXJyb3IgfSA9IGF3YWl0IHRoaXMuc3VwYWJhc2VcclxuXHRcdFx0LmZyb20oJ3Nlc3Npb25fcmVwb3J0c192M190YWJzJylcclxuXHRcdFx0LnNlbGVjdCgnc2Vzc2lvbl9pZCwgcmVwb3J0X2pzb24sIHN0YXR1cywgYXR0ZW1wdHMsIGxhc3RfZXJyb3IsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXQnKVxyXG5cdFx0XHQuZXEoJ3Nlc3Npb25faWQnLCBzZXNzaW9uSWQpXHJcblx0XHRcdC5zaW5nbGUoKVxyXG5cdFx0aWYgKGVycm9yKSB7XHJcblx0XHRcdGlmICgoZXJyb3IgYXMgYW55KS5jb2RlID09PSAnUEdSU1QxMTYnKSByZXR1cm4gbnVsbFxyXG5cdFx0XHRjb25zb2xlLmVycm9yKCdbcmVwb3J0cy12My10YWJzXSBmaW5kQnlTZXNzaW9uSWQgZXJyb3InLCB7IGNvZGU6IChlcnJvciBhcyBhbnkpLmNvZGUsIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsIHNlc3Npb25JZCB9KVxyXG5cdFx0XHRyZXR1cm4gbnVsbFxyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIG1hcERiUmVwb3J0VGFicyhyb3cpXHJcblx0fVxyXG5cclxuXHRhc3luYyB1cHNlcnRRdWV1ZWQoc2Vzc2lvbklkOiBzdHJpbmcpIHtcclxuXHRcdGNvbnN0IHBheWxvYWQgPSB7IFxyXG5cdFx0XHRzZXNzaW9uX2lkOiBzZXNzaW9uSWQsIFxyXG5cdFx0XHRzdGF0dXM6ICdxdWV1ZWQnIGFzIGNvbnN0LCBcclxuXHRcdFx0cmVwb3J0X2pzb246IHt9LFxyXG5cdFx0XHRhdHRlbXB0czogMCxcclxuXHRcdFx0bGFzdF9lcnJvcjogbnVsbFxyXG5cdFx0fVxyXG5cdFx0Y29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxyXG5cdFx0XHQuZnJvbSgnc2Vzc2lvbl9yZXBvcnRzX3YzX3RhYnMnKVxyXG5cdFx0XHQudXBzZXJ0KHBheWxvYWQsIHsgb25Db25mbGljdDogJ3Nlc3Npb25faWQnIH0pXHJcblx0XHRcdC5zZWxlY3QoJ3Nlc3Npb25faWQsIHJlcG9ydF9qc29uLCBzdGF0dXMsIGF0dGVtcHRzLCBsYXN0X2Vycm9yLCBjcmVhdGVkX2F0LCB1cGRhdGVkX2F0JylcclxuXHRcdFx0LnNpbmdsZSgpXHJcblx0XHRpZiAoZXJyb3IpIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHVwc2VydCBxdWV1ZWQgdGFicyByZXBvcnQ6ICR7ZXJyb3IubWVzc2FnZX1gKVxyXG5cdFx0cmV0dXJuIG1hcERiUmVwb3J0VGFicyhkYXRhKVxyXG5cdH1cclxuXHJcblx0YXN5bmMgc2V0UnVubmluZyhzZXNzaW9uSWQ6IHN0cmluZykge1xyXG5cdFx0Y29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxyXG5cdFx0XHQuZnJvbSgnc2Vzc2lvbl9yZXBvcnRzX3YzX3RhYnMnKVxyXG5cdFx0XHQudXBkYXRlKHsgc3RhdHVzOiAncnVubmluZycgfSlcclxuXHRcdFx0LmVxKCdzZXNzaW9uX2lkJywgc2Vzc2lvbklkKVxyXG5cdFx0XHQuc2VsZWN0KCdzZXNzaW9uX2lkLCByZXBvcnRfanNvbiwgc3RhdHVzLCBhdHRlbXB0cywgbGFzdF9lcnJvciwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdCcpXHJcblx0XHRcdC5zaW5nbGUoKVxyXG5cdFx0aWYgKGVycm9yKSB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBzZXQgdGFicyBydW5uaW5nOiAke2Vycm9yLm1lc3NhZ2V9YClcclxuXHRcdHJldHVybiBtYXBEYlJlcG9ydFRhYnMoZGF0YSlcclxuXHR9XHJcblxyXG5cdGFzeW5jIGluY3JlbWVudEF0dGVtcHRzKHNlc3Npb25JZDogc3RyaW5nKSB7XHJcblx0XHRjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCB0aGlzLnN1cGFiYXNlXHJcblx0XHRcdC5ycGMoJ2luY3JlbWVudF9yZXBvcnRfdGFic19hdHRlbXB0cycsIHsgcF9zZXNzaW9uX2lkOiBzZXNzaW9uSWQgfSlcclxuXHRcdC8vIElmIGhlbHBlciBmdW5jdGlvbiBub3QgcHJlc2VudCwgZmFsbCBiYWNrIHRvIHVwZGF0ZSB3aXRoIGV4cHJlc3Npb25cclxuXHRcdGlmIChlcnJvcikge1xyXG5cdFx0XHRjb25zdCB7IGRhdGE6IHJvdywgZXJyb3I6IHVwZEVyciB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxyXG5cdFx0XHRcdC5mcm9tKCdzZXNzaW9uX3JlcG9ydHNfdjNfdGFicycpXHJcblx0XHRcdFx0LnVwZGF0ZSh7IGF0dGVtcHRzOiAoYXdhaXQgKGFzeW5jICgpID0+IHtcclxuXHRcdFx0XHRcdGNvbnN0IHsgZGF0YTogY3VyIH0gPSBhd2FpdCB0aGlzLnN1cGFiYXNlXHJcblx0XHRcdFx0XHRcdC5mcm9tKCdzZXNzaW9uX3JlcG9ydHNfdjNfdGFicycpXHJcblx0XHRcdFx0XHRcdC5zZWxlY3QoJ2F0dGVtcHRzJylcclxuXHRcdFx0XHRcdFx0LmVxKCdzZXNzaW9uX2lkJywgc2Vzc2lvbklkKVxyXG5cdFx0XHRcdFx0XHQuc2luZ2xlKClcclxuXHRcdFx0XHRcdHJldHVybiAoY3VyPy5hdHRlbXB0cyA/PyAwKSArIDFcclxuXHRcdFx0XHR9KSgpKSB9KVxyXG5cdFx0XHRcdC5lcSgnc2Vzc2lvbl9pZCcsIHNlc3Npb25JZClcclxuXHRcdFx0XHQuc2VsZWN0KCdzZXNzaW9uX2lkLCByZXBvcnRfanNvbiwgc3RhdHVzLCBhdHRlbXB0cywgbGFzdF9lcnJvciwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdCcpXHJcblx0XHRcdFx0LnNpbmdsZSgpXHJcblx0XHRcdGlmICh1cGRFcnIpIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGluY3JlbWVudCB0YWJzIGF0dGVtcHRzOiAke3VwZEVyci5tZXNzYWdlfWApXHJcblx0XHRcdHJldHVybiBtYXBEYlJlcG9ydFRhYnMocm93KVxyXG5cdFx0fVxyXG5cdFx0Ly8gSWYgUlBDIHN1Y2NlZWRlZCwgZmV0Y2ggdG8gbWFwXHJcblx0XHRjb25zdCB7IGRhdGE6IHJvdzIsIGVycm9yOiBzZWxFcnIgfSA9IGF3YWl0IHRoaXMuc3VwYWJhc2VcclxuXHRcdFx0LmZyb20oJ3Nlc3Npb25fcmVwb3J0c192M190YWJzJylcclxuXHRcdFx0LnNlbGVjdCgnc2Vzc2lvbl9pZCwgcmVwb3J0X2pzb24sIHN0YXR1cywgYXR0ZW1wdHMsIGxhc3RfZXJyb3IsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXQnKVxyXG5cdFx0XHQuZXEoJ3Nlc3Npb25faWQnLCBzZXNzaW9uSWQpXHJcblx0XHRcdC5zaW5nbGUoKVxyXG5cdFx0aWYgKHNlbEVycikgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZmV0Y2ggdGFicyBhdHRlbXB0czogJHtzZWxFcnIubWVzc2FnZX1gKVxyXG5cdFx0cmV0dXJuIG1hcERiUmVwb3J0VGFicyhyb3cyKVxyXG5cdH1cclxuXHJcblx0YXN5bmMgc2V0UmVhZHkoc2Vzc2lvbklkOiBzdHJpbmcsIHJlcG9ydDogUmVwb3J0RGF0YVYzVGFicykge1xyXG5cdFx0Y29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxyXG5cdFx0XHQuZnJvbSgnc2Vzc2lvbl9yZXBvcnRzX3YzX3RhYnMnKVxyXG5cdFx0XHQudXBkYXRlKHsgc3RhdHVzOiAncmVhZHknLCByZXBvcnRfanNvbjogcmVwb3J0LCBsYXN0X2Vycm9yOiBudWxsIH0pXHJcblx0XHRcdC5lcSgnc2Vzc2lvbl9pZCcsIHNlc3Npb25JZClcclxuXHRcdFx0LnNlbGVjdCgnc2Vzc2lvbl9pZCwgcmVwb3J0X2pzb24sIHN0YXR1cywgYXR0ZW1wdHMsIGxhc3RfZXJyb3IsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXQnKVxyXG5cdFx0XHQuc2luZ2xlKClcclxuXHRcdGlmIChlcnJvcikgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gc2V0IHRhYnMgcmVhZHk6ICR7ZXJyb3IubWVzc2FnZX1gKVxyXG5cdFx0cmV0dXJuIG1hcERiUmVwb3J0VGFicyhkYXRhKVxyXG5cdH1cclxuXHJcblx0YXN5bmMgc2V0RmFpbGVkKHNlc3Npb25JZDogc3RyaW5nLCBlcnJvck1zZzogc3RyaW5nKSB7XHJcblx0XHRjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCB0aGlzLnN1cGFiYXNlXHJcblx0XHRcdC5mcm9tKCdzZXNzaW9uX3JlcG9ydHNfdjNfdGFicycpXHJcblx0XHRcdC51cGRhdGUoeyBzdGF0dXM6ICdmYWlsZWQnLCBsYXN0X2Vycm9yOiBlcnJvck1zZyB9KVxyXG5cdFx0XHQuZXEoJ3Nlc3Npb25faWQnLCBzZXNzaW9uSWQpXHJcblx0XHRcdC5zZWxlY3QoJ3Nlc3Npb25faWQsIHJlcG9ydF9qc29uLCBzdGF0dXMsIGF0dGVtcHRzLCBsYXN0X2Vycm9yLCBjcmVhdGVkX2F0LCB1cGRhdGVkX2F0JylcclxuXHRcdFx0LnNpbmdsZSgpXHJcblx0XHRpZiAoZXJyb3IpIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHNldCB0YWJzIGZhaWxlZDogJHtlcnJvci5tZXNzYWdlfWApXHJcblx0XHRyZXR1cm4gbWFwRGJSZXBvcnRUYWJzKGRhdGEpXHJcblx0fVxyXG59XHJcblxyXG5cclxuXHJcblxyXG5cclxuIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInN1cGFiYXNlQW5vbktleSIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIiwiZGVmYXVsdENsaWVudCIsIm1hcERiUmVwb3J0VGFicyIsInJvdyIsInNlc3Npb25faWQiLCJyZXBvcnQiLCJyZXBvcnRfanNvbiIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJzdGF0dXMiLCJhdHRlbXB0cyIsImxhc3RfZXJyb3IiLCJjcmVhdGVkX2F0IiwidXBkYXRlZF9hdCIsIlJlcG9ydHNWM1RhYnNSZXBvc2l0b3J5IiwiY29uc3RydWN0b3IiLCJzdXBhYmFzZSIsImZpbmRCeVNlc3Npb25JZCIsInNlc3Npb25JZCIsIl91c2VySWQiLCJkYXRhIiwiZXJyb3IiLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJzaW5nbGUiLCJjb2RlIiwiY29uc29sZSIsIm1lc3NhZ2UiLCJ1cHNlcnRRdWV1ZWQiLCJwYXlsb2FkIiwidXBzZXJ0Iiwib25Db25mbGljdCIsIkVycm9yIiwic2V0UnVubmluZyIsInVwZGF0ZSIsImluY3JlbWVudEF0dGVtcHRzIiwicnBjIiwicF9zZXNzaW9uX2lkIiwidXBkRXJyIiwiY3VyIiwicm93MiIsInNlbEVyciIsInNldFJlYWR5Iiwic2V0RmFpbGVkIiwiZXJyb3JNc2ciXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/server/repositories/reports-v3-tabs.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/repositories/sessions.ts":
/*!*********************************************!*\
  !*** ./src/server/repositories/sessions.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SessionsRepository: () => (/* binding */ SessionsRepository)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/.pnpm/@supabase+supabase-js@2.57.4/node_modules/@supabase/supabase-js/dist/module/index.js\");\n\n// Use untyped client until schema is applied and types regenerated\nconst supabaseUrl = \"https://hewpwluinbwaizwqhmjc.supabase.co\";\nconst supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhld3B3bHVpbmJ3YWl6d3FobWpjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5MTU5NTEsImV4cCI6MjA3MjQ5MTk1MX0.jhKzLYPdixxI8zcH20kkzL1WgP9RB33FeHtO0FRY7r4\";\nconst defaultClient = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey);\nfunction mapDbSession(row) {\n    const startedAt = row.started_at ? new Date(row.started_at) : null;\n    const fallbackTitle = startedAt ? `Session @ ${startedAt.toLocaleTimeString('en-GB', {\n        hour12: false\n    })}` : 'Session';\n    // Heuristic: if title_enc looks like base64/opaque, use fallback for display\n    const looksEncoded = typeof row.title_enc === 'string' && /^[A-Za-z0-9+/=]{20,}$/.test(row.title_enc);\n    return {\n        id: row.id,\n        owner_id: row.user_id,\n        subject_id: row.subject_id || null,\n        title: row.title_enc && !looksEncoded ? row.title_enc : fallbackTitle,\n        type: row.session_type,\n        status: row.ended_at ? 'completed' : 'active',\n        started_at: row.started_at,\n        ended_at: row.ended_at,\n        created_at: row.started_at,\n        updated_at: row.updated_at\n    };\n}\nclass SessionsRepository {\n    constructor(supabase = defaultClient){\n        this.supabase = supabase;\n    }\n    async findAll(options) {\n        const { filters = {}, sort = 'started_at', direction = 'desc', page = 1, pageSize = 10, userId } = options;\n        const sortColumn = [\n            'started_at',\n            'updated_at',\n            'ended_at'\n        ].includes(sort) ? sort : 'started_at';\n        let query = this.supabase.from('sessions').select('id,user_id,subject_id,title_enc,session_type,started_at,ended_at,updated_at', {\n            count: 'estimated'\n        }).eq('user_id', userId);\n        // Apply filters\n        if (filters.search) {\n            query = query.ilike('title_enc', `%${filters.search}%`);\n        }\n        if (filters.status && filters.status !== 'all') {\n            if (filters.status === 'active') {\n                query = query.is('ended_at', null);\n            } else if (filters.status === 'completed' || filters.status === 'cancelled') {\n                query = query.not('ended_at', 'is', null);\n            }\n        }\n        if (filters.type) {\n            query = query.eq('session_type', filters.type);\n        }\n        if (filters.dateFrom) {\n            query = query.gte('started_at', filters.dateFrom);\n        }\n        if (filters.dateTo) {\n            query = query.lte('started_at', filters.dateTo);\n        }\n        // Apply sorting\n        query = query.order(sortColumn, {\n            ascending: direction === 'asc'\n        });\n        // Apply pagination (1-based to 0-based conversion)\n        const from = (page - 1) * pageSize;\n        const to = from + pageSize - 1;\n        query = query.range(from, to);\n        const { data: rows, error, count } = await query;\n        if (error) {\n            throw new Error(`Failed to fetch sessions: ${error.message}`);\n        }\n        const baseRows = rows || [];\n        // Enrich with contact phone via subject lookup (prefer customer over lead)\n        const phoneBySubject = {};\n        const subjectIds = Array.from(new Set(baseRows.map((r)=>r.subject_id).filter((v)=>!!v)));\n        if (subjectIds.length > 0) {\n            // Fetch customer phones in bulk\n            const { data: custRows, error: custErr } = await this.supabase.from('customers').select('subject_id, phone').in('subject_id', subjectIds).eq('owner_id', userId);\n            if (!custErr && Array.isArray(custRows)) {\n                for (const r of custRows){\n                    if (r.subject_id && r.phone) phoneBySubject[r.subject_id] = r.phone;\n                }\n            }\n            // Fetch lead phones where customer missing\n            const missing = subjectIds.filter((id)=>!phoneBySubject[id]);\n            if (missing.length > 0) {\n                const { data: leadRows } = await this.supabase.from('leads').select('subject_id, phone').in('subject_id', missing).eq('owner_id', userId);\n                if (Array.isArray(leadRows)) {\n                    for (const r of leadRows){\n                        if (r.subject_id && r.phone && !phoneBySubject[r.subject_id]) {\n                            phoneBySubject[r.subject_id] = r.phone;\n                        }\n                    }\n                }\n            }\n        }\n        const sessions = baseRows.map((r)=>{\n            const s = mapDbSession(r);\n            const phone = r.subject_id ? phoneBySubject[r.subject_id] : undefined;\n            return phone ? {\n                ...s,\n                phone\n            } : s;\n        });\n        const total = count || 0;\n        const totalPages = Math.ceil(total / pageSize);\n        return {\n            sessions,\n            total,\n            page,\n            pageSize,\n            totalPages\n        };\n    }\n    async findById(id, userId) {\n        const { data: row, error } = await this.supabase.from('sessions').select('id,user_id,subject_id,title_enc,session_type,started_at,ended_at,updated_at').eq('id', id).eq('user_id', userId).single();\n        if (error) {\n            if (error.code === 'PGRST116') {\n                return null // Not found\n                ;\n            }\n            throw new Error(`Failed to fetch session: ${error.message}`);\n        }\n        return mapDbSession(row);\n    }\n    async create(sessionData, userId) {\n        const requestedType = sessionData?.type || 'ask';\n        const { data: newSessionId, error: rpcError } = await this.supabase.rpc('get_or_create_active_session', {\n            requested_type: requestedType\n        });\n        if (rpcError) {\n            throw new Error(`Failed to create session: ${rpcError.message}`);\n        }\n        const { data: row, error } = await this.supabase.from('sessions').select('id,user_id,subject_id,title_enc,session_type,started_at,ended_at,updated_at').eq('id', newSessionId).eq('user_id', userId).single();\n        if (error) {\n            throw new Error(`Failed to fetch created session: ${error.message}`);\n        }\n        return mapDbSession(row);\n    }\n    async update(id, sessionData, userId) {\n        // Support title update and ending a session\n        if (sessionData?.status === 'completed' || sessionData?.status === 'cancelled') {\n            const { error: endErr } = await this.supabase.rpc('end_session', {\n                session_id: id\n            });\n            if (endErr) throw new Error(`Failed to end session: ${endErr.message}`);\n        }\n        if (sessionData?.title) {\n            const { error: updErr } = await this.supabase.from('sessions').update({\n                title_enc: sessionData.title\n            }).eq('id', id).eq('user_id', userId);\n            if (updErr) throw new Error(`Failed to update session: ${updErr.message}`);\n        }\n        const { data: row, error } = await this.supabase.from('sessions').select('id,user_id,subject_id,title_enc,session_type,started_at,ended_at,updated_at').eq('id', id).eq('user_id', userId).single();\n        if (error) throw new Error(`Failed to fetch session: ${error.message}`);\n        return mapDbSession(row);\n    }\n    async delete(id, userId) {\n        const { error } = await this.supabase.from('sessions').delete().eq('id', id).eq('user_id', userId);\n        if (error) throw new Error(`Failed to delete session: ${error.message}`);\n    }\n    async getStats(userId) {\n        const [total, active, completed] = await Promise.all([\n            this.supabase.from('sessions').select('*', {\n                count: 'exact',\n                head: true\n            }).eq('user_id', userId),\n            this.supabase.from('sessions').select('*', {\n                count: 'exact',\n                head: true\n            }).eq('user_id', userId).is('ended_at', null),\n            this.supabase.from('sessions').select('*', {\n                count: 'exact',\n                head: true\n            }).eq('user_id', userId).not('ended_at', 'is', null)\n        ]);\n        return {\n            total: total.count || 0,\n            active: active.count || 0,\n            completed: completed.count || 0,\n            cancelled: 0\n        };\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3JlcG9zaXRvcmllcy9zZXNzaW9ucy50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUFvRDtBQUVwRCxtRUFBbUU7QUFDbkUsTUFBTUMsY0FBY0MsMENBQW9DO0FBQ3hELE1BQU1HLGtCQUFrQkgsa05BQXlDO0FBQ2pFLE1BQU1LLGdCQUFnQlAsbUVBQVlBLENBQUNDLGFBQWFJO0FBMEJoRCxTQUFTRyxhQUFhQyxHQUFRO0lBQzdCLE1BQU1DLFlBQVlELElBQUlFLFVBQVUsR0FBRyxJQUFJQyxLQUFLSCxJQUFJRSxVQUFVLElBQUk7SUFDOUQsTUFBTUUsZ0JBQWdCSCxZQUFZLENBQUMsVUFBVSxFQUFFQSxVQUFVSSxrQkFBa0IsQ0FBQyxTQUFTO1FBQUVDLFFBQVE7SUFBTSxJQUFJLEdBQUc7SUFDNUcsNkVBQTZFO0lBQzdFLE1BQU1DLGVBQWUsT0FBT1AsSUFBSVEsU0FBUyxLQUFLLFlBQVksd0JBQXdCQyxJQUFJLENBQUNULElBQUlRLFNBQVM7SUFDcEcsT0FBTztRQUNORSxJQUFJVixJQUFJVSxFQUFFO1FBQ1ZDLFVBQVVYLElBQUlZLE9BQU87UUFDckJDLFlBQVliLElBQUlhLFVBQVUsSUFBSTtRQUM5QkMsT0FBTyxJQUFLTixTQUFTLElBQUksQ0FBQ0QsZUFBZ0JQLElBQUlRLFNBQVMsR0FBR0o7UUFDMURXLE1BQU1mLElBQUlnQixZQUFZO1FBQ3RCQyxRQUFRakIsSUFBSWtCLFFBQVEsR0FBRyxjQUFjO1FBQ3JDaEIsWUFBWUYsSUFBSUUsVUFBVTtRQUMxQmdCLFVBQVVsQixJQUFJa0IsUUFBUTtRQUN0QkMsWUFBWW5CLElBQUlFLFVBQVU7UUFDMUJrQixZQUFZcEIsSUFBSW9CLFVBQVU7SUFDM0I7QUFDRDtBQUVPLE1BQU1DO0lBQ1RDLFlBQVksV0FBc0N4QixhQUFhLENBQUU7YUFBN0N5QixXQUFBQTtJQUE4QztJQUVsRSxNQUFNQyxRQUFRQyxPQUEyQixFQU10QztRQUNMLE1BQU0sRUFDTEMsVUFBVSxDQUFDLENBQUMsRUFD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UUFDaEIsSUFBSXNCLE9BQU8sTUFBTSxJQUFJQyxNQUFNLENBQUMsMEJBQTBCLEVBQUVELE1BQU1FLE9BQU8sRUFBRTtJQUN4RTtJQUVBLE1BQU13QyxTQUFTaEUsTUFBYyxFQUsxQjtRQUNGLE1BQU0sQ0FBQzZDLE9BQU9vQixRQUFRQyxVQUFVLEdBQUcsTUFBTUMsUUFBUUMsR0FBRyxDQUFDO1lBQ3BELElBQUksQ0FBQzVFLFFBQVEsQ0FBQ1ksSUFBSSxDQUFDLFlBQVlDLE1BQU0sQ0FBQyxLQUFLO2dCQUFFQyxPQUFPO2dCQUFTK0QsTUFBTTtZQUFLLEdBQUc5RCxFQUFFLENBQUMsV0FBV1A7WUFDekYsSUFBSSxDQUFDUixRQUFRLENBQUNZLElBQUksQ0FBQyxZQUFZQyxNQUFNLENBQUMsS0FBSztnQkFBRUMsT0FBTztnQkFBUytELE1BQU07WUFBSyxHQUFHOUQsRUFBRSxDQUFDLFdBQVdQLFFBQVFVLEVBQUUsQ0FBQyxZQUFZO1lBQ2hILElBQUksQ0FBQ2xCLFFBQVEsQ0FBQ1ksSUFBSSxDQUFDLFlBQVlDLE1BQU0sQ0FBQyxLQUFLO2dCQUFFQyxPQUFPO2dCQUFTK0QsTUFBTTtZQUFLLEdBQUc5RCxFQUFFLENBQUMsV0FBV1AsUUFBUVcsR0FBRyxDQUFDLFlBQVksTUFBTTtTQUN2SDtRQUVELE9BQU87WUFDTmtDLE9BQU8sTUFBT3ZDLEtBQUssSUFBZTtZQUNsQzJELFFBQVEsT0FBUTNELEtBQUssSUFBZTtZQUNwQzRELFdBQVcsVUFBVzVELEtBQUssSUFBZTtZQUMxQ2dFLFdBQVc7UUFDWjtJQUNEO0FBQ0QiLCJzb3VyY2VzIjpbIkQ6XFxEZWx0YSBJVlxcU29md2FyZXNcXGdsYXNzXFxzYW5kYm94XFxzaGFkY24tY3JtLWRhc2hib2FyZFxcc3JjXFxzZXJ2ZXJcXHJlcG9zaXRvcmllc1xcc2Vzc2lvbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJ1xuXG4vLyBVc2UgdW50eXBlZCBjbGllbnQgdW50aWwgc2NoZW1hIGlzIGFwcGxpZWQgYW5kIHR5cGVzIHJlZ2VuZXJhdGVkXG5jb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCFcbmNvbnN0IHN1cGFiYXNlQW5vbktleSA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIVxuY29uc3QgZGVmYXVsdENsaWVudCA9IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VBbm9uS2V5KVxuXG4vLyBUZW1wb3JhcnkgdHlwZXMgdW50aWwgc2NoZW1hIGlzIGFwcGxpZWRcbnR5cGUgU2Vzc2lvbiA9IGFueVxudHlwZSBTZXNzaW9uSW5zZXJ0ID0gYW55XG50eXBlIFNlc3Npb25VcGRhdGUgPSBhbnlcblxudHlwZSBTdXBhYmFzZUNsaWVudEFueSA9IHR5cGVvZiBkZWZhdWx0Q2xpZW50XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2Vzc2lvbkZpbHRlcnMge1xuXHRzZWFyY2g/OiBzdHJpbmdcblx0c3RhdHVzPzogJ2FsbCcgfCAnYWN0aXZlJyB8ICdjb21wbGV0ZWQnIHwgJ2NhbmNlbGxlZCdcblx0ZGF0ZUZyb20/OiBzdHJpbmdcblx0ZGF0ZVRvPzogc3RyaW5nXG5cdHR5cGU/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTZXNzaW9uTGlzdE9wdGlvbnMge1xuXHRmaWx0ZXJzPzogU2Vzc2lvbkZpbHRlcnNcblx0c29ydD86IHN0cmluZ1xuXHRkaXJlY3Rpb24/OiAnYXNjJyB8ICdkZXNjJ1xuXHRwYWdlPzogbnVtYmVyXG5cdHBhZ2VTaXplPzogbnVtYmVyXG5cdHVzZXJJZDogc3RyaW5nXG59XG5cbmZ1bmN0aW9uIG1hcERiU2Vzc2lvbihyb3c6IGFueSk6IGFueSB7XG5cdGNvbnN0IHN0YXJ0ZWRBdCA9IHJvdy5zdGFydGVkX2F0ID8gbmV3IERhdGUocm93LnN0YXJ0ZWRfYXQpIDogbnVsbFxuXHRjb25zdCBmYWxsYmFja1RpdGxlID0gc3RhcnRlZEF0ID8gYFNlc3Npb24gQCAke3N0YXJ0ZWRBdC50b0xvY2FsZVRpbWVTdHJpbmcoJ2VuLUdCJywgeyBob3VyMTI6IGZhbHNlIH0pfWAgOiAnU2Vzc2lvbidcblx0Ly8gSGV1cmlzdGljOiBpZiB0aXRsZV9lbmMgbG9va3MgbGlrZSBiYXNlNjQvb3BhcXVlLCB1c2UgZmFsbGJhY2sgZm9yIGRpc3BsYXlcblx0Y29uc3QgbG9va3NFbmNvZGVkID0gdHlwZW9mIHJvdy50aXRsZV9lbmMgPT09ICdzdHJpbmcnICYmIC9eW0EtWmEtejAtOSsvPV17MjAsfSQvLnRlc3Qocm93LnRpdGxlX2VuYylcblx0cmV0dXJuIHtcblx0XHRpZDogcm93LmlkLFxuXHRcdG93bmVyX2lkOiByb3cudXNlcl9pZCxcblx0XHRzdWJqZWN0X2lkOiByb3cuc3ViamVjdF9pZCB8fCBudWxsLFxuXHRcdHRpdGxlOiAocm93LnRpdGxlX2VuYyAmJiAhbG9va3NFbmNvZGVkKSA/IHJvdy50aXRsZV9lbmMgOiBmYWxsYmFja1RpdGxlLFxuXHRcdHR5cGU6IHJvdy5zZXNzaW9uX3R5cGUsXG5cdFx0c3RhdHVzOiByb3cuZW5kZWRfYXQgPyAnY29tcGxldGVkJyA6ICdhY3RpdmUnLFxuXHRcdHN0YXJ0ZWRfYXQ6IHJvdy5zdGFydGVkX2F0LFxuXHRcdGVuZGVkX2F0OiByb3cuZW5kZWRfYXQsXG5cdFx0Y3JlYXRlZF9hdDogcm93LnN0YXJ0ZWRfYXQsXG5cdFx0dXBkYXRlZF9hdDogcm93LnVwZGF0ZWRfYXQsXG5cdH1cbn1cblxuZXhwb3J0IGNsYXNzIFNlc3Npb25zUmVwb3NpdG9yeSB7XG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBzdXBhYmFzZTogU3VwYWJhc2VDbGllbnRBbnkgPSBkZWZhdWx0Q2xpZW50KSB7fVxuXG4gICAgYXN5bmMgZmluZEFsbChvcHRpb25zOiBTZXNzaW9uTGlzdE9wdGlvbnMpOiBQcm9taXNlPHtcbiAgICAgICAgc2Vzc2lvbnM6IFNlc3Npb25bXVxuICAgICAgICB0b3RhbDogbnVtYmVyXG4gICAgICAgIHBhZ2U6IG51bWJlclxuICAgICAgICBwYWdlU2l6ZTogbnVtYmVyXG4gICAgICAgIHRvdGFsUGFnZXM6IG51bWJlclxuICAgIH0+IHtcblx0XHRjb25zdCB7XG5cdFx0XHRmaWx0ZXJzID0ge30sXG5cdFx0XHRzb3J0ID0gJ3N0YXJ0ZWRfYXQnLFxuXHRcdFx0ZGlyZWN0aW9uID0gJ2Rlc2MnLFxuXHRcdFx0cGFnZSA9IDEsXG5cdFx0XHRwYWdlU2l6ZSA9IDEwLFxuXHRcdFx0dXNlcklkXG5cdFx0fSA9IG9wdGlvbnNcblxuXHRcdGNvbnN0IHNvcnRDb2x1bW4gPSBbJ3N0YXJ0ZWRfYXQnLCd1cGRhdGVkX2F0JywnZW5kZWRfYXQnXS5pbmNsdWRlcyhzb3J0KSA/IHNvcnQgOiAnc3RhcnRlZF9hdCdcblxuXHRcdGxldCBxdWVyeSA9IHRoaXMuc3VwYWJhc2Vcblx0XHRcdC5mcm9tKCdzZXNzaW9ucycpXG5cdFx0XHQuc2VsZWN0KCdpZCx1c2VyX2lkLHN1YmplY3RfaWQsdGl0bGVfZW5jLHNlc3Npb25fdHlwZSxzdGFydGVkX2F0LGVuZGVkX2F0LHVwZGF0ZWRfYXQnLCB7IGNvdW50OiAnZXN0aW1hdGVkJyB9KVxuXHRcdFx0LmVxKCd1c2VyX2lkJywgdXNlcklkKVxuXG5cdFx0Ly8gQXBwbHkgZmlsdGVyc1xuXHRcdGlmIChmaWx0ZXJzLnNlYXJjaCkge1xuXHRcdFx0cXVlcnkgPSBxdWVyeS5pbGlrZSgndGl0bGVfZW5jJywgYCUke2ZpbHRlcnMuc2VhcmNofSVgKVxuXHRcdH1cblxuXHRcdGlmIChmaWx0ZXJzLnN0YXR1cyAmJiBmaWx0ZXJzLnN0YXR1cyAhPT0gJ2FsbCcpIHtcblx0XHRcdGlmIChmaWx0ZXJzLnN0YXR1cyA9PT0gJ2FjdGl2ZScpIHtcblx0XHRcdFx0cXVlcnkgPSBxdWVyeS5pcygnZW5kZWRfYXQnLCBudWxsKVxuXHRcdFx0fSBlbHNlIGlmIChmaWx0ZXJzLnN0YXR1cyA9PT0gJ2NvbXBsZXRlZCcgfHwgZmlsdGVycy5zdGF0dXMgPT09ICdjYW5jZWxsZWQnKSB7XG5cdFx0XHRcdHF1ZXJ5ID0gcXVlcnkubm90KCdlbmRlZF9hdCcsICdpcycsIG51bGwpXG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKGZpbHRlcnMudHlwZSkge1xuXHRcdFx0cXVlcnkgPSBxdWVyeS5lcSgnc2Vzc2lvbl90eXBlJywgZmlsdGVycy50eXBlKVxuXHRcdH1cblxuXHRcdGlmIChmaWx0ZXJzLmRhdGVGcm9tKSB7XG5cdFx0XHRxdWVyeSA9IHF1ZXJ5Lmd0ZSgnc3RhcnRlZF9hdCcsIGZpbHRlcnMuZGF0ZUZyb20pXG5cdFx0fVxuXG5cdFx0aWYgKGZpbHRlcnMuZGF0ZVRvKSB7XG5cdFx0XHRxdWVyeSA9IHF1ZXJ5Lmx0ZSgnc3RhcnRlZF9hdCcsIGZpbHRlcnMuZGF0ZVRvKVxuXHRcdH1cblxuXHRcdC8vIEFwcGx5IHNvcnRpbmdcblx0XHRxdWVyeSA9IHF1ZXJ5Lm9yZGVyKHNvcnRDb2x1bW4sIHsgYXNjZW5kaW5nOiBkaXJlY3Rpb24gPT09ICdhc2MnIH0pXG5cblx0XHQvLyBBcHBseSBwYWdpbmF0aW9uICgxLWJhc2VkIHRvIDAtYmFzZWQgY29udmVyc2lvbilcblx0XHRjb25zdCBmcm9tID0gKHBhZ2UgLSAxKSAqIHBhZ2VTaXplXG5cdFx0Y29uc3QgdG8gPSBmcm9tICsgcGFnZVNpemUgLSAxXG5cdFx0cXVlcnkgPSBxdWVyeS5yYW5nZShmcm9tLCB0bylcblxuICAgICAgICBjb25zdCB7IGRhdGE6IHJvd3MsIGVycm9yLCBjb3VudCB9ID0gYXdhaXQgcXVlcnlcblxuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGZldGNoIHNlc3Npb25zOiAke2Vycm9yLm1lc3NhZ2V9YClcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGJhc2VSb3dzID0gcm93cyB8fCBbXVxuXG4gICAgICAgIC8vIEVucmljaCB3aXRoIGNvbnRhY3QgcGhvbmUgdmlhIHN1YmplY3QgbG9va3VwIChwcmVmZXIgY3VzdG9tZXIgb3ZlciBsZWFkKVxuICAgICAgICBjb25zdCBwaG9uZUJ5U3ViamVjdDogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHt9XG4gICAgICAgIGNvbnN0IHN1YmplY3RJZHMgPSBBcnJheS5mcm9tKG5ldyBTZXQoXG4gICAgICAgICAgICBiYXNlUm93cy5tYXAoKHI6IGFueSkgPT4gci5zdWJqZWN0X2lkKS5maWx0ZXIoKHY6IGFueSkgPT4gISF2KVxuICAgICAgICApKSBhcyBzdHJpbmdbXVxuXG4gICAgICAgIGlmIChzdWJqZWN0SWRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIC8vIEZldGNoIGN1c3RvbWVyIHBob25lcyBpbiBidWxrXG4gICAgICAgICAgICBjb25zdCB7IGRhdGE6IGN1c3RSb3dzLCBlcnJvcjogY3VzdEVyciB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxuICAgICAgICAgICAgICAgIC5mcm9tKCdjdXN0b21lcnMnKVxuICAgICAgICAgICAgICAgIC5zZWxlY3QoJ3N1YmplY3RfaWQsIHBob25lJylcbiAgICAgICAgICAgICAgICAuaW4oJ3N1YmplY3RfaWQnLCBzdWJqZWN0SWRzKVxuICAgICAgICAgICAgICAgIC5lcSgnb3duZXJfaWQnLCB1c2VySWQpXG4gICAgICAgICAgICBpZiAoIWN1c3RFcnIgJiYgQXJyYXkuaXNBcnJheShjdXN0Um93cykpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHIgb2YgY3VzdFJvd3MpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHIuc3ViamVjdF9pZCAmJiByLnBob25lKSBwaG9uZUJ5U3ViamVjdFtyLnN1YmplY3RfaWRdID0gci5waG9uZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRmV0Y2ggbGVhZCBwaG9uZXMgd2hlcmUgY3VzdG9tZXIgbWlzc2luZ1xuICAgICAgICAgICAgY29uc3QgbWlzc2luZyA9IHN1YmplY3RJZHMuZmlsdGVyKGlkID0+ICFwaG9uZUJ5U3ViamVjdFtpZF0pXG4gICAgICAgICAgICBpZiAobWlzc2luZy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBkYXRhOiBsZWFkUm93cyB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxuICAgICAgICAgICAgICAgICAgICAuZnJvbSgnbGVhZHMnKVxuICAgICAgICAgICAgICAgICAgICAuc2VsZWN0KCdzdWJqZWN0X2lkLCBwaG9uZScpXG4gICAgICAgICAgICAgICAgICAgIC5pbignc3ViamVjdF9pZCcsIG1pc3NpbmcpXG4gICAgICAgICAgICAgICAgICAgIC5lcSgnb3duZXJfaWQnLCB1c2VySWQpXG4gICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkobGVhZFJvd3MpKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgciBvZiBsZWFkUm93cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHIuc3ViamVjdF9pZCAmJiByLnBob25lICYmICFwaG9uZUJ5U3ViamVjdFtyLnN1YmplY3RfaWRdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGhvbmVCeVN1YmplY3Rbci5zdWJqZWN0X2lkXSA9IHIucGhvbmVcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHNlc3Npb25zID0gYmFzZVJvd3MubWFwKChyOiBhbnkpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHMgPSBtYXBEYlNlc3Npb24ocilcbiAgICAgICAgICAgIGNvbnN0IHBob25lID0gci5zdWJqZWN0X2lkID8gcGhvbmVCeVN1YmplY3Rbci5zdWJqZWN0X2lkXSA6IHVuZGVmaW5lZFxuICAgICAgICAgICAgcmV0dXJuIHBob25lID8geyAuLi5zLCBwaG9uZSB9IDogc1xuICAgICAgICB9KVxuICAgICAgICBjb25zdCB0b3RhbCA9IGNvdW50IHx8IDBcbiAgICAgICAgY29uc3QgdG90YWxQYWdlcyA9IE1hdGguY2VpbCh0b3RhbCAvIHBhZ2VTaXplKVxuXG4gICAgICAgIHJldHVybiB7IHNlc3Npb25zLCB0b3RhbCwgcGFnZSwgcGFnZVNpemUsIHRvdGFsUGFnZXMgfVxuICAgIH1cblxuXHRhc3luYyBmaW5kQnlJZChpZDogc3RyaW5nLCB1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8U2Vzc2lvbiB8IG51bGw+IHtcblx0XHRjb25zdCB7IGRhdGE6IHJvdywgZXJyb3IgfSA9IGF3YWl0IHRoaXMuc3VwYWJhc2Vcblx0XHRcdC5mcm9tKCdzZXNzaW9ucycpXG5cdFx0XHQuc2VsZWN0KCdpZCx1c2VyX2lkLHN1YmplY3RfaWQsdGl0bGVfZW5jLHNlc3Npb25fdHlwZSxzdGFydGVkX2F0LGVuZGVkX2F0LHVwZGF0ZWRfYXQnKVxuXHRcdFx0LmVxKCdpZCcsIGlkKVxuXHRcdFx0LmVxKCd1c2VyX2lkJywgdXNlcklkKVxuXHRcdFx0LnNpbmdsZSgpXG5cblx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdGlmICgoZXJyb3IgYXMgYW55KS5jb2RlID09PSAnUEdSU1QxMTYnKSB7XG5cdFx0XHRcdHJldHVybiBudWxsIC8vIE5vdCBmb3VuZFxuXHRcdFx0fVxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZmV0Y2ggc2Vzc2lvbjogJHtlcnJvci5tZXNzYWdlfWApXG5cdFx0fVxuXG5cdFx0cmV0dXJuIG1hcERiU2Vzc2lvbihyb3cpXG5cdH1cblxuXHRhc3luYyBjcmVhdGUoc2Vzc2lvbkRhdGE6IFNlc3Npb25JbnNlcnQsIHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxTZXNzaW9uPiB7XG5cdFx0Y29uc3QgcmVxdWVzdGVkVHlwZSA9IChzZXNzaW9uRGF0YSBhcyBhbnkpPy50eXBlIHx8ICdhc2snXG5cdFx0Y29uc3QgeyBkYXRhOiBuZXdTZXNzaW9uSWQsIGVycm9yOiBycGNFcnJvciB9ID0gYXdhaXQgKHRoaXMuc3VwYWJhc2UgYXMgYW55KVxuXHRcdFx0LnJwYygnZ2V0X29yX2NyZWF0ZV9hY3RpdmVfc2Vzc2lvbicsIHsgcmVxdWVzdGVkX3R5cGU6IHJlcXVlc3RlZFR5cGUgfSlcblxuXHRcdGlmIChycGNFcnJvcikge1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gY3JlYXRlIHNlc3Npb246ICR7cnBjRXJyb3IubWVzc2FnZX1gKVxuXHRcdH1cblxuXHRcdGNvbnN0IHsgZGF0YTogcm93LCBlcnJvciB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxuXHRcdFx0LmZyb20oJ3Nlc3Npb25zJylcblx0XHRcdC5zZWxlY3QoJ2lkLHVzZXJfaWQsc3ViamVjdF9pZCx0aXRsZV9lbmMsc2Vzc2lvbl90eXBlLHN0YXJ0ZWRfYXQsZW5kZWRfYXQsdXBkYXRlZF9hdCcpXG5cdFx0XHQuZXEoJ2lkJywgbmV3U2Vzc2lvbklkKVxuXHRcdFx0LmVxKCd1c2VyX2lkJywgdXNlcklkKVxuXHRcdFx0LnNpbmdsZSgpXG5cblx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGZldGNoIGNyZWF0ZWQgc2Vzc2lvbjogJHtlcnJvci5tZXNzYWdlfWApXG5cdFx0fVxuXG5cdFx0cmV0dXJuIG1hcERiU2Vzc2lvbihyb3cpXG5cdH1cblxuXHRhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgc2Vzc2lvbkRhdGE6IFNlc3Npb25VcGRhdGUsIHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxTZXNzaW9uPiB7XG5cdFx0Ly8gU3VwcG9ydCB0aXRsZSB1cGRhdGUgYW5kIGVuZGluZyBhIHNlc3Npb25cblx0XHRpZiAoKHNlc3Npb25EYXRhIGFzIGFueSk/LnN0YXR1cyA9PT0gJ2NvbXBsZXRlZCcgfHwgKHNlc3Npb25EYXRhIGFzIGFueSk/LnN0YXR1cyA9PT0gJ2NhbmNlbGxlZCcpIHtcblx0XHRcdGNvbnN0IHsgZXJyb3I6IGVuZEVyciB9ID0gYXdhaXQgKHRoaXMuc3VwYWJhc2UgYXMgYW55KS5ycGMoJ2VuZF9zZXNzaW9uJywgeyBzZXNzaW9uX2lkOiBpZCB9KVxuXHRcdFx0aWYgKGVuZEVycikgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZW5kIHNlc3Npb246ICR7ZW5kRXJyLm1lc3NhZ2V9YClcblx0XHR9XG5cblx0XHRpZiAoKHNlc3Npb25EYXRhIGFzIGFueSk/LnRpdGxlKSB7XG5cdFx0XHRjb25zdCB7IGVycm9yOiB1cGRFcnIgfSA9IGF3YWl0IHRoaXMuc3VwYWJhc2Vcblx0XHRcdFx0LmZyb20oJ3Nlc3Npb25zJylcblx0XHRcdFx0LnVwZGF0ZSh7IHRpdGxlX2VuYzogKHNlc3Npb25EYXRhIGFzIGFueSkudGl0bGUgfSlcblx0XHRcdFx0LmVxKCdpZCcsIGlkKVxuXHRcdFx0XHQuZXEoJ3VzZXJfaWQnLCB1c2VySWQpXG5cdFx0XHRpZiAodXBkRXJyKSB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byB1cGRhdGUgc2Vzc2lvbjogJHt1cGRFcnIubWVzc2FnZX1gKVxuXHRcdH1cblxuXHRcdGNvbnN0IHsgZGF0YTogcm93LCBlcnJvciB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxuXHRcdFx0LmZyb20oJ3Nlc3Npb25zJylcblx0XHRcdC5zZWxlY3QoJ2lkLHVzZXJfaWQsc3ViamVjdF9pZCx0aXRsZV9lbmMsc2Vzc2lvbl90eXBlLHN0YXJ0ZWRfYXQsZW5kZWRfYXQsdXBkYXRlZF9hdCcpXG5cdFx0XHQuZXEoJ2lkJywgaWQpXG5cdFx0XHQuZXEoJ3VzZXJfaWQnLCB1c2VySWQpXG5cdFx0XHQuc2luZ2xlKClcblx0XHRpZiAoZXJyb3IpIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGZldGNoIHNlc3Npb246ICR7ZXJyb3IubWVzc2FnZX1gKVxuXHRcdHJldHVybiBtYXBEYlNlc3Npb24ocm93KVxuXHR9XG5cblx0YXN5bmMgZGVsZXRlKGlkOiBzdHJpbmcsIHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0Y29uc3QgeyBlcnJvciB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxuXHRcdFx0LmZyb20oJ3Nlc3Npb25zJylcblx0XHRcdC5kZWxldGUoKVxuXHRcdFx0LmVxKCdpZCcsIGlkKVxuXHRcdFx0LmVxKCd1c2VyX2lkJywgdXNlcklkKVxuXHRcdGlmIChlcnJvcikgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZGVsZXRlIHNlc3Npb246ICR7ZXJyb3IubWVzc2FnZX1gKVxuXHR9XG5cblx0YXN5bmMgZ2V0U3RhdHModXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPHtcblx0XHR0b3RhbDogbnVtYmVyXG5cdFx0YWN0aXZlOiBudW1iZXJcblx0XHRjb21wbGV0ZWQ6IG51bWJlclxuXHRcdGNhbmNlbGxlZDogbnVtYmVyXG5cdH0+IHtcblx0XHRjb25zdCBbdG90YWwsIGFjdGl2ZSwgY29tcGxldGVkXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcblx0XHRcdHRoaXMuc3VwYWJhc2UuZnJvbSgnc2Vzc2lvbnMnKS5zZWxlY3QoJyonLCB7IGNvdW50OiAnZXhhY3QnLCBoZWFkOiB0cnVlIH0pLmVxKCd1c2VyX2lkJywgdXNlcklkKSxcblx0XHRcdHRoaXMuc3VwYWJhc2UuZnJvbSgnc2Vzc2lvbnMnKS5zZWxlY3QoJyonLCB7IGNvdW50OiAnZXhhY3QnLCBoZWFkOiB0cnVlIH0pLmVxKCd1c2VyX2lkJywgdXNlcklkKS5pcygnZW5kZWRfYXQnLCBudWxsKSxcblx0XHRcdHRoaXMuc3VwYWJhc2UuZnJvbSgnc2Vzc2lvbnMnKS5zZWxlY3QoJyonLCB7IGNvdW50OiAnZXhhY3QnLCBoZWFkOiB0cnVlIH0pLmVxKCd1c2VyX2lkJywgdXNlcklkKS5ub3QoJ2VuZGVkX2F0JywgJ2lzJywgbnVsbCksXG5cdFx0XSlcblxuXHRcdHJldHVybiB7XG5cdFx0XHR0b3RhbDogKHRvdGFsLmNvdW50IGFzIG51bWJlcikgfHwgMCxcblx0XHRcdGFjdGl2ZTogKGFjdGl2ZS5jb3VudCBhcyBudW1iZXIpIHx8IDAsXG5cdFx0XHRjb21wbGV0ZWQ6IChjb21wbGV0ZWQuY291bnQgYXMgbnVtYmVyKSB8fCAwLFxuXHRcdFx0Y2FuY2VsbGVkOiAwLFxuXHRcdH1cblx0fVxufVxuIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInN1cGFiYXNlQW5vbktleSIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIiwiZGVmYXVsdENsaWVudCIsIm1hcERiU2Vzc2lvbiIsInJvdyIsInN0YXJ0ZWRBdCIsInN0YXJ0ZWRfYXQiLCJEYXRlIiwiZmFsbGJhY2tUaXRsZSIsInRvTG9jYWxlVGltZVN0cmluZyIsImhvdXIxMiIsImxvb2tzRW5jb2RlZCIsInRpdGxlX2VuYyIsInRlc3QiLCJpZCIsIm93bmVyX2lkIiwidXNlcl9pZCIsInN1YmplY3RfaWQiLCJ0aXRsZSIsInR5cGUiLCJzZXNzaW9uX3R5cGUiLCJzdGF0dXMiLCJlbmRlZF9hdCIsImNyZWF0ZWRfYXQiLCJ1cGRhdGVkX2F0IiwiU2Vzc2lvbnNSZXBvc2l0b3J5IiwiY29uc3RydWN0b3IiLCJzdXBhYmFzZSIsImZpbmRBbGwiLCJvcHRpb25zIiwiZmlsdGVycyIsInNvcnQiLCJkaXJlY3Rpb24iLCJwYWdlIiwicGFnZVNpemUiLCJ1c2VySWQiLCJzb3J0Q29sdW1uIiwiaW5jbHVkZXMiLCJxdWVyeSIsImZyb20iLCJzZWxlY3QiLCJjb3VudCIsImVxIiwic2VhcmNoIiwiaWxpa2UiLCJpcyIsIm5vdCIsImRhdGVGcm9tIiwiZ3RlIiwiZGF0ZVRvIiwibHRlIiwib3JkZXIiLCJhc2NlbmRpbmciLCJ0byIsInJhbmdlIiwiZGF0YSIsInJvd3MiLCJlcnJvciIsIkVycm9yIiwibWVzc2FnZSIsImJhc2VSb3dzIiwicGhvbmVCeVN1YmplY3QiLCJzdWJqZWN0SWRzIiwiQXJyYXkiLCJTZXQiLCJtYXAiLCJyIiwiZmlsdGVyIiwidiIsImxlbmd0aCIsImN1c3RSb3dzIiwiY3VzdEVyciIsImluIiwiaXNBcnJheSIsInBob25lIiwibWlzc2luZyIsImxlYWRSb3dzIiwic2Vzc2lvbnMiLCJzIiwidW5kZWZpbmVkIiwidG90YWwiLCJ0b3RhbFBhZ2VzIiwiTWF0aCIsImNlaWwiLCJmaW5kQnlJZCIsInNpbmdsZSIsImNvZGUiLCJjcmVhdGUiLCJzZXNzaW9uRGF0YSIsInJlcXVlc3RlZFR5cGUiLCJuZXdTZXNzaW9uSWQiLCJycGNFcnJvciIsInJwYyIsInJlcXVlc3RlZF90eXBlIiwidXBkYXRlIiwiZW5kRXJyIiwic2Vzc2lvbl9pZCIsInVwZEVyciIsImRlbGV0ZSIsImdldFN0YXRzIiwiYWN0aXZlIiwiY29tcGxldGVkIiwiUHJvbWlzZSIsImFsbCIsImhlYWQiLCJjYW5jZWxsZWQiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/server/repositories/sessions.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/repositories/transcripts.ts":
/*!************************************************!*\
  !*** ./src/server/repositories/transcripts.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   TranscriptsRepository: () => (/* binding */ TranscriptsRepository)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/.pnpm/@supabase+supabase-js@2.57.4/node_modules/@supabase/supabase-js/dist/module/index.js\");\n\n// Use untyped client until schema is applied and types regenerated\nconst supabaseUrl = \"https://hewpwluinbwaizwqhmjc.supabase.co\";\nconst supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhld3B3bHVpbmJ3YWl6d3FobWpjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5MTU5NTEsImV4cCI6MjA3MjQ5MTk1MX0.jhKzLYPdixxI8zcH20kkzL1WgP9RB33FeHtO0FRY7r4\";\nconst defaultClient = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey);\nfunction mapDbTranscript(row) {\n    return {\n        id: row.id,\n        session_id: row.session_id,\n        content_enc: row.text_enc,\n        speaker: row.speaker,\n        timestamp: row.created_at,\n        created_at: row.created_at\n    };\n}\nclass TranscriptsRepository {\n    constructor(supabase = defaultClient){\n        this.supabase = supabase;\n    }\n    async findAll(options) {\n        const { filters = {}, sort = 'created_at', direction = 'asc', page = 1, pageSize = 50 } = options;\n        const sortColumn = [\n            'created_at'\n        ].includes(sort) ? sort : 'created_at';\n        let query = this.supabase.from('transcripts').select('id,session_id,speaker,text_enc,created_at', {\n            count: 'exact'\n        });\n        if (filters.sessionId) {\n            query = query.eq('session_id', filters.sessionId);\n        }\n        if (filters.search) {\n            query = query.ilike('text_enc', `%${filters.search}%`);\n        }\n        if (filters.speaker) {\n            query = query.eq('speaker', filters.speaker);\n        }\n        if (filters.dateFrom) {\n            query = query.gte('created_at', filters.dateFrom);\n        }\n        if (filters.dateTo) {\n            query = query.lte('created_at', filters.dateTo);\n        }\n        query = query.order(sortColumn, {\n            ascending: direction === 'asc'\n        });\n        const from = (page - 1) * pageSize;\n        const to = from + pageSize - 1;\n        query = query.range(from, to);\n        const { data: rows, error, count } = await query;\n        if (error) throw new Error(`Failed to fetch transcripts: ${error.message}`);\n        const transcripts = (rows || []).map(mapDbTranscript);\n        const total = count || 0;\n        const totalPages = Math.ceil(total / pageSize);\n        return {\n            transcripts,\n            total,\n            page,\n            pageSize,\n            totalPages\n        };\n    }\n    async findBySessionId(sessionId, _userId) {\n        const { data: rows, error } = await this.supabase.from('transcripts').select('id,session_id,speaker,text_enc,created_at').eq('session_id', sessionId).order('created_at', {\n            ascending: true\n        });\n        if (error) throw new Error(`Failed to fetch session transcripts: ${error.message}`);\n        return (rows || []).map(mapDbTranscript);\n    }\n    async findById(id, _userId) {\n        const { data: row, error } = await this.supabase.from('transcripts').select('id,session_id,speaker,text_enc,created_at').eq('id', id).single();\n        if (error) {\n            if (error.code === 'PGRST116') return null;\n            throw new Error(`Failed to fetch transcript: ${error.message}`);\n        }\n        return mapDbTranscript(row);\n    }\n    async create(transcriptData, _userId) {\n        const sessionId = transcriptData.session_id;\n        const speaker = transcriptData.speaker || 'Speaker';\n        const textEnc = transcriptData.content_enc || transcriptData.text_enc;\n        const clientTranscriptId = transcriptData.client_transcript_id || transcriptData.clientId || null;\n        let newId = null;\n        let rpcErr = null;\n        if (clientTranscriptId) {\n            const { data, error } = await this.supabase.rpc('add_transcript_safe', {\n                p_session_id: sessionId,\n                p_speaker: speaker,\n                p_text_enc: textEnc,\n                p_client_transcript_id: clientTranscriptId\n            });\n            newId = data;\n            rpcErr = error;\n            if (rpcErr) {\n                const fallback = await this.supabase.rpc('add_transcript', {\n                    session_id: sessionId,\n                    speaker,\n                    text_enc: textEnc\n                });\n                newId = fallback.data;\n                rpcErr = fallback.error;\n            }\n        } else {\n            const res = await this.supabase.rpc('add_transcript', {\n                session_id: sessionId,\n                speaker,\n                text_enc: textEnc\n            });\n            newId = res.data;\n            rpcErr = res.error;\n        }\n        if (rpcErr) throw new Error(`Failed to create transcript: ${rpcErr.message}`);\n        const { data: row, error } = await this.supabase.from('transcripts').select('id,session_id,speaker,text_enc,created_at').eq('id', newId).single();\n        if (error) throw new Error(`Failed to fetch created transcript: ${error.message}`);\n        return mapDbTranscript(row);\n    }\n    async update(id, transcriptData, _userId) {\n        const updates = {};\n        if (transcriptData.content_enc) updates.text_enc = transcriptData.content_enc;\n        if (transcriptData.speaker) updates.speaker = transcriptData.speaker;\n        const { error: updErr } = await this.supabase.from('transcripts').update(updates).eq('id', id);\n        if (updErr) throw new Error(`Failed to update transcript: ${updErr.message}`);\n        const { data: row, error } = await this.supabase.from('transcripts').select('id,session_id,speaker,text_enc,created_at').eq('id', id).single();\n        if (error) throw new Error(`Failed to fetch transcript: ${error.message}`);\n        return mapDbTranscript(row);\n    }\n    async delete(id, _userId) {\n        const { error } = await this.supabase.from('transcripts').delete().eq('id', id);\n        if (error) throw new Error(`Failed to delete transcript: ${error.message}`);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3JlcG9zaXRvcmllcy90cmFuc2NyaXB0cy50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUFvRDtBQUVwRCxtRUFBbUU7QUFDbkUsTUFBTUMsY0FBY0MsMENBQW9DO0FBQ3hELE1BQU1HLGtCQUFrQkgsa05BQXlDO0FBQ2pFLE1BQU1LLGdCQUFnQlAsbUVBQVlBLENBQUNDLGFBQWFJO0FBMEJoRCxTQUFTRyxnQkFBZ0JDLEdBQVE7SUFDaEMsT0FBTztRQUNOQyxJQUFJRCxJQUFJQyxFQUFFO1FBQ1ZDLFlBQVlGLElBQUlFLFVBQVU7UUFDMUJDLGFBQWFILElBQUlJLFFBQVE7UUFDekJDLFNBQVNMLElBQUlLLE9BQU87UUFDcEJDLFdBQVdOLElBQUlPLFVBQVU7UUFDekJBLFlBQVlQLElBQUlPLFVBQVU7SUFDM0I7QUFDRDtBQUVPLE1BQU1DO0lBQ1pDLFlBQVksV0FBc0NYLGFBQWEsQ0FBRTthQUE3Q1ksV0FBQUE7SUFBOEM7SUFFbEUsTUFBTUMsUUFBUUMsT0FBOEIsRUFNekM7UUFDRixNQUFNLEVBQ0xDLFVBQVUsQ0FBQyxDQUFDLEVBQ1pDLE9BQU8sWUFBWSxFQUNuQkMsWUFBWSxLQUFLLEVBQ2pCQyxPQUFPLENBQUMsRUFDUkMsV0FBVyxFQUFFLEVBQ2IsR0FBR0w7UUFFSixNQUFNTSxhQUFhO1lBQUM7U0FBYSxDQUFDQyxRQUFRLENBQUNMLFFBQVFBLE9BQU87UUFFMUQsSUFBSU0sUUFBUSxJQUFJLENBQUNWLFFBQVEsQ0FDdkJXLElBQUksQ0FBQyxlQUNMQyxNQUFNLENBQUMsNkNBQTZDO1lBQUVDLE9BQU87UUFBUTtRQUV2RSxJQUFJVixRQUFRVyxTQUFTLEVBQUU7WUFDdEJKLFFBQVFBLE1BQU1LLEVBQUUsQ0FBQyxjQUFjWixRQUFRVyxTQUFTO1FBQ2pEO1FBRUEsSUFBSVgsUUFBUWEsTUFBTSxFQUFFO1lBQ25CTixRQUFRQSxNQUFNTyxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUMsRUFBRWQsUUFBUWEsTUFBTSxDQUFDLENB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QU0sRUFBRSxHQUFHLE1BQU0sSUFBSSxDQUFDM0QsUUFBUSxDQUFDVyxJQUFJLENBQUMsZUFBZThDLE1BQU0sQ0FBQ0MsU0FBUzNDLEVBQUUsQ0FBQyxNQUFNeEI7UUFDM0YsSUFBSW9FLFFBQVEsTUFBTSxJQUFJOUIsTUFBTSxDQUFDLDZCQUE2QixFQUFFOEIsT0FBTzdCLE9BQU8sRUFBRTtRQUM1RSxNQUFNLEVBQUVKLE1BQU1wQyxHQUFHLEVBQUVzQyxLQUFLLEVBQUUsR0FBRyxNQUFNLElBQUksQ0FBQzVCLFFBQVEsQ0FDOUNXLElBQUksQ0FBQyxlQUNMQyxNQUFNLENBQUMsNkNBQ1BHLEVBQUUsQ0FBQyxNQUFNeEIsSUFDVGlELE1BQU07UUFDUixJQUFJWixPQUFPLE1BQU0sSUFBSUMsTUFBTSxDQUFDLDRCQUE0QixFQUFFRCxNQUFNRSxPQUFPLEVBQUU7UUFDekUsT0FBT3pDLGdCQUFnQkM7SUFDeEI7SUFFQSxNQUFNc0UsT0FBT3JFLEVBQVUsRUFBRStDLE9BQWUsRUFBaUI7UUFDeEQsTUFBTSxFQUFFVixLQUFLLEVBQUUsR0FBRyxNQUFNLElBQUksQ0FBQzVCLFFBQVEsQ0FBQ1csSUFBSSxDQUFDLGVBQWVpRCxNQUFNLEdBQUc3QyxFQUFFLENBQUMsTUFBTXhCO1FBQzVFLElBQUlxQyxPQUFPLE1BQU0sSUFBSUMsTUFBTSxDQUFDLDZCQUE2QixFQUFFRCxNQUFNRSxPQUFPLEVBQUU7SUFDM0U7QUFDRCIsInNvdXJjZXMiOlsiRDpcXERlbHRhIElWXFxTb2Z3YXJlc1xcZ2xhc3NcXHNhbmRib3hcXHNoYWRjbi1jcm0tZGFzaGJvYXJkXFxzcmNcXHNlcnZlclxccmVwb3NpdG9yaWVzXFx0cmFuc2NyaXB0cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnXG5cbi8vIFVzZSB1bnR5cGVkIGNsaWVudCB1bnRpbCBzY2hlbWEgaXMgYXBwbGllZCBhbmQgdHlwZXMgcmVnZW5lcmF0ZWRcbmNvbnN0IHN1cGFiYXNlVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIVxuY29uc3Qgc3VwYWJhc2VBbm9uS2V5ID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkhXG5jb25zdCBkZWZhdWx0Q2xpZW50ID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZUFub25LZXkpXG5cbi8vIFRlbXBvcmFyeSB0eXBlcyB1bnRpbCBzY2hlbWEgaXMgYXBwbGllZFxudHlwZSBUcmFuc2NyaXB0ID0gYW55XG50eXBlIFRyYW5zY3JpcHRJbnNlcnQgPSBhbnlcbnR5cGUgVHJhbnNjcmlwdFVwZGF0ZSA9IGFueVxuXG50eXBlIFN1cGFiYXNlQ2xpZW50QW55ID0gdHlwZW9mIGRlZmF1bHRDbGllbnRcblxuZXhwb3J0IGludGVyZmFjZSBUcmFuc2NyaXB0RmlsdGVycyB7XG5cdHNlYXJjaD86IHN0cmluZ1xuXHRzZXNzaW9uSWQ/OiBzdHJpbmdcblx0ZGF0ZUZyb20/OiBzdHJpbmdcblx0ZGF0ZVRvPzogc3RyaW5nXG5cdHNwZWFrZXI/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUcmFuc2NyaXB0TGlzdE9wdGlvbnMge1xuXHRmaWx0ZXJzPzogVHJhbnNjcmlwdEZpbHRlcnNcblx0c29ydD86IHN0cmluZ1xuXHRkaXJlY3Rpb24/OiAnYXNjJyB8ICdkZXNjJ1xuXHRwYWdlPzogbnVtYmVyXG5cdHBhZ2VTaXplPzogbnVtYmVyXG5cdHVzZXJJZDogc3RyaW5nXG59XG5cbmZ1bmN0aW9uIG1hcERiVHJhbnNjcmlwdChyb3c6IGFueSk6IGFueSB7XG5cdHJldHVybiB7XG5cdFx0aWQ6IHJvdy5pZCxcblx0XHRzZXNzaW9uX2lkOiByb3cuc2Vzc2lvbl9pZCxcblx0XHRjb250ZW50X2VuYzogcm93LnRleHRfZW5jLFxuXHRcdHNwZWFrZXI6IHJvdy5zcGVha2VyLFxuXHRcdHRpbWVzdGFtcDogcm93LmNyZWF0ZWRfYXQsXG5cdFx0Y3JlYXRlZF9hdDogcm93LmNyZWF0ZWRfYXQsXG5cdH1cbn1cblxuZXhwb3J0IGNsYXNzIFRyYW5zY3JpcHRzUmVwb3NpdG9yeSB7XG5cdGNvbnN0cnVjdG9yKHByaXZhdGUgc3VwYWJhc2U6IFN1cGFiYXNlQ2xpZW50QW55ID0gZGVmYXVsdENsaWVudCkge31cblxuXHRhc3luYyBmaW5kQWxsKG9wdGlvbnM6IFRyYW5zY3JpcHRMaXN0T3B0aW9ucyk6IFByb21pc2U8e1xuXHRcdHRyYW5zY3JpcHRzOiBUcmFuc2NyaXB0W11cblx0XHR0b3RhbDogbnVtYmVyXG5cdFx0cGFnZTogbnVtYmVyXG5cdFx0cGFnZVNpemU6IG51bWJlclxuXHRcdHRvdGFsUGFnZXM6IG51bWJlclxuXHR9PiB7XG5cdFx0Y29uc3Qge1xuXHRcdFx0ZmlsdGVycyA9IHt9LFxuXHRcdFx0c29ydCA9ICdjcmVhdGVkX2F0Jyxcblx0XHRcdGRpcmVjdGlvbiA9ICdhc2MnLFxuXHRcdFx0cGFnZSA9IDEsXG5cdFx0XHRwYWdlU2l6ZSA9IDUwLFxuXHRcdH0gPSBvcHRpb25zXG5cblx0XHRjb25zdCBzb3J0Q29sdW1uID0gWydjcmVhdGVkX2F0J10uaW5jbHVkZXMoc29ydCkgPyBzb3J0IDogJ2NyZWF0ZWRfYXQnXG5cblx0XHRsZXQgcXVlcnkgPSB0aGlzLnN1cGFiYXNlXG5cdFx0XHQuZnJvbSgndHJhbnNjcmlwdHMnKVxuXHRcdFx0LnNlbGVjdCgnaWQsc2Vzc2lvbl9pZCxzcGVha2VyLHRleHRfZW5jLGNyZWF0ZWRfYXQnLCB7IGNvdW50OiAnZXhhY3QnIH0pXG5cblx0XHRpZiAoZmlsdGVycy5zZXNzaW9uSWQpIHtcblx0XHRcdHF1ZXJ5ID0gcXVlcnkuZXEoJ3Nlc3Npb25faWQnLCBmaWx0ZXJzLnNlc3Npb25JZClcblx0XHR9XG5cblx0XHRpZiAoZmlsdGVycy5zZWFyY2gpIHtcblx0XHRcdHF1ZXJ5ID0gcXVlcnkuaWxpa2UoJ3RleHRfZW5jJywgYCUke2ZpbHRlcnMuc2VhcmNofSVgKVxuXHRcdH1cblxuXHRcdGlmIChmaWx0ZXJzLnNwZWFrZXIpIHtcblx0XHRcdHF1ZXJ5ID0gcXVlcnkuZXEoJ3NwZWFrZXInLCBmaWx0ZXJzLnNwZWFrZXIpXG5cdFx0fVxuXG5cdFx0aWYgKGZpbHRlcnMuZGF0ZUZyb20pIHtcblx0XHRcdHF1ZXJ5ID0gcXVlcnkuZ3RlKCdjcmVhdGVkX2F0JywgZmlsdGVycy5kYXRlRnJvbSlcblx0XHR9XG5cblx0XHRpZiAoZmlsdGVycy5kYXRlVG8pIHtcblx0XHRcdHF1ZXJ5ID0gcXVlcnkubHRlKCdjcmVhdGVkX2F0JywgZmlsdGVycy5kYXRlVG8pXG5cdFx0fVxuXG5cdFx0cXVlcnkgPSBxdWVyeS5vcmRlcihzb3J0Q29sdW1uLCB7IGFzY2VuZGluZzogZGlyZWN0aW9uID09PSAnYXNjJyB9KVxuXG5cdFx0Y29uc3QgZnJvbSA9IChwYWdlIC0gMSkgKiBwYWdlU2l6ZVxuXHRcdGNvbnN0IHRvID0gZnJvbSArIHBhZ2VTaXplIC0gMVxuXHRcdHF1ZXJ5ID0gcXVlcnkucmFuZ2UoZnJvbSwgdG8pXG5cblx0XHRjb25zdCB7IGRhdGE6IHJvd3MsIGVycm9yLCBjb3VudCB9ID0gYXdhaXQgcXVlcnlcblx0XHRpZiAoZXJyb3IpIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGZldGNoIHRyYW5zY3JpcHRzOiAke2Vycm9yLm1lc3NhZ2V9YClcblxuXHRcdGNvbnN0IHRyYW5zY3JpcHRzID0gKHJvd3MgfHwgW10pLm1hcChtYXBEYlRyYW5zY3JpcHQpXG5cdFx0Y29uc3QgdG90YWwgPSBjb3VudCB8fCAwXG5cdFx0Y29uc3QgdG90YWxQYWdlcyA9IE1hdGguY2VpbCh0b3RhbCAvIHBhZ2VTaXplKVxuXG5cdFx0cmV0dXJuIHsgdHJhbnNjcmlwdHMsIHRvdGFsLCBwYWdlLCBwYWdlU2l6ZSwgdG90YWxQYWdlcyB9XG5cdH1cblxuXHRhc3luYyBmaW5kQnlTZXNzaW9uSWQoc2Vzc2lvbklkOiBzdHJpbmcsIF91c2VySWQ6IHN0cmluZyk6IFByb21pc2U8VHJhbnNjcmlwdFtdPiB7XG5cdFx0Y29uc3QgeyBkYXRhOiByb3dzLCBlcnJvciB9ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVxuXHRcdFx0LmZyb20oJ3RyYW5zY3JpcHRzJylcblx0XHRcdC5zZWxlY3QoJ2lkLHNlc3Npb25faWQsc3BlYWtlcix0ZXh0X2VuYyxjcmVhdGVkX2F0Jylcblx0XHRcdC5lcSgnc2Vzc2lvbl9pZCcsIHNlc3Npb25JZClcblx0XHRcdC5vcmRlcignY3JlYXRlZF9hdCcsIHsgYXNjZW5kaW5nOiB0cnVlIH0pXG5cdFx0aWYgKGVycm9yKSB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBmZXRjaCBzZXNzaW9uIHRyYW5zY3JpcHRzOiAke2Vycm9yLm1lc3NhZ2V9YClcblx0XHRyZXR1cm4gKHJvd3MgfHwgW10pLm1hcChtYXBEYlRyYW5zY3JpcHQpXG5cdH1cblxuXHRhc3luYyBmaW5kQnlJZChpZDogc3RyaW5nLCBfdXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPFRyYW5zY3JpcHQgfCBudWxsPiB7XG5cdFx0Y29uc3QgeyBkYXRhOiByb3csIGVycm9yIH0gPSBhd2FpdCB0aGlzLnN1cGFiYXNlXG5cdFx0XHQuZnJvbSgndHJhbnNjcmlwdHMnKVxuXHRcdFx0LnNlbGVjdCgnaWQsc2Vzc2lvbl9pZCxzcGVha2VyLHRleHRfZW5jLGNyZWF0ZWRfYXQnKVxuXHRcdFx0LmVxKCdpZCcsIGlkKVxuXHRcdFx0LnNpbmdsZSgpXG5cdFx0aWYgKGVycm9yKSB7XG5cdFx0XHRpZiAoKGVycm9yIGFzIGFueSkuY29kZSA9PT0gJ1BHUlNUMTE2JykgcmV0dXJuIG51bGxcblx0XHRcdHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGZldGNoIHRyYW5zY3JpcHQ6ICR7ZXJyb3IubWVzc2FnZX1gKVxuXHRcdH1cblx0XHRyZXR1cm4gbWFwRGJUcmFuc2NyaXB0KHJvdylcblx0fVxuXG5cdGFzeW5jIGNyZWF0ZSh0cmFuc2NyaXB0RGF0YTogVHJhbnNjcmlwdEluc2VydCwgX3VzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxUcmFuc2NyaXB0PiB7XG5cdFx0Y29uc3Qgc2Vzc2lvbklkID0gKHRyYW5zY3JpcHREYXRhIGFzIGFueSkuc2Vzc2lvbl9pZFxuXHRcdGNvbnN0IHNwZWFrZXIgPSAodHJhbnNjcmlwdERhdGEgYXMgYW55KS5zcGVha2VyIHx8ICdTcGVha2VyJ1xuXHRcdGNvbnN0IHRleHRFbmMgPSAodHJhbnNjcmlwdERhdGEgYXMgYW55KS5jb250ZW50X2VuYyB8fCAodHJhbnNjcmlwdERhdGEgYXMgYW55KS50ZXh0X2VuY1xuXG5cdFx0Y29uc3QgY2xpZW50VHJhbnNjcmlwdElkID0gKHRyYW5zY3JpcHREYXRhIGFzIGFueSkuY2xpZW50X3RyYW5zY3JpcHRfaWQgfHwgKHRyYW5zY3JpcHREYXRhIGFzIGFueSkuY2xpZW50SWQgfHwgbnVsbFxuXG5cdFx0bGV0IG5ld0lkOiBhbnkgPSBudWxsXG5cdFx0bGV0IHJwY0VycjogYW55ID0gbnVsbFxuXG5cdFx0aWYgKGNsaWVudFRyYW5zY3JpcHRJZCkge1xuXHRcdFx0Y29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgKHRoaXMuc3VwYWJhc2UgYXMgYW55KVxuXHRcdFx0XHQucnBjKCdhZGRfdHJhbnNjcmlwdF9zYWZlJywgeyBwX3Nlc3Npb25faWQ6IHNlc3Npb25JZCwgcF9zcGVha2VyOiBzcGVha2VyLCBwX3RleHRfZW5jOiB0ZXh0RW5jLCBwX2NsaWVudF90cmFuc2NyaXB0X2lkOiBjbGllbnRUcmFuc2NyaXB0SWQgfSlcblx0XHRcdG5ld0lkID0gZGF0YVxuXHRcdFx0cnBjRXJyID0gZXJyb3Jcblx0XHRcdGlmIChycGNFcnIpIHtcblx0XHRcdFx0Y29uc3QgZmFsbGJhY2sgPSBhd2FpdCAodGhpcy5zdXBhYmFzZSBhcyBhbnkpXG5cdFx0XHRcdFx0LnJwYygnYWRkX3RyYW5zY3JpcHQnLCB7IHNlc3Npb25faWQ6IHNlc3Npb25JZCwgc3BlYWtlciwgdGV4dF9lbmM6IHRleHRFbmMgfSlcblx0XHRcdFx0bmV3SWQgPSBmYWxsYmFjay5kYXRhXG5cdFx0XHRcdHJwY0VyciA9IGZhbGxiYWNrLmVycm9yXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNvbnN0IHJlcyA9IGF3YWl0ICh0aGlzLnN1cGFiYXNlIGFzIGFueSlcblx0XHRcdFx0LnJwYygnYWRkX3RyYW5zY3JpcHQnLCB7IHNlc3Npb25faWQ6IHNlc3Npb25JZCwgc3BlYWtlciwgdGV4dF9lbmM6IHRleHRFbmMgfSlcblx0XHRcdG5ld0lkID0gcmVzLmRhdGFcblx0XHRcdHJwY0VyciA9IHJlcy5lcnJvclxuXHRcdH1cblx0XHRpZiAocnBjRXJyKSB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBjcmVhdGUgdHJhbnNjcmlwdDogJHtycGNFcnIubWVzc2FnZX1gKVxuXG5cdFx0Y29uc3QgeyBkYXRhOiByb3csIGVycm9yIH0gPSBhd2FpdCB0aGlzLnN1cGFiYXNlXG5cdFx0XHQuZnJvbSgndHJhbnNjcmlwdHMnKVxuXHRcdFx0LnNlbGVjdCgnaWQsc2Vzc2lvbl9pZCxzcGVha2VyLHRleHRfZW5jLGNyZWF0ZWRfYXQnKVxuXHRcdFx0LmVxKCdpZCcsIG5ld0lkKVxuXHRcdFx0LnNpbmdsZSgpXG5cdFx0aWYgKGVycm9yKSB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBmZXRjaCBjcmVhdGVkIHRyYW5zY3JpcHQ6ICR7ZXJyb3IubWVzc2FnZX1gKVxuXHRcdHJldHVybiBtYXBEYlRyYW5zY3JpcHQocm93KVxuXHR9XG5cblx0YXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIHRyYW5zY3JpcHREYXRhOiBUcmFuc2NyaXB0VXBkYXRlLCBfdXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPFRyYW5zY3JpcHQ+IHtcblx0XHRjb25zdCB1cGRhdGVzOiBhbnkgPSB7fVxuXHRcdGlmICgodHJhbnNjcmlwdERhdGEgYXMgYW55KS5jb250ZW50X2VuYykgdXBkYXRlcy50ZXh0X2VuYyA9ICh0cmFuc2NyaXB0RGF0YSBhcyBhbnkpLmNvbnRlbnRfZW5jXG5cdFx0aWYgKCh0cmFuc2NyaXB0RGF0YSBhcyBhbnkpLnNwZWFrZXIpIHVwZGF0ZXMuc3BlYWtlciA9ICh0cmFuc2NyaXB0RGF0YSBhcyBhbnkpLnNwZWFrZXJcblx0XHRjb25zdCB7IGVycm9yOiB1cGRFcnIgfSA9IGF3YWl0IHRoaXMuc3VwYWJhc2UuZnJvbSgndHJhbnNjcmlwdHMnKS51cGRhdGUodXBkYXRlcykuZXEoJ2lkJywgaWQpXG5cdFx0aWYgKHVwZEVycikgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gdXBkYXRlIHRyYW5zY3JpcHQ6ICR7dXBkRXJyLm1lc3NhZ2V9YClcblx0XHRjb25zdCB7IGRhdGE6IHJvdywgZXJyb3IgfSA9IGF3YWl0IHRoaXMuc3VwYWJhc2Vcblx0XHRcdC5mcm9tKCd0cmFuc2NyaXB0cycpXG5cdFx0XHQuc2VsZWN0KCdpZCxzZXNzaW9uX2lkLHNwZWFrZXIsdGV4dF9lbmMsY3JlYXRlZF9hdCcpXG5cdFx0XHQuZXEoJ2lkJywgaWQpXG5cdFx0XHQuc2luZ2xlKClcblx0XHRpZiAoZXJyb3IpIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGZldGNoIHRyYW5zY3JpcHQ6ICR7ZXJyb3IubWVzc2FnZX1gKVxuXHRcdHJldHVybiBtYXBEYlRyYW5zY3JpcHQocm93KVxuXHR9XG5cblx0YXN5bmMgZGVsZXRlKGlkOiBzdHJpbmcsIF91c2VySWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuXHRcdGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHRoaXMuc3VwYWJhc2UuZnJvbSgndHJhbnNjcmlwdHMnKS5kZWxldGUoKS5lcSgnaWQnLCBpZClcblx0XHRpZiAoZXJyb3IpIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGRlbGV0ZSB0cmFuc2NyaXB0OiAke2Vycm9yLm1lc3NhZ2V9YClcblx0fVxufVxuIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInN1cGFiYXNlQW5vbktleSIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIiwiZGVmYXVsdENsaWVudCIsIm1hcERiVHJhbnNjcmlwdCIsInJvdyIsImlkIiwic2Vzc2lvbl9pZCIsImNvbnRlbnRfZW5jIiwidGV4dF9lbmMiLCJzcGVha2VyIiwidGltZXN0YW1wIiwiY3JlYXRlZF9hdCIsIlRyYW5zY3JpcHRzUmVwb3NpdG9yeSIsImNvbnN0cnVjdG9yIiwic3VwYWJhc2UiLCJmaW5kQWxsIiwib3B0aW9ucyIsImZpbHRlcnMiLCJzb3J0IiwiZGlyZWN0aW9uIiwicGFnZSIsInBhZ2VTaXplIiwic29ydENvbHVtbiIsImluY2x1ZGVzIiwicXVlcnkiLCJmcm9tIiwic2VsZWN0IiwiY291bnQiLCJzZXNzaW9uSWQiLCJlcSIsInNlYXJjaCIsImlsaWtlIiwiZGF0ZUZyb20iLCJndGUiLCJkYXRlVG8iLCJsdGUiLCJvcmRlciIsImFzY2VuZGluZyIsInRvIiwicmFuZ2UiLCJkYXRhIiwicm93cyIsImVycm9yIiwiRXJyb3IiLCJtZXNzYWdlIiwidHJhbnNjcmlwdHMiLCJtYXAiLCJ0b3RhbCIsInRvdGFsUGFnZXMiLCJNYXRoIiwiY2VpbCIsImZpbmRCeVNlc3Npb25JZCIsIl91c2VySWQiLCJmaW5kQnlJZCIsInNpbmdsZSIsImNvZGUiLCJjcmVhdGUiLCJ0cmFuc2NyaXB0RGF0YSIsInRleHRFbmMiLCJjbGllbnRUcmFuc2NyaXB0SWQiLCJjbGllbnRfdHJhbnNjcmlwdF9pZCIsImNsaWVudElkIiwibmV3SWQiLCJycGNFcnIiLCJycGMiLCJwX3Nlc3Npb25faWQiLCJwX3NwZWFrZXIiLCJwX3RleHRfZW5jIiwicF9jbGllbnRfdHJhbnNjcmlwdF9pZCIsImZhbGxiYWNrIiwicmVzIiwidXBkYXRlIiwidXBkYXRlcyIsInVwZEVyciIsImRlbGV0ZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/repositories/transcripts.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/services/chance-of-sale-decision.ts":
/*!********************************************************!*\
  !*** ./src/server/services/chance-of-sale-decision.ts ***!
  \********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   decideChanceOfSaleUpdate: () => (/* binding */ decideChanceOfSaleUpdate)\n/* harmony export */ });\n/* harmony import */ var _server_repositories_reports_v3_tabs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/server/repositories/reports-v3-tabs */ \"(rsc)/./src/server/repositories/reports-v3-tabs.ts\");\n/* harmony import */ var _server_repositories_sessions__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/server/repositories/sessions */ \"(rsc)/./src/server/repositories/sessions.ts\");\n/* harmony import */ var _server_repositories_transcripts__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/server/repositories/transcripts */ \"(rsc)/./src/server/repositories/transcripts.ts\");\n/* harmony import */ var _server_services_openrouter__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/server/services/openrouter */ \"(rsc)/./src/server/services/openrouter.ts\");\n\n\n\n\nfunction extractChanceSegment(markdown) {\n    if (!markdown) return null;\n    const startMarker = '<!-- TAB: CHANCE OF SALE -->';\n    const endMarker = '<!-- /TAB: CHANCE OF SALE -->';\n    const start = markdown.indexOf(startMarker);\n    const end = markdown.indexOf(endMarker);\n    if (start === -1 || end === -1 || end <= start) return null;\n    return markdown.slice(start, end + endMarker.length);\n}\nfunction summarizeTranscripts(transcripts) {\n    const totalSegments = transcripts.length;\n    const speakers = Array.from(new Set(transcripts.map((t)=>t.speaker).filter(Boolean)));\n    const totalChars = transcripts.reduce((sum, t)=>sum + (t.content_enc || t.text_enc || '').length, 0);\n    const lastSegments = transcripts.slice(-Math.min(5, totalSegments)).map((t)=>({\n            ts: t.timestamp || t.created_at,\n            speaker: t.speaker,\n            text: String(t.content_enc || t.text_enc || '').slice(0, 280)\n        }));\n    return {\n        totalSegments,\n        speakers,\n        totalChars,\n        lastSegments\n    };\n}\nasync function decideChanceOfSaleUpdate(supabase, userId, sessionId) {\n    const sessionsRepo = new _server_repositories_sessions__WEBPACK_IMPORTED_MODULE_1__.SessionsRepository(supabase);\n    const transcriptsRepo = new _server_repositories_transcripts__WEBPACK_IMPORTED_MODULE_2__.TranscriptsRepository(supabase);\n    const reportsRepo = new _server_repositories_reports_v3_tabs__WEBPACK_IMPORTED_MODULE_0__.ReportsV3TabsRepository(supabase);\n    const [session, transcripts, report] = await Promise.all([\n        sessionsRepo.findById(sessionId, userId),\n        transcriptsRepo.findBySessionId(sessionId, userId),\n        reportsRepo.findBySessionId(sessionId, userId)\n    ]);\n    const chanceSegment = extractChanceSegment(report?.report?.markdown);\n    const transcriptSummary = summarizeTranscripts(transcripts);\n    const tools = [\n        {\n            type: 'function',\n            function: {\n                name: 'skip_chance_of_sale_update',\n                description: 'Skip updating chance-of-sale when no material changes warrant a refresh. Must provide a clear reason.',\n                parameters: {\n                    type: 'object',\n                    properties: {\n                        reason: {\n                            type: 'string',\n                            description: 'Short explanation of why the chance-of-sale report should remain unchanged.'\n                        }\n                    },\n                    required: [\n                        'reason'\n                    ]\n                }\n            }\n        },\n        {\n            type: 'function',\n            function: {\n                name: 'request_chance_of_sale_update',\n                description: 'Trigger a chance-of-sale update when meaningful information changed.',\n                parameters: {\n                    type: 'object',\n                    properties: {\n                        reason: {\n                            type: 'string',\n                            description: 'Succinct justification for running the update.'\n                        },\n                        sections: {\n                            type: 'array',\n                            items: {\n                                type: 'string'\n                            },\n                            description: 'Optional list of sections (e.g., DEAL_HEALTH_PIPELINE, BANT, BOOSTERS_BLOCKERS) that require updates.'\n                        }\n                    },\n                    required: [\n                        'reason'\n                    ]\n                }\n            }\n        }\n    ];\n    const decisionState = {};\n    const handlers = {\n        skip_chance_of_sale_update: async (args)=>{\n            decisionState.value = {\n                action: 'skip',\n                reason: String(args?.reason || 'Model determined no meaningful change.')\n            };\n            return {\n                content: 'Skipping chance-of-sale update.'\n            };\n        },\n        request_chance_of_sale_update: async (args)=>{\n            const sections = Array.isArray(args?.sections) ? args.sections.map((s)=>String(s)) : undefined;\n            decisionState.value = {\n                action: 'update',\n                reason: String(args?.reason || 'Model requested a refresh.'),\n                sections: sections && sections.length > 0 ? sections : undefined\n            };\n            return {\n                content: 'Chance-of-sale update requested.'\n            };\n        }\n    };\n    const systemPrompt = `You are a revenue operations analyst. Review session context and decide whether the chance-of-sale report needs updating.\n- Call exactly one tool.\n- If no material change is found, call skip_chance_of_sale_update with a concise reason.\n- If an update is warranted, call request_chance_of_sale_update and specify the most impacted sections.\n- Consider transcript volume, speaker activity, and any shifts from the previous report.`;\n    const context = {\n        session: session ? {\n            id: session.id,\n            type: session.type,\n            status: session.status,\n            started_at: session.started_at,\n            ended_at: session.ended_at\n        } : null,\n        transcript_summary: transcriptSummary,\n        previous_chance_of_sale_excerpt: chanceSegment?.slice(0, 2000) || null\n    };\n    const messages = [\n        {\n            role: 'system',\n            content: systemPrompt\n        },\n        {\n            role: 'user',\n            content: `SESSION_ID: ${sessionId}\\nCONTEXT:\\n${JSON.stringify(context, null, 2)}`\n        }\n    ];\n    await (0,_server_services_openrouter__WEBPACK_IMPORTED_MODULE_3__.chatWithTools)({\n        model: process.env.OPENROUTER_TOOL_MODEL || process.env.OPENROUTER_MODEL || 'gpt-4o-mini',\n        messages,\n        tools,\n        handlers,\n        parallelToolCalls: false,\n        maxToolIterations: 1,\n        returnOnToolCall: true,\n        providerSort: 'latency',\n        temperature: 0\n    });\n    if (decisionState.value) {\n        return decisionState.value;\n    }\n    // Fallback heuristics\n    if (!chanceSegment) {\n        return {\n            action: 'update',\n            reason: 'No previous chance-of-sale report exists.'\n        };\n    }\n    if (transcriptSummary.totalSegments === 0) {\n        return {\n            action: 'skip',\n            reason: 'No transcripts available for this session.'\n        };\n    }\n    return {\n        action: 'update',\n        reason: 'Defaulting to update when model returned no explicit decision.'\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3NlcnZpY2VzL2NoYW5jZS1vZi1zYWxlLWRlY2lzaW9uLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQStFO0FBQ1o7QUFDTTtBQUN1QztBQVFoSCxTQUFTSSxxQkFBcUJDLFFBQXdCO0lBQ3JELElBQUksQ0FBQ0EsVUFBVSxPQUFPO0lBQ3RCLE1BQU1DLGNBQWM7SUFDcEIsTUFBTUMsWUFBWTtJQUNsQixNQUFNQyxRQUFRSCxTQUFTSSxPQUFPLENBQUNIO0lBQy9CLE1BQU1JLE1BQU1MLFNBQVNJLE9BQU8sQ0FBQ0Y7SUFDN0IsSUFBSUMsVUFBVSxDQUFDLEtBQUtFLFFBQVEsQ0FBQyxLQUFLQSxPQUFPRixPQUFPLE9BQU87SUFDdkQsT0FBT0gsU0FBU00sS0FBSyxDQUFDSCxPQUFPRSxNQUFNSCxVQUFVSyxNQUFNO0FBQ3BEO0FBRUEsU0FBU0MscUJBQXFCQyxXQUFrQjtJQUMvQyxNQUFNQyxnQkFBZ0JELFlBQVlGLE1BQU07SUFDeEMsTUFBTUksV0FBV0MsTUFBTUMsSUFBSSxDQUFDLElBQUlDLElBQUlMLFlBQVlNLEdBQUcsQ0FBQyxDQUFDQyxJQUFXQSxFQUFFQyxPQUFPLEVBQUVDLE1BQU0sQ0FBQ0M7SUFDbEYsTUFBTUMsYUFBYVgsWUFBWVksTUFBTSxDQUFDLENBQUNDLEtBQUtOLElBQU1NLE1BQU0sQ0FBRU4sRUFBRU8sV0FBVyxJQUFJUCxFQUFFUSxRQUFRLElBQUksRUFBQyxFQUFjakIsTUFBTSxFQUFFO0lBQ2hILE1BQU1rQixlQUFlaEIsWUFBWUgsS0FBSyxDQUFDLENBQUNvQixLQUFLQyxHQUFHLENBQUMsR0FBR2pCLGdCQUFnQkssR0FBRyxDQUFDLENBQUNDLElBQVk7WUFDcEZZLElBQUlaLEVBQUVhLFNBQVMsSUFBSWIsRUFBRWMsVUFBVTtZQUMvQmIsU0FBU0QsRUFBRUMsT0FBTztZQUNsQmMsTUFBTUMsT0FBT2hCLEVBQUVPLFdBQVcsSUFBSVAsRUFBRVEsUUFBUSxJQUFJLElBQUlsQixLQUFLLENBQUMs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QU16RSwwRUFBYUEsQ0FBQztRQUNuQm9GLE9BQU9DLFFBQVFDLEdBQUcsQ0FBQ0MscUJBQXFCLElBQUlGLFFBQVFDLEdBQUcsQ0FBQ0UsZ0JBQWdCLElBQUk7UUFDNUVSO1FBQ0E5QjtRQUNBWTtRQUNBMkIsbUJBQW1CO1FBQ25CQyxtQkFBbUI7UUFDbkJDLGtCQUFrQjtRQUNsQkMsY0FBYztRQUNkQyxhQUFhO0lBQ2Q7SUFFQSxJQUFJaEMsY0FBY0ksS0FBSyxFQUFFO1FBQ3hCLE9BQU9KLGNBQWNJLEtBQUs7SUFDM0I7SUFFQSxzQkFBc0I7SUFDdEIsSUFBSSxDQUFDakIsZUFBZTtRQUNuQixPQUFPO1lBQ05rQixRQUFRO1lBQ1JULFFBQVE7UUFDVDtJQUNEO0lBQ0EsSUFBSVIsa0JBQWtCckMsYUFBYSxLQUFLLEdBQUc7UUFDMUMsT0FBTztZQUNOc0QsUUFBUTtZQUNSVCxRQUFRO1FBQ1Q7SUFDRDtJQUNBLE9BQU87UUFDTlMsUUFBUTtRQUNSVCxRQUFRO0lBQ1Q7QUFDRCIsInNvdXJjZXMiOlsiRDpcXERlbHRhIElWXFxTb2Z3YXJlc1xcZ2xhc3NcXHNhbmRib3hcXHNoYWRjbi1jcm0tZGFzaGJvYXJkXFxzcmNcXHNlcnZlclxcc2VydmljZXNcXGNoYW5jZS1vZi1zYWxlLWRlY2lzaW9uLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJlcG9ydHNWM1RhYnNSZXBvc2l0b3J5IH0gZnJvbSAnQC9zZXJ2ZXIvcmVwb3NpdG9yaWVzL3JlcG9ydHMtdjMtdGFicydcbmltcG9ydCB7IFNlc3Npb25zUmVwb3NpdG9yeSB9IGZyb20gJ0Avc2VydmVyL3JlcG9zaXRvcmllcy9zZXNzaW9ucydcbmltcG9ydCB7IFRyYW5zY3JpcHRzUmVwb3NpdG9yeSB9IGZyb20gJ0Avc2VydmVyL3JlcG9zaXRvcmllcy90cmFuc2NyaXB0cydcbmltcG9ydCB7IGNoYXRXaXRoVG9vbHMsIFRvb2xEZWZpbml0aW9uLCBDaGF0TWVzc2FnZSwgQ2hhdFRvb2xIYW5kbGVyUmVzdWx0IH0gZnJvbSAnQC9zZXJ2ZXIvc2VydmljZXMvb3BlbnJvdXRlcidcblxuZXhwb3J0IGludGVyZmFjZSBDaGFuY2VPZlNhbGVEZWNpc2lvbiB7XG5cdGFjdGlvbjogJ3VwZGF0ZScgfCAnc2tpcCdcblx0cmVhc29uOiBzdHJpbmdcblx0c2VjdGlvbnM/OiBzdHJpbmdbXVxufVxuXG5mdW5jdGlvbiBleHRyYWN0Q2hhbmNlU2VnbWVudChtYXJrZG93bj86IHN0cmluZyB8IG51bGwpOiBzdHJpbmcgfCBudWxsIHtcblx0aWYgKCFtYXJrZG93bikgcmV0dXJuIG51bGxcblx0Y29uc3Qgc3RhcnRNYXJrZXIgPSAnPCEtLSBUQUI6IENIQU5DRSBPRiBTQUxFIC0tPidcblx0Y29uc3QgZW5kTWFya2VyID0gJzwhLS0gL1RBQjogQ0hBTkNFIE9GIFNBTEUgLS0+J1xuXHRjb25zdCBzdGFydCA9IG1hcmtkb3duLmluZGV4T2Yoc3RhcnRNYXJrZXIpXG5cdGNvbnN0IGVuZCA9IG1hcmtkb3duLmluZGV4T2YoZW5kTWFya2VyKVxuXHRpZiAoc3RhcnQgPT09IC0xIHx8IGVuZCA9PT0gLTEgfHwgZW5kIDw9IHN0YXJ0KSByZXR1cm4gbnVsbFxuXHRyZXR1cm4gbWFya2Rvd24uc2xpY2Uoc3RhcnQsIGVuZCArIGVuZE1hcmtlci5sZW5ndGgpXG59XG5cbmZ1bmN0aW9uIHN1bW1hcml6ZVRyYW5zY3JpcHRzKHRyYW5zY3JpcHRzOiBhbnlbXSkge1xuXHRjb25zdCB0b3RhbFNlZ21lbnRzID0gdHJhbnNjcmlwdHMubGVuZ3RoXG5cdGNvbnN0IHNwZWFrZXJzID0gQXJyYXkuZnJvbShuZXcgU2V0KHRyYW5zY3JpcHRzLm1hcCgodDogYW55KSA9PiB0LnNwZWFrZXIpLmZpbHRlcihCb29sZWFuKSkpXG5cdGNvbnN0IHRvdGFsQ2hhcnMgPSB0cmFuc2NyaXB0cy5yZWR1Y2UoKHN1bSwgdCkgPT4gc3VtICsgKCh0LmNvbnRlbnRfZW5jIHx8IHQudGV4dF9lbmMgfHwgJycpIGFzIHN0cmluZykubGVuZ3RoLCAwKVxuXHRjb25zdCBsYXN0U2VnbWVudHMgPSB0cmFuc2NyaXB0cy5zbGljZSgtTWF0aC5taW4oNSwgdG90YWxTZWdtZW50cykpLm1hcCgodDogYW55KSA9PiAoe1xuXHRcdHRzOiB0LnRpbWVzdGFtcCB8fCB0LmNyZWF0ZWRfYXQsXG5cdFx0c3BlYWtlcjogdC5zcGVha2VyLFxuXHRcdHRleHQ6IFN0cmluZyh0LmNvbnRlbnRfZW5jIHx8IHQudGV4dF9lbmMgfHwgJycpLnNsaWNlKDAsIDI4MCksXG5cdH0pKVxuXHRyZXR1cm4geyB0b3RhbFNlZ21lbnRzLCBzcGVha2VycywgdG90YWxDaGFycywgbGFzdFNlZ21lbnRzIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRlY2lkZUNoYW5jZU9mU2FsZVVwZGF0ZShcblx0c3VwYWJhc2U6IGFueSxcblx0dXNlcklkOiBzdHJpbmcsXG5cdHNlc3Npb25JZDogc3RyaW5nXG4pOiBQcm9taXNlPENoYW5jZU9mU2FsZURlY2lzaW9uPiB7XG5cdGNvbnN0IHNlc3Npb25zUmVwbyA9IG5ldyBTZXNzaW9uc1JlcG9zaXRvcnkoc3VwYWJhc2UpXG5cdGNvbnN0IHRyYW5zY3JpcHRzUmVwbyA9IG5ldyBUcmFuc2NyaXB0c1JlcG9zaXRvcnkoc3VwYWJhc2UpXG5cdGNvbnN0IHJlcG9ydHNSZXBvID0gbmV3IFJlcG9ydHNWM1RhYnNSZXBvc2l0b3J5KHN1cGFiYXNlKVxuXG5cdGNvbnN0IFtzZXNzaW9uLCB0cmFuc2NyaXB0cywgcmVwb3J0XSA9IGF3YWl0IFByb21pc2UuYWxsKFtcblx0XHRzZXNzaW9uc1JlcG8uZmluZEJ5SWQoc2Vzc2lvbklkLCB1c2VySWQpLFxuXHRcdHRyYW5zY3JpcHRzUmVwby5maW5kQnlTZXNzaW9uSWQoc2Vzc2lvbklkLCB1c2VySWQpLFxuXHRcdHJlcG9ydHNSZXBvLmZpbmRCeVNlc3Npb25JZChzZXNzaW9uSWQsIHVzZXJJZCksXG5cdF0pXG5cblx0Y29uc3QgY2hhbmNlU2VnbWVudCA9IGV4dHJhY3RDaGFuY2VTZWdtZW50KChyZXBvcnQ/LnJlcG9ydCBhcyBhbnkpPy5tYXJrZG93bilcblx0Y29uc3QgdHJhbnNjcmlwdFN1bW1hcnkgPSBzdW1tYXJpemVUcmFuc2NyaXB0cyh0cmFuc2NyaXB0cylcblxuXHRjb25zdCB0b29sczogVG9vbERlZmluaXRpb25bXSA9IFtcblx0XHR7XG5cdFx0XHR0eXBlOiAnZnVuY3Rpb24nLFxuXHRcdFx0ZnVuY3Rpb246IHtcblx0XHRcdFx0bmFtZTogJ3NraXBfY2hhbmNlX29mX3NhbGVfdXBkYXRlJyxcblx0XHRcdFx0ZGVzY3JpcHRpb246ICdTa2lwIHVwZGF0aW5nIGNoYW5jZS1vZi1zYWxlIHdoZW4gbm8gbWF0ZXJpYWwgY2hhbmdlcyB3YXJyYW50IGEgcmVmcmVzaC4gTXVzdCBwcm92aWRlIGEgY2xlYXIgcmVhc29uLicsXG5cdFx0XHRcdHBhcmFtZXRlcnM6IHtcblx0XHRcdFx0XHR0eXBlOiAnb2JqZWN0Jyxcblx0XHRcdFx0XHRwcm9wZXJ0aWVzOiB7XG5cdFx0XHRcdFx0XHRyZWFzb246IHsgdHlwZTogJ3N0cmluZycsIGRlc2NyaXB0aW9uOiAnU2hvcnQgZXhwbGFuYXRpb24gb2Ygd2h5IHRoZSBjaGFuY2Utb2Ytc2FsZSByZXBvcnQgc2hvdWxkIHJlbWFpbiB1bmNoYW5nZWQuJyB9XG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRyZXF1aXJlZDogWydyZWFzb24nXSxcblx0XHRcdFx0fSxcblx0XHRcdH0sXG5cdFx0fSxcblx0XHR7XG5cdFx0XHR0eXBlOiAnZnVuY3Rpb24nLFxuXHRcdFx0ZnVuY3Rpb246IHtcblx0XHRcdFx0bmFtZTogJ3JlcXVlc3RfY2hhbmNlX29mX3NhbGVfdXBkYXRlJyxcblx0XHRcdFx0ZGVzY3JpcHRpb246ICdUcmlnZ2VyIGEgY2hhbmNlLW9mLXNhbGUgdXBkYXRlIHdoZW4gbWVhbmluZ2Z1bCBpbmZvcm1hdGlvbiBjaGFuZ2VkLicsXG5cdFx0XHRcdHBhcmFtZXRlcnM6IHtcblx0XHRcdFx0XHR0eXBlOiAnb2JqZWN0Jyxcblx0XHRcdFx0XHRwcm9wZXJ0aWVzOiB7XG5cdFx0XHRcdFx0XHRyZWFzb246IHsgdHlwZTogJ3N0cmluZycsIGRlc2NyaXB0aW9uOiAnU3VjY2luY3QganVzdGlmaWNhdGlvbiBmb3IgcnVubmluZyB0aGUgdXBkYXRlLicgfSxcblx0XHRcdFx0XHRcdHNlY3Rpb25zOiB7XG5cdFx0XHRcdFx0XHRcdHR5cGU6ICdhcnJheScsXG5cdFx0XHRcdFx0XHRcdGl0ZW1zOiB7IHR5cGU6ICdzdHJpbmcnIH0sXG5cdFx0XHRcdFx0XHRcdGRlc2NyaXB0aW9uOiAnT3B0aW9uYWwgbGlzdCBvZiBzZWN0aW9ucyAoZS5nLiwgREVBTF9IRUFMVEhfUElQRUxJTkUsIEJBTlQsIEJPT1NURVJTX0JMT0NLRVJTKSB0aGF0IHJlcXVpcmUgdXBkYXRlcy4nLFxuXHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdHJlcXVpcmVkOiBbJ3JlYXNvbiddLFxuXHRcdFx0XHR9LFxuXHRcdFx0fSxcblx0XHR9LFxuXHRdXG5cblx0Y29uc3QgZGVjaXNpb25TdGF0ZTogeyB2YWx1ZT86IENoYW5jZU9mU2FsZURlY2lzaW9uIH0gPSB7fVxuXG5cdGNvbnN0IGhhbmRsZXJzID0ge1xuXHRcdHNraXBfY2hhbmNlX29mX3NhbGVfdXBkYXRlOiBhc3luYyAoYXJnczogYW55KTogUHJvbWlzZTxDaGF0VG9vbEhhbmRsZXJSZXN1bHQ+ID0+IHtcblx0XHRcdGRlY2lzaW9uU3RhdGUudmFsdWUgPSB7XG5cdFx0XHRcdGFjdGlvbjogJ3NraXAnLFxuXHRcdFx0XHRyZWFzb246IFN0cmluZyhhcmdzPy5yZWFzb24gfHwgJ01vZGVsIGRldGVybWluZWQgbm8gbWVhbmluZ2Z1bCBjaGFuZ2UuJyksXG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4geyBjb250ZW50OiAnU2tpcHBpbmcgY2hhbmNlLW9mLXNhbGUgdXBkYXRlLicgfVxuXHRcdH0sXG5cdFx0cmVxdWVzdF9jaGFuY2Vfb2Zfc2FsZV91cGRhdGU6IGFzeW5jIChhcmdzOiBhbnkpOiBQcm9taXNlPENoYXRUb29sSGFuZGxlclJlc3VsdD4gPT4ge1xuXHRcdFx0Y29uc3Qgc2VjdGlvbnMgPSBBcnJheS5pc0FycmF5KGFyZ3M/LnNlY3Rpb25zKSA/IGFyZ3Muc2VjdGlvbnMubWFwKChzOiBhbnkpID0+IFN0cmluZyhzKSkgOiB1bmRlZmluZWRcblx0XHRcdGRlY2lzaW9uU3RhdGUudmFsdWUgPSB7XG5cdFx0XHRcdGFjdGlvbjogJ3VwZGF0ZScsXG5cdFx0XHRcdHJlYXNvbjogU3RyaW5nKGFyZ3M/LnJlYXNvbiB8fCAnTW9kZWwgcmVxdWVzdGVkIGEgcmVmcmVzaC4nKSxcblx0XHRcdFx0c2VjdGlvbnM6IHNlY3Rpb25zICYmIHNlY3Rpb25zLmxlbmd0aCA+IDAgPyBzZWN0aW9ucyA6IHVuZGVmaW5lZCxcblx0XHRcdH1cblx0XHRcdHJldHVybiB7IGNvbnRlbnQ6ICdDaGFuY2Utb2Ytc2FsZSB1cGRhdGUgcmVxdWVzdGVkLicgfVxuXHRcdH0sXG5cdH1cblxuXHRjb25zdCBzeXN0ZW1Qcm9tcHQgPSBgWW91IGFyZSBhIHJldmVudWUgb3BlcmF0aW9ucyBhbmFseXN0LiBSZXZpZXcgc2Vzc2lvbiBjb250ZXh0IGFuZCBkZWNpZGUgd2hldGhlciB0aGUgY2hhbmNlLW9mLXNhbGUgcmVwb3J0IG5lZWRzIHVwZGF0aW5nLlxuLSBDYWxsIGV4YWN0bHkgb25lIHRvb2wuXG4tIElmIG5vIG1hdGVyaWFsIGNoYW5nZSBpcyBmb3VuZCwgY2FsbCBza2lwX2NoYW5jZV9vZl9zYWxlX3VwZGF0ZSB3aXRoIGEgY29uY2lzZSByZWFzb24uXG4tIElmIGFuIHVwZGF0ZSBpcyB3YXJyYW50ZWQsIGNhbGwgcmVxdWVzdF9jaGFuY2Vfb2Zfc2FsZV91cGRhdGUgYW5kIHNwZWNpZnkgdGhlIG1vc3QgaW1wYWN0ZWQgc2VjdGlvbnMuXG4tIENvbnNpZGVyIHRyYW5zY3JpcHQgdm9sdW1lLCBzcGVha2VyIGFjdGl2aXR5LCBhbmQgYW55IHNoaWZ0cyBmcm9tIHRoZSBwcmV2aW91cyByZXBvcnQuYFxuXG5cdGNvbnN0IGNvbnRleHQgPSB7XG5cdFx0c2Vzc2lvbjogc2Vzc2lvbiA/IHtcblx0XHRcdGlkOiBzZXNzaW9uLmlkLFxuXHRcdFx0dHlwZTogc2Vzc2lvbi50eXBlLFxuXHRcdFx0c3RhdHVzOiBzZXNzaW9uLnN0YXR1cyxcblx0XHRcdHN0YXJ0ZWRfYXQ6IHNlc3Npb24uc3RhcnRlZF9hdCxcblx0XHRcdGVuZGVkX2F0OiBzZXNzaW9uLmVuZGVkX2F0LFxuXHRcdH0gOiBudWxsLFxuXHRcdHRyYW5zY3JpcHRfc3VtbWFyeTogdHJhbnNjcmlwdFN1bW1hcnksXG5cdFx0cHJldmlvdXNfY2hhbmNlX29mX3NhbGVfZXhjZXJwdDogY2hhbmNlU2VnbWVudD8uc2xpY2UoMCwgMjAwMCkgfHwgbnVsbCxcblx0fVxuXG5cdGNvbnN0IG1lc3NhZ2VzOiBDaGF0TWVzc2FnZVtdID0gW1xuXHRcdHsgcm9sZTogJ3N5c3RlbScsIGNvbnRlbnQ6IHN5c3RlbVByb21wdCB9LFxuXHRcdHsgcm9sZTogJ3VzZXInLCBjb250ZW50OiBgU0VTU0lPTl9JRDogJHtzZXNzaW9uSWR9XFxuQ09OVEVYVDpcXG4ke0pTT04uc3RyaW5naWZ5KGNvbnRleHQsIG51bGwsIDIpfWAgfSxcblx0XVxuXG5cdGF3YWl0IGNoYXRXaXRoVG9vbHMoe1xuXHRcdG1vZGVsOiBwcm9jZXNzLmVudi5PUEVOUk9VVEVSX1RPT0xfTU9ERUwgfHwgcHJvY2Vzcy5lbnYuT1BFTlJPVVRFUl9NT0RFTCB8fCAnZ3B0LTRvLW1pbmknLFxuXHRcdG1lc3NhZ2VzLFxuXHRcdHRvb2xzLFxuXHRcdGhhbmRsZXJzLFxuXHRcdHBhcmFsbGVsVG9vbENhbGxzOiBmYWxzZSxcblx0XHRtYXhUb29sSXRlcmF0aW9uczogMSxcblx0XHRyZXR1cm5PblRvb2xDYWxsOiB0cnVlLFxuXHRcdHByb3ZpZGVyU29ydDogJ2xhdGVuY3knLFxuXHRcdHRlbXBlcmF0dXJlOiAwLFxuXHR9KVxuXG5cdGlmIChkZWNpc2lvblN0YXRlLnZhbHVlKSB7XG5cdFx0cmV0dXJuIGRlY2lzaW9uU3RhdGUudmFsdWVcblx0fVxuXG5cdC8vIEZhbGxiYWNrIGhldXJpc3RpY3Ncblx0aWYgKCFjaGFuY2VTZWdtZW50KSB7XG5cdFx0cmV0dXJuIHtcblx0XHRcdGFjdGlvbjogJ3VwZGF0ZScsXG5cdFx0XHRyZWFzb246ICdObyBwcmV2aW91cyBjaGFuY2Utb2Ytc2FsZSByZXBvcnQgZXhpc3RzLicsXG5cdFx0fVxuXHR9XG5cdGlmICh0cmFuc2NyaXB0U3VtbWFyeS50b3RhbFNlZ21lbnRzID09PSAwKSB7XG5cdFx0cmV0dXJuIHtcblx0XHRcdGFjdGlvbjogJ3NraXAnLFxuXHRcdFx0cmVhc29uOiAnTm8gdHJhbnNjcmlwdHMgYXZhaWxhYmxlIGZvciB0aGlzIHNlc3Npb24uJyxcblx0XHR9XG5cdH1cblx0cmV0dXJuIHtcblx0XHRhY3Rpb246ICd1cGRhdGUnLFxuXHRcdHJlYXNvbjogJ0RlZmF1bHRpbmcgdG8gdXBkYXRlIHdoZW4gbW9kZWwgcmV0dXJuZWQgbm8gZXhwbGljaXQgZGVjaXNpb24uJyxcblx0fVxufVxuIl0sIm5hbWVzIjpbIlJlcG9ydHNWM1RhYnNSZXBvc2l0b3J5IiwiU2Vzc2lvbnNSZXBvc2l0b3J5IiwiVHJhbnNjcmlwdHNSZXBvc2l0b3J5IiwiY2hhdFdpdGhUb29scyIsImV4dHJhY3RDaGFuY2VTZWdtZW50IiwibWFya2Rvd24iLCJzdGFydE1hcmtlciIsImVuZE1hcmtlciIsInN0YXJ0IiwiaW5kZXhPZiIsImVuZCIsInNsaWNlIiwibGVuZ3RoIiwic3VtbWFyaXplVHJhbnNjcmlwdHMiLCJ0cmFuc2NyaXB0cyIsInRvdGFsU2VnbWVudHMiLCJzcGVha2VycyIsIkFycmF5IiwiZnJvbSIsIlNldCIsIm1hcCIsInQiLCJzcGVha2VyIiwiZmlsdGVyIiwiQm9vbGVhbiIsInRvdGFsQ2hhcnMiLCJyZWR1Y2UiLCJzdW0iLCJjb250ZW50X2VuYyIsInRleHRfZW5jIiwibGFzdFNlZ21lbnRzIiwiTWF0aCIsIm1pbiIsInRzIiwidGltZXN0YW1wIiwiY3JlYXRlZF9hdCIsInRleHQiLCJTdHJpbmciLCJkZWNpZGVDaGFuY2VPZlNhbGVVcGRhdGUiLCJzdXBhYmFzZSIsInVzZXJJZCIsInNlc3Npb25JZCIsInNlc3Npb25zUmVwbyIsInRyYW5zY3JpcHRzUmVwbyIsInJlcG9ydHNSZXBvIiwic2Vzc2lvbiIsInJlcG9ydCIsIlByb21pc2UiLCJhbGwiLCJmaW5kQnlJZCIsImZpbmRCeVNlc3Npb25JZCIsImNoYW5jZVNlZ21lbnQiLCJ0cmFuc2NyaXB0U3VtbWFyeSIsInRvb2xzIiwidHlwZSIsImZ1bmN0aW9uIiwibmFtZSIsImRlc2NyaXB0aW9uIiwicGFyYW1ldGVycyIsInByb3BlcnRpZXMiLCJyZWFzb24iLCJyZXF1aXJlZCIsInNlY3Rpb25zIiwiaXRlbXMiLCJkZWNpc2lvblN0YXRlIiwiaGFuZGxlcnMiLCJza2lwX2NoYW5jZV9vZl9zYWxlX3VwZGF0ZSIsImFyZ3MiLCJ2YWx1ZSIsImFjdGlvbiIsImNvbnRlbnQiLCJyZXF1ZXN0X2NoYW5jZV9vZl9zYWxlX3VwZGF0ZSIsImlzQXJyYXkiLCJzIiwidW5kZWZpbmVkIiwic3lzdGVtUHJvbXB0IiwiY29udGV4dCIsImlkIiwic3RhdHVzIiwic3RhcnRlZF9hdCIsImVuZGVkX2F0IiwidHJhbnNjcmlwdF9zdW1tYXJ5IiwicHJldmlvdXNfY2hhbmNlX29mX3NhbGVfZXhjZXJwdCIsIm1lc3NhZ2VzIiwicm9sZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJtb2RlbCIsInByb2Nlc3MiLCJlbnYiLCJPUEVOUk9VVEVSX1RPT0xfTU9ERUwiLCJPUEVOUk9VVEVSX01PREVMIiwicGFyYWxsZWxUb29sQ2FsbHMiLCJtYXhUb29sSXRlcmF0aW9ucyIsInJldHVybk9uVG9vbENhbGwiLCJwcm92aWRlclNvcnQiLCJ0ZW1wZXJhdHVyZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/services/chance-of-sale-decision.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/services/chance-of-sale-report.ts":
/*!******************************************************!*\
  !*** ./src/server/services/chance-of-sale-report.ts ***!
  \******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generateChanceOfSaleReport: () => (/* binding */ generateChanceOfSaleReport)\n/* harmony export */ });\n/* harmony import */ var _server_repositories_reports_v3_tabs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/server/repositories/reports-v3-tabs */ \"(rsc)/./src/server/repositories/reports-v3-tabs.ts\");\n/* harmony import */ var _server_repositories_transcripts__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/server/repositories/transcripts */ \"(rsc)/./src/server/repositories/transcripts.ts\");\n/* harmony import */ var _server_services_openrouter__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/server/services/openrouter */ \"(rsc)/./src/server/services/openrouter.ts\");\n/* harmony import */ var _server_services_markdown_indexer__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/server/services/markdown-indexer */ \"(rsc)/./src/server/services/markdown-indexer.ts\");\n/* harmony import */ var _server_repositories_sessions__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/server/repositories/sessions */ \"(rsc)/./src/server/repositories/sessions.ts\");\n\n\n\n\n\nfunction buildChanceSystemPrompt() {\n    return [\n        'You are an enterprise sales analyst. Generate ONLY the Chance of Sale tab as Markdown.',\n        'Output MUST be wrapped with these exact markers and include section anchors for reliable updates:',\n        '<!-- TAB: CHANCE OF SALE -->',\n        '# Chance of Sale',\n        '',\n        '<!-- SECTION: COS/DEAL_HEALTH -->',\n        '## Deal Health Pipeline',\n        '- Paragraph summary of readiness and engagement, followed by bullets for boosters and blockers context.',\n        '<!-- /SECTION: COS/DEAL_HEALTH -->',\n        '',\n        '<!-- SECTION: COS/MEDDICC -->',\n        '## MEDDICC',\n        '| Dimension        | Observations | Score (%) |',\n        '|------------------|--------------|-----------|',\n        '| Metrics          |             |          |',\n        '| Economic Buyer   |             |          |',\n        '| Decision Criteria|             |          |',\n        '| Decision Process |             |          |',\n        '| Identify Pain    |             |          |',\n        '| Champion         |             |          |',\n        '| Competition      |             |          |',\n        '<!-- /SECTION: COS/MEDDICC -->',\n        '',\n        '<!-- SECTION: COS/BANT -->',\n        '## BANT',\n        '| Dimension | Observations | Score (%) |',\n        '|----------|--------------|-----------|',\n        '| Budget   |             |          |',\n        '| Authority|             |          |',\n        '| Need     |             |          |',\n        '| Timeline |             |          |',\n        '<!-- /SECTION: COS/BANT -->',\n        '',\n        '<!-- SECTION: COS/DEAL_SCORE -->',\n        '## Deal Score Calculation',\n        'Deal Score = (0.25*Metrics + 0.15*EconomicBuyer + 0.10*DecisionCriteria + 0.10*DecisionProcess + 0.15*IdentifyPain + 0.10*Champion + 0.05*Competition + 0.05*Authority)',\n        '<!-- /SECTION: COS/DEAL_SCORE -->',\n        '',\n        '<!-- SECTION: COS/PROBABILITY -->',\n        '## Probability of Sale',\n        'Provide a short paragraph with the % estimate and risks.',\n        '<!-- /SECTION: COS/PROBABILITY -->',\n        '',\n        '<!-- SECTION: COS/BOOSTERS_BLOCKERS -->',\n        '## Boosters vs Blockers',\n        '- Separate bullets for positive vs negative influences.',\n        '<!-- /SECTION: COS/BOOSTERS_BLOCKERS -->',\n        '',\n        '<!-- SECTION: COS/NEXT_STEPS -->',\n        '## Next Steps to Close',\n        '- 35 bullets with owner, deadline, micro-scripts.',\n        '<!-- /SECTION: COS/NEXT_STEPS -->',\n        '',\n        '<!-- /TAB: CHANCE OF SALE -->',\n        '',\n        'Do NOT include Executive Summary or Sales Rep Performance tabs.'\n    ].join('\\n');\n}\nfunction assembleChanceUserPrompt(session, transcripts) {\n    const parts = [];\n    parts.push(`# SESSION\\nID: ${session?.id}\\nType: ${session?.type || session?.session_type || ''}\\nStartedAt: ${session?.started_at || ''}`);\n    const segments = transcripts.map((t)=>({\n            ts: t.timestamp,\n            speaker: t.speaker,\n            text: t.content_enc\n        }));\n    parts.push(`# TRANSCRIPTS\\n${JSON.stringify(segments)}`);\n    return parts.join('\\n\\n');\n}\nasync function generateChanceOfSaleReport(supabase, userId, sessionId) {\n    const repo = new _server_repositories_reports_v3_tabs__WEBPACK_IMPORTED_MODULE_0__.ReportsV3TabsRepository(supabase);\n    const sessionsRepo = new _server_repositories_sessions__WEBPACK_IMPORTED_MODULE_4__.SessionsRepository(supabase);\n    const transcriptsRepo = new _server_repositories_transcripts__WEBPACK_IMPORTED_MODULE_1__.TranscriptsRepository(supabase);\n    const existing = await repo.findBySessionId(sessionId, userId);\n    if (!existing) {\n        await repo.upsertQueued(sessionId);\n    }\n    try {\n        await repo.setRunning(sessionId);\n    } catch  {}\n    const session = await sessionsRepo.findById(sessionId, userId);\n    if (!session) throw new Error('Session not found');\n    const transcripts = await transcriptsRepo.findBySessionId(sessionId, userId);\n    const system = buildChanceSystemPrompt();\n    const user = assembleChanceUserPrompt(session, transcripts);\n    const model = process.env.OPENROUTER_MODEL || 'qwen/qwen3-235b-a22b:free';\n    let jsonText = null;\n    for(let attempt = 1; attempt <= 2; attempt++){\n        try {\n            const r = await (0,_server_services_openrouter__WEBPACK_IMPORTED_MODULE_2__.chatText)({\n                model,\n                messages: [\n                    {\n                        role: 'system',\n                        content: system\n                    },\n                    {\n                        role: 'user',\n                        content: user\n                    }\n                ],\n                temperature: 0.2,\n                maxTokens: 4000,\n                timeoutMs: 180000,\n                debug: true\n            });\n            jsonText = {\n                content: (r.content || '').trim()\n            };\n            break;\n        } catch (e) {\n            if (attempt < 2) await new Promise((r)=>setTimeout(r, attempt * 1000));\n            else throw e;\n        }\n    }\n    const cosMd = jsonText?.content || '';\n    if (!cosMd) throw new Error('Empty chance-of-sale markdown');\n    const current = await repo.findBySessionId(sessionId, userId);\n    const existingMd = current?.report?.markdown;\n    let combined = cosMd;\n    if (existingMd) {\n        // If summary exists, preserve it at the front\n        const execStart = existingMd.indexOf('<!-- TAB: EXECUTIVE SUMMARY -->');\n        const execEnd = existingMd.indexOf('<!-- /TAB: EXECUTIVE SUMMARY -->');\n        if (execStart >= 0 && execEnd > execStart) {\n            const execPart = existingMd.slice(execStart, execEnd + '<!-- /TAB: EXECUTIVE SUMMARY -->'.length);\n            combined = [\n                execPart.trim(),\n                '',\n                cosMd\n            ].join('\\n\\n');\n        }\n    }\n    await supabase.from('session_reports_v3_tabs').update({\n        status: 'ready',\n        report_json: {\n            ...current?.report || {},\n            markdown: combined\n        },\n        last_error: null\n    }).eq('session_id', sessionId).then(({ error })=>{\n        if (error) throw error;\n    });\n    try {\n        await (0,_server_services_markdown_indexer__WEBPACK_IMPORTED_MODULE_3__.indexReportMarkdown)(supabase, sessionId, combined);\n        console.info('[cos] saved combined markdown', {\n            combined_len: combined.length\n        });\n    } catch  {}\n    // Versioning record for full regeneration\n    try {\n        const subjectId = session?.subject_id;\n        if (subjectId) {\n            const cosStart = combined.indexOf('<!-- TAB: CHANCE OF SALE -->');\n            const cosEnd = combined.indexOf('<!-- /TAB: CHANCE OF SALE -->');\n            const cosMdOnly = cosStart >= 0 && cosEnd > cosStart ? combined.slice(cosStart, cosEnd + '<!-- /TAB: CHANCE OF SALE -->'.length) : combined;\n            const { data: verRow } = await supabase.from('cos_versions').select('version').eq('subject_id', subjectId).order('version', {\n                ascending: false\n            }).limit(1);\n            const nextVersion = (verRow?.[0]?.version || 0) + 1;\n            await supabase.from('cos_versions').insert({\n                subject_id: subjectId,\n                session_id: sessionId,\n                version: nextVersion,\n                markdown: cosMdOnly,\n                ops_json: null,\n                reason: 'full_generation',\n                source: 'full'\n            });\n        }\n    } catch  {}\n    return {\n        markdown: combined\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3NlcnZpY2VzL2NoYW5jZS1vZi1zYWxlLXJlcG9ydC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBK0U7QUFDTjtBQUNsQjtBQUNpQjtBQUNMO0FBRW5FLFNBQVNLO0lBQ1AsT0FBTztRQUNMO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7S0FDRCxDQUFDQyxJQUFJLENBQUM7QUFDVDtBQUVBLFNBQVNDLHlCQUF5QkMsT0FBWSxFQUFFQyxXQUFrQjtJQUNoRSxNQUFNQyxRQUFrQixFQUFFO0lBQzFCQSxNQUFNQyxJQUFJLENBQUMsQ0FBQyxlQUFlLEVBQUVILFNBQVNJLEdBQUcsUUFBUSxFQUFFSixTQUFTSyxRQUFRTCxTQUFTTSxnQkFBZ0IsR0FBRyxhQUFhLEVBQUVOLFNBQVNPLGNBQWMsSUFBSTtJQUMxSSxNQUFNQyxXQUFXUCxZQUFZUSxHQUFHLENBQUNDLENBQUFBLElBQU07WUFBRUMsSUFBSUQsRUFBRUUsU0FBUztZQUFFQyxTQUFTSCxFQUFFRyxPQUFPO1lBQUVDLE1BQU1KLEVBQUVLLFdBQVc7UUFBQztJQUNsR2IsTUFBTUMsSUFBSSxDQUFDLENBQUMsZUFBZSxFQUFFYSxLQUFLQyxTQUFTLENBQUNULFdBQVc7SUFDdkQsT0FBT04sTUFBTUosSUFBSSxDQUFDO0FBQ3BCO0FBRU8sZUFBZW9CLDJCQUNwQkMsUUFBYSxFQUNiQyxNQUFjLEVBQ2RDLFNBQWlCO0lBRWpCLE1B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QUFXO1lBQ2IsTUFBTUUsV0FBV3BCLFNBQVNFLE9BQU8sQ0FBQztZQUNsQyxNQUFNbUIsU0FBU3JCLFNBQVNFLE9BQU8sQ0FBQztZQUNoQyxNQUFNb0IsWUFBWUYsWUFBWSxLQUFLQyxTQUFTRCxXQUFXcEIsU0FBU0ssS0FBSyxDQUFDZSxVQUFVQyxTQUFTLGdDQUFnQ2YsTUFBTSxJQUFJTjtZQUNuSSxNQUFNLEVBQUV1QixNQUFNQyxNQUFNLEVBQUUsR0FBRyxNQUFNLFNBQzVCakIsSUFBSSxDQUFDLGdCQUNMa0IsTUFBTSxDQUFDLFdBQ1BiLEVBQUUsQ0FBQyxjQUFjTSxXQUNqQlEsS0FBSyxDQUFDLFdBQVc7Z0JBQUVDLFdBQVc7WUFBTSxHQUNwQ0MsS0FBSyxDQUFDO1lBQ1QsTUFBTUMsY0FBYyxDQUFDTCxRQUFRLENBQUMsRUFBRSxFQUFFTSxXQUFXLEtBQUs7WUFDbEQsTUFBTSxTQUNIdkIsSUFBSSxDQUFDLGdCQUNMd0IsTUFBTSxDQUFDO2dCQUNOWixZQUFZRDtnQkFDWmMsWUFBWW5FO2dCQUNaaUUsU0FBU0Q7Z0JBQ1Q5QixVQUFVdUI7Z0JBQ1ZXLFVBQVU7Z0JBQ1ZDLFFBQVE7Z0JBQ1JDLFFBQVE7WUFDVjtRQUNKO0lBQ0YsRUFBRSxPQUFNLENBQUM7SUFFVCxPQUFPO1FBQUVwQyxVQUFVQztJQUFTO0FBQzlCIiwic291cmNlcyI6WyJEOlxcRGVsdGEgSVZcXFNvZndhcmVzXFxnbGFzc1xcc2FuZGJveFxcc2hhZGNuLWNybS1kYXNoYm9hcmRcXHNyY1xcc2VydmVyXFxzZXJ2aWNlc1xcY2hhbmNlLW9mLXNhbGUtcmVwb3J0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJlcG9ydHNWM1RhYnNSZXBvc2l0b3J5IH0gZnJvbSAnQC9zZXJ2ZXIvcmVwb3NpdG9yaWVzL3JlcG9ydHMtdjMtdGFicydcbmltcG9ydCB7IFRyYW5zY3JpcHRzUmVwb3NpdG9yeSB9IGZyb20gJ0Avc2VydmVyL3JlcG9zaXRvcmllcy90cmFuc2NyaXB0cydcbmltcG9ydCB7IGNoYXRUZXh0IH0gZnJvbSAnQC9zZXJ2ZXIvc2VydmljZXMvb3BlbnJvdXRlcidcbmltcG9ydCB7IGluZGV4UmVwb3J0TWFya2Rvd24gfSBmcm9tICdAL3NlcnZlci9zZXJ2aWNlcy9tYXJrZG93bi1pbmRleGVyJ1xuaW1wb3J0IHsgU2Vzc2lvbnNSZXBvc2l0b3J5IH0gZnJvbSAnQC9zZXJ2ZXIvcmVwb3NpdG9yaWVzL3Nlc3Npb25zJ1xuXG5mdW5jdGlvbiBidWlsZENoYW5jZVN5c3RlbVByb21wdCgpOiBzdHJpbmcge1xuICByZXR1cm4gW1xuICAgICdZb3UgYXJlIGFuIGVudGVycHJpc2Ugc2FsZXMgYW5hbHlzdC4gR2VuZXJhdGUgT05MWSB0aGUgQ2hhbmNlIG9mIFNhbGUgdGFiIGFzIE1hcmtkb3duLicsXG4gICAgJ091dHB1dCBNVVNUIGJlIHdyYXBwZWQgd2l0aCB0aGVzZSBleGFjdCBtYXJrZXJzIGFuZCBpbmNsdWRlIHNlY3Rpb24gYW5jaG9ycyBmb3IgcmVsaWFibGUgdXBkYXRlczonLFxuICAgICc8IS0tIFRBQjogQ0hBTkNFIE9GIFNBTEUgLS0+JyxcbiAgICAnIyBDaGFuY2Ugb2YgU2FsZScsXG4gICAgJycsXG4gICAgJzwhLS0gU0VDVElPTjogQ09TL0RFQUxfSEVBTFRIIC0tPicsXG4gICAgJyMjIERlYWwgSGVhbHRoIFBpcGVsaW5lJyxcbiAgICAnLSBQYXJhZ3JhcGggc3VtbWFyeSBvZiByZWFkaW5lc3MgYW5kIGVuZ2FnZW1lbnQsIGZvbGxvd2VkIGJ5IGJ1bGxldHMgZm9yIGJvb3N0ZXJzIGFuZCBibG9ja2VycyBjb250ZXh0LicsXG4gICAgJzwhLS0gL1NFQ1RJT046IENPUy9ERUFMX0hFQUxUSCAtLT4nLFxuICAgICcnLFxuICAgICc8IS0tIFNFQ1RJT046IENPUy9NRURESUNDIC0tPicsXG4gICAgJyMjIE1FRERJQ0MnLFxuICAgICd8IERpbWVuc2lvbiAgICAgICAgfCBPYnNlcnZhdGlvbnMgfCBTY29yZSAoJSkgfCcsXG4gICAgJ3wtLS0tLS0tLS0tLS0tLS0tLS18LS0tLS0tLS0tLS0tLS18LS0tLS0tLS0tLS18JyxcbiAgICAnfCBNZXRyaWNzICAgICAgICAgIHwg4oCmICAgICAgICAgICAgfCDigKYgICAgICAgICB8JyxcbiAgICAnfCBFY29ub21pYyBCdXllciAgIHwg4oCmICAgICAgICAgICAgfCDigKYgICAgICAgICB8JyxcbiAgICAnfCBEZWNpc2lvbiBDcml0ZXJpYXwg4oCmICAgICAgICAgICAgfCDigKYgICAgICAgICB8JyxcbiAgICAnfCBEZWNpc2lvbiBQcm9jZXNzIHwg4oCmICAgICAgICAgICAgfCDigKYgICAgICAgICB8JyxcbiAgICAnfCBJZGVudGlmeSBQYWluICAgIHwg4oCmICAgICAgICAgICAgfCDigKYgICAgICAgICB8JyxcbiAgICAnfCBDaGFtcGlvbiAgICAgICAgIHwg4oCmICAgICAgICAgICAgfCDigKYgICAgICAgICB8JyxcbiAgICAnfCBDb21wZXRpdGlvbiAgICAgIHwg4oCmICAgICAgICAgICAgfCDigKYgICAgICAgICB8JyxcbiAgICAnPCEtLSAvU0VDVElPTjogQ09TL01FRERJQ0MgLS0+JyxcbiAgICAnJyxcbiAgICAnPCEtLSBTRUNUSU9OOiBDT1MvQkFOVCAtLT4nLFxuICAgICcjIyBCQU5UJyxcbiAgICAnfCBEaW1lbnNpb24gfCBPYnNlcnZhdGlvbnMgfCBTY29yZSAoJSkgfCcsXG4gICAgJ3wtLS0tLS0tLS0tfC0tLS0tLS0tLS0tLS0tfC0tLS0tLS0tLS0tfCcsXG4gICAgJ3wgQnVkZ2V0ICAgfCDigKYgICAgICAgICAgICB8IOKApiAgICAgICAgIHwnLFxuICAgICd8IEF1dGhvcml0eXwg4oCmICAgICAgICAgICAgfCDigKYgICAgICAgICB8JyxcbiAgICAnfCBOZWVkICAgICB8IOKApiAgICAgICAgICAgIHwg4oCmICAgICAgICAgfCcsXG4gICAgJ3wgVGltZWxpbmUgfCDigKYgICAgICAgICAgICB8IOKApiAgICAgICAgIHwnLFxuICAgICc8IS0tIC9TRUNUSU9OOiBDT1MvQkFOVCAtLT4nLFxuICAgICcnLFxuICAgICc8IS0tIFNFQ1RJT046IENPUy9ERUFMX1NDT1JFIC0tPicsXG4gICAgJyMjIERlYWwgU2NvcmUgQ2FsY3VsYXRpb24nLFxuICAgICdEZWFsIFNjb3JlID0gKDAuMjUqTWV0cmljcyArIDAuMTUqRWNvbm9taWNCdXllciArIDAuMTAqRGVjaXNpb25Dcml0ZXJpYSArIDAuMTAqRGVjaXNpb25Qcm9jZXNzICsgMC4xNSpJZGVudGlmeVBhaW4gKyAwLjEwKkNoYW1waW9uICsgMC4wNSpDb21wZXRpdGlvbiArIDAuMDUqQXV0aG9yaXR5KScsXG4gICAgJzwhLS0gL1NFQ1RJT046IENPUy9ERUFMX1NDT1JFIC0tPicsXG4gICAgJycsXG4gICAgJzwhLS0gU0VDVElPTjogQ09TL1BST0JBQklMSVRZIC0tPicsXG4gICAgJyMjIFByb2JhYmlsaXR5IG9mIFNhbGUnLFxuICAgICdQcm92aWRlIGEgc2hvcnQgcGFyYWdyYXBoIHdpdGggdGhlICUgZXN0aW1hdGUgYW5kIHJpc2tzLicsXG4gICAgJzwhLS0gL1NFQ1RJT046IENPUy9QUk9CQUJJTElUWSAtLT4nLFxuICAgICcnLFxuICAgICc8IS0tIFNFQ1RJT046IENPUy9CT09TVEVSU19CTE9DS0VSUyAtLT4nLFxuICAgICcjIyBCb29zdGVycyB2cyBCbG9ja2VycycsXG4gICAgJy0gU2VwYXJhdGUgYnVsbGV0cyBmb3IgcG9zaXRpdmUgdnMgbmVnYXRpdmUgaW5mbHVlbmNlcy4nLFxuICAgICc8IS0tIC9TRUNUSU9OOiBDT1MvQk9PU1RFUlNfQkxPQ0tFUlMgLS0+JyxcbiAgICAnJyxcbiAgICAnPCEtLSBTRUNUSU9OOiBDT1MvTkVYVF9TVEVQUyAtLT4nLFxuICAgICcjIyBOZXh0IFN0ZXBzIHRvIENsb3NlJyxcbiAgICAnLSAz4oCTNSBidWxsZXRzIHdpdGggb3duZXIsIGRlYWRsaW5lLCBtaWNyby1zY3JpcHRzLicsXG4gICAgJzwhLS0gL1NFQ1RJT046IENPUy9ORVhUX1NURVBTIC0tPicsXG4gICAgJycsXG4gICAgJzwhLS0gL1RBQjogQ0hBTkNFIE9GIFNBTEUgLS0+JyxcbiAgICAnJyxcbiAgICAnRG8gTk9UIGluY2x1ZGUgRXhlY3V0aXZlIFN1bW1hcnkgb3IgU2FsZXMgUmVwIFBlcmZvcm1hbmNlIHRhYnMuJyxcbiAgXS5qb2luKCdcXG4nKVxufVxuXG5mdW5jdGlvbiBhc3NlbWJsZUNoYW5jZVVzZXJQcm9tcHQoc2Vzc2lvbjogYW55LCB0cmFuc2NyaXB0czogYW55W10pOiBzdHJpbmcge1xuICBjb25zdCBwYXJ0czogc3RyaW5nW10gPSBbXVxuICBwYXJ0cy5wdXNoKGAjIFNFU1NJT05cXG5JRDogJHtzZXNzaW9uPy5pZH1cXG5UeXBlOiAke3Nlc3Npb24/LnR5cGUgfHwgc2Vzc2lvbj8uc2Vzc2lvbl90eXBlIHx8ICcnfVxcblN0YXJ0ZWRBdDogJHtzZXNzaW9uPy5zdGFydGVkX2F0IHx8ICcnfWApXG4gIGNvbnN0IHNlZ21lbnRzID0gdHJhbnNjcmlwdHMubWFwKHQgPT4gKHsgdHM6IHQudGltZXN0YW1wLCBzcGVha2VyOiB0LnNwZWFrZXIsIHRleHQ6IHQuY29udGVudF9lbmMgfSkpXG4gIHBhcnRzLnB1c2goYCMgVFJBTlNDUklQVFNcXG4ke0pTT04uc3RyaW5naWZ5KHNlZ21lbnRzKX1gKVxuICByZXR1cm4gcGFydHMuam9pbignXFxuXFxuJylcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlQ2hhbmNlT2ZTYWxlUmVwb3J0KFxuICBzdXBhYmFzZTogYW55LFxuICB1c2VySWQ6IHN0cmluZyxcbiAgc2Vzc2lvbklkOiBzdHJpbmdcbik6IFByb21pc2U8eyBtYXJrZG93bjogc3RyaW5nIH0+IHtcbiAgY29uc3QgcmVwbyA9IG5ldyBSZXBvcnRzVjNUYWJzUmVwb3NpdG9yeShzdXBhYmFzZSlcbiAgY29uc3Qgc2Vzc2lvbnNSZXBvID0gbmV3IFNlc3Npb25zUmVwb3NpdG9yeShzdXBhYmFzZSlcbiAgY29uc3QgdHJhbnNjcmlwdHNSZXBvID0gbmV3IFRyYW5zY3JpcHRzUmVwb3NpdG9yeShzdXBhYmFzZSlcblxuICBjb25zdCBleGlzdGluZyA9IGF3YWl0IHJlcG8uZmluZEJ5U2Vzc2lvbklkKHNlc3Npb25JZCwgdXNlcklkKVxuICBpZiAoIWV4aXN0aW5nKSB7XG4gICAgYXdhaXQgcmVwby51cHNlcnRRdWV1ZWQoc2Vzc2lvbklkKVxuICB9XG4gIHRyeSB7IGF3YWl0IHJlcG8uc2V0UnVubmluZyhzZXNzaW9uSWQpIH0gY2F0Y2gge31cblxuICBjb25zdCBzZXNzaW9uID0gYXdhaXQgc2Vzc2lvbnNSZXBvLmZpbmRCeUlkKHNlc3Npb25JZCwgdXNlcklkKVxuICBpZiAoIXNlc3Npb24pIHRocm93IG5ldyBFcnJvcignU2Vzc2lvbiBub3QgZm91bmQnKVxuICBjb25zdCB0cmFuc2NyaXB0cyA9IGF3YWl0IHRyYW5zY3JpcHRzUmVwby5maW5kQnlTZXNzaW9uSWQoc2Vzc2lvbklkLCB1c2VySWQpXG5cbiAgY29uc3Qgc3lzdGVtID0gYnVpbGRDaGFuY2VTeXN0ZW1Qcm9tcHQoKVxuICBjb25zdCB1c2VyID0gYXNzZW1ibGVDaGFuY2VVc2VyUHJvbXB0KHNlc3Npb24sIHRyYW5zY3JpcHRzKVxuICBjb25zdCBtb2RlbCA9IChwcm9jZXNzLmVudi5PUEVOUk9VVEVSX01PREVMIHx8ICdxd2VuL3F3ZW4zLTIzNWItYTIyYjpmcmVlJylcblxuICBsZXQganNvblRleHQ6IHsgY29udGVudDogc3RyaW5nIH0gfCBudWxsID0gbnVsbFxuICBmb3IgKGxldCBhdHRlbXB0ID0gMTsgYXR0ZW1wdCA8PSAyOyBhdHRlbXB0KyspIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgciA9IGF3YWl0IGNoYXRUZXh0KHtcbiAgICAgICAgbW9kZWwsXG4gICAgICAgIG1lc3NhZ2VzOiBbXG4gICAgICAgICAgeyByb2xlOiAnc3lzdGVtJywgY29udGVudDogc3lzdGVtIH0sXG4gICAgICAgICAgeyByb2xlOiAndXNlcicsIGNvbnRlbnQ6IHVzZXIgfSxcbiAgICAgICAgXSxcbiAgICAgICAgdGVtcGVyYXR1cmU6IDAuMixcbiAgICAgICAgbWF4VG9rZW5zOiA0MDAwLFxuICAgICAgICB0aW1lb3V0TXM6IDE4MF8wMDAsXG4gICAgICAgIGRlYnVnOiB0cnVlLFxuICAgICAgfSlcbiAgICAgIGpzb25UZXh0ID0geyBjb250ZW50OiAoci5jb250ZW50IHx8ICcnKS50cmltKCkgfVxuICAgICAgYnJlYWtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBpZiAoYXR0ZW1wdCA8IDIpIGF3YWl0IG5ldyBQcm9taXNlKHIgPT4gc2V0VGltZW91dChyLCBhdHRlbXB0ICogMTAwMCkpXG4gICAgICBlbHNlIHRocm93IGVcbiAgICB9XG4gIH1cbiAgY29uc3QgY29zTWQgPSBqc29uVGV4dD8uY29udGVudCB8fCAnJ1xuICBpZiAoIWNvc01kKSB0aHJvdyBuZXcgRXJyb3IoJ0VtcHR5IGNoYW5jZS1vZi1zYWxlIG1hcmtkb3duJylcblxuICBjb25zdCBjdXJyZW50ID0gYXdhaXQgcmVwby5maW5kQnlTZXNzaW9uSWQoc2Vzc2lvbklkLCB1c2VySWQpXG4gIGNvbnN0IGV4aXN0aW5nTWQ6IHN0cmluZyB8IHVuZGVmaW5lZCA9IChjdXJyZW50Py5yZXBvcnQgYXMgYW55KT8ubWFya2Rvd25cblxuICBsZXQgY29tYmluZWQgPSBjb3NNZFxuICBpZiAoZXhpc3RpbmdNZCkge1xuICAgIC8vIElmIHN1bW1hcnkgZXhpc3RzLCBwcmVzZXJ2ZSBpdCBhdCB0aGUgZnJvbnRcbiAgICBjb25zdCBleGVjU3RhcnQgPSBleGlzdGluZ01kLmluZGV4T2YoJzwhLS0gVEFCOiBFWEVDVVRJVkUgU1VNTUFSWSAtLT4nKVxuICAgIGNvbnN0IGV4ZWNFbmQgPSBleGlzdGluZ01kLmluZGV4T2YoJzwhLS0gL1RBQjogRVhFQ1VUSVZFIFNVTU1BUlkgLS0+JylcbiAgICBpZiAoZXhlY1N0YXJ0ID49IDAgJiYgZXhlY0VuZCA+IGV4ZWNTdGFydCkge1xuICAgICAgY29uc3QgZXhlY1BhcnQgPSBleGlzdGluZ01kLnNsaWNlKGV4ZWNTdGFydCwgZXhlY0VuZCArICc8IS0tIC9UQUI6IEVYRUNVVElWRSBTVU1NQVJZIC0tPicubGVuZ3RoKVxuICAgICAgY29tYmluZWQgPSBbZXhlY1BhcnQudHJpbSgpLCAnJywgY29zTWRdLmpvaW4oJ1xcblxcbicpXG4gICAgfVxuICB9XG5cbiAgYXdhaXQgKHN1cGFiYXNlIGFzIGFueSlcbiAgICAuZnJvbSgnc2Vzc2lvbl9yZXBvcnRzX3YzX3RhYnMnKVxuICAgIC51cGRhdGUoeyBzdGF0dXM6ICdyZWFkeScsIHJlcG9ydF9qc29uOiB7IC4uLihjdXJyZW50Py5yZXBvcnQgfHwge30pLCBtYXJrZG93bjogY29tYmluZWQgfSwgbGFzdF9lcnJvcjogbnVsbCB9KVxuICAgIC5lcSgnc2Vzc2lvbl9pZCcsIHNlc3Npb25JZClcbiAgICAudGhlbigoeyBlcnJvciB9OiBhbnkpID0+IHsgaWYgKGVycm9yKSB0aHJvdyBlcnJvciB9KVxuXG4gIHRyeSB7IGF3YWl0IGluZGV4UmVwb3J0TWFya2Rvd24oc3VwYWJhc2UsIHNlc3Npb25JZCwgY29tYmluZWQpOyBjb25zb2xlLmluZm8oJ1tjb3NdIHNhdmVkIGNvbWJpbmVkIG1hcmtkb3duJywgeyBjb21iaW5lZF9sZW46IGNvbWJpbmVkLmxlbmd0aCB9KSB9IGNhdGNoIHt9XG5cbiAgLy8gVmVyc2lvbmluZyByZWNvcmQgZm9yIGZ1bGwgcmVnZW5lcmF0aW9uXG4gIHRyeSB7XG4gICAgY29uc3Qgc3ViamVjdElkID0gKHNlc3Npb24gYXMgYW55KT8uc3ViamVjdF9pZFxuICAgIGlmIChzdWJqZWN0SWQpIHtcbiAgICAgIGNvbnN0IGNvc1N0YXJ0ID0gY29tYmluZWQuaW5kZXhPZignPCEtLSBUQUI6IENIQU5DRSBPRiBTQUxFIC0tPicpXG4gICAgICBjb25zdCBjb3NFbmQgPSBjb21iaW5lZC5pbmRleE9mKCc8IS0tIC9UQUI6IENIQU5DRSBPRiBTQUxFIC0tPicpXG4gICAgICBjb25zdCBjb3NNZE9ubHkgPSBjb3NTdGFydCA+PSAwICYmIGNvc0VuZCA+IGNvc1N0YXJ0ID8gY29tYmluZWQuc2xpY2UoY29zU3RhcnQsIGNvc0VuZCArICc8IS0tIC9UQUI6IENIQU5DRSBPRiBTQUxFIC0tPicubGVuZ3RoKSA6IGNvbWJpbmVkXG4gICAgICBjb25zdCB7IGRhdGE6IHZlclJvdyB9ID0gYXdhaXQgKHN1cGFiYXNlIGFzIGFueSlcbiAgICAgICAgLmZyb20oJ2Nvc192ZXJzaW9ucycpXG4gICAgICAgIC5zZWxlY3QoJ3ZlcnNpb24nKVxuICAgICAgICAuZXEoJ3N1YmplY3RfaWQnLCBzdWJqZWN0SWQpXG4gICAgICAgIC5vcmRlcigndmVyc2lvbicsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KVxuICAgICAgICAubGltaXQoMSlcbiAgICAgIGNvbnN0IG5leHRWZXJzaW9uID0gKHZlclJvdz8uWzBdPy52ZXJzaW9uIHx8IDApICsgMVxuICAgICAgYXdhaXQgKHN1cGFiYXNlIGFzIGFueSlcbiAgICAgICAgLmZyb20oJ2Nvc192ZXJzaW9ucycpXG4gICAgICAgIC5pbnNlcnQoe1xuICAgICAgICAgIHN1YmplY3RfaWQ6IHN1YmplY3RJZCxcbiAgICAgICAgICBzZXNzaW9uX2lkOiBzZXNzaW9uSWQsXG4gICAgICAgICAgdmVyc2lvbjogbmV4dFZlcnNpb24sXG4gICAgICAgICAgbWFya2Rvd246IGNvc01kT25seSxcbiAgICAgICAgICBvcHNfanNvbjogbnVsbCxcbiAgICAgICAgICByZWFzb246ICdmdWxsX2dlbmVyYXRpb24nLFxuICAgICAgICAgIHNvdXJjZTogJ2Z1bGwnLFxuICAgICAgICB9KVxuICAgIH1cbiAgfSBjYXRjaCB7fVxuXG4gIHJldHVybiB7IG1hcmtkb3duOiBjb21iaW5lZCB9XG59XG4iXSwibmFtZXMiOlsiUmVwb3J0c1YzVGFic1JlcG9zaXRvcnkiLCJUcmFuc2NyaXB0c1JlcG9zaXRvcnkiLCJjaGF0VGV4dCIsImluZGV4UmVwb3J0TWFya2Rvd24iLCJTZXNzaW9uc1JlcG9zaXRvcnkiLCJidWlsZENoYW5jZVN5c3RlbVByb21wdCIsImpvaW4iLCJhc3NlbWJsZUNoYW5jZVVzZXJQcm9tcHQiLCJzZXNzaW9uIiwidHJhbnNjcmlwdHMiLCJwYXJ0cyIsInB1c2giLCJpZCIsInR5cGUiLCJzZXNzaW9uX3R5cGUiLCJzdGFydGVkX2F0Iiwic2VnbWVudHMiLCJtYXAiLCJ0IiwidHMiLCJ0aW1lc3RhbXAiLCJzcGVha2VyIiwidGV4dCIsImNvbnRlbnRfZW5jIiwiSlNPTiIsInN0cmluZ2lmeSIsImdlbmVyYXRlQ2hhbmNlT2ZTYWxlUmVwb3J0Iiwic3VwYWJhc2UiLCJ1c2VySWQiLCJzZXNzaW9uSWQiLCJyZXBvIiwic2Vzc2lvbnNSZXBvIiwidHJhbnNjcmlwdHNSZXBvIiwiZXhpc3RpbmciLCJmaW5kQnlTZXNzaW9uSWQiLCJ1cHNlcnRRdWV1ZWQiLCJzZXRSdW5uaW5nIiwiZmluZEJ5SWQiLCJFcnJvciIsInN5c3RlbSIsInVzZXIiLCJtb2RlbCIsInByb2Nlc3MiLCJlbnYiLCJPUEVOUk9VVEVSX01PREVMIiwianNvblRleHQiLCJhdHRlbXB0IiwiciIsIm1lc3NhZ2VzIiwicm9sZSIsImNvbnRlbnQiLCJ0ZW1wZXJhdHVyZSIsIm1heFRva2VucyIsInRpbWVvdXRNcyIsImRlYnVnIiwidHJpbSIsImUiLCJQcm9taXNlIiwic2V0VGltZW91dCIsImNvc01kIiwiY3VycmVudCIsImV4aXN0aW5nTWQiLCJyZXBvcnQiLCJtYXJrZG93biIsImNvbWJpbmVkIiwiZXhlY1N0YXJ0IiwiaW5kZXhPZiIsImV4ZWNFbmQiLCJleGVjUGFydCIsInNsaWNlIiwibGVuZ3RoIiwiZnJvbSIsInVwZGF0ZSIsInN0YXR1cyIsInJlcG9ydF9qc29uIiwibGFzdF9lcnJvciIsImVxIiwidGhlbiIsImVycm9yIiwiY29uc29sZSIsImluZm8iLCJjb21iaW5lZF9sZW4iLCJzdWJqZWN0SWQiLCJzdWJqZWN0X2lkIiwiY29zU3RhcnQiLCJjb3NFbmQiLCJjb3NNZE9ubHkiLCJkYXRhIiwidmVyUm93Iiwic2VsZWN0Iiwib3JkZXIiLCJhc2NlbmRpbmciLCJsaW1pdCIsIm5leHRWZXJzaW9uIiwidmVyc2lvbiIsImluc2VydCIsInNlc3Npb25faWQiLCJvcHNfanNvbiIsInJlYXNvbiIsInNvdXJjZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/services/chance-of-sale-report.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/services/markdown-indexer.ts":
/*!*************************************************!*\
  !*** ./src/server/services/markdown-indexer.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   indexReportMarkdown: () => (/* binding */ indexReportMarkdown)\n/* harmony export */ });\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_0__);\n\nfunction normalizeNewlines(s) {\n    return (s || '').replace(/\\r\\n?/g, '\\n');\n}\nfunction slugify(s) {\n    return (s || '').toLowerCase().replace(/[^a-z0-9\\s\\-]/g, '').trim().replace(/\\s+/g, '-').replace(/-+/g, '-');\n}\nfunction extractSections(markdown, root) {\n    const text = normalizeNewlines(markdown);\n    const lines = text.split('\\n');\n    const sections = [];\n    const stack = [];\n    const flush = (startIndex, endIndex)=>{\n        if (stack.length === 0) return;\n        const node = stack[stack.length - 1];\n        const title = node.title;\n        const level = node.level;\n        const pathSlugs = [\n            root,\n            ...stack.map((s)=>s.slug)\n        ];\n        const slug_path = pathSlugs.join('/');\n        const content_markdown = lines.slice(startIndex, endIndex).join('\\n');\n        sections.push({\n            slug_path,\n            level,\n            title,\n            content_markdown,\n            start_line: startIndex + 1,\n            end_line: endIndex + 1\n        });\n    };\n    // We capture content for each heading until the next heading of same or higher level\n    let contentStart = 0;\n    for(let i = 0; i < lines.length; i++){\n        const m = /^(#{1,6})\\s+(.*)$/.exec(lines[i]);\n        if (!m) continue;\n        const level = m[1].length;\n        const title = m[2].trim();\n        // Close previous node\n        if (stack.length > 0) {\n            flush(contentStart, i - 1);\n        }\n        // Adjust stack to current level\n        while(stack.length > 0 && stack[stack.length - 1].level >= level){\n            stack.pop();\n        }\n        const slug = slugify(title);\n        stack.push({\n            level,\n            title,\n            slug,\n            start: i\n        });\n        contentStart = i + 1;\n    }\n    // Flush last\n    if (stack.length > 0) {\n        flush(contentStart, lines.length - 1);\n    }\n    return sections;\n}\nfunction extractTabSegment(all, tab) {\n    const text = normalizeNewlines(all);\n    const parts = text.split(/(```[\\s\\S]*?```)/g);\n    const mkStart = (name)=>new RegExp(`<!--\\\\s*TAB:\\\\s*${name}\\\\s*-->`, 'i');\n    const mkEnd = (name)=>new RegExp(`<!--\\\\s*\\\\/\\\\s*TAB:\\\\s*${name}\\\\s*-->`, 'i');\n    const startExec = mkStart('EXECUTIVE\\\\s+SUMMARY');\n    const endExec = mkEnd('EXECUTIVE\\\\s+SUMMARY');\n    const startChance = mkStart('CHANCE\\\\s+OF\\\\s+SALE');\n    const endChance = mkEnd('CHANCE\\\\s+OF\\\\s+SALE');\n    let cur = 'none';\n    const out = [];\n    for (const part of parts){\n        if (part.startsWith('```')) {\n            if (cur !== 'none') out.push(part);\n            continue;\n        }\n        const isStartExec = startExec.test(part);\n        const isEndExec = endExec.test(part);\n        const isStartChance = startChance.test(part);\n        const isEndChance = endChance.test(part);\n        if (isStartExec || isStartChance || isEndExec || isEndChance) {\n            // strip markers\n            const cleaned = part.replace(startExec, '').replace(endExec, '').replace(startChance, '').replace(endChance, '');\n            if (cleaned && cur !== 'none') out.push(cleaned);\n            if (isStartExec) cur = 'exec';\n            else if (isStartChance) cur = 'chance';\n            else if (isEndExec && cur === 'exec') cur = 'none';\n            else if (isEndChance && cur === 'chance') cur = 'none';\n            continue;\n        }\n        if (cur !== 'none') out.push(part);\n    }\n    const combined = out.join('');\n    const trimmed = combined.replace(/^\\n+|\\s+$/g, '').trim();\n    if (!trimmed) return undefined;\n    return trimmed;\n}\nasync function indexReportMarkdown(supabase, sessionId, allMarkdown) {\n    const execMd = extractTabSegment(allMarkdown, 'exec');\n    const chanceMd = extractTabSegment(allMarkdown, 'chance');\n    // Delete only the roots we will re-insert\n    const rootsToReplace = [];\n    if (execMd) rootsToReplace.push('executive_summary');\n    if (chanceMd) rootsToReplace.push('chance_of_sale');\n    for (const root of rootsToReplace){\n        await supabase.from('report_sections').delete().eq('session_id', sessionId).eq('report_kind', 'tabs').like('slug_path', `${root}%`).then(()=>{}, ()=>{});\n    }\n    const rows = [];\n    const pushSections = (md, root)=>{\n        // Prefer SECTION anchor parsing for deterministic paths; fallback to heading-based\n        const anchorRegex = /<!--\\s*SECTION:\\s*([A-Z0-9_\\/\\-]+)\\s*-->[\\s\\S]*?<!--\\s*\\/SECTION:\\s*\\1\\s*-->/g;\n        const blocks = [];\n        let m;\n        while((m = anchorRegex.exec(md)) !== null){\n            const id = m[1];\n            const full = m[0];\n            const inner = full.replace(new RegExp(`<!--\\\\s*SECTION:\\\\s*${id}\\\\s*-->`), '').replace(new RegExp(`<!--\\\\s*\\\\/SECTION:\\\\s*${id}\\\\s*-->`), '');\n            blocks.push({\n                id,\n                content: inner\n            });\n        }\n        if (blocks.length > 0) {\n            for (const b of blocks){\n                rows.push({\n                    session_id: sessionId,\n                    report_kind: 'tabs',\n                    node_id: (0,crypto__WEBPACK_IMPORTED_MODULE_0__.randomUUID)(),\n                    slug_path: `${root}/${b.id}`,\n                    level: 2,\n                    title: b.id,\n                    content_markdown: normalizeNewlines(b.content).trim(),\n                    start_line: 0,\n                    end_line: 0\n                });\n            }\n        } else {\n            const secs = extractSections(md, root);\n            for (const s of secs){\n                rows.push({\n                    session_id: sessionId,\n                    report_kind: 'tabs',\n                    node_id: (0,crypto__WEBPACK_IMPORTED_MODULE_0__.randomUUID)(),\n                    slug_path: s.slug_path,\n                    level: s.level,\n                    title: s.title,\n                    content_markdown: s.content_markdown,\n                    start_line: s.start_line,\n                    end_line: s.end_line\n                });\n            }\n        }\n    };\n    if (execMd) pushSections(execMd, 'executive_summary');\n    if (chanceMd) pushSections(chanceMd, 'chance_of_sale');\n    if (rows.length > 0) {\n        await supabase.from('report_sections').insert(rows).then(()=>{}, ()=>{});\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3NlcnZpY2VzL21hcmtkb3duLWluZGV4ZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQ21DO0FBRW5DLFNBQVNDLGtCQUFrQkMsQ0FBUztJQUNsQyxPQUFPLENBQUNBLEtBQUssRUFBQyxFQUFHQyxPQUFPLENBQUMsVUFBVTtBQUNyQztBQVdBLFNBQVNDLFFBQVFGLENBQVM7SUFDeEIsT0FBTyxDQUFDQSxLQUFLLEVBQUMsRUFDWEcsV0FBVyxHQUNYRixPQUFPLENBQUMsa0JBQWtCLElBQzFCRyxJQUFJLEdBQ0pILE9BQU8sQ0FBQyxRQUFRLEtBQ2hCQSxPQUFPLENBQUMsT0FBTztBQUNwQjtBQUVBLFNBQVNJLGdCQUFnQkMsUUFBZ0IsRUFBRUMsSUFBNEM7SUFDckYsTUFBTUMsT0FBT1Qsa0JBQWtCTztJQUMvQixNQUFNRyxRQUFRRCxLQUFLRSxLQUFLLENBQUM7SUFDekIsTUFBTUMsV0FBc0IsRUFBRTtJQUc5QixNQUFNQyxRQUFxQixFQUFFO0lBRTdCLE1BQU1DLFFBQVEsQ0FBQ0MsWUFBb0JDO1FBQ2pDLElBQUlILE1BQU1JLE1BQU0sS0FBSyxHQUFHO1FBQ3hCLE1BQU1DLE9BQU9MLEtBQUssQ0FBQ0EsTUFBTUksTUFBTSxHQUFHLEVBQUU7UUFDcEMsTUFBTUUsUUFBUUQsS0FBS0MsS0FBSztRQUN4QixNQUFNQyxRQUFRRixLQUFLRSxLQUFLO1FBQ3hCLE1BQU1DLFlBQVk7WUFBQ2I7ZUFBU0ssTUFBTVMsR0FBRyxDQUFDckIsQ0FBQUEsSUFBS0EsRUFBRXNCLElBQUk7U0FBRTtRQUNuRCxNQUFNQyxZQUFZSCxVQUFVSSxJQUFJLENBQUM7UUFDakMsTUFBTUMsbUJBQW1CaEIsTUFBTWlCLEtBQUssQ0FBQ1osWUFBWUMsVUFBVVMsSUFBSSxDQUFDO1FBQ2hFYixTQUFTZ0IsSUFBSSxDQUFDO1lBQUVKO1lBQVdKO1lBQU9EO1lBQU9PO1lBQWtCRyxZQUFZZCxhQUFhO1lBQUdlLFVBQVVkLFdBQVc7UUFBRTtJQUNoSDtJQUVB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YXNoYm9hcmRcXHNyY1xcc2VydmVyXFxzZXJ2aWNlc1xcbWFya2Rvd24taW5kZXhlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IFN1cGFiYXNlQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJ1xuaW1wb3J0IHsgcmFuZG9tVVVJRCB9IGZyb20gJ2NyeXB0bydcblxuZnVuY3Rpb24gbm9ybWFsaXplTmV3bGluZXMoczogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIChzIHx8ICcnKS5yZXBsYWNlKC9cXHJcXG4/L2csICdcXG4nKVxufVxuXG5leHBvcnQgdHlwZSBTZWN0aW9uID0ge1xuICBzbHVnX3BhdGg6IHN0cmluZ1xuICBsZXZlbDogbnVtYmVyXG4gIHRpdGxlOiBzdHJpbmdcbiAgY29udGVudF9tYXJrZG93bjogc3RyaW5nXG4gIHN0YXJ0X2xpbmU6IG51bWJlclxuICBlbmRfbGluZTogbnVtYmVyXG59XG5cbmZ1bmN0aW9uIHNsdWdpZnkoczogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIChzIHx8ICcnKVxuICAgIC50b0xvd2VyQ2FzZSgpXG4gICAgLnJlcGxhY2UoL1teYS16MC05XFxzXFwtXS9nLCAnJylcbiAgICAudHJpbSgpXG4gICAgLnJlcGxhY2UoL1xccysvZywgJy0nKVxuICAgIC5yZXBsYWNlKC8tKy9nLCAnLScpXG59XG5cbmZ1bmN0aW9uIGV4dHJhY3RTZWN0aW9ucyhtYXJrZG93bjogc3RyaW5nLCByb290OiAnZXhlY3V0aXZlX3N1bW1hcnknIHwgJ2NoYW5jZV9vZl9zYWxlJyk6IFNlY3Rpb25bXSB7XG4gIGNvbnN0IHRleHQgPSBub3JtYWxpemVOZXdsaW5lcyhtYXJrZG93bilcbiAgY29uc3QgbGluZXMgPSB0ZXh0LnNwbGl0KCdcXG4nKVxuICBjb25zdCBzZWN0aW9uczogU2VjdGlvbltdID0gW11cblxuICB0eXBlIFN0YWNrTm9kZSA9IHsgbGV2ZWw6IG51bWJlcjsgdGl0bGU6IHN0cmluZzsgc2x1Zzogc3RyaW5nOyBzdGFydDogbnVtYmVyIH1cbiAgY29uc3Qgc3RhY2s6IFN0YWNrTm9kZVtdID0gW11cblxuICBjb25zdCBmbHVzaCA9IChzdGFydEluZGV4OiBudW1iZXIsIGVuZEluZGV4OiBudW1iZXIpID0+IHtcbiAgICBpZiAoc3RhY2subGVuZ3RoID09PSAwKSByZXR1cm5cbiAgICBjb25zdCBub2RlID0gc3RhY2tbc3RhY2subGVuZ3RoIC0gMV1cbiAgICBjb25zdCB0aXRsZSA9IG5vZGUudGl0bGVcbiAgICBjb25zdCBsZXZlbCA9IG5vZGUubGV2ZWxcbiAgICBjb25zdCBwYXRoU2x1Z3MgPSBbcm9vdCwgLi4uc3RhY2subWFwKHMgPT4gcy5zbHVnKV1cbiAgICBjb25zdCBzbHVnX3BhdGggPSBwYXRoU2x1Z3Muam9pbignLycpXG4gICAgY29uc3QgY29udGVudF9tYXJrZG93biA9IGxpbmVzLnNsaWNlKHN0YXJ0SW5kZXgsIGVuZEluZGV4KS5qb2luKCdcXG4nKVxuICAgIHNlY3Rpb25zLnB1c2goeyBzbHVnX3BhdGgsIGxldmVsLCB0aXRsZSwgY29udGVudF9tYXJrZG93biwgc3RhcnRfbGluZTogc3RhcnRJbmRleCArIDEsIGVuZF9saW5lOiBlbmRJbmRleCArIDEgfSlcbiAgfVxuXG4gIC8vIFdlIGNhcHR1cmUgY29udGVudCBmb3IgZWFjaCBoZWFkaW5nIHVudGlsIHRoZSBuZXh0IGhlYWRpbmcgb2Ygc2FtZSBvciBoaWdoZXIgbGV2ZWxcbiAgbGV0IGNvbnRlbnRTdGFydCA9IDBcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaW5lcy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IG0gPSAvXigjezEsNn0pXFxzKyguKikkLy5leGVjKGxpbmVzW2ldKVxuICAgIGlmICghbSkgY29udGludWVcbiAgICBjb25zdCBsZXZlbCA9IG1bMV0ubGVuZ3RoXG4gICAgY29uc3QgdGl0bGUgPSBtWzJdLnRyaW0oKVxuICAgIC8vIENsb3NlIHByZXZpb3VzIG5vZGVcbiAgICBpZiAoc3RhY2subGVuZ3RoID4gMCkge1xuICAgICAgZmx1c2goY29udGVudFN0YXJ0LCBpIC0gMSlcbiAgICB9XG4gICAgLy8gQWRqdXN0IHN0YWNrIHRvIGN1cnJlbnQgbGV2ZWxcbiAgICB3aGlsZSAoc3RhY2subGVuZ3RoID4gMCAmJiBzdGFja1tzdGFjay5sZW5ndGggLSAxXS5sZXZlbCA+PSBsZXZlbCkge1xuICAgICAgc3RhY2sucG9wKClcbiAgICB9XG4gICAgY29uc3Qgc2x1ZyA9IHNsdWdpZnkodGl0bGUpXG4gICAgc3RhY2sucHVzaCh7IGxldmVsLCB0aXRsZSwgc2x1Zywgc3RhcnQ6IGkgfSlcbiAgICBjb250ZW50U3RhcnQgPSBpICsgMVxuICB9XG4gIC8vIEZsdXNoIGxhc3RcbiAgaWYgKHN0YWNrLmxlbmd0aCA+IDApIHtcbiAgICBmbHVzaChjb250ZW50U3RhcnQsIGxpbmVzLmxlbmd0aCAtIDEpXG4gIH1cbiAgcmV0dXJuIHNlY3Rpb25zXG59XG5cbmZ1bmN0aW9uIGV4dHJhY3RUYWJTZWdtZW50KGFsbDogc3RyaW5nLCB0YWI6ICdleGVjJyB8ICdjaGFuY2UnKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgY29uc3QgdGV4dCA9IG5vcm1hbGl6ZU5ld2xpbmVzKGFsbClcbiAgY29uc3QgcGFydHMgPSB0ZXh0LnNwbGl0KC8oYGBgW1xcc1xcU10qP2BgYCkvZylcbiAgY29uc3QgbWtTdGFydCA9IChuYW1lOiBzdHJpbmcpID0+IG5ldyBSZWdFeHAoYDwhLS1cXFxccypUQUI6XFxcXHMqJHtuYW1lfVxcXFxzKi0tPmAsICdpJylcbiAgY29uc3QgbWtFbmQgPSAobmFtZTogc3RyaW5nKSA9PiBuZXcgUmVnRXhwKGA8IS0tXFxcXHMqXFxcXC9cXFxccypUQUI6XFxcXHMqJHtuYW1lfVxcXFxzKi0tPmAsICdpJylcbiAgY29uc3Qgc3RhcnRFeGVjID0gbWtTdGFydCgnRVhFQ1VUSVZFXFxcXHMrU1VNTUFSWScpXG4gIGNvbnN0IGVuZEV4ZWMgPSBta0VuZCgnRVhFQ1VUSVZFXFxcXHMrU1VNTUFSWScpXG4gIGNvbnN0IHN0YXJ0Q2hhbmNlID0gbWtTdGFydCgnQ0hBTkNFXFxcXHMrT0ZcXFxccytTQUxFJylcbiAgY29uc3QgZW5kQ2hhbmNlID0gbWtFbmQoJ0NIQU5DRVxcXFxzK09GXFxcXHMrU0FMRScpXG5cbiAgbGV0IGN1cjogJ25vbmUnIHwgJ2V4ZWMnIHwgJ2NoYW5jZScgPSAnbm9uZSdcbiAgY29uc3Qgb3V0OiBzdHJpbmdbXSA9IFtdXG4gIGZvciAoY29uc3QgcGFydCBvZiBwYXJ0cykge1xuICAgIGlmIChwYXJ0LnN0YXJ0c1dpdGgoJ2BgYCcpKSB7XG4gICAgICBpZiAoY3VyICE9PSAnbm9uZScpIG91dC5wdXNoKHBhcnQpXG4gICAgICBjb250aW51ZVxuICAgIH1cbiAgICBjb25zdCBpc1N0YXJ0RXhlYyA9IHN0YXJ0RXhlYy50ZXN0KHBhcnQpXG4gICAgY29uc3QgaXNFbmRFeGVjID0gZW5kRXhlYy50ZXN0KHBhcnQpXG4gICAgY29uc3QgaXNTdGFydENoYW5jZSA9IHN0YXJ0Q2hhbmNlLnRlc3QocGFydClcbiAgICBjb25zdCBpc0VuZENoYW5jZSA9IGVuZENoYW5jZS50ZXN0KHBhcnQpXG5cbiAgICBpZiAoaXNTdGFydEV4ZWMgfHwgaXNTdGFydENoYW5jZSB8fCBpc0VuZEV4ZWMgfHwgaXNFbmRDaGFuY2UpIHtcbiAgICAgIC8vIHN0cmlwIG1hcmtlcnNcbiAgICAgIGNvbnN0IGNsZWFuZWQgPSBwYXJ0XG4gICAgICAgIC5yZXBsYWNlKHN0YXJ0RXhlYywgJycpXG4gICAgICAgIC5yZXBsYWNlKGVuZEV4ZWMsICcnKVxuICAgICAgICAucmVwbGFjZShzdGFydENoYW5jZSwgJycpXG4gICAgICAgIC5yZXBsYWNlKGVuZENoYW5jZSwgJycpXG4gICAgICBpZiAoY2xlYW5lZCAmJiBjdXIgIT09ICdub25lJykgb3V0LnB1c2goY2xlYW5lZClcbiAgICAgIGlmIChpc1N0YXJ0RXhlYykgY3VyID0gJ2V4ZWMnXG4gICAgICBlbHNlIGlmIChpc1N0YXJ0Q2hhbmNlKSBjdXIgPSAnY2hhbmNlJ1xuICAgICAgZWxzZSBpZiAoaXNFbmRFeGVjICYmIGN1ciA9PT0gJ2V4ZWMnKSBjdXIgPSAnbm9uZSdcbiAgICAgIGVsc2UgaWYgKGlzRW5kQ2hhbmNlICYmIGN1ciA9PT0gJ2NoYW5jZScpIGN1ciA9ICdub25lJ1xuICAgICAgY29udGludWVcbiAgICB9XG4gICAgaWYgKGN1ciAhPT0gJ25vbmUnKSBvdXQucHVzaChwYXJ0KVxuICB9XG4gIGNvbnN0IGNvbWJpbmVkID0gb3V0LmpvaW4oJycpXG4gIGNvbnN0IHRyaW1tZWQgPSBjb21iaW5lZC5yZXBsYWNlKC9eXFxuK3xcXHMrJC9nLCAnJykudHJpbSgpXG4gIGlmICghdHJpbW1lZCkgcmV0dXJuIHVuZGVmaW5lZFxuICByZXR1cm4gdHJpbW1lZFxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaW5kZXhSZXBvcnRNYXJrZG93bihcbiAgc3VwYWJhc2U6IFN1cGFiYXNlQ2xpZW50LFxuICBzZXNzaW9uSWQ6IHN0cmluZyxcbiAgYWxsTWFya2Rvd246IHN0cmluZ1xuKTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnN0IGV4ZWNNZCA9IGV4dHJhY3RUYWJTZWdtZW50KGFsbE1hcmtkb3duLCAnZXhlYycpXG4gIGNvbnN0IGNoYW5jZU1kID0gZXh0cmFjdFRhYlNlZ21lbnQoYWxsTWFya2Rvd24sICdjaGFuY2UnKVxuXG4gIC8vIERlbGV0ZSBvbmx5IHRoZSByb290cyB3ZSB3aWxsIHJlLWluc2VydFxuICBjb25zdCByb290c1RvUmVwbGFjZTogQXJyYXk8J2V4ZWN1dGl2ZV9zdW1tYXJ5JyB8ICdjaGFuY2Vfb2Zfc2FsZSc+ID0gW11cbiAgaWYgKGV4ZWNNZCkgcm9vdHNUb1JlcGxhY2UucHVzaCgnZXhlY3V0aXZlX3N1bW1hcnknKVxuICBpZiAoY2hhbmNlTWQpIHJvb3RzVG9SZXBsYWNlLnB1c2goJ2NoYW5jZV9vZl9zYWxlJylcbiAgZm9yIChjb25zdCByb290IG9mIHJvb3RzVG9SZXBsYWNlKSB7XG4gICAgYXdhaXQgKHN1cGFiYXNlIGFzIGFueSlcbiAgICAgIC5mcm9tKCdyZXBvcnRfc2VjdGlvbnMnKVxuICAgICAgLmRlbGV0ZSgpXG4gICAgICAuZXEoJ3Nlc3Npb25faWQnLCBzZXNzaW9uSWQpXG4gICAgICAuZXEoJ3JlcG9ydF9raW5kJywgJ3RhYnMnKVxuICAgICAgLmxpa2UoJ3NsdWdfcGF0aCcsIGAke3Jvb3R9JWApXG4gICAgICAudGhlbigoKSA9PiB7fSwgKCkgPT4ge30pXG4gIH1cblxuICBjb25zdCByb3dzOiBhbnlbXSA9IFtdXG4gIGNvbnN0IHB1c2hTZWN0aW9ucyA9IChtZDogc3RyaW5nLCByb290OiAnZXhlY3V0aXZlX3N1bW1hcnknfCdjaGFuY2Vfb2Zfc2FsZScpID0+IHtcbiAgICAvLyBQcmVmZXIgU0VDVElPTiBhbmNob3IgcGFyc2luZyBmb3IgZGV0ZXJtaW5pc3RpYyBwYXRoczsgZmFsbGJhY2sgdG8gaGVhZGluZy1iYXNlZFxuICAgIGNvbnN0IGFuY2hvclJlZ2V4ID0gLzwhLS1cXHMqU0VDVElPTjpcXHMqKFtBLVowLTlfXFwvXFwtXSspXFxzKi0tPltcXHNcXFNdKj88IS0tXFxzKlxcL1NFQ1RJT046XFxzKlxcMVxccyotLT4vZ1xuICAgIGNvbnN0IGJsb2NrczogQXJyYXk8eyBpZDogc3RyaW5nOyBjb250ZW50OiBzdHJpbmcgfT4gPSBbXVxuICAgIGxldCBtOiBSZWdFeHBFeGVjQXJyYXkgfCBudWxsXG4gICAgd2hpbGUgKChtID0gYW5jaG9yUmVnZXguZXhlYyhtZCkpICE9PSBudWxsKSB7XG4gICAgICBjb25zdCBpZCA9IG1bMV1cbiAgICAgIGNvbnN0IGZ1bGwgPSBtWzBdXG4gICAgICBjb25zdCBpbm5lciA9IGZ1bGxcbiAgICAgICAgLnJlcGxhY2UobmV3IFJlZ0V4cChgPCEtLVxcXFxzKlNFQ1RJT046XFxcXHMqJHtpZH1cXFxccyotLT5gKSwgJycpXG4gICAgICAgIC5yZXBsYWNlKG5ldyBSZWdFeHAoYDwhLS1cXFxccypcXFxcL1NFQ1RJT046XFxcXHMqJHtpZH1cXFxccyotLT5gKSwgJycpXG4gICAgICBibG9ja3MucHVzaCh7IGlkLCBjb250ZW50OiBpbm5lciB9KVxuICAgIH1cbiAgICBpZiAoYmxvY2tzLmxlbmd0aCA+IDApIHtcbiAgICAgIGZvciAoY29uc3QgYiBvZiBibG9ja3MpIHtcbiAgICAgICAgcm93cy5wdXNoKHtcbiAgICAgICAgICBzZXNzaW9uX2lkOiBzZXNzaW9uSWQsXG4gICAgICAgICAgcmVwb3J0X2tpbmQ6ICd0YWJzJyxcbiAgICAgICAgICBub2RlX2lkOiByYW5kb21VVUlEKCksXG4gICAgICAgICAgc2x1Z19wYXRoOiBgJHtyb290fS8ke2IuaWR9YCxcbiAgICAgICAgICBsZXZlbDogMixcbiAgICAgICAgICB0aXRsZTogYi5pZCxcbiAgICAgICAgICBjb250ZW50X21hcmtkb3duOiBub3JtYWxpemVOZXdsaW5lcyhiLmNvbnRlbnQpLnRyaW0oKSxcbiAgICAgICAgICBzdGFydF9saW5lOiAwLFxuICAgICAgICAgIGVuZF9saW5lOiAwLFxuICAgICAgICB9KVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBzZWNzID0gZXh0cmFjdFNlY3Rpb25zKG1kLCByb290KVxuICAgICAgZm9yIChjb25zdCBzIG9mIHNlY3MpIHtcbiAgICAgICAgcm93cy5wdXNoKHtcbiAgICAgICAgICBzZXNzaW9uX2lkOiBzZXNzaW9uSWQsXG4gICAgICAgICAgcmVwb3J0X2tpbmQ6ICd0YWJzJyxcbiAgICAgICAgICBub2RlX2lkOiByYW5kb21VVUlEKCksXG4gICAgICAgICAgc2x1Z19wYXRoOiBzLnNsdWdfcGF0aCxcbiAgICAgICAgICBsZXZlbDogcy5sZXZlbCxcbiAgICAgICAgICB0aXRsZTogcy50aXRsZSxcbiAgICAgICAgICBjb250ZW50X21hcmtkb3duOiBzLmNvbnRlbnRfbWFya2Rvd24sXG4gICAgICAgICAgc3RhcnRfbGluZTogcy5zdGFydF9saW5lLFxuICAgICAgICAgIGVuZF9saW5lOiBzLmVuZF9saW5lLFxuICAgICAgICB9KVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGlmIChleGVjTWQpIHB1c2hTZWN0aW9ucyhleGVjTWQsICdleGVjdXRpdmVfc3VtbWFyeScpXG4gIGlmIChjaGFuY2VNZCkgcHVzaFNlY3Rpb25zKGNoYW5jZU1kLCAnY2hhbmNlX29mX3NhbGUnKVxuXG4gIGlmIChyb3dzLmxlbmd0aCA+IDApIHtcbiAgICBhd2FpdCAoc3VwYWJhc2UgYXMgYW55KS5mcm9tKCdyZXBvcnRfc2VjdGlvbnMnKS5pbnNlcnQocm93cykudGhlbigoKSA9PiB7fSwgKCkgPT4ge30pXG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJyYW5kb21VVUlEIiwibm9ybWFsaXplTmV3bGluZXMiLCJzIiwicmVwbGFjZSIsInNsdWdpZnkiLCJ0b0xvd2VyQ2FzZSIsInRyaW0iLCJleHRyYWN0U2VjdGlvbnMiLCJtYXJrZG93biIsInJvb3QiLCJ0ZXh0IiwibGluZXMiLCJzcGxpdCIsInNlY3Rpb25zIiwic3RhY2siLCJmbHVzaCIsInN0YXJ0SW5kZXgiLCJlbmRJbmRleCIsImxlbmd0aCIsIm5vZGUiLCJ0aXRsZSIsImxldmVsIiwicGF0aFNsdWdzIiwibWFwIiwic2x1ZyIsInNsdWdfcGF0aCIsImpvaW4iLCJjb250ZW50X21hcmtkb3duIiwic2xpY2UiLCJwdXNoIiwic3RhcnRfbGluZSIsImVuZF9saW5lIiwiY29udGVudFN0YXJ0IiwiaSIsIm0iLCJleGVjIiwicG9wIiwic3RhcnQiLCJleHRyYWN0VGFiU2VnbWVudCIsImFsbCIsInRhYiIsInBhcnRzIiwibWtTdGFydCIsIm5hbWUiLCJSZWdFeHAiLCJta0VuZCIsInN0YXJ0RXhlYyIsImVuZEV4ZWMiLCJzdGFydENoYW5jZSIsImVuZENoYW5jZSIsImN1ciIsIm91dCIsInBhcnQiLCJzdGFydHNXaXRoIiwiaXNTdGFydEV4ZWMiLCJ0ZXN0IiwiaXNFbmRFeGVjIiwiaXNTdGFydENoYW5jZSIsImlzRW5kQ2hhbmNlIiwiY2xlYW5lZCIsImNvbWJpbmVkIiwidHJpbW1lZCIsInVuZGVmaW5lZCIsImluZGV4UmVwb3J0TWFya2Rvd24iLCJzdXBhYmFzZSIsInNlc3Npb25JZCIsImFsbE1hcmtkb3duIiwiZXhlY01kIiwiY2hhbmNlTWQiLCJyb290c1RvUmVwbGFjZSIsImZyb20iLCJkZWxldGUiLCJlcSIsImxpa2UiLCJ0aGVuIiwicm93cyIsInB1c2hTZWN0aW9ucyIsIm1kIiwiYW5jaG9yUmVnZXgiLCJibG9ja3MiLCJpZCIsImZ1bGwiLCJpbm5lciIsImNvbnRlbnQiLCJiIiwic2Vzc2lvbl9pZCIsInJlcG9ydF9raW5kIiwibm9kZV9pZCIsInNlY3MiLCJpbnNlcnQiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/server/services/markdown-indexer.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/services/openrouter.ts":
/*!*******************************************!*\
  !*** ./src/server/services/openrouter.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   chatJsonSchema: () => (/* binding */ chatJsonSchema),\n/* harmony export */   chatText: () => (/* binding */ chatText),\n/* harmony export */   chatWithTools: () => (/* binding */ chatWithTools),\n/* harmony export */   normalizeProviderSort: () => (/* binding */ normalizeProviderSort)\n/* harmony export */ });\nconst OPENROUTER_URL = 'https://openrouter.ai/api/v1/chat/completions';\n// Normalize provider sort to current OpenRouter API values.\n// Backwards compatible mapping for legacy values used in older code.\nfunction normalizeProviderSort(sort) {\n    const envDefault = (process.env.OPENROUTER_PROVIDER_SORT || '').toLowerCase();\n    const candidate = (sort || envDefault || 'price').toLowerCase();\n    if (candidate === 'price') return 'price';\n    if (candidate === 'throughput') return 'throughput';\n    if (candidate === 'latency') return 'latency';\n    // legacy aliases\n    if (candidate === 'speed') return 'latency';\n    if (candidate === 'quality') return 'latency';\n    return 'price';\n}\nfunction buildHeaders() {\n    const headers = {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${process.env.OPENROUTER_API_KEY}`\n    };\n    if (process.env.OPENROUTER_HTTP_REFERER) headers['HTTP-Referer'] = process.env.OPENROUTER_HTTP_REFERER;\n    if (process.env.OPENROUTER_X_TITLE) headers['X-Title'] = process.env.OPENROUTER_X_TITLE;\n    return headers;\n}\nfunction messageCharLength(message) {\n    const content = message.content;\n    if (typeof content === 'string') return content.length;\n    return 0;\n}\nfunction estimateTokens(messages) {\n    const charCount = messages.reduce((sum, m)=>sum + messageCharLength(m), 0);\n    // Very rough heuristic: ~4 chars per token for English text\n    const approxTokens = Math.ceil(charCount / 4);\n    return {\n        approxTokens,\n        charCount\n    };\n}\nasync function chatJsonSchema(opts) {\n    const body = {\n        model: opts.model,\n        messages: opts.messages,\n        response_format: {\n            type: 'json_schema',\n            json_schema: {\n                name: opts.schema.name,\n                strict: opts.schema.strict,\n                schema: opts.schema.schema\n            }\n        },\n        provider: {\n            sort: normalizeProviderSort(opts.providerSort)\n        },\n        temperature: typeof opts.temperature === 'number' ? opts.temperature : 0.1,\n        max_tokens: typeof opts.maxTokens === 'number' ? opts.maxTokens : 16000\n    };\n    const controller = new AbortController();\n    const timeout = setTimeout(()=>controller.abort(), typeof opts.timeoutMs === 'number' ? opts.timeoutMs : 90000);\n    const shouldDebug = Boolean(opts.debug || process.env.OPENROUTER_DEBUG === 'true' || process.env.REPORT_DEBUG_OPENROUTER === 'true');\n    const headers = buildHeaders();\n    const { approxTokens, charCount } = estimateTokens(opts.messages);\n    const requestSizeBytes = Buffer.byteLength(JSON.stringify(body), 'utf8');\n    const t0 = Date.now();\n    try {\n        if (shouldDebug) {\n            console.info('[openrouter] debug request', {\n                model: opts.model,\n                input_tokens_approx: approxTokens,\n                input_chars: charCount,\n                request_size_bytes: requestSizeBytes,\n                provider_sort: body.provider?.sort,\n                max_tokens: body.max_tokens,\n                temperature: body.temperature\n            });\n        }\n        const res = await fetch(OPENROUTER_URL, {\n            method: 'POST',\n            headers,\n            body: JSON.stringify(body),\n            signal: controller.signal\n        });\n        const latencyMs = Date.now() - t0;\n        if (!res.ok) {\n            const errText = await res.text().catch(()=>'');\n            if (shouldDebug) console.error('[openrouter] debug error', {\n                status: res.status,\n                latency_ms: latencyMs,\n                error: errText?.slice?.(0, 500)\n            });\n            throw new Error(`OpenRouter ${res.status}: ${errText}`);\n        }\n        const json = await res.json();\n        if (shouldDebug) {\n            console.info('[openrouter] debug response', {\n                latency_ms: latencyMs,\n                usage: json?.usage || null,\n                finish_reason: json?.choices?.[0]?.finish_reason || null\n            });\n        }\n        const content = json?.choices?.[0]?.message?.content;\n        return {\n            content,\n            raw: json\n        };\n    } finally{\n        clearTimeout(timeout);\n    }\n}\nasync function chatText(opts) {\n    const body = {\n        model: opts.model,\n        messages: opts.messages,\n        provider: {\n            sort: normalizeProviderSort(opts.providerSort)\n        },\n        temperature: typeof opts.temperature === 'number' ? opts.temperature : 0.3,\n        max_tokens: typeof opts.maxTokens === 'number' ? opts.maxTokens : 4000\n    };\n    const controller = new AbortController();\n    const timeout = setTimeout(()=>controller.abort(), typeof opts.timeoutMs === 'number' ? opts.timeoutMs : 90000);\n    const shouldDebug = Boolean(opts.debug || process.env.OPENROUTER_DEBUG === 'true' || process.env.REPORT_DEBUG_OPENROUTER === 'true');\n    const headers = buildHeaders();\n    const { approxTokens, charCount } = (()=>{\n        const charCount = (opts.messages || []).reduce((s, m)=>s + (m.content?.length || 0), 0);\n        return {\n            approxTokens: Math.ceil(charCount / 4),\n            charCount\n        };\n    })();\n    const requestSizeBytes = (()=>{\n        try {\n            if (typeof Buffer !== 'undefined') return Buffer.byteLength(JSON.stringify(body), 'utf8');\n        } catch  {}\n        try {\n            return new TextEncoder().encode(JSON.stringify(body)).length;\n        } catch  {}\n        try {\n            return (JSON.stringify(body) || '').length;\n        } catch  {\n            return 0;\n        }\n    })();\n    const t0 = Date.now();\n    try {\n        if (shouldDebug) {\n            console.info('[openrouter:text] debug request', {\n                model: opts.model,\n                input_tokens_approx: approxTokens,\n                input_chars: charCount,\n                request_size_bytes: requestSizeBytes,\n                provider_sort: body.provider?.sort,\n                max_tokens: body.max_tokens,\n                temperature: body.temperature\n            });\n        }\n        const res = await fetch(OPENROUTER_URL, {\n            method: 'POST',\n            headers,\n            body: JSON.stringify(body),\n            signal: controller.signal\n        });\n        const latencyMs = Date.now() - t0;\n        if (!res.ok) {\n            const errText = await res.text().catch(()=>'');\n            if (shouldDebug) console.error('[openrouter:text] debug error', {\n                status: res.status,\n                latency_ms: latencyMs,\n                error: errText?.slice?.(0, 500)\n            });\n            throw new Error(`OpenRouter ${res.status}: ${errText}`);\n        }\n        const json = await res.json();\n        if (shouldDebug) {\n            console.info('[openrouter:text] debug response', {\n                latency_ms: latencyMs,\n                usage: json?.usage || null,\n                finish_reason: json?.choices?.[0]?.finish_reason || null\n            });\n        }\n        const content = json?.choices?.[0]?.message?.content;\n        return {\n            content,\n            raw: json\n        };\n    } finally{\n        clearTimeout(timeout);\n    }\n}\nasync function chatWithTools(opts) {\n    const conversation = [\n        ...opts.messages\n    ];\n    const toolCalls = [];\n    const maxIterations = Math.max(1, opts.maxToolIterations ?? 3);\n    const shouldDebug = Boolean(opts.debug || process.env.OPENROUTER_DEBUG === 'true' || process.env.REPORT_DEBUG_OPENROUTER === 'true');\n    for(let iteration = 0; iteration < maxIterations; iteration++){\n        const body = {\n            model: opts.model,\n            messages: conversation,\n            tools: opts.tools,\n            provider: {\n                sort: normalizeProviderSort(opts.providerSort)\n            },\n            tool_choice: opts.toolChoice ?? 'auto',\n            parallel_tool_calls: typeof opts.parallelToolCalls === 'boolean' ? opts.parallelToolCalls : undefined,\n            temperature: typeof opts.temperature === 'number' ? opts.temperature : 0,\n            max_tokens: typeof opts.maxTokens === 'number' ? opts.maxTokens : undefined\n        };\n        const controller = new AbortController();\n        const timeout = setTimeout(()=>controller.abort(), typeof opts.timeoutMs === 'number' ? opts.timeoutMs : 120000);\n        const headers = buildHeaders();\n        const { approxTokens, charCount } = estimateTokens(conversation);\n        const requestSizeBytes = (()=>{\n            try {\n                if (typeof Buffer !== 'undefined') return Buffer.byteLength(JSON.stringify(body), 'utf8');\n            } catch  {}\n            try {\n                return new TextEncoder().encode(JSON.stringify(body)).length;\n            } catch  {}\n            try {\n                return (JSON.stringify(body) || '').length;\n            } catch  {\n                return 0;\n            }\n        })();\n        const t0 = Date.now();\n        try {\n            if (shouldDebug) {\n                console.info('[openrouter:tools] debug request', {\n                    iteration,\n                    model: opts.model,\n                    input_tokens_approx: approxTokens,\n                    input_chars: charCount,\n                    request_size_bytes: requestSizeBytes,\n                    provider_sort: body.provider?.sort,\n                    tool_choice: body.tool_choice,\n                    parallel_tool_calls: body.parallel_tool_calls\n                });\n            }\n            const res = await fetch(OPENROUTER_URL, {\n                method: 'POST',\n                headers,\n                body: JSON.stringify(body),\n                signal: controller.signal\n            });\n            const latencyMs = Date.now() - t0;\n            if (!res.ok) {\n                const errText = await res.text().catch(()=>'');\n                if (shouldDebug) console.error('[openrouter:tools] debug error', {\n                    status: res.status,\n                    latency_ms: latencyMs,\n                    error: errText?.slice?.(0, 500)\n                });\n                throw new Error(`OpenRouter ${res.status}: ${errText}`);\n            }\n            const json = await res.json();\n            const choice = json?.choices?.[0];\n            if (!choice?.message) throw new Error('OpenRouter response missing message for tool call flow');\n            if (shouldDebug) {\n                console.info('[openrouter:tools] debug response', {\n                    iteration,\n                    latency_ms: latencyMs,\n                    finish_reason: choice?.finish_reason || null,\n                    tool_calls: choice?.message?.tool_calls?.map((t)=>t?.function?.name) || []\n                });\n            }\n            const assistantMessage = choice.message;\n            conversation.push(assistantMessage);\n            const calls = assistantMessage.tool_calls || [];\n            if (calls.length > 0) {\n                for (const call of calls){\n                    const handler = opts.handlers?.[call.function?.name];\n                    if (!handler) throw new Error(`Unhandled tool call: ${call.function?.name}`);\n                    let parsedArgs = {};\n                    try {\n                        parsedArgs = call.function?.arguments ? JSON.parse(call.function.arguments) : {};\n                    } catch (error) {\n                        throw new Error(`Failed to parse tool arguments for ${call.function?.name}: ${error.message}`);\n                    }\n                    const handlerResult = await handler(parsedArgs, {\n                        toolCall: call\n                    });\n                    const content = typeof handlerResult.content === 'string' ? handlerResult.content : JSON.stringify(handlerResult.content ?? {});\n                    conversation.push({\n                        role: 'tool',\n                        tool_call_id: call.id,\n                        content\n                    });\n                    toolCalls.push({\n                        tool: call.function.name,\n                        arguments: parsedArgs,\n                        response: handlerResult,\n                        toolCallId: call.id\n                    });\n                }\n                if (opts.returnOnToolCall) {\n                    return {\n                        finalMessage: assistantMessage,\n                        raw: json,\n                        toolCalls,\n                        transcript: conversation\n                    };\n                }\n                continue;\n            }\n            return {\n                finalMessage: assistantMessage,\n                raw: json,\n                toolCalls,\n                transcript: conversation\n            };\n        } finally{\n            clearTimeout(timeout);\n        }\n    }\n    throw new Error('Tool calling loop exceeded maximum iterations without completion');\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3NlcnZpY2VzL29wZW5yb3V0ZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQW9DQSxNQUFNQSxpQkFBaUI7QUFFdkIsNERBQTREO0FBQzVELHFFQUFxRTtBQUM5RCxTQUFTQyxzQkFBc0JDLElBQXdCO0lBQzdELE1BQU1DLGFBQWEsQ0FBQ0MsUUFBUUMsR0FBRyxDQUFDQyx3QkFBd0IsSUFBSSxFQUFDLEVBQUdDLFdBQVc7SUFDM0UsTUFBTUMsWUFBWSxDQUFDTixRQUFRQyxjQUFjLE9BQU0sRUFBR0ksV0FBVztJQUM3RCxJQUFJQyxjQUFjLFNBQVMsT0FBTztJQUNsQyxJQUFJQSxjQUFjLGNBQWMsT0FBTztJQUN2QyxJQUFJQSxjQUFjLFdBQVcsT0FBTztJQUNwQyxpQkFBaUI7SUFDakIsSUFBSUEsY0FBYyxTQUFTLE9BQU87SUFDbEMsSUFBSUEsY0FBYyxXQUFXLE9BQU87SUFDcEMsT0FBTztBQUNSO0FBRUEsU0FBU0M7SUFDUixNQUFNQyxVQUFrQztRQUN2QyxnQkFBZ0I7UUFDaEIsaUJBQWlCLENBQUMsT0FBTyxFQUFFTixRQUFRQyxHQUFHLENBQUNNLGtCQUFrQixFQUFFO0lBQzVEO0lBQ0EsSUFBSVAsUUFBUUMsR0FBRyxDQUFDTyx1QkFBdUIsRUFBRUYsT0FBTyxDQUFDLGVBQWUsR0FBR04sUUFBUUMsR0FBRyxDQUFDTyx1QkFBdUI7SUFDdEcsSUFBSVIsUUFBUUMsR0FBRyxDQUFDUSxrQkFBa0IsRUFBRUgsT0FBTyxDQUFDLFVBQVUsR0FBR04sUUFBUUMsR0FBRyxDQUFDUSxrQkFBa0I7SUFDdkYsT0FBT0g7QUFDUjtBQUVBLFNBQVNJLGtCQUFrQkMsT0FBb0I7SUFDOUMsTUFBTUMsVUFBVUQsUUFBUUMsT0FBTztJQUMvQixJQUFJLE9BQU9BLFlBQVksVUFBVSxPQUFPQSxRQUFRQyxNQUFNO0lBQ3RELE9BQU87QUFDUjtBQUVBLFNBQVNDLGVBQWVDLFFBQXVCO0lBQzlDLE1BQU1DLFlBQVlELFNBQVNFLE1BQU0sQ0FB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LE9BQU87Z0JBQUVtQyxjQUFjbEI7Z0JBQWtCeEIsS0FBS0o7Z0JBQU1ZO2dCQUFXbUMsWUFBWXBDO1lBQWE7UUFDekYsU0FBVTtZQUNUTixhQUFhMUM7UUFDZDtJQUNEO0lBQ0EsTUFBTSxJQUFJb0MsTUFBTTtBQUNqQiIsInNvdXJjZXMiOlsiRDpcXERlbHRhIElWXFxTb2Z3YXJlc1xcZ2xhc3NcXHNhbmRib3hcXHNoYWRjbi1jcm0tZGFzaGJvYXJkXFxzcmNcXHNlcnZlclxcc2VydmljZXNcXG9wZW5yb3V0ZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IHR5cGUgQ2hhdFJvbGUgPSAnc3lzdGVtJyB8ICd1c2VyJyB8ICdhc3Npc3RhbnQnIHwgJ3Rvb2wnXG5cbmV4cG9ydCBpbnRlcmZhY2UgVG9vbENhbGwge1xuXHRpZDogc3RyaW5nXG5cdHR5cGU6ICdmdW5jdGlvbidcblx0ZnVuY3Rpb246IHtcblx0XHRuYW1lOiBzdHJpbmdcblx0XHRhcmd1bWVudHM6IHN0cmluZ1xuXHR9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2hhdE1lc3NhZ2Uge1xuXHRyb2xlOiBDaGF0Um9sZVxuXHRjb250ZW50Pzogc3RyaW5nXG5cdG5hbWU/OiBzdHJpbmdcblx0dG9vbF9jYWxsX2lkPzogc3RyaW5nXG5cdHRvb2xfY2FsbHM/OiBUb29sQ2FsbFtdXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSnNvblNjaGVtYVNwZWMge1xuXHRuYW1lOiBzdHJpbmdcblx0c3RyaWN0OiBib29sZWFuXG5cdHNjaGVtYTogYW55XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2hhdEpzb25TY2hlbWFPcHRpb25zIHtcblx0bW9kZWw6IHN0cmluZ1xuXHRtZXNzYWdlczogQ2hhdE1lc3NhZ2VbXVxuXHRzY2hlbWE6IEpzb25TY2hlbWFTcGVjXG5cdHRlbXBlcmF0dXJlPzogbnVtYmVyXG5cdG1heFRva2Vucz86IG51bWJlclxuXHRwcm92aWRlclNvcnQ/OiAncHJpY2UnIHwgJ3Rocm91Z2hwdXQnIHwgJ2xhdGVuY3knXG5cdHRpbWVvdXRNcz86IG51bWJlclxuXHRkZWJ1Zz86IGJvb2xlYW5cbn1cblxuY29uc3QgT1BFTlJPVVRFUl9VUkwgPSAnaHR0cHM6Ly9vcGVucm91dGVyLmFpL2FwaS92MS9jaGF0L2NvbXBsZXRpb25zJ1xuXG4vLyBOb3JtYWxpemUgcHJvdmlkZXIgc29ydCB0byBjdXJyZW50IE9wZW5Sb3V0ZXIgQVBJIHZhbHVlcy5cbi8vIEJhY2t3YXJkcyBjb21wYXRpYmxlIG1hcHBpbmcgZm9yIGxlZ2FjeSB2YWx1ZXMgdXNlZCBpbiBvbGRlciBjb2RlLlxuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZVByb3ZpZGVyU29ydChzb3J0OiBzdHJpbmcgfCB1bmRlZmluZWQpOiAncHJpY2UnIHwgJ3Rocm91Z2hwdXQnIHwgJ2xhdGVuY3knIHtcblx0Y29uc3QgZW52RGVmYXVsdCA9IChwcm9jZXNzLmVudi5PUEVOUk9VVEVSX1BST1ZJREVSX1NPUlQgfHwgJycpLnRvTG93ZXJDYXNlKClcblx0Y29uc3QgY2FuZGlkYXRlID0gKHNvcnQgfHwgZW52RGVmYXVsdCB8fCAncHJpY2UnKS50b0xvd2VyQ2FzZSgpXG5cdGlmIChjYW5kaWRhdGUgPT09ICdwcmljZScpIHJldHVybiAncHJpY2UnXG5cdGlmIChjYW5kaWRhdGUgPT09ICd0aHJvdWdocHV0JykgcmV0dXJuICd0aHJvdWdocHV0J1xuXHRpZiAoY2FuZGlkYXRlID09PSAnbGF0ZW5jeScpIHJldHVybiAnbGF0ZW5jeSdcblx0Ly8gbGVnYWN5IGFsaWFzZXNcblx0aWYgKGNhbmRpZGF0ZSA9PT0gJ3NwZWVkJykgcmV0dXJuICdsYXRlbmN5J1xuXHRpZiAoY2FuZGlkYXRlID09PSAncXVhbGl0eScpIHJldHVybiAnbGF0ZW5jeSdcblx0cmV0dXJuICdwcmljZSdcbn1cblxuZnVuY3Rpb24gYnVpbGRIZWFkZXJzKCk6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4ge1xuXHRjb25zdCBoZWFkZXJzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xuXHRcdCdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG5cdFx0J0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7cHJvY2Vzcy5lbnYuT1BFTlJPVVRFUl9BUElfS0VZfWAsXG5cdH1cblx0aWYgKHByb2Nlc3MuZW52Lk9QRU5ST1VURVJfSFRUUF9SRUZFUkVSKSBoZWFkZXJzWydIVFRQLVJlZmVyZXInXSA9IHByb2Nlc3MuZW52Lk9QRU5ST1VURVJfSFRUUF9SRUZFUkVSXG5cdGlmIChwcm9jZXNzLmVudi5PUEVOUk9VVEVSX1hfVElUTEUpIGhlYWRlcnNbJ1gtVGl0bGUnXSA9IHByb2Nlc3MuZW52Lk9QRU5ST1VURVJfWF9USVRMRVxuXHRyZXR1cm4gaGVhZGVyc1xufVxuXG5mdW5jdGlvbiBtZXNzYWdlQ2hhckxlbmd0aChtZXNzYWdlOiBDaGF0TWVzc2FnZSk6IG51bWJlciB7XG5cdGNvbnN0IGNvbnRlbnQgPSBtZXNzYWdlLmNvbnRlbnRcblx0aWYgKHR5cGVvZiBjb250ZW50ID09PSAnc3RyaW5nJykgcmV0dXJuIGNvbnRlbnQubGVuZ3RoXG5cdHJldHVybiAwXG59XG5cbmZ1bmN0aW9uIGVzdGltYXRlVG9rZW5zKG1lc3NhZ2VzOiBDaGF0TWVzc2FnZVtdKTogeyBhcHByb3hUb2tlbnM6IG51bWJlcjsgY2hhckNvdW50OiBudW1iZXIgfSB7XG5cdGNvbnN0IGNoYXJDb3VudCA9IG1lc3NhZ2VzLnJlZHVjZSgoc3VtLCBtKSA9PiBzdW0gKyBtZXNzYWdlQ2hhckxlbmd0aChtKSwgMClcblx0Ly8gVmVyeSByb3VnaCBoZXVyaXN0aWM6IH40IGNoYXJzIHBlciB0b2tlbiBmb3IgRW5nbGlzaCB0ZXh0XG5cdGNvbnN0IGFwcHJveFRva2VucyA9IE1hdGguY2VpbChjaGFyQ291bnQgLyA0KVxuXHRyZXR1cm4geyBhcHByb3hUb2tlbnMsIGNoYXJDb3VudCB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGF0SnNvblNjaGVtYShvcHRzOiBDaGF0SnNvblNjaGVtYU9wdGlvbnMpOiBQcm9taXNlPHsgY29udGVudDogc3RyaW5nOyByYXc6IGFueSB9PiB7XG5cdGNvbnN0IGJvZHk6IGFueSA9IHtcblx0XHRtb2RlbDogb3B0cy5tb2RlbCxcblx0XHRtZXNzYWdlczogb3B0cy5tZXNzYWdlcyxcblx0XHRyZXNwb25zZV9mb3JtYXQ6IHtcblx0XHRcdHR5cGU6ICdqc29uX3NjaGVtYScsXG5cdFx0XHRqc29uX3NjaGVtYToge1xuXHRcdFx0XHRuYW1lOiBvcHRzLnNjaGVtYS5uYW1lLFxuXHRcdFx0XHRzdHJpY3Q6IG9wdHMuc2NoZW1hLnN0cmljdCxcblx0XHRcdFx0c2NoZW1hOiBvcHRzLnNjaGVtYS5zY2hlbWEsXG5cdFx0XHR9LFxuXHRcdH0sXG5cdFx0cHJvdmlkZXI6IHsgc29ydDogbm9ybWFsaXplUHJvdmlkZXJTb3J0KG9wdHMucHJvdmlkZXJTb3J0KSB9LFxuXHRcdHRlbXBlcmF0dXJlOiB0eXBlb2Ygb3B0cy50ZW1wZXJhdHVyZSA9PT0gJ251bWJlcicgPyBvcHRzLnRlbXBlcmF0dXJlIDogMC4xLFxuXHRcdG1heF90b2tlbnM6IHR5cGVvZiBvcHRzLm1heFRva2VucyA9PT0gJ251bWJlcicgPyBvcHRzLm1heFRva2VucyA6IDE2MDAwLFxuXHR9XG5cblx0Y29uc3QgY29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKVxuXHRjb25zdCB0aW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiBjb250cm9sbGVyLmFib3J0KCksIHR5cGVvZiBvcHRzLnRpbWVvdXRNcyA9PT0gJ251bWJlcicgPyBvcHRzLnRpbWVvdXRNcyA6IDkwXzAwMClcblx0Y29uc3Qgc2hvdWxkRGVidWcgPSBCb29sZWFuKG9wdHMuZGVidWcgfHwgcHJvY2Vzcy5lbnYuT1BFTlJPVVRFUl9ERUJVRyA9PT0gJ3RydWUnIHx8IHByb2Nlc3MuZW52LlJFUE9SVF9ERUJVR19PUEVOUk9VVEVSID09PSAndHJ1ZScpXG5cblx0Y29uc3QgaGVhZGVycyA9IGJ1aWxkSGVhZGVycygpXG5cdGNvbnN0IHsgYXBwcm94VG9rZW5zLCBjaGFyQ291bnQgfSA9IGVzdGltYXRlVG9rZW5zKG9wdHMubWVzc2FnZXMpXG5cdGNvbnN0IHJlcXVlc3RTaXplQnl0ZXMgPSBCdWZmZXIuYnl0ZUxlbmd0aChKU09OLnN0cmluZ2lmeShib2R5KSwgJ3V0ZjgnKVxuXHRjb25zdCB0MCA9IERhdGUubm93KClcblx0dHJ5IHtcblx0XHRpZiAoc2hvdWxkRGVidWcpIHtcblx0XHRcdGNvbnNvbGUuaW5mbygnW29wZW5yb3V0ZXJdIGRlYnVnIHJlcXVlc3QnLCB7XG5cdFx0XHRcdG1vZGVsOiBvcHRzLm1vZGVsLFxuXHRcdFx0XHRpbnB1dF90b2tlbnNfYXBwcm94OiBhcHByb3hUb2tlbnMsXG5cdFx0XHRcdGlucHV0X2NoYXJzOiBjaGFyQ291bnQsXG5cdFx0XHRcdHJlcXVlc3Rfc2l6ZV9ieXRlczogcmVxdWVzdFNpemVCeXRlcyxcblx0XHRcdFx0cHJvdmlkZXJfc29ydDogYm9keS5wcm92aWRlcj8uc29ydCxcblx0XHRcdFx0bWF4X3Rva2VuczogYm9keS5tYXhfdG9rZW5zLFxuXHRcdFx0XHR0ZW1wZXJhdHVyZTogYm9keS50ZW1wZXJhdHVyZSxcblx0XHRcdH0pXG5cdFx0fVxuXHRcdGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKE9QRU5ST1VURVJfVVJMLCB7XG5cdFx0XHRtZXRob2Q6ICdQT1NUJyxcblx0XHRcdGhlYWRlcnMsXG5cdFx0XHRib2R5OiBKU09OLnN0cmluZ2lmeShib2R5KSxcblx0XHRcdHNpZ25hbDogY29udHJvbGxlci5zaWduYWwsXG5cdFx0fSlcblx0XHRjb25zdCBsYXRlbmN5TXMgPSBEYXRlLm5vdygpIC0gdDBcblx0XHRpZiAoIXJlcy5vaykge1xuXHRcdFx0Y29uc3QgZXJyVGV4dCA9IGF3YWl0IHJlcy50ZXh0KCkuY2F0Y2goKCkgPT4gJycpXG5cdFx0XHRpZiAoc2hvdWxkRGVidWcpIGNvbnNvbGUuZXJyb3IoJ1tvcGVucm91dGVyXSBkZWJ1ZyBlcnJvcicsIHsgc3RhdHVzOiByZXMuc3RhdHVzLCBsYXRlbmN5X21zOiBsYXRlbmN5TXMsIGVycm9yOiBlcnJUZXh0Py5zbGljZT8uKDAsIDUwMCkgfSlcblx0XHRcdHRocm93IG5ldyBFcnJvcihgT3BlblJvdXRlciAke3Jlcy5zdGF0dXN9OiAke2VyclRleHR9YClcblx0XHR9XG5cdFx0Y29uc3QganNvbiA9IGF3YWl0IHJlcy5qc29uKClcblx0XHRpZiAoc2hvdWxkRGVidWcpIHtcblx0XHRcdGNvbnNvbGUuaW5mbygnW29wZW5yb3V0ZXJdIGRlYnVnIHJlc3BvbnNlJywge1xuXHRcdFx0XHRsYXRlbmN5X21zOiBsYXRlbmN5TXMsXG5cdFx0XHRcdHVzYWdlOiBqc29uPy51c2FnZSB8fCBudWxsLFxuXHRcdFx0XHRmaW5pc2hfcmVhc29uOiBqc29uPy5jaG9pY2VzPy5bMF0/LmZpbmlzaF9yZWFzb24gfHwgbnVsbCxcblx0XHRcdH0pXG5cdFx0fVxuXHRcdGNvbnN0IGNvbnRlbnQgPSBqc29uPy5jaG9pY2VzPy5bMF0/Lm1lc3NhZ2U/LmNvbnRlbnRcblx0XHRyZXR1cm4geyBjb250ZW50LCByYXc6IGpzb24gfVxuXHR9IGZpbmFsbHkge1xuXHRcdGNsZWFyVGltZW91dCh0aW1lb3V0KVxuXHR9XG59XG5cbi8vIFRleHQgKG1hcmtkb3duKSBjaGF0IHdpdGhvdXQgSlNPTiBzY2hlbWEgZW5mb3JjZW1lbnRcbmV4cG9ydCBpbnRlcmZhY2UgQ2hhdFRleHRPcHRpb25zIHtcbiAgbW9kZWw6IHN0cmluZ1xuICBtZXNzYWdlczogQ2hhdE1lc3NhZ2VbXVxuICB0ZW1wZXJhdHVyZT86IG51bWJlclxuICBtYXhUb2tlbnM/OiBudW1iZXJcbiAgcHJvdmlkZXJTb3J0PzogJ3ByaWNlJyB8ICd0aHJvdWdocHV0JyB8ICdsYXRlbmN5J1xuICB0aW1lb3V0TXM/OiBudW1iZXJcbiAgZGVidWc/OiBib29sZWFuXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGF0VGV4dChvcHRzOiBDaGF0VGV4dE9wdGlvbnMpOiBQcm9taXNlPHsgY29udGVudDogc3RyaW5nOyByYXc6IGFueSB9PiB7XG4gIGNvbnN0IGJvZHk6IGFueSA9IHtcbiAgICBtb2RlbDogb3B0cy5tb2RlbCxcbiAgICBtZXNzYWdlczogb3B0cy5tZXNzYWdlcyxcbiAgICBwcm92aWRlcjogeyBzb3J0OiBub3JtYWxpemVQcm92aWRlclNvcnQob3B0cy5wcm92aWRlclNvcnQpIH0sXG4gICAgdGVtcGVyYXR1cmU6IHR5cGVvZiBvcHRzLnRlbXBlcmF0dXJlID09PSAnbnVtYmVyJyA/IG9wdHMudGVtcGVyYXR1cmUgOiAwLjMsXG4gICAgbWF4X3Rva2VuczogdHlwZW9mIG9wdHMubWF4VG9rZW5zID09PSAnbnVtYmVyJyA/IG9wdHMubWF4VG9rZW5zIDogNDAwMCxcbiAgfVxuXG4gIGNvbnN0IGNvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKClcbiAgY29uc3QgdGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4gY29udHJvbGxlci5hYm9ydCgpLCB0eXBlb2Ygb3B0cy50aW1lb3V0TXMgPT09ICdudW1iZXInID8gb3B0cy50aW1lb3V0TXMgOiA5MF8wMDApXG4gIGNvbnN0IHNob3VsZERlYnVnID0gQm9vbGVhbihvcHRzLmRlYnVnIHx8IHByb2Nlc3MuZW52Lk9QRU5ST1VURVJfREVCVUcgPT09ICd0cnVlJyB8fCBwcm9jZXNzLmVudi5SRVBPUlRfREVCVUdfT1BFTlJPVVRFUiA9PT0gJ3RydWUnKVxuXG4gIGNvbnN0IGhlYWRlcnMgPSBidWlsZEhlYWRlcnMoKVxuICBjb25zdCB7IGFwcHJveFRva2VucywgY2hhckNvdW50IH0gPSAoKCk6IHsgYXBwcm94VG9rZW5zOiBudW1iZXI7IGNoYXJDb3VudDogbnVtYmVyIH0gPT4ge1xuICAgIGNvbnN0IGNoYXJDb3VudCA9IChvcHRzLm1lc3NhZ2VzIHx8IFtdKS5yZWR1Y2UoKHMsIG0pID0+IHMgKyAobS5jb250ZW50Py5sZW5ndGggfHwgMCksIDApXG4gICAgcmV0dXJuIHsgYXBwcm94VG9rZW5zOiBNYXRoLmNlaWwoY2hhckNvdW50IC8gNCksIGNoYXJDb3VudCB9XG4gIH0pKClcbiAgY29uc3QgcmVxdWVzdFNpemVCeXRlcyA9ICgoKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGlmICh0eXBlb2YgQnVmZmVyICE9PSAndW5kZWZpbmVkJykgcmV0dXJuIEJ1ZmZlci5ieXRlTGVuZ3RoKEpTT04uc3RyaW5naWZ5KGJvZHkpLCAndXRmOCcpXG4gICAgfSBjYXRjaCB7fVxuICAgIHRyeSB7IHJldHVybiBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoSlNPTi5zdHJpbmdpZnkoYm9keSkpLmxlbmd0aCB9IGNhdGNoIHt9XG4gICAgdHJ5IHsgcmV0dXJuIChKU09OLnN0cmluZ2lmeShib2R5KSB8fCAnJykubGVuZ3RoIH0gY2F0Y2ggeyByZXR1cm4gMCB9XG4gIH0pKClcbiAgY29uc3QgdDAgPSBEYXRlLm5vdygpXG4gIHRyeSB7XG4gICAgaWYgKHNob3VsZERlYnVnKSB7XG4gICAgICBjb25zb2xlLmluZm8oJ1tvcGVucm91dGVyOnRleHRdIGRlYnVnIHJlcXVlc3QnLCB7XG4gICAgICAgIG1vZGVsOiBvcHRzLm1vZGVsLFxuICAgICAgICBpbnB1dF90b2tlbnNfYXBwcm94OiBhcHByb3hUb2tlbnMsXG4gICAgICAgIGlucHV0X2NoYXJzOiBjaGFyQ291bnQsXG4gICAgICAgIHJlcXVlc3Rfc2l6ZV9ieXRlczogcmVxdWVzdFNpemVCeXRlcyxcbiAgICAgICAgcHJvdmlkZXJfc29ydDogYm9keS5wcm92aWRlcj8uc29ydCxcbiAgICAgICAgbWF4X3Rva2VuczogYm9keS5tYXhfdG9rZW5zLFxuICAgICAgICB0ZW1wZXJhdHVyZTogYm9keS50ZW1wZXJhdHVyZSxcbiAgICAgIH0pXG4gICAgfVxuICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKE9QRU5ST1VURVJfVVJMLCB7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGhlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShib2R5KSxcbiAgICAgIHNpZ25hbDogY29udHJvbGxlci5zaWduYWwsXG4gICAgfSlcbiAgICBjb25zdCBsYXRlbmN5TXMgPSBEYXRlLm5vdygpIC0gdDBcbiAgICBpZiAoIXJlcy5vaykge1xuICAgICAgY29uc3QgZXJyVGV4dCA9IGF3YWl0IHJlcy50ZXh0KCkuY2F0Y2goKCkgPT4gJycpXG4gICAgICBpZiAoc2hvdWxkRGVidWcpIGNvbnNvbGUuZXJyb3IoJ1tvcGVucm91dGVyOnRleHRdIGRlYnVnIGVycm9yJywgeyBzdGF0dXM6IHJlcy5zdGF0dXMsIGxhdGVuY3lfbXM6IGxhdGVuY3lNcywgZXJyb3I6IGVyclRleHQ/LnNsaWNlPy4oMCwgNTAwKSB9KVxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBPcGVuUm91dGVyICR7cmVzLnN0YXR1c306ICR7ZXJyVGV4dH1gKVxuICAgIH1cbiAgICBjb25zdCBqc29uID0gYXdhaXQgcmVzLmpzb24oKVxuICAgIGlmIChzaG91bGREZWJ1Zykge1xuICAgICAgY29uc29sZS5pbmZvKCdbb3BlbnJvdXRlcjp0ZXh0XSBkZWJ1ZyByZXNwb25zZScsIHtcbiAgICAgICAgbGF0ZW5jeV9tczogbGF0ZW5jeU1zLFxuICAgICAgICB1c2FnZToganNvbj8udXNhZ2UgfHwgbnVsbCxcbiAgICAgICAgZmluaXNoX3JlYXNvbjoganNvbj8uY2hvaWNlcz8uWzBdPy5maW5pc2hfcmVhc29uIHx8IG51bGwsXG4gICAgICB9KVxuICAgIH1cbiAgICBjb25zdCBjb250ZW50ID0ganNvbj8uY2hvaWNlcz8uWzBdPy5tZXNzYWdlPy5jb250ZW50XG4gICAgcmV0dXJuIHsgY29udGVudCwgcmF3OiBqc29uIH1cbiAgfSBmaW5hbGx5IHtcbiAgICBjbGVhclRpbWVvdXQodGltZW91dClcbiAgfVxufVxuXG5leHBvcnQgdHlwZSBUb29sRGVmaW5pdGlvbiA9IHtcblx0dHlwZTogJ2Z1bmN0aW9uJ1xuXHRmdW5jdGlvbjoge1xuXHRcdG5hbWU6IHN0cmluZ1xuXHRcdGRlc2NyaXB0aW9uPzogc3RyaW5nXG5cdFx0cGFyYW1ldGVycz86IFJlY29yZDxzdHJpbmcsIGFueT5cblx0fVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENoYXRUb29sSGFuZGxlclJlc3VsdCB7XG5cdGNvbnRlbnQ6IHN0cmluZ1xuXHRtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT5cbn1cblxuZXhwb3J0IHR5cGUgQ2hhdFRvb2xIYW5kbGVyID0gKGFyZ3M6IGFueSwgY29udGV4dDogeyB0b29sQ2FsbDogVG9vbENhbGwgfSkgPT4gUHJvbWlzZTxDaGF0VG9vbEhhbmRsZXJSZXN1bHQ+IHwgQ2hhdFRvb2xIYW5kbGVyUmVzdWx0XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2hhdFdpdGhUb29sc09wdGlvbnMge1xuXHRtb2RlbDogc3RyaW5nXG5cdG1lc3NhZ2VzOiBDaGF0TWVzc2FnZVtdXG5cdHRvb2xzOiBUb29sRGVmaW5pdGlvbltdXG5cdGhhbmRsZXJzOiBSZWNvcmQ8c3RyaW5nLCBDaGF0VG9vbEhhbmRsZXI+XG5cdHRvb2xDaG9pY2U/OiAnYXV0bycgfCAnbm9uZScgfCB7IHR5cGU6ICdmdW5jdGlvbic7IGZ1bmN0aW9uOiB7IG5hbWU6IHN0cmluZyB9IH1cblx0cGFyYWxsZWxUb29sQ2FsbHM/OiBib29sZWFuXG5cdG1heFRvb2xJdGVyYXRpb25zPzogbnVtYmVyXG5cdHByb3ZpZGVyU29ydD86ICdwcmljZScgfCAndGhyb3VnaHB1dCcgfCAnbGF0ZW5jeSdcblx0dGVtcGVyYXR1cmU/OiBudW1iZXJcblx0bWF4VG9rZW5zPzogbnVtYmVyXG5cdHRpbWVvdXRNcz86IG51bWJlclxuXHRkZWJ1Zz86IGJvb2xlYW5cblx0cmV0dXJuT25Ub29sQ2FsbD86IGJvb2xlYW5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBDaGF0VG9vbENhbGxMb2cge1xuXHR0b29sOiBzdHJpbmdcblx0YXJndW1lbnRzOiBhbnlcblx0cmVzcG9uc2U6IENoYXRUb29sSGFuZGxlclJlc3VsdFxuXHR0b29sQ2FsbElkOiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBDaGF0V2l0aFRvb2xzUmVzdWx0IHtcblx0ZmluYWxNZXNzYWdlPzogQ2hhdE1lc3NhZ2Vcblx0cmF3OiBhbnlcblx0dG9vbENhbGxzOiBDaGF0VG9vbENhbGxMb2dbXVxuXHR0cmFuc2NyaXB0OiBDaGF0TWVzc2FnZVtdXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGF0V2l0aFRvb2xzKG9wdHM6IENoYXRXaXRoVG9vbHNPcHRpb25zKTogUHJvbWlzZTxDaGF0V2l0aFRvb2xzUmVzdWx0PiB7XG5cdGNvbnN0IGNvbnZlcnNhdGlvbjogQ2hhdE1lc3NhZ2VbXSA9IFsuLi5vcHRzLm1lc3NhZ2VzXVxuXHRjb25zdCB0b29sQ2FsbHM6IENoYXRUb29sQ2FsbExvZ1tdID0gW11cblx0Y29uc3QgbWF4SXRlcmF0aW9ucyA9IE1hdGgubWF4KDEsIG9wdHMubWF4VG9vbEl0ZXJhdGlvbnMgPz8gMylcblx0Y29uc3Qgc2hvdWxkRGVidWcgPSBCb29sZWFuKG9wdHMuZGVidWcgfHwgcHJvY2Vzcy5lbnYuT1BFTlJPVVRFUl9ERUJVRyA9PT0gJ3RydWUnIHx8IHByb2Nlc3MuZW52LlJFUE9SVF9ERUJVR19PUEVOUk9VVEVSID09PSAndHJ1ZScpXG5cblx0Zm9yIChsZXQgaXRlcmF0aW9uID0gMDsgaXRlcmF0aW9uIDwgbWF4SXRlcmF0aW9uczsgaXRlcmF0aW9uKyspIHtcblx0XHRjb25zdCBib2R5OiBhbnkgPSB7XG5cdFx0XHRtb2RlbDogb3B0cy5tb2RlbCxcblx0XHRcdG1lc3NhZ2VzOiBjb252ZXJzYXRpb24sXG5cdFx0XHR0b29sczogb3B0cy50b29scyxcblx0XHRcdHByb3ZpZGVyOiB7IHNvcnQ6IG5vcm1hbGl6ZVByb3ZpZGVyU29ydChvcHRzLnByb3ZpZGVyU29ydCkgfSxcblx0XHRcdHRvb2xfY2hvaWNlOiBvcHRzLnRvb2xDaG9pY2UgPz8gJ2F1dG8nLFxuXHRcdFx0cGFyYWxsZWxfdG9vbF9jYWxsczogdHlwZW9mIG9wdHMucGFyYWxsZWxUb29sQ2FsbHMgPT09ICdib29sZWFuJyA/IG9wdHMucGFyYWxsZWxUb29sQ2FsbHMgOiB1bmRlZmluZWQsXG5cdFx0XHR0ZW1wZXJhdHVyZTogdHlwZW9mIG9wdHMudGVtcGVyYXR1cmUgPT09ICdudW1iZXInID8gb3B0cy50ZW1wZXJhdHVyZSA6IDAsXG5cdFx0XHRtYXhfdG9rZW5zOiB0eXBlb2Ygb3B0cy5tYXhUb2tlbnMgPT09ICdudW1iZXInID8gb3B0cy5tYXhUb2tlbnMgOiB1bmRlZmluZWQsXG5cdFx0fVxuXG5cdFx0Y29uc3QgY29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKVxuXHRcdGNvbnN0IHRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IGNvbnRyb2xsZXIuYWJvcnQoKSwgdHlwZW9mIG9wdHMudGltZW91dE1zID09PSAnbnVtYmVyJyA/IG9wdHMudGltZW91dE1zIDogMTIwXzAwMClcblx0XHRjb25zdCBoZWFkZXJzID0gYnVpbGRIZWFkZXJzKClcblx0XHRjb25zdCB7IGFwcHJveFRva2VucywgY2hhckNvdW50IH0gPSBlc3RpbWF0ZVRva2Vucyhjb252ZXJzYXRpb24pXG4gIGNvbnN0IHJlcXVlc3RTaXplQnl0ZXMgPSAoKCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBpZiAodHlwZW9mIEJ1ZmZlciAhPT0gJ3VuZGVmaW5lZCcpIHJldHVybiBCdWZmZXIuYnl0ZUxlbmd0aChKU09OLnN0cmluZ2lmeShib2R5KSwgJ3V0ZjgnKVxuICAgIH0gY2F0Y2gge31cbiAgICB0cnkgeyByZXR1cm4gbmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKEpTT04uc3RyaW5naWZ5KGJvZHkpKS5sZW5ndGggfSBjYXRjaCB7fVxuICAgIHRyeSB7IHJldHVybiAoSlNPTi5zdHJpbmdpZnkoYm9keSkgfHwgJycpLmxlbmd0aCB9IGNhdGNoIHsgcmV0dXJuIDAgfVxuICB9KSgpXG5cdFx0Y29uc3QgdDAgPSBEYXRlLm5vdygpXG5cdFx0dHJ5IHtcblx0XHRcdGlmIChzaG91bGREZWJ1Zykge1xuXHRcdFx0XHRjb25zb2xlLmluZm8oJ1tvcGVucm91dGVyOnRvb2xzXSBkZWJ1ZyByZXF1ZXN0Jywge1xuXHRcdFx0XHRcdGl0ZXJhdGlvbixcblx0XHRcdFx0XHRtb2RlbDogb3B0cy5tb2RlbCxcblx0XHRcdFx0XHRpbnB1dF90b2tlbnNfYXBwcm94OiBhcHByb3hUb2tlbnMsXG5cdFx0XHRcdFx0aW5wdXRfY2hhcnM6IGNoYXJDb3VudCxcblx0XHRcdFx0XHRyZXF1ZXN0X3NpemVfYnl0ZXM6IHJlcXVlc3RTaXplQnl0ZXMsXG5cdFx0XHRcdFx0cHJvdmlkZXJfc29ydDogYm9keS5wcm92aWRlcj8uc29ydCxcblx0XHRcdFx0XHR0b29sX2Nob2ljZTogYm9keS50b29sX2Nob2ljZSxcblx0XHRcdFx0XHRwYXJhbGxlbF90b29sX2NhbGxzOiBib2R5LnBhcmFsbGVsX3Rvb2xfY2FsbHMsXG5cdFx0XHRcdH0pXG5cdFx0XHR9XG5cdFx0XHRjb25zdCByZXMgPSBhd2FpdCBmZXRjaChPUEVOUk9VVEVSX1VSTCwge1xuXHRcdFx0XHRtZXRob2Q6ICdQT1NUJyxcblx0XHRcdFx0aGVhZGVycyxcblx0XHRcdFx0Ym9keTogSlNPTi5zdHJpbmdpZnkoYm9keSksXG5cdFx0XHRcdHNpZ25hbDogY29udHJvbGxlci5zaWduYWwsXG5cdFx0XHR9KVxuXHRcdFx0Y29uc3QgbGF0ZW5jeU1zID0gRGF0ZS5ub3coKSAtIHQwXG5cdFx0XHRpZiAoIXJlcy5vaykge1xuXHRcdFx0XHRjb25zdCBlcnJUZXh0ID0gYXdhaXQgcmVzLnRleHQoKS5jYXRjaCgoKSA9PiAnJylcblx0XHRcdFx0aWYgKHNob3VsZERlYnVnKSBjb25zb2xlLmVycm9yKCdbb3BlbnJvdXRlcjp0b29sc10gZGVidWcgZXJyb3InLCB7IHN0YXR1czogcmVzLnN0YXR1cywgbGF0ZW5jeV9tczogbGF0ZW5jeU1zLCBlcnJvcjogZXJyVGV4dD8uc2xpY2U/LigwLCA1MDApIH0pXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihgT3BlblJvdXRlciAke3Jlcy5zdGF0dXN9OiAke2VyclRleHR9YClcblx0XHRcdH1cblx0XHRcdGNvbnN0IGpzb24gPSBhd2FpdCByZXMuanNvbigpXG5cdFx0XHRjb25zdCBjaG9pY2UgPSBqc29uPy5jaG9pY2VzPy5bMF1cblx0XHRcdGlmICghY2hvaWNlPy5tZXNzYWdlKSB0aHJvdyBuZXcgRXJyb3IoJ09wZW5Sb3V0ZXIgcmVzcG9uc2UgbWlzc2luZyBtZXNzYWdlIGZvciB0b29sIGNhbGwgZmxvdycpXG5cdFx0XHRpZiAoc2hvdWxkRGVidWcpIHtcblx0XHRcdFx0Y29uc29sZS5pbmZvKCdbb3BlbnJvdXRlcjp0b29sc10gZGVidWcgcmVzcG9uc2UnLCB7XG5cdFx0XHRcdFx0aXRlcmF0aW9uLFxuXHRcdFx0XHRcdGxhdGVuY3lfbXM6IGxhdGVuY3lNcyxcblx0XHRcdFx0XHRmaW5pc2hfcmVhc29uOiBjaG9pY2U/LmZpbmlzaF9yZWFzb24gfHwgbnVsbCxcblx0XHRcdFx0XHR0b29sX2NhbGxzOiBjaG9pY2U/Lm1lc3NhZ2U/LnRvb2xfY2FsbHM/Lm1hcCgodDogVG9vbENhbGwpID0+IHQ/LmZ1bmN0aW9uPy5uYW1lKSB8fCBbXSxcblx0XHRcdFx0fSlcblx0XHRcdH1cblx0XHRcdGNvbnN0IGFzc2lzdGFudE1lc3NhZ2UgPSBjaG9pY2UubWVzc2FnZSBhcyBDaGF0TWVzc2FnZVxuXHRcdFx0Y29udmVyc2F0aW9uLnB1c2goYXNzaXN0YW50TWVzc2FnZSlcblx0XHRcdGNvbnN0IGNhbGxzID0gYXNzaXN0YW50TWVzc2FnZS50b29sX2NhbGxzIHx8IFtdXG5cdFx0XHRpZiAoY2FsbHMubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRmb3IgKGNvbnN0IGNhbGwgb2YgY2FsbHMpIHtcblx0XHRcdFx0XHRjb25zdCBoYW5kbGVyID0gb3B0cy5oYW5kbGVycz8uW2NhbGwuZnVuY3Rpb24/Lm5hbWVdXG5cdFx0XHRcdFx0aWYgKCFoYW5kbGVyKSB0aHJvdyBuZXcgRXJyb3IoYFVuaGFuZGxlZCB0b29sIGNhbGw6ICR7Y2FsbC5mdW5jdGlvbj8ubmFtZX1gKVxuXHRcdFx0XHRcdGxldCBwYXJzZWRBcmdzOiBhbnkgPSB7fVxuXHRcdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0XHRwYXJzZWRBcmdzID0gY2FsbC5mdW5jdGlvbj8uYXJndW1lbnRzID8gSlNPTi5wYXJzZShjYWxsLmZ1bmN0aW9uLmFyZ3VtZW50cykgOiB7fVxuXHRcdFx0XHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBwYXJzZSB0b29sIGFyZ3VtZW50cyBmb3IgJHtjYWxsLmZ1bmN0aW9uPy5uYW1lfTogJHsoZXJyb3IgYXMgRXJyb3IpLm1lc3NhZ2V9YClcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0Y29uc3QgaGFuZGxlclJlc3VsdCA9IGF3YWl0IGhhbmRsZXIocGFyc2VkQXJncywgeyB0b29sQ2FsbDogY2FsbCB9KVxuXHRcdFx0XHRcdGNvbnN0IGNvbnRlbnQgPSB0eXBlb2YgaGFuZGxlclJlc3VsdC5jb250ZW50ID09PSAnc3RyaW5nJyA/IGhhbmRsZXJSZXN1bHQuY29udGVudCA6IEpTT04uc3RyaW5naWZ5KGhhbmRsZXJSZXN1bHQuY29udGVudCA/PyB7fSlcblx0XHRcdFx0XHRjb252ZXJzYXRpb24ucHVzaCh7XG5cdFx0XHRcdFx0XHRyb2xlOiAndG9vbCcsXG5cdFx0XHRcdFx0XHR0b29sX2NhbGxfaWQ6IGNhbGwuaWQsXG5cdFx0XHRcdFx0XHRjb250ZW50LFxuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0dG9vbENhbGxzLnB1c2goe1xuXHRcdFx0XHRcdFx0dG9vbDogY2FsbC5mdW5jdGlvbi5uYW1lLFxuXHRcdFx0XHRcdFx0YXJndW1lbnRzOiBwYXJzZWRBcmdzLFxuXHRcdFx0XHRcdFx0cmVzcG9uc2U6IGhhbmRsZXJSZXN1bHQsXG5cdFx0XHRcdFx0XHR0b29sQ2FsbElkOiBjYWxsLmlkLFxuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdH1cblx0XHRcdFx0aWYgKG9wdHMucmV0dXJuT25Ub29sQ2FsbCkge1xuXHRcdFx0XHRcdHJldHVybiB7IGZpbmFsTWVzc2FnZTogYXNzaXN0YW50TWVzc2FnZSwgcmF3OiBqc29uLCB0b29sQ2FsbHMsIHRyYW5zY3JpcHQ6IGNvbnZlcnNhdGlvbiB9XG5cdFx0XHRcdH1cblx0XHRcdFx0Y29udGludWVcblx0XHRcdH1cblx0XHRcdHJldHVybiB7IGZpbmFsTWVzc2FnZTogYXNzaXN0YW50TWVzc2FnZSwgcmF3OiBqc29uLCB0b29sQ2FsbHMsIHRyYW5zY3JpcHQ6IGNvbnZlcnNhdGlvbiB9XG5cdFx0fSBmaW5hbGx5IHtcblx0XHRcdGNsZWFyVGltZW91dCh0aW1lb3V0KVxuXHRcdH1cblx0fVxuXHR0aHJvdyBuZXcgRXJyb3IoJ1Rvb2wgY2FsbGluZyBsb29wIGV4Y2VlZGVkIG1heGltdW0gaXRlcmF0aW9ucyB3aXRob3V0IGNvbXBsZXRpb24nKVxufVxuIl0sIm5hbWVzIjpbIk9QRU5ST1VURVJfVVJMIiwibm9ybWFsaXplUHJvdmlkZXJTb3J0Iiwic29ydCIsImVudkRlZmF1bHQiLCJwcm9jZXNzIiwiZW52IiwiT1BFTlJPVVRFUl9QUk9WSURFUl9TT1JUIiwidG9Mb3dlckNhc2UiLCJjYW5kaWRhdGUiLCJidWlsZEhlYWRlcnMiLCJoZWFkZXJzIiwiT1BFTlJPVVRFUl9BUElfS0VZIiwiT1BFTlJPVVRFUl9IVFRQX1JFRkVSRVIiLCJPUEVOUk9VVEVSX1hfVElUTEUiLCJtZXNzYWdlQ2hhckxlbmd0aCIsIm1lc3NhZ2UiLCJjb250ZW50IiwibGVuZ3RoIiwiZXN0aW1hdGVUb2tlbnMiLCJtZXNzYWdlcyIsImNoYXJDb3VudCIsInJlZHVjZSIsInN1bSIsIm0iLCJhcHByb3hUb2tlbnMiLCJNYXRoIiwiY2VpbCIsImNoYXRKc29uU2NoZW1hIiwib3B0cyIsImJvZHkiLCJtb2RlbCIsInJlc3BvbnNlX2Zvcm1hdCIsInR5cGUiLCJqc29uX3NjaGVtYSIsIm5hbWUiLCJzY2hlbWEiLCJzdHJpY3QiLCJwcm92aWRlciIsInByb3ZpZGVyU29ydCIsInRlbXBlcmF0dXJlIiwibWF4X3Rva2VucyIsIm1heFRva2VucyIsImNvbnRyb2xsZXIiLCJBYm9ydENvbnRyb2xsZXIiLCJ0aW1lb3V0Iiwic2V0VGltZW91dCIsImFib3J0IiwidGltZW91dE1zIiwic2hvdWxkRGVidWciLCJCb29sZWFuIiwiZGVidWciLCJPUEVOUk9VVEVSX0RFQlVHIiwiUkVQT1JUX0RFQlVHX09QRU5ST1VURVIiLCJyZXF1ZXN0U2l6ZUJ5dGVzIiwiQnVmZmVyIiwiYnl0ZUxlbmd0aCIsIkpTT04iLCJzdHJpbmdpZnkiLCJ0MCIsIkRhdGUiLCJub3ciLCJjb25zb2xlIiwiaW5mbyIsImlucHV0X3Rva2Vuc19hcHByb3giLCJpbnB1dF9jaGFycyIsInJlcXVlc3Rfc2l6ZV9ieXRlcyIsInByb3ZpZGVyX3NvcnQiLCJyZXMiLCJmZXRjaCIsIm1ldGhvZCIsInNpZ25hbCIsImxhdGVuY3lNcyIsIm9rIiwiZXJyVGV4dCIsInRleHQiLCJjYXRjaCIsImVycm9yIiwic3RhdHVzIiwibGF0ZW5jeV9tcyIsInNsaWNlIiwiRXJyb3IiLCJqc29uIiwidXNhZ2UiLCJmaW5pc2hfcmVhc29uIiwiY2hvaWNlcyIsInJhdyIsImNsZWFyVGltZW91dCIsImNoYXRUZXh0IiwicyIsIlRleHRFbmNvZGVyIiwiZW5jb2RlIiwiY2hhdFdpdGhUb29scyIsImNvbnZlcnNhdGlvbiIsInRvb2xDYWxscyIsIm1heEl0ZXJhdGlvbnMiLCJtYXgiLCJtYXhUb29sSXRlcmF0aW9ucyIsIml0ZXJhdGlvbiIsInRvb2xzIiwidG9vbF9jaG9pY2UiLCJ0b29sQ2hvaWNlIiwicGFyYWxsZWxfdG9vbF9jYWxscyIsInBhcmFsbGVsVG9vbENhbGxzIiwidW5kZWZpbmVkIiwiY2hvaWNlIiwidG9vbF9jYWxscyIsIm1hcCIsInQiLCJmdW5jdGlvbiIsImFzc2lzdGFudE1lc3NhZ2UiLCJwdXNoIiwiY2FsbHMiLCJjYWxsIiwiaGFuZGxlciIsImhhbmRsZXJzIiwicGFyc2VkQXJncyIsImFyZ3VtZW50cyIsInBhcnNlIiwiaGFuZGxlclJlc3VsdCIsInRvb2xDYWxsIiwicm9sZSIsInRvb2xfY2FsbF9pZCIsImlkIiwidG9vbCIsInJlc3BvbnNlIiwidG9vbENhbGxJZCIsInJldHVybk9uVG9vbENhbGwiLCJmaW5hbE1lc3NhZ2UiLCJ0cmFuc2NyaXB0Il0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/server/services/openrouter.ts\n");

/***/ }),

/***/ "(ssr)/./node_modules/.pnpm/next@15.2.2_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!*********************************************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/next@15.2.2_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \*********************************************************************************************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

"use strict";
module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("zlib");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next@15.2.2_react-dom@19.1.1_react@19.1.1__react@19.1.1","vendor-chunks/tr46@0.0.3","vendor-chunks/@supabase+auth-js@2.71.1","vendor-chunks/@supabase+realtime-js@2.15.5","vendor-chunks/@supabase+postgrest-js@1.21.4","vendor-chunks/@supabase+node-fetch@2.6.15","vendor-chunks/@supabase+storage-js@2.12.1","vendor-chunks/whatwg-url@5.0.0","vendor-chunks/@supabase+ssr@0.7.0_@supabase+supabase-js@2.57.4","vendor-chunks/@supabase+supabase-js@2.57.4","vendor-chunks/cookie@1.0.2","vendor-chunks/@supabase+functions-js@2.4.6","vendor-chunks/webidl-conversions@3.0.1"], () => (__webpack_exec__("(rsc)/./node_modules/.pnpm/next@15.2.2_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fsessions%2F%5Bid%5D%2Fchance-of-sale%2Froute&page=%2Fapi%2Fsessions%2F%5Bid%5D%2Fchance-of-sale%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsessions%2F%5Bid%5D%2Fchance-of-sale%2Froute.ts&appDir=D%3A%5CDelta%20IV%5CSofwares%5Cglass%5Csandbox%5Cshadcn-crm-dashboard%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CDelta%20IV%5CSofwares%5Cglass%5Csandbox%5Cshadcn-crm-dashboard&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();