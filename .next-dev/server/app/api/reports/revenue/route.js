/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/reports/revenue/route";
exports.ids = ["app/api/reports/revenue/route"];
exports.modules = {

/***/ "(rsc)/./node_modules/.pnpm/next@15.2.2_@playwright+test@1.57.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Freports%2Frevenue%2Froute&page=%2Fapi%2Freports%2Frevenue%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Freports%2Frevenue%2Froute.ts&appDir=D%3A%5CDelta%20IV%5CSofwares%5Cglass%5Csandbox%5Cshadcn-crm-dashboard%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CDelta%20IV%5CSofwares%5Cglass%5Csandbox%5Cshadcn-crm-dashboard&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/next@15.2.2_@playwright+test@1.57.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Freports%2Frevenue%2Froute&page=%2Fapi%2Freports%2Frevenue%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Freports%2Frevenue%2Froute.ts&appDir=D%3A%5CDelta%20IV%5CSofwares%5Cglass%5Csandbox%5Cshadcn-crm-dashboard%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CDelta%20IV%5CSofwares%5Cglass%5Csandbox%5Cshadcn-crm-dashboard&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/.pnpm/next@15.2.2_@playwright+test@1.57.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/.pnpm/next@15.2.2_@playwright+test@1.57.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/.pnpm/next@15.2.2_@playwright+test@1.57.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var D_Delta_IV_Sofwares_glass_sandbox_shadcn_crm_dashboard_src_app_api_reports_revenue_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/reports/revenue/route.ts */ \"(rsc)/./src/app/api/reports/revenue/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/reports/revenue/route\",\n        pathname: \"/api/reports/revenue\",\n        filename: \"route\",\n        bundlePath: \"app/api/reports/revenue/route\"\n    },\n    resolvedPagePath: \"D:\\\\Delta IV\\\\Sofwares\\\\glass\\\\sandbox\\\\shadcn-crm-dashboard\\\\src\\\\app\\\\api\\\\reports\\\\revenue\\\\route.ts\",\n    nextConfigOutput,\n    userland: D_Delta_IV_Sofwares_glass_sandbox_shadcn_crm_dashboard_src_app_api_reports_revenue_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbmV4dEAxNS4yLjJfQHBsYXl3cmlnaHQrdGVzdEAxLjU3LjBfcmVhY3QtZG9tQDE4LjMuMV9yZWFjdEAxOC4zLjFfX3JlYWN0QDE4LjMuMS9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIvaW5kZXguanM/bmFtZT1hcHAlMkZhcGklMkZyZXBvcnRzJTJGcmV2ZW51ZSUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGcmVwb3J0cyUyRnJldmVudWUlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZyZXBvcnRzJTJGcmV2ZW51ZSUyRnJvdXRlLnRzJmFwcERpcj1EJTNBJTVDRGVsdGElMjBJViU1Q1NvZndhcmVzJTVDZ2xhc3MlNUNzYW5kYm94JTVDc2hhZGNuLWNybS1kYXNoYm9hcmQlNUNzcmMlNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUQlM0ElNUNEZWx0YSUyMElWJTVDU29md2FyZXMlNUNnbGFzcyU1Q3NhbmRib3glNUNzaGFkY24tY3JtLWRhc2hib2FyZCZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBK0Y7QUFDdkM7QUFDcUI7QUFDdUQ7QUFDcEk7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLHlHQUFtQjtBQUMzQztBQUNBLGNBQWMsa0VBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxzREFBc0Q7QUFDOUQ7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDMEY7O0FBRTFGIiwic291cmNlcyI6WyIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIkQ6XFxcXERlbHRhIElWXFxcXFNvZndhcmVzXFxcXGdsYXNzXFxcXHNhbmRib3hcXFxcc2hhZGNuLWNybS1kYXNoYm9hcmRcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxccmVwb3J0c1xcXFxyZXZlbnVlXFxcXHJvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9yZXBvcnRzL3JldmVudWUvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9yZXBvcnRzL3JldmVudWVcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL3JlcG9ydHMvcmV2ZW51ZS9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIkQ6XFxcXERlbHRhIElWXFxcXFNvZndhcmVzXFxcXGdsYXNzXFxcXHNhbmRib3hcXFxcc2hhZGNuLWNybS1kYXNoYm9hcmRcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxccmVwb3J0c1xcXFxyZXZlbnVlXFxcXHJvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgd29ya0FzeW5jU3RvcmFnZSwgd29ya1VuaXRBc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgd29ya0FzeW5jU3RvcmFnZSxcbiAgICAgICAgd29ya1VuaXRBc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCB3b3JrQXN5bmNTdG9yYWdlLCB3b3JrVW5pdEFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/next@15.2.2_@playwright+test@1.57.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Freports%2Frevenue%2Froute&page=%2Fapi%2Freports%2Frevenue%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Freports%2Frevenue%2Froute.ts&appDir=D%3A%5CDelta%20IV%5CSofwares%5Cglass%5Csandbox%5Cshadcn-crm-dashboard%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CDelta%20IV%5CSofwares%5Cglass%5Csandbox%5Cshadcn-crm-dashboard&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/next@15.2.2_@playwright+test@1.57.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!*********************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/next@15.2.2_@playwright+test@1.57.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \*********************************************************************************************************************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(rsc)/./src/app/api/reports/revenue/route.ts":
/*!**********************************************!*\
  !*** ./src/app/api/reports/revenue/route.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   runtime: () => (/* binding */ runtime)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/.pnpm/next@15.2.2_@playwright+test@1.57.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/api/server.js\");\n/* harmony import */ var _supabase_ssr__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/ssr */ \"@supabase/ssr\");\n/* harmony import */ var _supabase_ssr__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_supabase_ssr__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/.pnpm/next@15.2.2_@playwright+test@1.57.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/api/headers.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! zod */ \"(rsc)/./node_modules/.pnpm/zod@3.25.76/node_modules/zod/v3/types.js\");\n\n\n\n\nconst runtime = 'nodejs';\nconst querySchema = zod__WEBPACK_IMPORTED_MODULE_3__.object({\n    from: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n    to: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n    groupBy: zod__WEBPACK_IMPORTED_MODULE_3__[\"enum\"]([\n        'day',\n        'week',\n        'month'\n    ]).optional().default('month')\n});\nasync function getServerClient() {\n    const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_2__.cookies)();\n    return (0,_supabase_ssr__WEBPACK_IMPORTED_MODULE_1__.createServerClient)(\"https://hewpwluinbwaizwqhmjc.supabase.co\", \"sb_publishable_F1bepvhJ6cGvjDNRfj_QfA_ZcNq0USi\", {\n        cookies: {\n            getAll () {\n                return cookieStore.getAll();\n            },\n            setAll (cookiesToSet) {\n                cookiesToSet.forEach(({ name, value, options })=>cookieStore.set(name, value, options));\n            }\n        }\n    });\n}\nfunction mergeSeries(series) {\n    const map = new Map();\n    for (const row of series || []){\n        const prev = map.get(row.period) || 0;\n        map.set(row.period, prev + (row.amount_minor || 0));\n    }\n    return Array.from(map.entries()).map(([period, amount_minor])=>({\n            period,\n            amount_minor\n        }));\n}\nasync function GET(request) {\n    try {\n        const supabase = await getServerClient();\n        const { data: { user } } = await supabase.auth.getUser();\n        if (!user) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Unauthorized'\n        }, {\n            status: 401\n        });\n        const userId = user.id;\n        const { searchParams } = new URL(request.url);\n        const parsed = querySchema.safeParse({\n            from: searchParams.get('from') || undefined,\n            to: searchParams.get('to') || undefined,\n            groupBy: searchParams.get('groupBy') || undefined\n        });\n        if (!parsed.success) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Invalid params',\n                details: parsed.error.flatten()\n            }, {\n                status: 400\n            });\n        }\n        const from = parsed.data.from || null;\n        const to = parsed.data.to || null;\n        const groupBy = parsed.data.groupBy;\n        // Helper to call RPC with safe fallback (rpc() is awaitable but may not expose .catch())\n        async function rpcSeries(name) {\n            try {\n                const res = await supabase.rpc(name, {\n                    user_id: userId,\n                    date_from: from,\n                    date_to: to,\n                    group_by: groupBy\n                });\n                return res?.data || [];\n            } catch  {\n                return [];\n            }\n        }\n        // Source series via RPC (if available) for visualization\n        const [oneSeries, schedSeries, recurSeries] = await Promise.all([\n            rpcSeries('get_onetime_invoice_revenue'),\n            rpcSeries('get_payment_schedule_revenue'),\n            rpcSeries('get_recurring_revenue')\n        ]);\n        // Build merged periods and totals in UI-expected shape\n        const allPeriods = new Set([\n            ...oneSeries.map((r)=>r.period),\n            ...schedSeries.map((r)=>r.period),\n            ...recurSeries.map((r)=>r.period)\n        ]);\n        const revenue = Array.from(allPeriods.values()).sort().map((period)=>{\n            const oneAmt = oneSeries.find((r)=>r.period === period)?.amount_minor || 0;\n            const schedAmt = schedSeries.find((r)=>r.period === period)?.amount_minor || 0;\n            const recurAmt = recurSeries.find((rw)=>rw.period === period)?.amount_minor || 0;\n            return {\n                period,\n                total_revenue_minor: oneAmt + schedAmt + recurAmt,\n                sources: {\n                    one_time_invoices: oneAmt,\n                    payment_schedules: schedAmt,\n                    recurring_revenue: recurAmt\n                }\n            };\n        });\n        // KPIs (owner-scoped); use schedule tables for realized/pending and invoices/leads for draft/potential\n        // Payment schedules realized (paid)\n        const paidSchedQuery = supabase.from('invoice_payment_schedules').select('amount_minor, invoice_line_id, invoices!inner(owner_id)').eq('invoices.owner_id', userId).eq('status', 'paid');\n        if (from) paidSchedQuery.gte('paid_at', from);\n        if (to) paidSchedQuery.lte('paid_at', to);\n        const paidSchedRes = await paidSchedQuery;\n        const paidSchedules = paidSchedRes.data || [];\n        // Recurring realized (billed)\n        const billedRecQuery = supabase.from('recurring_revenue_schedules').select('amount_minor, invoice_line_id, invoices!invoice_lines_invoice_id_fkey!inner(owner_id), invoice_lines!inner(id)').eq('invoices.owner_id', userId).eq('status', 'billed');\n        if (from) billedRecQuery.gte('billed_at', from);\n        if (to) billedRecQuery.lte('billed_at', to);\n        const billedRecRes = await billedRecQuery;\n        const billedRecurring = billedRecRes.data || [];\n        // Pending = unpaid schedules + unbilled recurring within range\n        const pendingSchedQuery = supabase.from('invoice_payment_schedules').select('amount_minor, invoice_line_id, invoices!inner(owner_id), status').eq('invoices.owner_id', userId);\n        if (from) pendingSchedQuery.gte('due_at_utc', from);\n        if (to) pendingSchedQuery.lte('due_at_utc', to);\n        const pendingSchedRes = await pendingSchedQuery;\n        const pendingSchedules = (pendingSchedRes.data || []).filter((row)=>row.status === 'pending' || row.status === 'overdue');\n        const scheduledRecQuery = supabase.from('recurring_revenue_schedules').select('amount_minor, invoice_line_id, invoices!invoice_lines_invoice_id_fkey!inner(owner_id)').eq('invoices.owner_id', user.id).eq('status', 'scheduled');\n        if (from) scheduledRecQuery.gte('billing_at_utc', from);\n        if (to) scheduledRecQuery.lte('billing_at_utc', to);\n        const scheduledRecRes = await scheduledRecQuery;\n        const scheduledRecurring = scheduledRecRes.data || [];\n        // Draft invoices (sum amount in minor)\n        const draftInvRes = await supabase.from('invoices').select('amount').eq('owner_id', userId).eq('status', 'draft');\n        const draftInvoices = draftInvRes.data || [];\n        // Lead potential (sum open leads value)\n        const leadsRes = await supabase.from('leads').select('value, status').eq('owner_id', userId).is('deleted_at', null);\n        const leads = leadsRes.data || [];\n        const openLeads = leads.filter((l)=>l.status !== 'converted' && l.status !== 'disqualified');\n        // Onetime invoices (no schedules and no recurring lines) â€” include in KPIs\n        async function sumOnetimeInvoices(statuses) {\n            let q = supabase.from('invoices').select('id, amount, status').eq('owner_id', userId);\n            if (statuses.length === 1) {\n                q = q.eq('status', statuses[0]);\n            }\n            if (from) q = q.gte('date', from);\n            if (to) q = q.lte('date', to);\n            // Filter: exclude if any schedules exist\n            const { data: invs, error: invErr } = await q;\n            if (invErr) return {\n                totalMinor: 0,\n                invoiceIds: []\n            };\n            const filtered = (invs || []).filter((i)=>statuses.includes(i.status));\n            const ids = filtered.map((i)=>i.id);\n            if (ids.length === 0) return {\n                totalMinor: 0,\n                invoiceIds: []\n            };\n            // Exclude invoices that have schedules\n            const { data: schedAny } = await supabase.from('invoice_payment_schedules').select('invoice_id').in('invoice_id', ids);\n            const withSched = new Set((schedAny || []).map((r)=>r.invoice_id));\n            const candidate = filtered.filter((i)=>!withSched.has(i.id));\n            if (candidate.length === 0) return {\n                totalMinor: 0,\n                invoiceIds: []\n            };\n            // Exclude invoices whose any line is recurring\n            const { data: recurLines } = await supabase.from('invoice_lines').select('invoice_id, product_id, products:product_id(recurring_interval)').in('invoice_id', candidate.map((c)=>c.id));\n            const recurringInvoiceIds = new Set((recurLines || []).filter((rl)=>(rl.products?.recurring_interval ?? null) !== null).map((rl)=>rl.invoice_id));\n            const final = candidate.filter((c)=>!recurringInvoiceIds.has(c.id));\n            const totalMinor = final.reduce((s, r)=>s + Math.round((r.amount || 0) * 100), 0);\n            return {\n                totalMinor,\n                invoiceIds: final.map((f)=>f.id)\n            };\n        }\n        const { totalMinor: onetimeRealizedMinor, invoiceIds: onetimeRealizedIds } = await sumOnetimeInvoices([\n            'paid'\n        ]);\n        const { totalMinor: onetimePendingMinor, invoiceIds: onetimePendingIds } = await sumOnetimeInvoices([\n            'pending',\n            'overdue',\n            'sent'\n        ]);\n        // Realized revenue total (schedules + recurring + onetime paid)\n        const realizedFromSchedules = paidSchedules.reduce((s, r)=>s + (r.amount_minor || 0), 0);\n        const realizedFromRecurring = billedRecurring.reduce((s, r)=>s + (r.amount_minor || 0), 0);\n        const realized_total_minor = realizedFromSchedules + realizedFromRecurring + onetimeRealizedMinor;\n        // Pending revenue total (unpaid + unbilled in range + onetime sent/pending/overdue)\n        const pendingFromSchedules = pendingSchedules.reduce((s, r)=>s + (r.amount_minor || 0), 0);\n        const pendingFromRecurring = scheduledRecurring.reduce((s, r)=>s + (r.amount_minor || 0), 0);\n        const pending_total_minor = pendingFromSchedules + pendingFromRecurring + onetimePendingMinor;\n        const draft_total_minor = draftInvoices.reduce((s, r)=>s + Math.round((r.amount || 0) * 100), 0);\n        const lead_potential_minor = openLeads.reduce((s, r)=>s + Math.round((r.value || 0) * 100), 0);\n        // Realized COGS & tax: pro-rate invoice_line values by realized amount per line\n        const allLineIds = Array.from(new Set([\n            ...paidSchedules.map((r)=>r.invoice_line_id).filter(Boolean),\n            ...billedRecurring.map((r)=>r.invoice_line_id).filter(Boolean),\n            ...pendingSchedules.map((r)=>r.invoice_line_id).filter(Boolean),\n            ...scheduledRecurring.map((r)=>r.invoice_line_id).filter(Boolean)\n        ]));\n        let lineMap = new Map();\n        if (allLineIds.length > 0) {\n            const lineRes = await supabase.from('invoice_lines').select('id, total_minor, cogs_minor, tax_minor').in('id', allLineIds);\n            const lines = lineRes.data || [];\n            lineMap = new Map(lines.map((l)=>[\n                    l.id,\n                    {\n                        total_minor: l.total_minor || 0,\n                        cogs_minor: l.cogs_minor || 0,\n                        tax_minor: l.tax_minor || 0\n                    }\n                ]));\n        }\n        function prorate(lineId, amountMinor, field) {\n            if (!lineId) return 0;\n            const l = lineMap.get(lineId);\n            if (!l || !l.total_minor || l.total_minor <= 0) return 0;\n            const ratio = Math.max(0, Math.min(1, amountMinor / l.total_minor));\n            const base = field === 'cogs_minor' ? l.cogs_minor || 0 : l.tax_minor || 0;\n            return Math.round(base * ratio);\n        }\n        // Add COGS and tax for onetime realized invoices (full line values)\n        let onetimeCogsMinor = 0;\n        let onetimeTaxMinor = 0;\n        if (onetimeRealizedIds.length > 0) {\n            const { data: otLines } = await supabase.from('invoice_lines').select('id, invoice_id, cogs_minor, tax_minor').in('invoice_id', onetimeRealizedIds);\n            onetimeCogsMinor = (otLines || []).reduce((s, l)=>s + (l.cogs_minor || 0), 0);\n            onetimeTaxMinor = (otLines || []).reduce((s, l)=>s + (l.tax_minor || 0), 0);\n        }\n        const realized_cogs_from_sched = paidSchedules.reduce((s, r)=>s + prorate(r.invoice_line_id, r.amount_minor || 0, 'cogs_minor'), 0);\n        const realized_cogs_from_recur = billedRecurring.reduce((s, r)=>s + prorate(r.invoice_line_id, r.amount_minor || 0, 'cogs_minor'), 0);\n        const realized_cogs_minor = realized_cogs_from_sched + realized_cogs_from_recur + onetimeCogsMinor;\n        const realized_tax_from_sched = paidSchedules.reduce((s, r)=>s + prorate(r.invoice_line_id, r.amount_minor || 0, 'tax_minor'), 0);\n        const realized_tax_from_recur = billedRecurring.reduce((s, r)=>s + prorate(r.invoice_line_id, r.amount_minor || 0, 'tax_minor'), 0);\n        const realized_tax_minor = realized_tax_from_sched + realized_tax_from_recur + onetimeTaxMinor;\n        const realized_net_revenue_minor = Math.max(0, realized_total_minor - realized_tax_minor);\n        const gross_profit_minor = realized_net_revenue_minor > 0 ? Math.max(0, realized_net_revenue_minor - realized_cogs_minor) : 0;\n        const gross_margin_percent = realized_net_revenue_minor > 0 ? gross_profit_minor * 100 / realized_net_revenue_minor : 0;\n        // Pending tax & net revenue (mirror realized breakdown, but for pending flows)\n        const pending_tax_from_sched = pendingSchedules.reduce((s, r)=>s + prorate(r.invoice_line_id, r.amount_minor || 0, 'tax_minor'), 0);\n        const pending_tax_from_recur = scheduledRecurring.reduce((s, r)=>s + prorate(r.invoice_line_id, r.amount_minor || 0, 'tax_minor'), 0);\n        let onetimePendingTaxMinor = 0;\n        if (onetimePendingIds.length > 0) {\n            const { data: pendingLines } = await supabase.from('invoice_lines').select('invoice_id, tax_minor').in('invoice_id', onetimePendingIds);\n            onetimePendingTaxMinor = (pendingLines || []).reduce((s, l)=>s + (l.tax_minor || 0), 0);\n        }\n        const pending_tax_minor = pending_tax_from_sched + pending_tax_from_recur + onetimePendingTaxMinor;\n        const pending_net_revenue_minor = Math.max(0, pending_total_minor - pending_tax_minor);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            groupBy,\n            from,\n            to,\n            revenue,\n            realized_total_minor,\n            realized_net_revenue_minor,\n            realized_tax_minor,\n            pending_total_minor,\n            pending_net_revenue_minor,\n            pending_tax_minor,\n            draft_total_minor,\n            lead_potential_minor,\n            gross_profit_minor,\n            gross_margin_percent\n        });\n    } catch (e) {\n        console.error('[reports/revenue] GET error:', e);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Internal server error'\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9yZXBvcnRzL3JldmVudWUvcm91dGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUF1RDtBQUNMO0FBQ1o7QUFDZjtBQUVoQixNQUFNSSxVQUFVLFNBQVE7QUFFL0IsTUFBTUMsY0FBY0YsdUNBQVEsQ0FBQztJQUMzQkksTUFBTUosdUNBQVEsR0FBR00sUUFBUTtJQUN6QkMsSUFBSVAsdUNBQVEsR0FBR00sUUFBUTtJQUN2QkUsU0FBU1Isd0NBQU0sQ0FBQztRQUFDO1FBQU07UUFBTztLQUFRLEVBQUVNLFFBQVEsR0FBR0ksT0FBTyxDQUFDO0FBQzdEO0FBRUEsZUFBZUM7SUFDYixNQUFNQyxjQUFjLE1BQU1iLHFEQUFPQTtJQUNqQyxPQUFPRCxpRUFBa0JBLENBQ3ZCZSwwQ0FBb0MsRUFDcENBLGdEQUF5QyxFQUN6QztRQUNFZCxTQUFTO1lBQ1BrQjtnQkFBVyxPQUFPTCxZQUFZSyxNQUFNO1lBQUc7WUFDdkNDLFFBQU9DLFlBQVk7Z0JBQUlBLGFBQWFDLE9BQU8sQ0FBQyxDQUFDLEVBQUVDLElBQUksRUFBRUMsS0FBSyxFQUFFQyxPQUFPLEVBQUUsR0FBS1gsWUFBWVksR0FBRyxDQUFDSCxNQUFNQyxPQUFPQztZQUFVO1FBQ25IO0lBQ0Y7QUFFSjtBQUVBLFNBQVNFLFlBQVlDLE1BQXVEO0lBQzFFLE1BQU1DLE1BQU0sSUFBSUM7SUFDaEIsS0FBSyxNQUFNQyxPQUFPSCxVQUFVLEVBQUUsQ0FBRTtRQUM5QixNQUFNSSxPQUFPSCxJQUFJSSxHQUFHLENBQUNGLElBQUlHLE1BQU0sS0FBSztRQUNwQ0wsSUFBSUgsR0FBRyxDQUFDSyxJQUFJRyxNQUFNLEVBQUVGLE9BQVFELENBQUFBLElBQUlJLFlBQVksSUFBSTtJQUNsRDtJQUNBLE9BQU9DLE1BQU05QixJQUFJLENBQUN1QixJQUFJUSxPQUFPLElBQUlSLEdBQUcsQ0FBQyxDQUFDLENBQUNLLFFBQVFDLGFBQWEsR0FBTTtZQUFFRDtZQUFRQztRQUFhO0FBQzNGO0FBRU8s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c1xcZ2xhc3NcXHNhbmRib3hcXHNoYWRjbi1jcm0tZGFzaGJvYXJkXFxzcmNcXGFwcFxcYXBpXFxyZXBvcnRzXFxyZXZlbnVlXFxyb3V0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInXG5pbXBvcnQgeyBjcmVhdGVTZXJ2ZXJDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3NyJ1xuaW1wb3J0IHsgY29va2llcyB9IGZyb20gJ25leHQvaGVhZGVycydcbmltcG9ydCB7IHogfSBmcm9tICd6b2QnXG5cbmV4cG9ydCBjb25zdCBydW50aW1lID0gJ25vZGVqcydcblxuY29uc3QgcXVlcnlTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIGZyb206IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgdG86IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgZ3JvdXBCeTogei5lbnVtKFsnZGF5Jywnd2VlaycsJ21vbnRoJ10pLm9wdGlvbmFsKCkuZGVmYXVsdCgnbW9udGgnKSxcbn0pXG5cbmFzeW5jIGZ1bmN0aW9uIGdldFNlcnZlckNsaWVudCgpIHtcbiAgY29uc3QgY29va2llU3RvcmUgPSBhd2FpdCBjb29raWVzKClcbiAgcmV0dXJuIGNyZWF0ZVNlcnZlckNsaWVudChcbiAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwhLFxuICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZISxcbiAgICB7XG4gICAgICBjb29raWVzOiB7XG4gICAgICAgIGdldEFsbCgpIHsgcmV0dXJuIGNvb2tpZVN0b3JlLmdldEFsbCgpIH0sXG4gICAgICAgIHNldEFsbChjb29raWVzVG9TZXQpIHsgY29va2llc1RvU2V0LmZvckVhY2goKHsgbmFtZSwgdmFsdWUsIG9wdGlvbnMgfSkgPT4gY29va2llU3RvcmUuc2V0KG5hbWUsIHZhbHVlLCBvcHRpb25zKSkgfSxcbiAgICAgIH0sXG4gICAgfVxuICApXG59XG5cbmZ1bmN0aW9uIG1lcmdlU2VyaWVzKHNlcmllczogQXJyYXk8eyBwZXJpb2Q6IHN0cmluZzsgYW1vdW50X21pbm9yOiBudW1iZXIgfT4pIHtcbiAgY29uc3QgbWFwID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKVxuICBmb3IgKGNvbnN0IHJvdyBvZiBzZXJpZXMgfHwgW10pIHtcbiAgICBjb25zdCBwcmV2ID0gbWFwLmdldChyb3cucGVyaW9kKSB8fCAwXG4gICAgbWFwLnNldChyb3cucGVyaW9kLCBwcmV2ICsgKHJvdy5hbW91bnRfbWlub3IgfHwgMCkpXG4gIH1cbiAgcmV0dXJuIEFycmF5LmZyb20obWFwLmVudHJpZXMoKSkubWFwKChbcGVyaW9kLCBhbW91bnRfbWlub3JdKSA9PiAoeyBwZXJpb2QsIGFtb3VudF9taW5vciB9KSlcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICB0cnkge1xuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgZ2V0U2VydmVyQ2xpZW50KClcbiAgICBjb25zdCB7IGRhdGE6IHsgdXNlciB9IH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKVxuICAgIGlmICghdXNlcikgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdVbmF1dGhvcml6ZWQnIH0sIHsgc3RhdHVzOiA0MDEgfSlcbiAgICBjb25zdCB1c2VySWQgPSB1c2VyIS5pZCBhcyBzdHJpbmdcblxuICAgIGNvbnN0IHsgc2VhcmNoUGFyYW1zIH0gPSBuZXcgVVJMKHJlcXVlc3QudXJsKVxuICAgIGNvbnN0IHBhcnNlZCA9IHF1ZXJ5U2NoZW1hLnNhZmVQYXJzZSh7XG4gICAgICBmcm9tOiBzZWFyY2hQYXJhbXMuZ2V0KCdmcm9tJykgfHwgdW5kZWZpbmVkLFxuICAgICAgdG86IHNlYXJjaFBhcmFtcy5nZXQoJ3RvJykgfHwgdW5kZWZpbmVkLFxuICAgICAgZ3JvdXBCeTogKHNlYXJjaFBhcmFtcy5nZXQoJ2dyb3VwQnknKSBhcyBhbnkpIHx8IHVuZGVmaW5lZCxcbiAgICB9KVxuICAgIGlmICghcGFyc2VkLnN1Y2Nlc3MpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnSW52YWxpZCBwYXJhbXMnLCBkZXRhaWxzOiBwYXJzZWQuZXJyb3IuZmxhdHRlbigpIH0sIHsgc3RhdHVzOiA0MDAgfSlcbiAgICB9XG5cbiAgICBjb25zdCBmcm9tID0gcGFyc2VkLmRhdGEuZnJvbSB8fCBudWxsXG4gICAgY29uc3QgdG8gPSBwYXJzZWQuZGF0YS50byB8fCBudWxsXG4gICAgY29uc3QgZ3JvdXBCeSA9IHBhcnNlZC5kYXRhLmdyb3VwQnlcblxuICAgIC8vIEhlbHBlciB0byBjYWxsIFJQQyB3aXRoIHNhZmUgZmFsbGJhY2sgKHJwYygpIGlzIGF3YWl0YWJsZSBidXQgbWF5IG5vdCBleHBvc2UgLmNhdGNoKCkpXG4gICAgYXN5bmMgZnVuY3Rpb24gcnBjU2VyaWVzKG5hbWU6IHN0cmluZykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgKHN1cGFiYXNlIGFzIGFueSkucnBjKG5hbWUsIHsgdXNlcl9pZDogdXNlcklkLCBkYXRlX2Zyb206IGZyb20sIGRhdGVfdG86IHRvLCBncm91cF9ieTogZ3JvdXBCeSB9KVxuICAgICAgICByZXR1cm4gKHJlcz8uZGF0YSB8fCBbXSkgYXMgQXJyYXk8eyBwZXJpb2Q6IHN0cmluZzsgYW1vdW50X21pbm9yOiBudW1iZXIgfT5cbiAgICAgIH0gY2F0Y2gge1xuICAgICAgICByZXR1cm4gW10gYXMgQXJyYXk8eyBwZXJpb2Q6IHN0cmluZzsgYW1vdW50X21pbm9yOiBudW1iZXIgfT5cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBTb3VyY2Ugc2VyaWVzIHZpYSBSUEMgKGlmIGF2YWlsYWJsZSkgZm9yIHZpc3VhbGl6YXRpb25cbiAgICBjb25zdCBbb25lU2VyaWVzLCBzY2hlZFNlcmllcywgcmVjdXJTZXJpZXNdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgcnBjU2VyaWVzKCdnZXRfb25ldGltZV9pbnZvaWNlX3JldmVudWUnKSxcbiAgICAgIHJwY1NlcmllcygnZ2V0X3BheW1lbnRfc2NoZWR1bGVfcmV2ZW51ZScpLFxuICAgICAgcnBjU2VyaWVzKCdnZXRfcmVjdXJyaW5nX3JldmVudWUnKSxcbiAgICBdKVxuXG4gICAgLy8gQnVpbGQgbWVyZ2VkIHBlcmlvZHMgYW5kIHRvdGFscyBpbiBVSS1leHBlY3RlZCBzaGFwZVxuICAgIGNvbnN0IGFsbFBlcmlvZHMgPSBuZXcgU2V0PHN0cmluZz4oW1xuICAgICAgLi4ub25lU2VyaWVzLm1hcChyID0+IHIucGVyaW9kKSxcbiAgICAgIC4uLnNjaGVkU2VyaWVzLm1hcChyID0+IHIucGVyaW9kKSxcbiAgICAgIC4uLnJlY3VyU2VyaWVzLm1hcChyID0+IHIucGVyaW9kKSxcbiAgICBdKVxuXG4gICAgY29uc3QgcmV2ZW51ZSA9IEFycmF5LmZyb20oYWxsUGVyaW9kcy52YWx1ZXMoKSkuc29ydCgpLm1hcChwZXJpb2QgPT4ge1xuICAgICAgY29uc3Qgb25lQW10ID0gb25lU2VyaWVzLmZpbmQociA9PiByLnBlcmlvZCA9PT0gcGVyaW9kKT8uYW1vdW50X21pbm9yIHx8IDBcbiAgICAgIGNvbnN0IHNjaGVkQW10ID0gc2NoZWRTZXJpZXMuZmluZChyID0+IHIucGVyaW9kID09PSBwZXJpb2QpPy5hbW91bnRfbWlub3IgfHwgMFxuICAgICAgY29uc3QgcmVjdXJBbXQgPSByZWN1clNlcmllcy5maW5kKHJ3ID0+IHJ3LnBlcmlvZCA9PT0gcGVyaW9kKT8uYW1vdW50X21pbm9yIHx8IDBcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHBlcmlvZCxcbiAgICAgICAgdG90YWxfcmV2ZW51ZV9taW5vcjogb25lQW10ICsgc2NoZWRBbXQgKyByZWN1ckFtdCxcbiAgICAgICAgc291cmNlczoge1xuICAgICAgICAgIG9uZV90aW1lX2ludm9pY2VzOiBvbmVBbXQsXG4gICAgICAgICAgcGF5bWVudF9zY2hlZHVsZXM6IHNjaGVkQW10LFxuICAgICAgICAgIHJlY3VycmluZ19yZXZlbnVlOiByZWN1ckFtdCxcbiAgICAgICAgfSxcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgLy8gS1BJcyAob3duZXItc2NvcGVkKTsgdXNlIHNjaGVkdWxlIHRhYmxlcyBmb3IgcmVhbGl6ZWQvcGVuZGluZyBhbmQgaW52b2ljZXMvbGVhZHMgZm9yIGRyYWZ0L3BvdGVudGlhbFxuICAgIC8vIFBheW1lbnQgc2NoZWR1bGVzIHJlYWxpemVkIChwYWlkKVxuICAgIGNvbnN0IHBhaWRTY2hlZFF1ZXJ5ID0gKHN1cGFiYXNlIGFzIGFueSlcbiAgICAgIC5mcm9tKCdpbnZvaWNlX3BheW1lbnRfc2NoZWR1bGVzJylcbiAgICAgIC5zZWxlY3QoJ2Ftb3VudF9taW5vciwgaW52b2ljZV9saW5lX2lkLCBpbnZvaWNlcyFpbm5lcihvd25lcl9pZCknKVxuICAgICAgLmVxKCdpbnZvaWNlcy5vd25lcl9pZCcsIHVzZXJJZClcbiAgICAgIC5lcSgnc3RhdHVzJywgJ3BhaWQnKVxuICAgIGlmIChmcm9tKSBwYWlkU2NoZWRRdWVyeS5ndGUoJ3BhaWRfYXQnLCBmcm9tKVxuICAgIGlmICh0bykgcGFpZFNjaGVkUXVlcnkubHRlKCdwYWlkX2F0JywgdG8pXG4gICAgY29uc3QgcGFpZFNjaGVkUmVzID0gYXdhaXQgcGFpZFNjaGVkUXVlcnlcbiAgICBjb25zdCBwYWlkU2NoZWR1bGVzID0gKHBhaWRTY2hlZFJlcy5kYXRhIHx8IFtdKSBhcyBBcnJheTx7IGFtb3VudF9taW5vcjogbnVtYmVyOyBpbnZvaWNlX2xpbmVfaWQ6IHN0cmluZyB8IG51bGwgfT5cblxuICAgIC8vIFJlY3VycmluZyByZWFsaXplZCAoYmlsbGVkKVxuICAgIGNvbnN0IGJpbGxlZFJlY1F1ZXJ5ID0gKHN1cGFiYXNlIGFzIGFueSlcbiAgICAgIC5mcm9tKCdyZWN1cnJpbmdfcmV2ZW51ZV9zY2hlZHVsZXMnKVxuICAgICAgLnNlbGVjdCgnYW1vdW50X21pbm9yLCBpbnZvaWNlX2xpbmVfaWQsIGludm9pY2VzIWludm9pY2VfbGluZXNfaW52b2ljZV9pZF9ma2V5IWlubmVyKG93bmVyX2lkKSwgaW52b2ljZV9saW5lcyFpbm5lcihpZCknKVxuICAgICAgLmVxKCdpbnZvaWNlcy5vd25lcl9pZCcsIHVzZXJJZClcbiAgICAgIC5lcSgnc3RhdHVzJywgJ2JpbGxlZCcpXG4gICAgaWYgKGZyb20pIGJpbGxlZFJlY1F1ZXJ5Lmd0ZSgnYmlsbGVkX2F0JywgZnJvbSlcbiAgICBpZiAodG8pIGJpbGxlZFJlY1F1ZXJ5Lmx0ZSgnYmlsbGVkX2F0JywgdG8pXG4gICAgY29uc3QgYmlsbGVkUmVjUmVzID0gYXdhaXQgYmlsbGVkUmVjUXVlcnlcbiAgICBjb25zdCBiaWxsZWRSZWN1cnJpbmcgPSAoYmlsbGVkUmVjUmVzLmRhdGEgfHwgW10pIGFzIEFycmF5PHsgYW1vdW50X21pbm9yOiBudW1iZXI7IGludm9pY2VfbGluZV9pZDogc3RyaW5nIH0+XG5cbiAgICAvLyBQZW5kaW5nID0gdW5wYWlkIHNjaGVkdWxlcyArIHVuYmlsbGVkIHJlY3VycmluZyB3aXRoaW4gcmFuZ2VcbiAgICBjb25zdCBwZW5kaW5nU2NoZWRRdWVyeSA9IChzdXBhYmFzZSBhcyBhbnkpXG4gICAgICAuZnJvbSgnaW52b2ljZV9wYXltZW50X3NjaGVkdWxlcycpXG4gICAgICAuc2VsZWN0KCdhbW91bnRfbWlub3IsIGludm9pY2VfbGluZV9pZCwgaW52b2ljZXMhaW5uZXIob3duZXJfaWQpLCBzdGF0dXMnKVxuICAgICAgLmVxKCdpbnZvaWNlcy5vd25lcl9pZCcsIHVzZXJJZClcbiAgICBpZiAoZnJvbSkgcGVuZGluZ1NjaGVkUXVlcnkuZ3RlKCdkdWVfYXRfdXRjJywgZnJvbSlcbiAgICBpZiAodG8pIHBlbmRpbmdTY2hlZFF1ZXJ5Lmx0ZSgnZHVlX2F0X3V0YycsIHRvKVxuICAgIGNvbnN0IHBlbmRpbmdTY2hlZFJlcyA9IGF3YWl0IHBlbmRpbmdTY2hlZFF1ZXJ5XG4gICAgY29uc3QgcGVuZGluZ1NjaGVkdWxlcyA9ICgocGVuZGluZ1NjaGVkUmVzLmRhdGEgfHwgW10pIGFzIEFycmF5PHtcbiAgICAgIGFtb3VudF9taW5vcjogbnVtYmVyXG4gICAgICBpbnZvaWNlX2xpbmVfaWQ6IHN0cmluZyB8IG51bGxcbiAgICAgIHN0YXR1czogc3RyaW5nXG4gICAgfT4pLmZpbHRlcihyb3cgPT4gcm93LnN0YXR1cyA9PT0gJ3BlbmRpbmcnIHx8IHJvdy5zdGF0dXMgPT09ICdvdmVyZHVlJylcblxuICAgIGNvbnN0IHNjaGVkdWxlZFJlY1F1ZXJ5ID0gKHN1cGFiYXNlIGFzIGFueSlcbiAgICAgIC5mcm9tKCdyZWN1cnJpbmdfcmV2ZW51ZV9zY2hlZHVsZXMnKVxuICAgICAgLnNlbGVjdCgnYW1vdW50X21pbm9yLCBpbnZvaWNlX2xpbmVfaWQsIGludm9pY2VzIWludm9pY2VfbGluZXNfaW52b2ljZV9pZF9ma2V5IWlubmVyKG93bmVyX2lkKScpXG4gICAgICAuZXEoJ2ludm9pY2VzLm93bmVyX2lkJywgdXNlci5pZClcbiAgICAgIC5lcSgnc3RhdHVzJywgJ3NjaGVkdWxlZCcpXG4gICAgaWYgKGZyb20pIHNjaGVkdWxlZFJlY1F1ZXJ5Lmd0ZSgnYmlsbGluZ19hdF91dGMnLCBmcm9tKVxuICAgIGlmICh0bykgc2NoZWR1bGVkUmVjUXVlcnkubHRlKCdiaWxsaW5nX2F0X3V0YycsIHRvKVxuICAgIGNvbnN0IHNjaGVkdWxlZFJlY1JlcyA9IGF3YWl0IHNjaGVkdWxlZFJlY1F1ZXJ5XG4gICAgY29uc3Qgc2NoZWR1bGVkUmVjdXJyaW5nID0gKHNjaGVkdWxlZFJlY1Jlcy5kYXRhIHx8IFtdKSBhcyBBcnJheTx7XG4gICAgICBhbW91bnRfbWlub3I6IG51bWJlclxuICAgICAgaW52b2ljZV9saW5lX2lkOiBzdHJpbmdcbiAgICB9PlxuXG4gICAgLy8gRHJhZnQgaW52b2ljZXMgKHN1bSBhbW91bnQgaW4gbWlub3IpXG4gICAgY29uc3QgZHJhZnRJbnZSZXMgPSBhd2FpdCAoc3VwYWJhc2UgYXMgYW55KVxuICAgICAgLmZyb20oJ2ludm9pY2VzJylcbiAgICAgIC5zZWxlY3QoJ2Ftb3VudCcpXG4gICAgICAuZXEoJ293bmVyX2lkJywgdXNlcklkKVxuICAgICAgLmVxKCdzdGF0dXMnLCAnZHJhZnQnKVxuICAgIGNvbnN0IGRyYWZ0SW52b2ljZXMgPSAoZHJhZnRJbnZSZXMuZGF0YSB8fCBbXSkgYXMgQXJyYXk8eyBhbW91bnQ6IG51bWJlciB9PlxuXG4gICAgLy8gTGVhZCBwb3RlbnRpYWwgKHN1bSBvcGVuIGxlYWRzIHZhbHVlKVxuICAgIGNvbnN0IGxlYWRzUmVzID0gYXdhaXQgKHN1cGFiYXNlIGFzIGFueSlcbiAgICAgIC5mcm9tKCdsZWFkcycpXG4gICAgICAuc2VsZWN0KCd2YWx1ZSwgc3RhdHVzJylcbiAgICAgIC5lcSgnb3duZXJfaWQnLCB1c2VySWQpXG4gICAgICAuaXMoJ2RlbGV0ZWRfYXQnLCBudWxsKVxuICAgIGNvbnN0IGxlYWRzID0gKGxlYWRzUmVzLmRhdGEgfHwgW10pIGFzIEFycmF5PHsgdmFsdWU6IG51bWJlcjsgc3RhdHVzOiBzdHJpbmcgfT5cbiAgICBjb25zdCBvcGVuTGVhZHMgPSBsZWFkcy5maWx0ZXIobCA9PiBsLnN0YXR1cyAhPT0gJ2NvbnZlcnRlZCcgJiYgbC5zdGF0dXMgIT09ICdkaXNxdWFsaWZpZWQnKVxuXG4gICAgLy8gT25ldGltZSBpbnZvaWNlcyAobm8gc2NoZWR1bGVzIGFuZCBubyByZWN1cnJpbmcgbGluZXMpIOKAlCBpbmNsdWRlIGluIEtQSXNcbiAgICBhc3luYyBmdW5jdGlvbiBzdW1PbmV0aW1lSW52b2ljZXMoc3RhdHVzZXM6IHN0cmluZ1tdKSB7XG4gICAgICBsZXQgcSA9IChzdXBhYmFzZSBhcyBhbnkpXG4gICAgICAgIC5mcm9tKCdpbnZvaWNlcycpXG4gICAgICAgIC5zZWxlY3QoJ2lkLCBhbW91bnQsIHN0YXR1cycpXG4gICAgICAgIC5lcSgnb3duZXJfaWQnLCB1c2VySWQpXG4gICAgICBpZiAoc3RhdHVzZXMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIHEgPSBxLmVxKCdzdGF0dXMnLCBzdGF0dXNlc1swXSlcbiAgICAgIH1cbiAgICAgIGlmIChmcm9tKSBxID0gcS5ndGUoJ2RhdGUnLCBmcm9tKVxuICAgICAgaWYgKHRvKSBxID0gcS5sdGUoJ2RhdGUnLCB0bylcbiAgICAgIC8vIEZpbHRlcjogZXhjbHVkZSBpZiBhbnkgc2NoZWR1bGVzIGV4aXN0XG4gICAgICBjb25zdCB7IGRhdGE6IGludnMsIGVycm9yOiBpbnZFcnIgfSA9IGF3YWl0IHFcbiAgICAgIGlmIChpbnZFcnIpIHJldHVybiB7IHRvdGFsTWlub3I6IDAsIGludm9pY2VJZHM6IFtdIGFzIHN0cmluZ1tdIH1cbiAgICAgIGNvbnN0IGZpbHRlcmVkID0gKGludnMgfHwgW10pLmZpbHRlcigoaTogYW55KSA9PiBzdGF0dXNlcy5pbmNsdWRlcyhpLnN0YXR1cykpXG4gICAgICBjb25zdCBpZHMgPSBmaWx0ZXJlZC5tYXAoKGk6IGFueSkgPT4gaS5pZClcbiAgICAgIGlmIChpZHMubGVuZ3RoID09PSAwKSByZXR1cm4geyB0b3RhbE1pbm9yOiAwLCBpbnZvaWNlSWRzOiBbXSBhcyBzdHJpbmdbXSB9XG4gICAgICAvLyBFeGNsdWRlIGludm9pY2VzIHRoYXQgaGF2ZSBzY2hlZHVsZXNcbiAgICAgIGNvbnN0IHsgZGF0YTogc2NoZWRBbnkgfSA9IGF3YWl0IChzdXBhYmFzZSBhcyBhbnkpXG4gICAgICAgIC5mcm9tKCdpbnZvaWNlX3BheW1lbnRfc2NoZWR1bGVzJylcbiAgICAgICAgLnNlbGVjdCgnaW52b2ljZV9pZCcpXG4gICAgICAgIC5pbignaW52b2ljZV9pZCcsIGlkcylcbiAgICAgIGNvbnN0IHdpdGhTY2hlZCA9IG5ldyBTZXQoKHNjaGVkQW55IHx8IFtdKS5tYXAoKHI6IGFueSkgPT4gci5pbnZvaWNlX2lkKSlcbiAgICAgIGNvbnN0IGNhbmRpZGF0ZSA9IGZpbHRlcmVkLmZpbHRlcigoaTogYW55KSA9PiAhd2l0aFNjaGVkLmhhcyhpLmlkKSlcbiAgICAgIGlmIChjYW5kaWRhdGUubGVuZ3RoID09PSAwKSByZXR1cm4geyB0b3RhbE1pbm9yOiAwLCBpbnZvaWNlSWRzOiBbXSBhcyBzdHJpbmdbXSB9XG4gICAgICAvLyBFeGNsdWRlIGludm9pY2VzIHdob3NlIGFueSBsaW5lIGlzIHJlY3VycmluZ1xuICAgICAgY29uc3QgeyBkYXRhOiByZWN1ckxpbmVzIH0gPSBhd2FpdCAoc3VwYWJhc2UgYXMgYW55KVxuICAgICAgICAuZnJvbSgnaW52b2ljZV9saW5lcycpXG4gICAgICAgIC5zZWxlY3QoJ2ludm9pY2VfaWQsIHByb2R1Y3RfaWQsIHByb2R1Y3RzOnByb2R1Y3RfaWQocmVjdXJyaW5nX2ludGVydmFsKScpXG4gICAgICAgIC5pbignaW52b2ljZV9pZCcsIGNhbmRpZGF0ZS5tYXAoKGM6IGFueSkgPT4gYy5pZCkpXG4gICAgICBjb25zdCByZWN1cnJpbmdJbnZvaWNlSWRzID0gbmV3IFNldCgocmVjdXJMaW5lcyB8fCBbXSkuZmlsdGVyKChybDogYW55KSA9PiAocmwucHJvZHVjdHM/LnJlY3VycmluZ19pbnRlcnZhbCA/PyBudWxsKSAhPT0gbnVsbCkubWFwKChybDogYW55KSA9PiBybC5pbnZvaWNlX2lkKSlcbiAgICAgIGNvbnN0IGZpbmFsID0gY2FuZGlkYXRlLmZpbHRlcigoYzogYW55KSA9PiAhcmVjdXJyaW5nSW52b2ljZUlkcy5oYXMoYy5pZCkpXG4gICAgICBjb25zdCB0b3RhbE1pbm9yID0gZmluYWwucmVkdWNlKChzOiBudW1iZXIsIHI6IGFueSkgPT4gcyArIE1hdGgucm91bmQoKHIuYW1vdW50IHx8IDApICogMTAwKSwgMClcbiAgICAgIHJldHVybiB7IHRvdGFsTWlub3IsIGludm9pY2VJZHM6IGZpbmFsLm1hcCgoZjogYW55KSA9PiBmLmlkIGFzIHN0cmluZykgfVxuICAgIH1cblxuICAgIGNvbnN0IHsgdG90YWxNaW5vcjogb25ldGltZVJlYWxpemVkTWlub3IsIGludm9pY2VJZHM6IG9uZXRpbWVSZWFsaXplZElkcyB9ID0gYXdhaXQgc3VtT25ldGltZUludm9pY2VzKFsncGFpZCddKVxuICAgIGNvbnN0IHsgdG90YWxNaW5vcjogb25ldGltZVBlbmRpbmdNaW5vciwgaW52b2ljZUlkczogb25ldGltZVBlbmRpbmdJZHMgfSA9IGF3YWl0IHN1bU9uZXRpbWVJbnZvaWNlcyhbJ3BlbmRpbmcnLCdvdmVyZHVlJywnc2VudCddKVxuXG4gICAgLy8gUmVhbGl6ZWQgcmV2ZW51ZSB0b3RhbCAoc2NoZWR1bGVzICsgcmVjdXJyaW5nICsgb25ldGltZSBwYWlkKVxuICAgIGNvbnN0IHJlYWxpemVkRnJvbVNjaGVkdWxlcyA9IHBhaWRTY2hlZHVsZXMucmVkdWNlKChzLCByKSA9PiBzICsgKHIuYW1vdW50X21pbm9yIHx8IDApLCAwKVxuICAgIGNvbnN0IHJlYWxpemVkRnJvbVJlY3VycmluZyA9IGJpbGxlZFJlY3VycmluZy5yZWR1Y2UoKHMsIHIpID0+IHMgKyAoci5hbW91bnRfbWlub3IgfHwgMCksIDApXG4gICAgY29uc3QgcmVhbGl6ZWRfdG90YWxfbWlub3IgPSByZWFsaXplZEZyb21TY2hlZHVsZXMgKyByZWFsaXplZEZyb21SZWN1cnJpbmcgKyBvbmV0aW1lUmVhbGl6ZWRNaW5vclxuXG4gICAgLy8gUGVuZGluZyByZXZlbnVlIHRvdGFsICh1bnBhaWQgKyB1bmJpbGxlZCBpbiByYW5nZSArIG9uZXRpbWUgc2VudC9wZW5kaW5nL292ZXJkdWUpXG4gICAgY29uc3QgcGVuZGluZ0Zyb21TY2hlZHVsZXMgPSBwZW5kaW5nU2NoZWR1bGVzLnJlZHVjZSgocywgcikgPT4gcyArIChyLmFtb3VudF9taW5vciB8fCAwKSwgMClcbiAgICBjb25zdCBwZW5kaW5nRnJvbVJlY3VycmluZyA9IHNjaGVkdWxlZFJlY3VycmluZy5yZWR1Y2UoKHMsIHIpID0+IHMgKyAoci5hbW91bnRfbWlub3IgfHwgMCksIDApXG4gICAgY29uc3QgcGVuZGluZ190b3RhbF9taW5vciA9IHBlbmRpbmdGcm9tU2NoZWR1bGVzICsgcGVuZGluZ0Zyb21SZWN1cnJpbmcgKyBvbmV0aW1lUGVuZGluZ01pbm9yXG5cbiAgICBjb25zdCBkcmFmdF90b3RhbF9taW5vciA9IGRyYWZ0SW52b2ljZXMucmVkdWNlKChzLCByKSA9PiBzICsgTWF0aC5yb3VuZCgoci5hbW91bnQgfHwgMCkgKiAxMDApLCAwKVxuICAgIGNvbnN0IGxlYWRfcG90ZW50aWFsX21pbm9yID0gb3BlbkxlYWRzLnJlZHVjZSgocywgcikgPT4gcyArIE1hdGgucm91bmQoKHIudmFsdWUgfHwgMCkgKiAxMDApLCAwKVxuXG4gICAgLy8gUmVhbGl6ZWQgQ09HUyAmIHRheDogcHJvLXJhdGUgaW52b2ljZV9saW5lIHZhbHVlcyBieSByZWFsaXplZCBhbW91bnQgcGVyIGxpbmVcbiAgICBjb25zdCBhbGxMaW5lSWRzID0gQXJyYXkuZnJvbShcbiAgICAgIG5ldyBTZXQoW1xuICAgICAgICAuLi5wYWlkU2NoZWR1bGVzLm1hcChyID0+IHIuaW52b2ljZV9saW5lX2lkKS5maWx0ZXIoQm9vbGVhbikgYXMgc3RyaW5nW10sXG4gICAgICAgIC4uLmJpbGxlZFJlY3VycmluZy5tYXAociA9PiByLmludm9pY2VfbGluZV9pZCkuZmlsdGVyKEJvb2xlYW4pIGFzIHN0cmluZ1tdLFxuICAgICAgICAuLi5wZW5kaW5nU2NoZWR1bGVzLm1hcChyID0+IHIuaW52b2ljZV9saW5lX2lkKS5maWx0ZXIoQm9vbGVhbikgYXMgc3RyaW5nW10sXG4gICAgICAgIC4uLnNjaGVkdWxlZFJlY3VycmluZy5tYXAociA9PiByLmludm9pY2VfbGluZV9pZCkuZmlsdGVyKEJvb2xlYW4pIGFzIHN0cmluZ1tdLFxuICAgICAgXSksXG4gICAgKVxuXG4gICAgdHlwZSBMaW5lQWdnID0geyB0b3RhbF9taW5vcjogbnVtYmVyOyBjb2dzX21pbm9yOiBudW1iZXI7IHRheF9taW5vcjogbnVtYmVyIH1cbiAgICBsZXQgbGluZU1hcCA9IG5ldyBNYXA8c3RyaW5nLCBMaW5lQWdnPigpXG4gICAgaWYgKGFsbExpbmVJZHMubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgbGluZVJlcyA9IGF3YWl0IChzdXBhYmFzZSBhcyBhbnkpXG4gICAgICAgIC5mcm9tKCdpbnZvaWNlX2xpbmVzJylcbiAgICAgICAgLnNlbGVjdCgnaWQsIHRvdGFsX21pbm9yLCBjb2dzX21pbm9yLCB0YXhfbWlub3InKVxuICAgICAgICAuaW4oJ2lkJywgYWxsTGluZUlkcylcbiAgICAgIGNvbnN0IGxpbmVzID0gKGxpbmVSZXMuZGF0YSB8fCBbXSkgYXMgQXJyYXk8eyBpZDogc3RyaW5nOyB0b3RhbF9taW5vcjogbnVtYmVyOyBjb2dzX21pbm9yOiBudW1iZXI7IHRheF9taW5vcjogbnVtYmVyIH0+XG4gICAgICBsaW5lTWFwID0gbmV3IE1hcChcbiAgICAgICAgbGluZXMubWFwKGwgPT4gW1xuICAgICAgICAgIGwuaWQsXG4gICAgICAgICAge1xuICAgICAgICAgICAgdG90YWxfbWlub3I6IGwudG90YWxfbWlub3IgfHwgMCxcbiAgICAgICAgICAgIGNvZ3NfbWlub3I6IGwuY29nc19taW5vciB8fCAwLFxuICAgICAgICAgICAgdGF4X21pbm9yOiBsLnRheF9taW5vciB8fCAwLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0pLFxuICAgICAgKVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHByb3JhdGUobGluZUlkOiBzdHJpbmcgfCBudWxsIHwgdW5kZWZpbmVkLCBhbW91bnRNaW5vcjogbnVtYmVyLCBmaWVsZDogJ2NvZ3NfbWlub3InIHwgJ3RheF9taW5vcicpOiBudW1iZXIge1xuICAgICAgaWYgKCFsaW5lSWQpIHJldHVybiAwXG4gICAgICBjb25zdCBsID0gbGluZU1hcC5nZXQobGluZUlkKVxuICAgICAgaWYgKCFsIHx8ICFsLnRvdGFsX21pbm9yIHx8IGwudG90YWxfbWlub3IgPD0gMCkgcmV0dXJuIDBcbiAgICAgIGNvbnN0IHJhdGlvID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oMSwgYW1vdW50TWlub3IgLyBsLnRvdGFsX21pbm9yKSlcbiAgICAgIGNvbnN0IGJhc2UgPSBmaWVsZCA9PT0gJ2NvZ3NfbWlub3InID8gKGwuY29nc19taW5vciB8fCAwKSA6IChsLnRheF9taW5vciB8fCAwKVxuICAgICAgcmV0dXJuIE1hdGgucm91bmQoYmFzZSAqIHJhdGlvKVxuICAgIH1cblxuICAgIC8vIEFkZCBDT0dTIGFuZCB0YXggZm9yIG9uZXRpbWUgcmVhbGl6ZWQgaW52b2ljZXMgKGZ1bGwgbGluZSB2YWx1ZXMpXG4gICAgbGV0IG9uZXRpbWVDb2dzTWlub3IgPSAwXG4gICAgbGV0IG9uZXRpbWVUYXhNaW5vciA9IDBcbiAgICBpZiAob25ldGltZVJlYWxpemVkSWRzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IHsgZGF0YTogb3RMaW5lcyB9ID0gYXdhaXQgKHN1cGFiYXNlIGFzIGFueSlcbiAgICAgICAgLmZyb20oJ2ludm9pY2VfbGluZXMnKVxuICAgICAgICAuc2VsZWN0KCdpZCwgaW52b2ljZV9pZCwgY29nc19taW5vciwgdGF4X21pbm9yJylcbiAgICAgICAgLmluKCdpbnZvaWNlX2lkJywgb25ldGltZVJlYWxpemVkSWRzKVxuICAgICAgb25ldGltZUNvZ3NNaW5vciA9IChvdExpbmVzIHx8IFtdKS5yZWR1Y2UoKHM6IG51bWJlciwgbDogYW55KSA9PiBzICsgKGwuY29nc19taW5vciB8fCAwKSwgMClcbiAgICAgIG9uZXRpbWVUYXhNaW5vciA9IChvdExpbmVzIHx8IFtdKS5yZWR1Y2UoKHM6IG51bWJlciwgbDogYW55KSA9PiBzICsgKGwudGF4X21pbm9yIHx8IDApLCAwKVxuICAgIH1cbiAgICBjb25zdCByZWFsaXplZF9jb2dzX2Zyb21fc2NoZWQgPSBwYWlkU2NoZWR1bGVzLnJlZHVjZShcbiAgICAgIChzLCByKSA9PiBzICsgcHJvcmF0ZShyLmludm9pY2VfbGluZV9pZCwgci5hbW91bnRfbWlub3IgfHwgMCwgJ2NvZ3NfbWlub3InKSxcbiAgICAgIDAsXG4gICAgKVxuICAgIGNvbnN0IHJlYWxpemVkX2NvZ3NfZnJvbV9yZWN1ciA9IGJpbGxlZFJlY3VycmluZy5yZWR1Y2UoXG4gICAgICAocywgcikgPT4gcyArIHByb3JhdGUoci5pbnZvaWNlX2xpbmVfaWQsIHIuYW1vdW50X21pbm9yIHx8IDAsICdjb2dzX21pbm9yJyksXG4gICAgICAwLFxuICAgIClcbiAgICBjb25zdCByZWFsaXplZF9jb2dzX21pbm9yID0gcmVhbGl6ZWRfY29nc19mcm9tX3NjaGVkICsgcmVhbGl6ZWRfY29nc19mcm9tX3JlY3VyICsgb25ldGltZUNvZ3NNaW5vclxuXG4gICAgY29uc3QgcmVhbGl6ZWRfdGF4X2Zyb21fc2NoZWQgPSBwYWlkU2NoZWR1bGVzLnJlZHVjZShcbiAgICAgIChzLCByKSA9PiBzICsgcHJvcmF0ZShyLmludm9pY2VfbGluZV9pZCwgci5hbW91bnRfbWlub3IgfHwgMCwgJ3RheF9taW5vcicpLFxuICAgICAgMCxcbiAgICApXG4gICAgY29uc3QgcmVhbGl6ZWRfdGF4X2Zyb21fcmVjdXIgPSBiaWxsZWRSZWN1cnJpbmcucmVkdWNlKFxuICAgICAgKHMsIHIpID0+IHMgKyBwcm9yYXRlKHIuaW52b2ljZV9saW5lX2lkLCByLmFtb3VudF9taW5vciB8fCAwLCAndGF4X21pbm9yJyksXG4gICAgICAwLFxuICAgIClcbiAgICBjb25zdCByZWFsaXplZF90YXhfbWlub3IgPSByZWFsaXplZF90YXhfZnJvbV9zY2hlZCArIHJlYWxpemVkX3RheF9mcm9tX3JlY3VyICsgb25ldGltZVRheE1pbm9yXG5cbiAgICBjb25zdCByZWFsaXplZF9uZXRfcmV2ZW51ZV9taW5vciA9IE1hdGgubWF4KDAsIHJlYWxpemVkX3RvdGFsX21pbm9yIC0gcmVhbGl6ZWRfdGF4X21pbm9yKVxuICAgIGNvbnN0IGdyb3NzX3Byb2ZpdF9taW5vciA9XG4gICAgICByZWFsaXplZF9uZXRfcmV2ZW51ZV9taW5vciA+IDAgPyBNYXRoLm1heCgwLCByZWFsaXplZF9uZXRfcmV2ZW51ZV9taW5vciAtIHJlYWxpemVkX2NvZ3NfbWlub3IpIDogMFxuICAgIGNvbnN0IGdyb3NzX21hcmdpbl9wZXJjZW50ID1cbiAgICAgIHJlYWxpemVkX25ldF9yZXZlbnVlX21pbm9yID4gMCA/IChncm9zc19wcm9maXRfbWlub3IgKiAxMDApIC8gcmVhbGl6ZWRfbmV0X3JldmVudWVfbWlub3IgOiAwXG5cbiAgICAvLyBQZW5kaW5nIHRheCAmIG5ldCByZXZlbnVlIChtaXJyb3IgcmVhbGl6ZWQgYnJlYWtkb3duLCBidXQgZm9yIHBlbmRpbmcgZmxvd3MpXG4gICAgY29uc3QgcGVuZGluZ190YXhfZnJvbV9zY2hlZCA9IHBlbmRpbmdTY2hlZHVsZXMucmVkdWNlKFxuICAgICAgKHMsIHIpID0+IHMgKyBwcm9yYXRlKHIuaW52b2ljZV9saW5lX2lkLCByLmFtb3VudF9taW5vciB8fCAwLCAndGF4X21pbm9yJyksXG4gICAgICAwLFxuICAgIClcbiAgICBjb25zdCBwZW5kaW5nX3RheF9mcm9tX3JlY3VyID0gc2NoZWR1bGVkUmVjdXJyaW5nLnJlZHVjZShcbiAgICAgIChzLCByKSA9PiBzICsgcHJvcmF0ZShyLmludm9pY2VfbGluZV9pZCwgci5hbW91bnRfbWlub3IgfHwgMCwgJ3RheF9taW5vcicpLFxuICAgICAgMCxcbiAgICApXG5cbiAgICBsZXQgb25ldGltZVBlbmRpbmdUYXhNaW5vciA9IDBcbiAgICBpZiAob25ldGltZVBlbmRpbmdJZHMubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgeyBkYXRhOiBwZW5kaW5nTGluZXMgfSA9IGF3YWl0IChzdXBhYmFzZSBhcyBhbnkpXG4gICAgICAgIC5mcm9tKCdpbnZvaWNlX2xpbmVzJylcbiAgICAgICAgLnNlbGVjdCgnaW52b2ljZV9pZCwgdGF4X21pbm9yJylcbiAgICAgICAgLmluKCdpbnZvaWNlX2lkJywgb25ldGltZVBlbmRpbmdJZHMpXG4gICAgICBvbmV0aW1lUGVuZGluZ1RheE1pbm9yID0gKHBlbmRpbmdMaW5lcyB8fCBbXSkucmVkdWNlKFxuICAgICAgICAoczogbnVtYmVyLCBsOiBhbnkpID0+IHMgKyAobC50YXhfbWlub3IgfHwgMCksXG4gICAgICAgIDAsXG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgcGVuZGluZ190YXhfbWlub3IgPSBwZW5kaW5nX3RheF9mcm9tX3NjaGVkICsgcGVuZGluZ190YXhfZnJvbV9yZWN1ciArIG9uZXRpbWVQZW5kaW5nVGF4TWlub3JcbiAgICBjb25zdCBwZW5kaW5nX25ldF9yZXZlbnVlX21pbm9yID0gTWF0aC5tYXgoMCwgcGVuZGluZ190b3RhbF9taW5vciAtIHBlbmRpbmdfdGF4X21pbm9yKVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIGdyb3VwQnksXG4gICAgICBmcm9tLFxuICAgICAgdG8sXG4gICAgICByZXZlbnVlLFxuICAgICAgcmVhbGl6ZWRfdG90YWxfbWlub3IsXG4gICAgICByZWFsaXplZF9uZXRfcmV2ZW51ZV9taW5vcixcbiAgICAgIHJlYWxpemVkX3RheF9taW5vcixcbiAgICAgIHBlbmRpbmdfdG90YWxfbWlub3IsXG4gICAgICBwZW5kaW5nX25ldF9yZXZlbnVlX21pbm9yLFxuICAgICAgcGVuZGluZ190YXhfbWlub3IsXG4gICAgICBkcmFmdF90b3RhbF9taW5vcixcbiAgICAgIGxlYWRfcG90ZW50aWFsX21pbm9yLFxuICAgICAgZ3Jvc3NfcHJvZml0X21pbm9yLFxuICAgICAgZ3Jvc3NfbWFyZ2luX3BlcmNlbnQsXG4gICAgfSlcbiAgfSBjYXRjaCAoZTogYW55KSB7XG4gICAgY29uc29sZS5lcnJvcignW3JlcG9ydHMvcmV2ZW51ZV0gR0VUIGVycm9yOicsIGUpXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InIH0sIHsgc3RhdHVzOiA1MDAgfSlcbiAgfVxufVxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImNyZWF0ZVNlcnZlckNsaWVudCIsImNvb2tpZXMiLCJ6IiwicnVudGltZSIsInF1ZXJ5U2NoZW1hIiwib2JqZWN0IiwiZnJvbSIsInN0cmluZyIsIm9wdGlvbmFsIiwidG8iLCJncm91cEJ5IiwiZW51bSIsImRlZmF1bHQiLCJnZXRTZXJ2ZXJDbGllbnQiLCJjb29raWVTdG9yZSIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsImdldEFsbCIsInNldEFsbCIsImNvb2tpZXNUb1NldCIsImZvckVhY2giLCJuYW1lIiwidmFsdWUiLCJvcHRpb25zIiwic2V0IiwibWVyZ2VTZXJpZXMiLCJzZXJpZXMiLCJtYXAiLCJNYXAiLCJyb3ciLCJwcmV2IiwiZ2V0IiwicGVyaW9kIiwiYW1vdW50X21pbm9yIiwiQXJyYXkiLCJlbnRyaWVzIiwiR0VUIiwicmVxdWVzdCIsInN1cGFiYXNlIiwiZGF0YSIsInVzZXIiLCJhdXRoIiwiZ2V0VXNlciIsImpzb24iLCJlcnJvciIsInN0YXR1cyIsInVzZXJJZCIsImlkIiwic2VhcmNoUGFyYW1zIiwiVVJMIiwidXJsIiwicGFyc2VkIiwic2FmZVBhcnNlIiwidW5kZWZpbmVkIiwic3VjY2VzcyIsImRldGFpbHMiLCJmbGF0dGVuIiwicnBjU2VyaWVzIiwicmVzIiwicnBjIiwidXNlcl9pZCIsImRhdGVfZnJvbSIsImRhdGVfdG8iLCJncm91cF9ieSIsIm9uZVNlcmllcyIsInNjaGVkU2VyaWVzIiwicmVjdXJTZXJpZXMiLCJQcm9taXNlIiwiYWxsIiwiYWxsUGVyaW9kcyIsIlNldCIsInIiLCJyZXZlbnVlIiwidmFsdWVzIiwic29ydCIsIm9uZUFtdCIsImZpbmQiLCJzY2hlZEFtdCIsInJlY3VyQW10IiwicnciLCJ0b3RhbF9yZXZlbnVlX21pbm9yIiwic291cmNlcyIsIm9uZV90aW1lX2ludm9pY2VzIiwicGF5bWVudF9zY2hlZHVsZXMiLCJyZWN1cnJpbmdfcmV2ZW51ZSIsInBhaWRTY2hlZFF1ZXJ5Iiwic2VsZWN0IiwiZXEiLCJndGUiLCJsdGUiLCJwYWlkU2NoZWRSZXMiLCJwYWlkU2NoZWR1bGVzIiwiYmlsbGVkUmVjUXVlcnkiLCJiaWxsZWRSZWNSZXMiLCJiaWxsZWRSZWN1cnJpbmciLCJwZW5kaW5nU2NoZWRRdWVyeSIsInBlbmRpbmdTY2hlZFJlcyIsInBlbmRpbmdTY2hlZHVsZXMiLCJmaWx0ZXIiLCJzY2hlZHVsZWRSZWNRdWVyeSIsInNjaGVkdWxlZFJlY1JlcyIsInNjaGVkdWxlZFJlY3VycmluZyIsImRyYWZ0SW52UmVzIiwiZHJhZnRJbnZvaWNlcyIsImxlYWRzUmVzIiwiaXMiLCJsZWFkcyIsIm9wZW5MZWFkcyIsImwiLCJzdW1PbmV0aW1lSW52b2ljZXMiLCJzdGF0dXNlcyIsInEiLCJsZW5ndGgiLCJpbnZzIiwiaW52RXJyIiwidG90YWxNaW5vciIsImludm9pY2VJZHMiLCJmaWx0ZXJlZCIsImkiLCJpbmNsdWRlcyIsImlkcyIsInNjaGVkQW55IiwiaW4iLCJ3aXRoU2NoZWQiLCJpbnZvaWNlX2lkIiwiY2FuZGlkYXRlIiwiaGFzIiwicmVjdXJMaW5lcyIsImMiLCJyZWN1cnJpbmdJbnZvaWNlSWRzIiwicmwiLCJwcm9kdWN0cyIsInJlY3VycmluZ19pbnRlcnZhbCIsImZpbmFsIiwicmVkdWNlIiwicyIsIk1hdGgiLCJyb3VuZCIsImFtb3VudCIsImYiLCJvbmV0aW1lUmVhbGl6ZWRNaW5vciIsIm9uZXRpbWVSZWFsaXplZElkcyIsIm9uZXRpbWVQZW5kaW5nTWlub3IiLCJvbmV0aW1lUGVuZGluZ0lkcyIsInJlYWxpemVkRnJvbVNjaGVkdWxlcyIsInJlYWxpemVkRnJvbVJlY3VycmluZyIsInJlYWxpemVkX3RvdGFsX21pbm9yIiwicGVuZGluZ0Zyb21TY2hlZHVsZXMiLCJwZW5kaW5nRnJvbVJlY3VycmluZyIsInBlbmRpbmdfdG90YWxfbWlub3IiLCJkcmFmdF90b3RhbF9taW5vciIsImxlYWRfcG90ZW50aWFsX21pbm9yIiwiYWxsTGluZUlkcyIsImludm9pY2VfbGluZV9pZCIsIkJvb2xlYW4iLCJsaW5lTWFwIiwibGluZVJlcyIsImxpbmVzIiwidG90YWxfbWlub3IiLCJjb2dzX21pbm9yIiwidGF4X21pbm9yIiwicHJvcmF0ZSIsImxpbmVJZCIsImFtb3VudE1pbm9yIiwiZmllbGQiLCJyYXRpbyIsIm1heCIsIm1pbiIsImJhc2UiLCJvbmV0aW1lQ29nc01pbm9yIiwib25ldGltZVRheE1pbm9yIiwib3RMaW5lcyIsInJlYWxpemVkX2NvZ3NfZnJvbV9zY2hlZCIsInJlYWxpemVkX2NvZ3NfZnJvbV9yZWN1ciIsInJlYWxpemVkX2NvZ3NfbWlub3IiLCJyZWFsaXplZF90YXhfZnJvbV9zY2hlZCIsInJlYWxpemVkX3RheF9mcm9tX3JlY3VyIiwicmVhbGl6ZWRfdGF4X21pbm9yIiwicmVhbGl6ZWRfbmV0X3JldmVudWVfbWlub3IiLCJncm9zc19wcm9maXRfbWlub3IiLCJncm9zc19tYXJnaW5fcGVyY2VudCIsInBlbmRpbmdfdGF4X2Zyb21fc2NoZWQiLCJwZW5kaW5nX3RheF9mcm9tX3JlY3VyIiwib25ldGltZVBlbmRpbmdUYXhNaW5vciIsInBlbmRpbmdMaW5lcyIsInBlbmRpbmdfdGF4X21pbm9yIiwicGVuZGluZ19uZXRfcmV2ZW51ZV9taW5vciIsImUiLCJjb25zb2xlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/reports/revenue/route.ts\n");

/***/ }),

/***/ "(ssr)/./node_modules/.pnpm/next@15.2.2_@playwright+test@1.57.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!*********************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/next@15.2.2_@playwright+test@1.57.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \*********************************************************************************************************************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "@supabase/ssr":
/*!********************************!*\
  !*** external "@supabase/ssr" ***!
  \********************************/
/***/ ((module) => {

"use strict";
module.exports = require("@supabase/ssr");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next@15.2.2_@playwright+test@1.57.0_react-dom@18.3.1_react@18.3.1__react@18.3.1","vendor-chunks/zod@3.25.76"], () => (__webpack_exec__("(rsc)/./node_modules/.pnpm/next@15.2.2_@playwright+test@1.57.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Freports%2Frevenue%2Froute&page=%2Fapi%2Freports%2Frevenue%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Freports%2Frevenue%2Froute.ts&appDir=D%3A%5CDelta%20IV%5CSofwares%5Cglass%5Csandbox%5Cshadcn-crm-dashboard%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CDelta%20IV%5CSofwares%5Cglass%5Csandbox%5Cshadcn-crm-dashboard&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();